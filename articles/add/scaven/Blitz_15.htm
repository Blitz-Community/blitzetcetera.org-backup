<html><head><link rel=stylesheet href="scaven.css" Type=Text/css><meta http-equiv=Content-Type content="text/html; charset=windows-1251"><title> Blitz3D Туториал</title></head><body id=t1><div id=t2><table id=t3> <tr id=t22> <td id=t23> <p id=t51>15. Первая 3Д игра. Часть 5 – оптимизация кода</p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Но это ещё не всё… Дальше мы возьмём готовые куски кода, и создадим из них функции… (вот где всё самое клёвое-то начинается </span><span id=t10><span id=t11>J</span></span><span id=t9>!!!)</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Для начала предлагаю сделать функцию, создающую кубики. Назовём её, например, </span><span id=t43>CreateWalls</span><span id=t43>(</span><span id=t43>t</span><span id=t43>n)</span><span id=t9>, в скобки которой будем указывать, сколько кубиков нам надо создать! (Вот для чего нам нужны были списки </span><span id=t10><span id=t11>J</span></span><span id=t9>)…</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Функции (как вы помните) нужно вставлять в конце кода, после команды </span><span id=t43>End</span><span id=t9>. Как мы её сделаем? Да просто вырежем весь кусок кода, в котором мы создаём кубики и стены, и засунем в функцию (поменяв заодно цифру 29 на </span><span id=t43>tn</span><span id=t9> – переменную, в которой будет содержаться число, введённое в функцию):</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t62>Function </span><span id=t64>CreateWalls</span><span id=t63>(</span><span id=t64>tn</span><span id=t63>)</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span>For </span><span id=t64>i</span><span id=t63>=</span><span id=t65>0 </span><span id=t62>To </span><span id=t64>tn</span><span id=t65></span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t64>w</span><span id=t63>.</span><span id=t64>Walls</span><span id=t63> = </span><span id=t62>New</span><span id=t63> </span><span id=t64>Walls</span><span id=t63></span></p> <p id=t27><span id=t64><span id=t15>  </span>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>=</span><span id=t62>CreateCube</span><span id=t63>()</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>Repeat<span id=t15>  </span></span></p> <p id=t27><span id=t62><span id=t15>   </span>PositionEntity </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t62>Rnd</span><span id=t63>(-</span><span id=t65>40</span><span id=t63>,</span><span id=t65>40</span><span id=t63>),</span><span id=t65>0</span><span id=t63>,</span><span id=t62>Rnd</span><span id=t63>(-</span><span id=t65>40</span><span id=t63>,</span><span id=t65>40</span><span id=t63>)</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>Until Abs</span><span id=t63>(</span><span id=t62>EntityX</span><span id=t63>(</span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>))&gt;</span><span id=t65>10 </span><span id=t62>Or Abs</span><span id=t63>(</span><span id=t62>EntityZ</span><span id=t63>(</span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>))&gt;</span><span id=t65>10</span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t62>EntityType </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>, </span><span id=t64>TypeWalls</span></p> <p id=t27><span id=t64><span id=t15>  </span></span><span id=t62>EntityColor </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>255</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t62><span id=t15> </span>Next</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t64><span id=t15> </span>w</span><span id=t63>.</span><span id=t64>Walls</span><span id=t63> = </span><span id=t62>New</span><span id=t63> </span><span id=t64>Walls</span><span id=t63></span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>=</span><span id=t62>CreateCube</span><span id=t63>()</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>EntityColor </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>100</span><span id=t63>,</span><span id=t65>20</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t62>EntityType </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t64>TypeWalls</span></p> <p id=t27><span id=t62><span id=t15> </span>PositionEntity </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,-</span><span id=t65>50</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span><span id=t63></span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>FitMesh </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,-</span><span id=t65>50</span><span id=t63>,</span><span id=t65>2</span><span id=t63>,</span><span id=t65>3</span><span id=t63>,</span><span id=t65>100</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t64><span id=t15> </span>w</span><span id=t63>.</span><span id=t64>Walls</span><span id=t63> = </span><span id=t62>New</span><span id=t63> </span><span id=t64>Walls</span><span id=t63></span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>=</span><span id=t62>CreateCube</span><span id=t63>()</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>EntityColor </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>100</span><span id=t63>,</span><span id=t65>20</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t62>EntityType </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t64>TypeWalls</span></p> <p id=t27><span id=t62><span id=t15> </span>PositionEntity </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>50</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span><span id=t63></span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>FitMesh </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,-</span><span id=t65>50</span><span id=t63>,</span><span id=t65>2</span><span id=t63>,</span><span id=t65>3</span><span id=t63>,</span><span id=t65>100</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t64><span id=t15> </span>w</span><span id=t63>.</span><span id=t64>Walls</span><span id=t63> = </span><span id=t62>New</span><span id=t63> </span><span id=t64>Walls</span><span id=t63></span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>=</span><span id=t62>CreateCube</span><span id=t63>()</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>EntityColor </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>100</span><span id=t63>,</span><span id=t65>20</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t62>EntityType </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t64>TypeWalls</span></p> <p id=t27><span id=t62><span id=t15> </span>PositionEntity </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,-</span><span id=t65>50</span><span id=t63></span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>FitMesh </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,-</span><span id=t65>50</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,</span><span id=t65>100</span><span id=t63>,</span><span id=t65>3</span><span id=t63>,</span><span id=t65>2</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t64><span id=t15> </span>w</span><span id=t63>.</span><span id=t64>Walls</span><span id=t63> = </span><span id=t62>New</span><span id=t63> </span><span id=t64>Walls</span><span id=t63></span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>=</span><span id=t62>CreateCube</span><span id=t63>()</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>EntityColor </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>100</span><span id=t63>,</span><span id=t65>20</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t62>EntityType </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t64>TypeWalls</span></p> <p id=t27><span id=t62><span id=t15> </span>PositionEntity </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>50</span><span id=t63></span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>FitMesh </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,-</span><span id=t65>50</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,</span><span id=t65>100</span><span id=t63>,</span><span id=t65>3</span><span id=t63>,</span><span id=t65>2</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t48><span id=t62>End Function</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>… а вместо него напишем:</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t48><span id=t64>CreateWalls</span><span id=t63>(</span><span id=t65>29</span><span id=t63>)</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Дальше предлагаю создать функцию для того, чтобы ставить цилиндр в случайное место и заодно проверять его – вырежем то, что у нас в главном цикле, где цилиндр устанавливается в случайное место, и проверяется его пересечение с кубиками:</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t62>Function </span><span id=t64>PositionTarget</span><span id=t63>()</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t62>Repeat </span></p> <p id=t27><span id=t62><span id=t15>  </span></span><span id=t64>inter</span><span id=t63>=</span><span id=t62>False</span></p> <p id=t27><span id=t62><span id=t15>  </span>PositionEntity </span><span id=t64>Target</span><span id=t63>,</span><span id=t62>Rnd</span><span id=t63>(-</span><span id=t65>40</span><span id=t63>,</span><span id=t65>40</span><span id=t63>),</span><span id=t65>0</span><span id=t63>,</span><span id=t62>Rnd</span><span id=t63>(-</span><span id=t65>40</span><span id=t63>,</span><span id=t65>40</span><span id=t63>)</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>For </span><span id=t64>w</span><span id=t63>.</span><span id=t64>Walls</span><span id=t63> = </span><span id=t62>Each</span><span id=t63> </span><span id=t64>Walls</span><span id=t63></span></p> <p id=t27><span id=t65><span id=t15>   </span></span><span id=t62>If MeshesIntersect</span><span id=t63>(</span><span id=t64>Target</span><span id=t63>, </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>) </span><span id=t64>inter</span><span id=t63>=</span><span id=t62>True</span></p> <p id=t27><span id=t62><span id=t15>  </span>Next</span></p> <p id=t27><span id=t62><span id=t15> </span>Until </span><span id=t64>inter</span><span id=t63>=</span><span id=t62>False</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t48><span id=t62>End</span><span id=t63> </span><span id=t62>Function</span><span id=t63> </span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Ну а вместо этого куска кода вставим вызов этой функции – т.е. так:</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t62>If EntityCollided </span><span id=t63>(</span><span id=t64>Player</span><span id=t63>,</span><span id=t64>TypeTarget</span><span id=t63>)</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t64>PositionTarget</span><span id=t63>()</span></p> <p id=t27><span id=t62><span id=t15> </span>UpdateWorld</span></p> <p id=t27><span id=t62><span id=t15> </span></span><span id=t64>Score</span><span id=t63>=</span><span id=t64>Score</span><span id=t63>+</span><span id=t65>1 </span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t64>Speed</span><span id=t63>=</span><span id=t64>Speed</span><span id=t63>+.</span><span id=t65>01</span></p> <p id=t48><span id=t62>EndIf</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Заодно, заменим строчку в самом начале, когда мы создаём цилиндр:</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t48><span id=t62>PositionEntity </span><span id=t64>Target</span><span id=t63>,</span><span id=t62>Rnd</span><span id=t63>(-</span><span id=t65>40</span><span id=t63>,</span><span id=t65>40</span><span id=t63>),</span><span id=t65>0</span><span id=t63>,</span><span id=t62>Rnd</span><span id=t63>(-</span><span id=t65>40</span><span id=t63>,</span><span id=t65>40</span><span id=t63>)</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>…на:</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t48><span id=t64>PositionTarget</span><span id=t63>()</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>(а то я забыл в самом начале указать проверку на пересечение с кубиками, и получалось так, что в самом начале цилиндр мог находиться наполовину в кубе </span><span id=t10><span id=t11>J</span></span><span id=t9>)</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Так продолжим нашу вырезательную деятельность…</span></p> <p id=t8><span id=t9>Теперь засунем в функцию команды создания игрока</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t62>Function </span><span id=t64>CreatePlayer</span><span id=t63>()</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t64><span id=t15> </span>Player</span><span id=t63>=</span><span id=t62>CreateSphere</span><span id=t63>()</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t64><span id=t15> </span>Plac</span><span id=t63>=</span><span id=t62>CreateCone</span><span id=t63>(</span><span id=t65>8</span><span id=t63>)</span></p> <p id=t27><span id=t62><span id=t15> </span>RotateMesh </span><span id=t64>Plac</span><span id=t63>,-</span><span id=t65>90</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0 </span></p> <p id=t27><span id=t62><span id=t15> </span>ScaleMesh </span><span id=t64>Plac</span><span id=t63>,</span><span id=t65>1</span><span id=t63>,</span><span id=t65>1</span><span id=t63>,</span><span id=t65>1</span><span id=t63>.</span><span id=t65>2</span></p> <p id=t27><span id=t62><span id=t15> </span>PositionMesh </span><span id=t64>Plac</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>.</span><span id=t65>5</span></p> <p id=t27><span id=t62><span id=t15> </span>AddMesh </span><span id=t64>Plac</span><span id=t63>,</span><span id=t64>Player</span></p> <p id=t27><span id=t62><span id=t15> </span>EntityType </span><span id=t64>Player</span><span id=t63>, </span><span id=t64>TypePlayer</span></p> <p id=t27><span id=t62><span id=t15> </span>EntityColor </span><span id=t64>Player</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>255</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span>FreeEntity </span><span id=t64>Plac</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t48><span id=t62>End</span><span id=t62> </span><span id=t62>Function</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>А наверху у нас останется:</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t62>Global </span><span id=t64>Player</span><span id=t63></span></p> <p id=t48><span id=t64>CreatePlayer</span><span id=t63>()</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Также сделаем функцию для создания цилиндра</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t62>Function </span><span id=t64>CreateTarget</span><span id=t63>()</span></p> <p id=t27><span id=t64>&nbsp;</span></p> <p id=t27><span id=t64><span id=t15> </span>Target</span><span id=t63>=</span><span id=t62>CreateCylinder</span><span id=t63>()</span></p> <p id=t27><span id=t64><span id=t15> </span>PositionTarget</span><span id=t63>()</span></p> <p id=t27><span id=t62><span id=t15> </span>EntityColor </span><span id=t64>Target</span><span id=t63>,</span><span id=t65>255</span><span id=t63>,</span><span id=t65>215</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15> </span></span></p> <p id=t27><span id=t62><span id=t15> </span>EntityType </span><span id=t64>Target</span><span id=t63>,</span><span id=t64>TypeTarget</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t48><span id=t62>End Function</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Ну, а наверху, мы напишем… </span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t62>Global</span><span id=t64> Target</span></p> <p id=t48><span id=t64>CreateTarget</span><span id=t63>()</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Не забудьте обозначить переменную </span><span id=t43>Target</span><span id=t9> как </span><span id=t43>Global</span><span id=t9> </span><span id=t9>– иначе функция не «увидит» её…</span></p> <p id=t8><span id=t9>И функцию для создания камеры и света</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t62>Function </span><span id=t64>CreateEnv</span><span id=t63>()</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t64><span id=t15> </span>cam</span><span id=t63>=</span><span id=t62>CreateCamera</span><span id=t63>()</span></p> <p id=t27><span id=t62><span id=t15> </span>PositionEntity </span><span id=t64>cam</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>40</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t62><span id=t15> </span>TurnEntity </span><span id=t64>cam</span><span id=t63>,</span><span id=t65>90</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t64><span id=t15> </span>lit</span><span id=t63>=</span><span id=t62>CreateLight</span><span id=t63>()</span></p> <p id=t27><span id=t62><span id=t15> </span>TurnEntity </span><span id=t64>lit</span><span id=t63>,</span><span id=t65>70</span><span id=t63>,</span><span id=t65>70</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t48><span id=t62>End</span><span id=t65> </span><span id=t62>Function</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Ну, и наверху, не забыв обозначить переменные </span><span id=t43>cam</span><span id=t9> </span><span id=t9>и </span><span id=t43>lit</span><span id=t9> как </span><span id=t43>Global</span><span id=t9>, напишем</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t62>Global</span><span id=t64> cam</span></p> <p id=t27><span id=t62>Global</span><span id=t64> lit</span></p> <p id=t48><span id=t64>CreateEnv</span><span id=t63>()</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Теперь, возьмём все команды в главном цикле (кроме команды </span><span id=t43>Flip</span><span id=t9>), и сделаем из них… правильно Функцию! А как вы догадались? </span><span id=t10><span id=t11>J</span></span><span id=t9>…</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t62>Function </span><span id=t64>UpdateGame</span><span id=t63>()</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span>MoveEntity </span><span id=t64>Player</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t64>Speed</span><span id=t63>#</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t62>If KeyDown</span><span id=t63>(</span><span id=t65>203</span><span id=t63>) </span><span id=t62>TurnEntity </span><span id=t64>Player</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>3</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t62>If KeyDown</span><span id=t63>(</span><span id=t65>205</span><span id=t63>) </span><span id=t62>TurnEntity </span><span id=t64>Player</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,-</span><span id=t65>3</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15> </span></span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t62>PointEntity </span><span id=t64>cam</span><span id=t63>,</span><span id=t64>Player </span></p> <p id=t27><span id=t64>&nbsp;</span></p> <p id=t27><span id=t64><span id=t15> </span></span><span id=t62>If EntityCollided </span><span id=t63>(</span><span id=t64>Player</span><span id=t63>,</span><span id=t64>TypeTarget</span><span id=t63>)</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t64>PositionTarget</span><span id=t63>()</span></p> <p id=t27><span id=t62><span id=t15>  </span>UpdateWorld</span></p> <p id=t27><span id=t62><span id=t15>  </span></span><span id=t64>Score</span><span id=t63>=</span><span id=t64>Score</span><span id=t63>+</span><span id=t65>1 </span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t64>Speed</span><span id=t63>=</span><span id=t64>Speed</span><span id=t63>+.</span><span id=t65>01</span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t62>EndIf</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span>If EntityCollided </span><span id=t63>(</span><span id=t64>Player</span><span id=t63>,</span><span id=t64>TypeWalls</span><span id=t63>) </span><span id=t62>End</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span>UpdateWorld</span></p> <p id=t27><span id=t62><span id=t15> </span>RenderWorld</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span>Color </span><span id=t65>255</span><span id=t63>,</span><span id=t65>215</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t62>Text </span><span id=t65>320</span><span id=t63>,</span><span id=t65>10</span><span id=t63>,</span><span id=t66>&quot;Score : &quot;</span><span id=t63>+</span><span id=t64>Score</span><span id=t63>,</span><span id=t62>True</span><span id=t63>,</span><span id=t62>True</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t48><span id=t62>End Function</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>И весь главный цикл у нас будет представлять:</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t62>Repeat</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span></span><span id=t64>UpdateGame</span><span id=t63>() </span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span>Flip</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t48><span id=t62>Until KeyHit</span><span id=t63>(</span><span id=t65>1</span><span id=t63>)</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>А команды инициализации после некоторой оптимизации и расставления по местам будут выглядеть так:</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t62>SeedRnd MilliSecs</span><span id=t63>()</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t62>Type</span><span id=t63> </span><span id=t64>Walls</span><span id=t63></span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t62>Field</span><span id=t63> </span><span id=t64>model</span><span id=t63></span></p> <p id=t27><span id=t62>End</span><span id=t63> </span><span id=t62>Type</span><span id=t63></span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t62>Const </span><span id=t64>TypePlayer</span><span id=t63>=</span><span id=t65>1</span><span id=t63>,</span><span id=t64>TypeWalls</span><span id=t63>=</span><span id=t65>2</span><span id=t63>,</span><span id=t64>TypeTarget</span><span id=t63>=</span><span id=t65>3</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t62>Global </span><span id=t64>Speed</span><span id=t63>#=.</span><span id=t65>1</span><span id=t63>,</span><span id=t64>Score</span><span id=t63>=</span><span id=t65>0</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t62>Global </span><span id=t64>Player</span><span id=t63></span></p> <p id=t27><span id=t62>Global</span><span id=t64> Target</span></p> <p id=t27><span id=t62>Global</span><span id=t64> cam</span></p> <p id=t27><span id=t62>Global</span><span id=t64> lit</span></p> <p id=t27><span id=t64>&nbsp;</span></p> <p id=t27><span id=t62>Graphics3D </span><span id=t65>640</span><span id=t63>,</span><span id=t65>480</span><span id=t63>,</span><span id=t65>16</span><span id=t63>,</span><span id=t65>1</span></p> <p id=t27><span id=t62>SetBuffer BackBuffer</span><span id=t63>()</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t64>CreatePlayer</span><span id=t63>()</span></p> <p id=t27><span id=t64>CreateWalls</span><span id=t63>(</span><span id=t65>29</span><span id=t63>)</span></p> <p id=t27><span id=t64>CreateTarget</span><span id=t63>()</span></p> <p id=t27><span id=t64>CreateEnv</span><span id=t63>()</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t62>Collisions </span><span id=t64>TypePlayer</span><span id=t63>,</span><span id=t64>TypeWalls</span><span id=t63>,</span><span id=t65>2</span><span id=t63>,</span><span id=t65>2</span></p> <p id=t48><span id=t62>Collisions </span><span id=t64>TypePlayer</span><span id=t63>,</span><span id=t64>TypeTarget</span><span id=t63>,</span><span id=t65>2</span><span id=t63>,</span><span id=t65>2</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>И последнюю функцию мы создадим сами. Она будет очистит из памяти все объекты которые мы тут создавали…</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t62>Function </span><span id=t64>FreeGame</span><span id=t63>()</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62>ClearCollisions</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span>FreeEntity</span><span id=t64> cam</span><span id=t62></span></p> <p id=t27><span id=t62><span id=t15> </span>FreeEntity </span><span id=t64>lit</span><span id=t62></span></p> <p id=t27><span id=t62><span id=t15> </span>FreeEntity </span><span id=t64>Player</span><span id=t62></span></p> <p id=t27><span id=t62><span id=t15> </span>FreeEntity </span><span id=t64>Target</span><span id=t62></span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span>For </span><span id=t64>w</span><span id=t63>.</span><span id=t64>Walls</span><span id=t63>=</span><span id=t62>Each </span><span id=t64>Walls</span><span id=t62></span></p> <p id=t27><span id=t62><span id=t15>  </span>FreeEntity </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63></span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>Delete</span><span id=t63> </span><span id=t64>w</span><span id=t63></span></p> <p id=t27><span id=t62><span id=t15> </span>Next</span><span id=t63></span></p> <p id=t27><span id=t69>&nbsp;</span></p> <p id=t27><span id=t64><span id=t15> </span>Speed</span><span id=t63>#=.</span><span id=t65>1</span><span id=t63></span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t64>Score</span><span id=t63>=</span><span id=t65>0</span><span id=t63></span></p> <p id=t27><span id=t69>&nbsp;</span></p> <p id=t48><span id=t62>End</span><span id=t62> </span><span id=t62>Function</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Обратите внимание на то, как удаляются списки. Сначала удаляются все объекты, занимающие память, а потом указатель на элемент списка… ну, понятно, короче </span><span id=t10><span id=t11>J</span></span><span id=t9>…</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>И заодно вызовем эту функцию как раз перед командой </span><span id=t43>End</span><span id=t9>. (ну это надеюсь сами сделаете)</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Вот так выглядит наш код после оптимизации, (или офункциации </span><span id=t10><span id=t11>J</span></span><span id=t9>):</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t62>SeedRnd MilliSecs</span><span id=t63>()</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t62>Type </span><span id=t64>Walls</span></p> <p id=t27><span id=t64><span id=t15> </span></span><span id=t62>Field </span><span id=t64>model</span></p> <p id=t27><span id=t62>End Type</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62>Const </span><span id=t64>TypePlayer</span><span id=t63>=</span><span id=t65>1</span><span id=t63>,</span><span id=t64>TypeWalls</span><span id=t63>=</span><span id=t65>2</span><span id=t63>,</span><span id=t64>TypeTarget</span><span id=t63>=</span><span id=t65>3</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t62>Global </span><span id=t64>Speed</span><span id=t63>#=.</span><span id=t65>1</span><span id=t63>,</span><span id=t64>Score</span><span id=t63>=</span><span id=t65>0</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t62>Global </span><span id=t64>Player</span></p> <p id=t27><span id=t62>Global </span><span id=t64>Target</span></p> <p id=t27><span id=t62>Global </span><span id=t64>cam</span></p> <p id=t27><span id=t62>Global </span><span id=t64>lit</span></p> <p id=t27><span id=t64>&nbsp;</span></p> <p id=t27><span id=t62>Graphics3D </span><span id=t65>640</span><span id=t63>,</span><span id=t65>480</span><span id=t63>,</span><span id=t65>16</span><span id=t63>,</span><span id=t65>1</span></p> <p id=t27><span id=t62>SetBuffer BackBuffer</span><span id=t63>()</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t64>CreatePlayer</span><span id=t63>()</span></p> <p id=t27><span id=t64>CreateWalls</span><span id=t63>(</span><span id=t65>29</span><span id=t63>)</span></p> <p id=t27><span id=t64>CreateTarget</span><span id=t63>()</span></p> <p id=t27><span id=t64>CreateEnv</span><span id=t63>()</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t62>Collisions </span><span id=t64>TypePlayer</span><span id=t63>,</span><span id=t64>TypeWalls</span><span id=t63>,</span><span id=t65>2</span><span id=t63>,</span><span id=t65>2</span></p> <p id=t27><span id=t62>Collisions </span><span id=t64>TypePlayer</span><span id=t63>,</span><span id=t64>TypeTarget</span><span id=t63>,</span><span id=t65>2</span><span id=t63>,</span><span id=t65>2</span></p> <p id=t27><span id=t65><span id=t15> </span></span></p> <p id=t27><span id=t70>;*******************</span></p> <p id=t27><span id=t70>;Main Cycle</span></p> <p id=t27><span id=t70>;*******************</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t62>Repeat</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span></span><span id=t64>UpdateGame</span><span id=t63>()</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t62>Flip</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62>Until KeyHit</span><span id=t63>(</span><span id=t65>1</span><span id=t63>)</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t64>FreeGame</span><span id=t63>()</span></p> <p id=t27><span id=t62>End</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t70>;*******************</span></p> <p id=t27><span id=t70>;Functions</span></p> <p id=t27><span id=t70>;*******************</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62>Function </span><span id=t64>CreateWalls</span><span id=t63>(</span><span id=t64>tn</span><span id=t63>)</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t62>For </span><span id=t64>i</span><span id=t63>=</span><span id=t65>0 </span><span id=t62>To </span><span id=t64>tn</span></p> <p id=t27><span id=t64><span id=t15>  </span>w</span><span id=t63>.</span><span id=t64>Walls </span><span id=t63>= </span><span id=t62>New </span><span id=t64>Walls</span></p> <p id=t27><span id=t64><span id=t15>  </span>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>=</span><span id=t62>CreateCube</span><span id=t63>()</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>Repeat<span id=t15>  </span></span></p> <p id=t27><span id=t62><span id=t15>   </span>PositionEntity </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t62>Rnd</span><span id=t63>(-</span><span id=t65>40</span><span id=t63>,</span><span id=t65>40</span><span id=t63>),</span><span id=t65>0</span><span id=t63>,</span><span id=t62>Rnd</span><span id=t63>(-</span><span id=t65>40</span><span id=t63>,</span><span id=t65>40</span><span id=t63>)</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>Until Abs</span><span id=t63>(</span><span id=t62>EntityX</span><span id=t63>(</span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>))&gt;</span><span id=t65>10 </span><span id=t62>Or Abs</span><span id=t63>(</span><span id=t62>EntityZ</span><span id=t63>(</span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>))&gt;</span><span id=t65>10</span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t62>EntityType </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>, </span><span id=t64>TypeWalls</span></p> <p id=t27><span id=t64><span id=t15>  </span></span><span id=t62>EntityColor </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>255</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t62>Next</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span></span><span id=t64>w</span><span id=t63>.</span><span id=t64>Walls </span><span id=t63>= </span><span id=t62>New </span><span id=t64>Walls</span></p> <p id=t27><span id=t64><span id=t15>  </span>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>=</span><span id=t62>CreateCube</span><span id=t63>()</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>EntityColor </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>100</span><span id=t63>,</span><span id=t65>20</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t62>EntityType </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t64>TypeWalls</span></p> <p id=t27><span id=t64><span id=t15> </span></span><span id=t62>PositionEntity </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,-</span><span id=t65>50</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t62>FitMesh </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,-</span><span id=t65>50</span><span id=t63>,</span><span id=t65>2</span><span id=t63>,</span><span id=t65>3</span><span id=t63>,</span><span id=t65>100</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t64>w</span><span id=t63>.</span><span id=t64>Walls </span><span id=t63>= </span><span id=t62>New </span><span id=t64>Walls</span></p> <p id=t27><span id=t64><span id=t15>  </span>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>=</span><span id=t62>CreateCube</span><span id=t63>()</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>EntityColor </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>100</span><span id=t63>,</span><span id=t65>20</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t62>EntityType </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t64>TypeWalls</span></p> <p id=t27><span id=t64><span id=t15> </span></span><span id=t62>PositionEntity </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>50</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t62>FitMesh </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,-</span><span id=t65>50</span><span id=t63>,</span><span id=t65>2</span><span id=t63>,</span><span id=t65>3</span><span id=t63>,</span><span id=t65>100</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t64>w</span><span id=t63>.</span><span id=t64>Walls </span><span id=t63>= </span><span id=t62>New </span><span id=t64>Walls</span></p> <p id=t27><span id=t64><span id=t15>  </span>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>=</span><span id=t62>CreateCube</span><span id=t63>()</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>EntityColor </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>100</span><span id=t63>,</span><span id=t65>20</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t62>EntityType </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t64>TypeWalls</span></p> <p id=t27><span id=t64><span id=t15> </span></span><span id=t62>PositionEntity </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,-</span><span id=t65>50</span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t62>FitMesh </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,-</span><span id=t65>50</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,</span><span id=t65>100</span><span id=t63>,</span><span id=t65>3</span><span id=t63>,</span><span id=t65>2</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t64>w</span><span id=t63>.</span><span id=t64>Walls </span><span id=t63>= </span><span id=t62>New </span><span id=t64>Walls</span></p> <p id=t27><span id=t64><span id=t15>  </span>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>=</span><span id=t62>CreateCube</span><span id=t63>()</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>EntityColor </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>100</span><span id=t63>,</span><span id=t65>20</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t62>EntityType </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t64>TypeWalls</span></p> <p id=t27><span id=t64><span id=t15> </span></span><span id=t62>PositionEntity </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>50</span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t62>FitMesh </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>,-</span><span id=t65>50</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>,</span><span id=t65>100</span><span id=t63>,</span><span id=t65>3</span><span id=t63>,</span><span id=t65>2</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t62>End Function</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62>Function </span><span id=t64>PositionTarget</span><span id=t63>()</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t62>Repeat </span></p> <p id=t27><span id=t62><span id=t15>  </span></span><span id=t64>inter</span><span id=t63>=</span><span id=t62>False</span></p> <p id=t27><span id=t62><span id=t15>  </span>PositionEntity </span><span id=t64>Target</span><span id=t63>,</span><span id=t62>Rnd</span><span id=t63>(-</span><span id=t65>40</span><span id=t63>,</span><span id=t65>40</span><span id=t63>),</span><span id=t65>0</span><span id=t63>,</span><span id=t62>Rnd</span><span id=t63>(-</span><span id=t65>40</span><span id=t63>,</span><span id=t65>40</span><span id=t63>)</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>For </span><span id=t64>w</span><span id=t63>.</span><span id=t64>Walls </span><span id=t63>= </span><span id=t62>Each </span><span id=t64>Walls</span></p> <p id=t27><span id=t64><span id=t15>   </span></span><span id=t62>If MeshesIntersect</span><span id=t63>(</span><span id=t64>Target</span><span id=t63>, </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63>) </span><span id=t64>inter</span><span id=t63>=</span><span id=t62>True</span></p> <p id=t27><span id=t62><span id=t15>  </span>Next</span></p> <p id=t27><span id=t62><span id=t15> </span>Until </span><span id=t64>inter</span><span id=t63>=</span><span id=t62>False</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62>End Function </span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62>Function </span><span id=t64>CreatePlayer</span><span id=t63>()</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t64>Player</span><span id=t63>=</span><span id=t62>CreateSphere</span><span id=t63>()</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t64>Plac</span><span id=t63>=</span><span id=t62>CreateCone</span><span id=t63>(</span><span id=t65>8</span><span id=t63>)</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t62>RotateMesh </span><span id=t64>Plac</span><span id=t63>,-</span><span id=t65>90</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0 </span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t62>ScaleMesh </span><span id=t64>Plac</span><span id=t63>,</span><span id=t65>1</span><span id=t63>,</span><span id=t65>1</span><span id=t63>,</span><span id=t65>1</span><span id=t63>.</span><span id=t65>2</span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t62>PositionMesh </span><span id=t64>Plac</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,-</span><span id=t65>1</span><span id=t63>.</span><span id=t65>5</span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t62>AddMesh </span><span id=t64>Plac</span><span id=t63>,</span><span id=t64>Player</span></p> <p id=t27><span id=t64><span id=t15> </span></span><span id=t62>EntityType </span><span id=t64>Player</span><span id=t63>, </span><span id=t64>TypePlayer</span></p> <p id=t27><span id=t64><span id=t15> </span></span><span id=t62>EntityColor </span><span id=t64>Player</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>255</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t62>FreeEntity </span><span id=t64>Plac</span></p> <p id=t27><span id=t64>&nbsp;</span></p> <p id=t27><span id=t62>End Function</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62>Function </span><span id=t64>CreateTarget</span><span id=t63>()</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t64>Target</span><span id=t63>=</span><span id=t62>CreateCylinder</span><span id=t63>()</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t64>PositionTarget</span><span id=t63>()</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t62>EntityColor </span><span id=t64>Target</span><span id=t63>,</span><span id=t65>255</span><span id=t63>,</span><span id=t65>215</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15> </span></span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t62>EntityType </span><span id=t64>Target</span><span id=t63>,</span><span id=t64>TypeTarget</span></p> <p id=t27><span id=t64>&nbsp;</span></p> <p id=t27><span id=t62>End Function</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62>Function </span><span id=t64>CreateEnv</span><span id=t63>()</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t64>cam</span><span id=t63>=</span><span id=t62>CreateCamera</span><span id=t63>()</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t62>PositionEntity </span><span id=t64>cam</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>40</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t62>TurnEntity </span><span id=t64>cam</span><span id=t63>,</span><span id=t65>90</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t64>lit</span><span id=t63>=</span><span id=t62>CreateLight</span><span id=t63>()</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t62>TurnEntity </span><span id=t64>lit</span><span id=t63>,</span><span id=t65>70</span><span id=t63>,</span><span id=t65>70</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65>&nbsp;</span></p> <p id=t27><span id=t62>End Function</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62>Function </span><span id=t64>UpdateGame</span><span id=t63>()</span></p> <p id=t27><span id=t63>&nbsp;</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t62>MoveEntity </span><span id=t64>Player</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t64>Speed</span><span id=t63>#</span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t62>If KeyDown</span><span id=t63>(</span><span id=t65>203</span><span id=t63>) </span><span id=t62>TurnEntity </span><span id=t64>Player</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,</span><span id=t65>3</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t62>If KeyDown</span><span id=t63>(</span><span id=t65>205</span><span id=t63>) </span><span id=t62>TurnEntity </span><span id=t64>Player</span><span id=t63>,</span><span id=t65>0</span><span id=t63>,-</span><span id=t65>3</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15> </span></span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t62>PointEntity </span><span id=t64>cam</span><span id=t63>,</span><span id=t64>Player </span></p> <p id=t27><span id=t64>&nbsp;</span></p> <p id=t27><span id=t64><span id=t15> </span></span><span id=t62>If EntityCollided </span><span id=t63>(</span><span id=t64>Player</span><span id=t63>,</span><span id=t64>TypeTarget</span><span id=t63>)</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t64>PositionTarget</span><span id=t63>()</span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>UpdateWorld</span></p> <p id=t27><span id=t62><span id=t15>  </span></span><span id=t64>Score</span><span id=t63>=</span><span id=t64>Score</span><span id=t63>+</span><span id=t65>1 </span></p> <p id=t27><span id=t65><span id=t15>  </span></span><span id=t64>Speed</span><span id=t63>=</span><span id=t64>Speed</span><span id=t63>+.</span><span id=t65>01</span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t62>EndIf</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span>If EntityCollided </span><span id=t63>(</span><span id=t64>Player</span><span id=t63>,</span><span id=t64>TypeWalls</span><span id=t63>) </span><span id=t62>End</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span>UpdateWorld</span></p> <p id=t27><span id=t62><span id=t15> </span>RenderWorld</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span>Color </span><span id=t65>255</span><span id=t63>,</span><span id=t65>215</span><span id=t63>,</span><span id=t65>0</span></p> <p id=t27><span id=t65><span id=t15> </span></span><span id=t62>Text </span><span id=t65>320</span><span id=t63>,</span><span id=t65>10</span><span id=t63>,</span><span id=t66>&quot;Score : &quot;</span><span id=t63>+</span><span id=t64>Score</span><span id=t63>,</span><span id=t62>True</span><span id=t63>,</span><span id=t62>True</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62>End Function</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62>Function </span><span id=t64>FreeGame</span><span id=t63>()</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62>ClearCollisions</span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span>FreeEntity</span><span id=t64> cam</span><span id=t62></span></p> <p id=t27><span id=t62><span id=t15> </span>FreeEntity </span><span id=t64>lit</span><span id=t62></span></p> <p id=t27><span id=t62><span id=t15> </span>FreeEntity </span><span id=t64>Player</span><span id=t62></span></p> <p id=t27><span id=t62><span id=t15> </span>FreeEntity </span><span id=t64>Target</span><span id=t62></span></p> <p id=t27><span id=t62>&nbsp;</span></p> <p id=t27><span id=t62><span id=t15> </span>For </span><span id=t64>w</span><span id=t63>.</span><span id=t64>Walls</span><span id=t63>=</span><span id=t62>Each </span><span id=t64>Walls</span><span id=t62></span></p> <p id=t27><span id=t62><span id=t15>  </span>FreeEntity </span><span id=t64>w</span><span id=t63>\</span><span id=t64>model</span><span id=t63></span></p> <p id=t27><span id=t63><span id=t15>  </span></span><span id=t62>Delete</span><span id=t63> </span><span id=t64>w</span><span id=t63></span></p> <p id=t27><span id=t62><span id=t15> </span>Next</span><span id=t63></span></p> <p id=t27><span id=t69>&nbsp;</span></p> <p id=t27><span id=t64><span id=t15> </span>Speed</span><span id=t63>#=.</span><span id=t65>1</span><span id=t63></span></p> <p id=t27><span id=t63><span id=t15> </span></span><span id=t64>Score</span><span id=t63>=</span><span id=t65>0</span><span id=t63></span></p> <p id=t27><span id=t69>&nbsp;</span></p> <p id=t48><span id=t62>End Function</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8>&nbsp;<span id=t9></span></p> </td> <td id=t37> <p id=t8><span id=t9><span id=t15> </span></span><b><span id=t16>Оглавление</span></b><b><span id=t16>:</span></b></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t17><span id=t18>0.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_0.htm">Введение</a></span></p> <p id=t17><span id=t18>1.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_1.htm">В начале была Тьма</a></span></p> <p id=t17><span id=t18>2.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_2.htm">Есть ли жизнь в <span id=t20>DirectX</span></a></span></p> <p id=t17><span id=t18>3.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_3.htm">Свобода и Власть 3Д (0)</a></span></p> <p id=t17><span id=t18>4.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_4.htm">Свобода и Власть 3Д (1)</a></span></p> <p id=t17><span id=t18>5.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_5.htm">2Д в 3Д</a></span></p> <p id=t17><span id=t18>6.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_6.htm">Трёхмерный курсор</a></span></p> <p id=t17><span id=t18>7.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_7.htm">Родительская зависимость или Привязки</a></span></p> <p id=t17><span id=t18>8.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_8.htm">Фишки с привязками</a></span></p> <p id=t17><span id=t18>9.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_9.htm">Коллизион Детекшн или как устроен мир…</a></span></p> <p id=t21><span id=t18>10.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_10.htm">Первая 3Д игра. Часть 0 – основы движка</a></span></p> <p id=t21><span id=t18>11.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_11.htm">Первая 3Д игра. Часть 1 – разработка движка</a></span></p> <p id=t21><span id=t18>12.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_12.htm">Первая 3Д игра. Часть 2 – устранение багов</a></span></p> <p id=t21><span id=t18>13.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_13.htm">Первая 3Д игра. Часть 3 – внешний вид</a></span></p> <p id=t21><span id=t18>14.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_14.htm">Первая 3Д игра. Часть 4 – от массива к спискам</a></span></p> <p id=t21><span id=t18>15.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_15.htm">Первая 3Д игра. Часть 5 – оптимизация кода</a></span></p> <p id=t21><span id=t18>16.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_16.htm">Первая 3Д игра. Часть 6 – завершение</a></span></p> <p id=t21><span id=t18>17.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_17.htm">Выведение</a></span></p> <p id=t8><span id=t18>&nbsp;</span></p> <p id=t6><span id=t18>&nbsp;</span></p> <p id=t8>&nbsp;<span id=t18></span></p> </td> </tr></table><p id=t6><span id=t20>&nbsp;</span></p></div></body></html>