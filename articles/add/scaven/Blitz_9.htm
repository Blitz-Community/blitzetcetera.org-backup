<html><head><link rel=stylesheet href="scaven.css" Type=Text/css><meta http-equiv=Content-Type content="text/html; charset=windows-1251"><title> Blitz3D Туториал</title></head><body id=t1><div id=t2><table id=t3> <tr id=t22> <td id=t23> <p id=t51>9. Коллизион Детекшн или как устроен мир…</p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Вот мы плавно подошли к главной составной части физики Блитц3Д (не надо только пугаться – никаких формул типа </span><span id=t9>mc</span><span id=t9>^2 вспоминать не нужно </span><span id=t10><span id=t11>J</span></span><span id=t9> – здесь вы их сами будете придумывать!), и одного из его самых главных компонентов – проверки на соприкосновение! Я думаю, после того, как мы его разберём, вы будете готовы к тому, что бы приступить к самой разработке игр… </span><span id=t10><span id=t11>J<span id=t11>J<span id=t11>J</span></span></span></span><span id=t9>!!! </span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Ну, ладно, начнём – чего время-то терять? </span><span id=t10><span id=t11>J</span></span><span id=t9>:</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t28>SeedRnd MilliSecs</span><span id=t30>() </span></p> <p id=t27><span id=t30>&nbsp;</span></p> <p id=t27><span id=t28>Graphics3D </span><span id=t29>640</span><span id=t30>,</span><span id=t29>480</span><span id=t30>,</span><span id=t29>16</span><span id=t30>,</span><span id=t29>1</span></p> <p id=t27><span id=t28>SetBuffer BackBuffer</span><span id=t30>()</span></p> <p id=t27><span id=t30>&nbsp;</span></p> <p id=t27><span id=t28>Const </span><span id=t31>TypePlayer</span><span id=t30>=</span><span id=t29>1</span><span id=t30>,</span><span id=t31>TypeWall</span><span id=t30>=</span><span id=t29>2</span></p> <p id=t27><span id=t29>&nbsp;</span></p> <p id=t27><span id=t31>Player</span><span id=t30>=</span><span id=t28>CreateSphere</span><span id=t30>()</span></p> <p id=t27><span id=t28>EntityType </span><span id=t31>Player</span><span id=t30>,</span><span id=t31>TypePlayer</span></p> <p id=t27><span id=t31>&nbsp;</span></p> <p id=t27><span id=t31>Wall</span><span id=t30>=</span><span id=t28>CreateCube</span><span id=t30>()</span></p> <p id=t27><span id=t28>PositionEntity </span><span id=t31>Wall</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>10</span></p> <p id=t27><span id=t28>EntityType </span><span id=t31>Wall</span><span id=t30>,</span><span id=t31>TypeWall</span></p> <p id=t27><span id=t31>&nbsp;</span></p> <p id=t27><span id=t28>Collisions </span><span id=t31>TypePlayer</span><span id=t30>,</span><span id=t31>TypeWall</span><span id=t30>,</span><span id=t29>2</span><span id=t30>,</span><span id=t29>3</span></p> <p id=t27><span id=t29>&nbsp;</span></p> <p id=t27><span id=t31>cam</span><span id=t30>=</span><span id=t28>CreateCamera</span><span id=t30>()</span></p> <p id=t27><span id=t28>PositionEntity </span><span id=t31>cam</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>30</span><span id=t30>,</span><span id=t29>0</span></p> <p id=t27><span id=t28>TurnEntity </span><span id=t31>cam</span><span id=t30>,</span><span id=t29>90</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>0</span></p> <p id=t27><span id=t29>&nbsp;</span></p> <p id=t27><span id=t31>lit</span><span id=t30>=</span><span id=t28>CreateLight</span><span id=t30>()</span></p> <p id=t27><span id=t28>TurnEntity </span><span id=t31>lit</span><span id=t30>,</span><span id=t29>70</span><span id=t30>,</span><span id=t29>70</span><span id=t30>,</span><span id=t29>0</span></p> <p id=t27><span id=t29>&nbsp;</span></p> <p id=t27><span id=t29><span id=t15> </span></span></p> <p id=t27><span id=t28>Repeat</span></p> <p id=t27><span id=t28><span id=t15> </span></span></p> <p id=t27><span id=t28><span id=t15> </span>If KeyDown</span><span id=t30>(</span><span id=t29>200</span><span id=t30>) </span><span id=t28>MoveEntity </span><span id=t31>Player</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,.</span><span id=t29>1</span></p> <p id=t27><span id=t29><span id=t15> </span></span><span id=t28>If KeyDown</span><span id=t30>(</span><span id=t29>208</span><span id=t30>) </span><span id=t28>MoveEntity </span><span id=t31>Player</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,-.</span><span id=t29>1</span></p> <p id=t27><span id=t29><span id=t15> </span></span><span id=t28>If KeyDown</span><span id=t30>(</span><span id=t29>203</span><span id=t30>) </span><span id=t28>TurnEntity </span><span id=t31>Player</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>2</span><span id=t30>,</span><span id=t29>0</span></p> <p id=t27><span id=t29><span id=t15> </span></span><span id=t28>If KeyDown</span><span id=t30>(</span><span id=t29>205</span><span id=t30>) </span><span id=t28>TurnEntity </span><span id=t31>Player</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,-</span><span id=t29>2</span><span id=t30>,</span><span id=t29>0</span></p> <p id=t27><span id=t29><span id=t15> </span></span></p> <p id=t27><span id=t29><span id=t15> </span></span><span id=t28>UpdateWorld</span></p> <p id=t27><span id=t28><span id=t15> </span>RenderWorld</span></p> <p id=t27><span id=t28>&nbsp;</span></p> <p id=t27><span id=t28><span id=t15> </span>Flip</span></p> <p id=t27><span id=t28>&nbsp;</span></p> <p id=t27><span id=t28>Until KeyHit</span><span id=t30>(</span><span id=t29>1</span><span id=t30>)</span></p> <p id=t27><span id=t30>&nbsp;</span></p> <p id=t48><span id=t28>End</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Итак, в этой программке представлен основной принцип проверки на прикосновения. Здесь мы создаём шар и куб, затем, стрелками управляем шаром, и, если вы захотите заехать внутрь куба, у вас ничего не получится<span id=t15>  </span></span><span id=t10><span id=t11>J</span></span><span id=t9>! УРА! Это и есть тот самый коллизион детекшн – он не пропускает одни объекты в другие, если, конечно перед этим указать, какие именно объекты, и куда именно не пускать (</span><span id=t10><span id=t11>J</span></span><span id=t9>) …</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>А теперь разберём все нововведения.</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Сначала мы создали две константы – </span><span id=t43>TypePlayer</span><span id=t9>, равной единице и </span><span id=t43>TypeWall</span><span id=t9>, равной двойке. Зачем мы это сделали? Так это чтобы не запутаться! Я думаю, потом поймёте в чём именно… Ещё, вы, наверное, заметили, ещё одну новую команду – </span><b><span id=t43>EntityType</span><span id=t43> </span><span id=t43>объект, тип объекта</span></b><span id=t9> – присваивает данному объекту данный тип. Тип (в данном случае) - это просто цифры. Здесь мы вместо цифр использовали константы – чтобы не запутаться, да и чтобы легко можно было прочитать – к какому типу этот объект относится, и с чем соприкасается ( а то представьте такую ситуацию… у нас есть (какие-то) цифры для главного героя, стены, врагов, ну, и прочей дряни – всё это мы вначале создания проекта распределили, расставили, и благополучно забыли за ненадобностью… но вдруг в середине проекта вы вспоминаете, что забыли задать проверку на столкновение между врагом и героем (…ну это уж я утрирую… </span><span id=t10><span id=t11>J</span></span><span id=t9>), и начинаете судорожно вспоминать какая же цифра у вас обозначала врага, просматриваете килобайты кода… ну в общем можно поступить намного удобней, задав сразу константы, таким вот образом Тип_Герой = 1, Тип_Стена = 2, Тип_Пол = 3, Тип_Враг = 13, Тип_Враг_Босс = 113… Тип_какая-то_хрень_-_просто_валяться_где-нибудь_будет = </span><span id=t59>2147483647</span><span id=t9>… </span><span id=t10><span id=t11>J</span></span><span id=t9>! И мы тут уже не цифры пишем, а типа «Коллизион между Типом_Врагом и Типом_Героем»!!!</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Следуящая команда: </span><b><span id=t43>Collision</span><span id=t43> </span><span id=t43>первый тип, второй тип, метод, результат</span></b><span id=t9> – в общем то, что она делает я только что написал, ну а подробней:</span></p> <p id=t8><span id=t9>Первый тип – объект, который будет проверяться на столкновения.</span></p> <p id=t8><span id=t9>Второй тип – объект, с которым эти самые столкновения и будут происходить… </span><span id=t10><span id=t11>J</span></span><span id=t9></span></p> <p id=t8><span id=t9>Метод:</span></p> <p id=t8><span id=t9><span id=t49>            </span>1 – соприкосновение сферы со сферой</span></p> <p id=t8><span id=t9><span id=t49>            </span>2 – соприкосновение сферы с полигонами</span></p> <p id=t8><span id=t9><span id=t49>            </span>3 – соприкосновение сферы с параллелепипедом </span></p> <p id=t8><span id=t9>Результат:</span></p> <p id=t8><span id=t9><span id=t49>            </span>1 – остановка</span></p> <p id=t8><span id=t9><span id=t49>            </span>2 – скольжение – полное скольжение</span></p> <p id=t8><span id=t9><span id=t49>            </span>3 – скольжение – защита объекта от скольжения вниз (может я перевёл не правильно, конечно, ну в общем этот метод создан для работы с террайнами в 3Д)</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Теперь постараюсь обо всём этом, да поподробнее… начнём с методов:</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Как видите, объект, который будет проверяться на столкновения (первый объект) должен будет иметь «сферу» столкновения – так как методы столкновения бывают только сферы с чем-нибудь. Величину этой самой сферы проверки можно задать для каждого объекта отдельно – с помощью команды </span><b><span id=t43>EntityRadius</span><span id=t43> объект, радиус#</span></b><span id=t9>. Это накладывает некоторые ограничения (зато сама проверка – очень быстро реализована) и как бы ваша фигура не выглядела – коллизия будет проверяться именно по какой-то сфере – т.е. допустим, у вас есть предмет – спичка – здесь вам придётся делать либо большую сферу, получая довольно приличное расстояние в середине спички между радиусом сферы соприкосновения и радиусом самой спички, либо сделать сферу поменьше, но сверху и снизу спичка будет вылезать из сферы (как вариант – только верхняя или нижняя часть) – т.е. тут уже эта выпирающая часть может залезть в другой объект… ну, со спичкой я опять же утрирую – но, вот моделки людей, например, тоже не похожи на шары – так что рано или поздно, такой вопрос встанет, и о нём лучше подумать заранее – например, можно сделать более приземистых, коренастых юнитов – как в Квейке первом, например…</span><span id=t9></span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Далее – насчёт коллизиона. 1-е: этот самый коллизион происходит только при движении первого объекта внутрь второго… 2-е: Коллизион – вещь односторонняя – т.е. если мы, как в примере, хотим, чтобы герой соприкасался с врагами, а те, в свою очередь – с ним, то нам нужно писать две команды - «Коллизион между Типом_Героем и Типом_Врагом» и «Коллизион между Типом_Врагом и Типом_Героем»… а так как первый объект должен иметь именно СФЕРУ соприкосновения, то единственный доступный метод здесь – первый! Так что к сфере надо будет привыкнуть, и уже начинать думать, что с ними делать… правда, я слышал о том, что разработчики думают сделать коллизиион по эллипсоиду, но когда это будет?… </span><span id=t10><span id=t11>J</span></span><span id=t9></span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Так, незадолго до того, как я дописал туториал, вышел апдейт 1.82 (поэтому я тут немного дополняю </span><span id=t10><span id=t11>J</span></span><span id=t9>), где эллипсоидный метод столкновения уже реализован, правда удлинять или сплющивать можно только по </span><span id=t9>Y </span><span id=t9>оси, но и это неплохо! Если я не ошибаюсь, новая команда выглядит так: </span><b><span id=t43>EntityRadius </span><span id=t43>объект, радиус по </span></b><b><span id=t43>X </span><span id=t43>и </span></b><b><span id=t43>Z</span><span id=t43>, радиус по </span></b><b><span id=t43>Y</span></b><span id=t9>...</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Вот, в общем-то и вся основа 3Д… понравилось? Ну да прикололся я – ни фига ещё не всё!!! </span><span id=t10><span id=t11>J<span id=t11>J<span id=t11>J</span></span></span></span><span id=t9>!!! (хотя самые основные части позади)</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Теперь будет намного интереснее. При условии конечно, что вы старательно изучали все эти главы, на которые потратили лучшие минуты своей жизни (</span><span id=t10><span id=t11>J</span></span><span id=t9>) и большую часть поняли. Что же пора заняться тем, о чём я там обещал наверху – парой простеньких игрушек!</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8>&nbsp;<span id=t9></span></p> </td> <td id=t37> <p id=t8><span id=t9><span id=t15> </span></span><b><span id=t16>Оглавление:</span></b></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t17><span id=t18>0.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_0.htm">Введение</a></span></p> <p id=t17><span id=t18>1.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_1.htm">В начале была Тьма</a></span></p> <p id=t17><span id=t18>2.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_2.htm">Есть ли жизнь в <span id=t20>DirectX</span></a></span></p> <p id=t17><span id=t18>3.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_3.htm">Свобода и Власть 3Д (0)</a></span></p> <p id=t17><span id=t18>4.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_4.htm">Свобода и Власть 3Д (1)</a></span></p> <p id=t17><span id=t18>5.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_5.htm">2Д в 3Д</a></span></p> <p id=t17><span id=t18>6.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_6.htm">Трёхмерный курсор</a></span></p> <p id=t17><span id=t18>7.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_7.htm">Родительская зависимость или Привязки</a></span></p> <p id=t17><span id=t18>8.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_8.htm">Фишки с привязками</a></span></p> <p id=t17><span id=t18>9.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_9.htm">Коллизион Детекшн или как устроен мир…</a></span></p> <p id=t21><span id=t18>10.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_10.htm">Первая 3Д игра. Часть 0 – основы движка</a></span></p> <p id=t21><span id=t18>11.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_11.htm">Первая 3Д игра. Часть 1 – разработка движка</a></span></p> <p id=t21><span id=t18>12.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_12.htm">Первая 3Д игра. Часть 2 – устранение багов</a></span></p> <p id=t21><span id=t18>13.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_13.htm">Первая 3Д игра. Часть 3 – внешний вид</a></span></p> <p id=t21><span id=t18>14.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_14.htm">Первая 3Д игра. Часть 4 – от массива к спискам</a></span></p> <p id=t21><span id=t18>15.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_15.htm">Первая 3Д игра. Часть 5 – оптимизация кода</a></span></p> <p id=t21><span id=t18>16.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_16.htm">Первая 3Д игра. Часть 6 – завершение</a></span></p> <p id=t21><span id=t18>17.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_17.htm">Выведение</a></span></p> <p id=t8><span id=t18>&nbsp;</span></p> <p id=t6><span id=t18>&nbsp;</span></p> <p id=t8>&nbsp;<span id=t18></span></p> </td> </tr></table><p id=t6><span id=t20>&nbsp;</span></p></div></body></html>