<html><head><link rel=stylesheet href="scaven.css" Type=Text/css><meta http-equiv=Content-Type content="text/html; charset=windows-1251"><title>Blitz3D Туториал</title></head><body id=t1><div id=t2><table id=t3> <tr id=t22> <td id=t23> <p id=t53>7. Родительская зависимость или Привязки</p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>В этой главе мне бы хотелось рассказать о том что такое привязки, и что с ними можно делать. Начнём сразу с примера. Да возьмём один из прошлых – помните, когда мы поворачивали кубик?</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t28>Graphics3D </span><span id=t29>640</span><span id=t30>,</span><span id=t29>480</span><span id=t30>,</span><span id=t29>16</span><span id=t30>,</span><span id=t29>1</span></p> <p id=t27><span id=t28>SetBuffer BackBuffer</span><span id=t30>()</span></p> <p id=t27><span id=t29>&nbsp;</span></p> <p id=t27><span id=t31>lit</span><span id=t30>=</span><span id=t28>CreateLight</span><span id=t30>()</span></p> <p id=t27><span id=t30>&nbsp;</span></p> <p id=t27><span id=t31>cub</span><span id=t30>=</span><span id=t28>CreateCube</span><span id=t30>()</span></p> <p id=t27><span id=t28>ScaleEntity</span><span id=t31> cub</span><span id=t30>,</span><span id=t29>1</span><span id=t30>,.</span><span id=t29>5</span><span id=t30>,</span><span id=t29>2</span></p> <p id=t27><span id=t30>&nbsp;</span></p> <p id=t27><span id=t31>cam</span><span id=t30>=</span><span id=t28>CreateCamera</span><span id=t30>()</span></p> <p id=t27><span id=t28>PositionEntity </span><span id=t31>cam</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>5</span><span id=t30>,-</span><span id=t29>10</span></p> <p id=t27><span id=t30>&nbsp;</span></p> <p id=t27><span id=t31>pln</span><span id=t30>=</span><span id=t28>CreatePlane</span><span id=t30>()</span></p> <p id=t27><span id=t31>tex</span><span id=t30>=</span><span id=t28>LoadTexture</span><span id=t30>(</span><span id=t52>&quot;Picture.bmp&quot;</span><span id=t30>)</span></p> <p id=t27><span id=t28>ScaleTexture</span><span id=t31> tex</span><span id=t30>,</span><span id=t29>10</span><span id=t30>,</span><span id=t29>10</span><span id=t30></span></p> <p id=t27><span id=t28>EntityTexture</span><span id=t31> pln</span><span id=t30>,</span><span id=t31>tex</span></p> <p id=t27><span id=t28>PositionEntity</span><span id=t31> pln</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,-</span><span id=t29>1</span><span id=t30>,</span><span id=t29>0</span><span id=t30></span></p> <p id=t27><span id=t30>&nbsp;</span></p> <p id=t27><span id=t28>Repeat</span></p> <p id=t27><span id=t28>&nbsp;</span></p> <p id=t27><span id=t28><span id=t15> </span>If KeyDown</span><span id=t30>(</span><span id=t29>200</span><span id=t30>) </span><span id=t28>MoveEntity </span><span id=t31>cub</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,.</span><span id=t29>1</span></p> <p id=t27><span id=t29><span id=t15> </span></span><span id=t28>If KeyDown</span><span id=t30>(</span><span id=t29>208</span><span id=t30>) </span><span id=t28>MoveEntity </span><span id=t31>cub</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,-.</span><span id=t29>1</span></p> <p id=t27><span id=t29><span id=t15> </span></span><span id=t28>If KeyDown</span><span id=t30>(</span><span id=t29>203</span><span id=t30>) </span><span id=t28>TurnEntity </span><span id=t31>cub</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>1</span><span id=t30>,</span><span id=t29>0</span></p> <p id=t27><span id=t29><span id=t15> </span></span><span id=t28>If KeyDown</span><span id=t30>(</span><span id=t29>205</span><span id=t30>) </span><span id=t28>TurnEntity </span><span id=t31>cub</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,-</span><span id=t29>1</span><span id=t30>,</span><span id=t29>0</span></p> <p id=t27><span id=t29>&nbsp;</span></p> <p id=t27><span id=t29><span id=t15> </span></span></p> <p id=t27><span id=t29><span id=t15> </span></span><span id=t28>UpdateWorld</span></p> <p id=t27><span id=t28><span id=t15> </span>RenderWorld</span></p> <p id=t27><span id=t28>&nbsp;</span></p> <p id=t27><span id=t28><span id=t15> </span>Flip</span></p> <p id=t27><span id=t28>&nbsp;</span></p> <p id=t27><span id=t28>Until KeyHit</span><span id=t30>(</span><span id=t29>1</span><span id=t30>)</span></p> <p id=t27><span id=t30>&nbsp;</span></p> <p id=t54><span id=t28>End</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>В общем-то ничего не изменилось, мы только поставили плоскость внизу, и (зачем-то </span><span id=t10><span id=t11>J</span></span><span id=t9>) создали камеру ПОСЛЕ создания куба.</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Хорошо, теперь кое-что изменим. Представим, например, что мы делаем какую-нибудь игру с видом от третьего лица. Тогда нам надо, чтобы камера двигалась вместе с кирпичом – вернее сзади него. Сделайте вот что - замените простую строчку создания камеры на:</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t48><span id=t31>cam</span><span id=t30>=</span><span id=t28>CreateCamera</span><span id=t30>(</span><span id=t31>cub</span><span id=t30>)</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Какая-то хитрая строчка… вроде ничего не изменилось, кроме того, что мы поставили в скобки переменную созданного нами куба. В этом и весь фокус! Когда мы создаём какой-то объект, и в скобках ничего не указываем, объект создаётся свободным, а если мы что-то укажем – объект становится зависимым от другого объекта, указанного в скобках – в данном случае это куб. Немного расскажу об этой зависимости:</span></p> <p id=t8><span id=t9>Значит так, во-первых свободный, непривязанный ни к чему объект создаётся в точке 0,0,0 относительно мировой системы координат. Объект же, привязанный таким образом к другому объекту - родителю, создаётся в той точке, где находится его родитель. Второе – все команды которые писались раньше относительно мировой системы координат – теперь пишутся относительно системы координат родителя т.е. в данном случае если бы камера не была привязана к кубу, команда </span><span id=t28>PositionEntity</span><span id=t28> </span><span id=t31>cam</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>5</span><span id=t30>,-</span><span id=t29>10</span><span id=t9> означала бы поставить объект </span><span id=t9>cam</span><span id=t9> в точку с координатами 0,5,-10. А так как она привязана к кубу, камера ставится в точку 0,5,-10 относительно куба (т.е. центр куба для камеры считается точкой 0,0,0). Получается, что камера располагается сзади и немного сверху относительно куба. И куда мы этот куб перед этим бы не поставили, как бы не повернули – всё равна камера бы поставилась именно таким образом. И, наконец, самое главное: Все движения и повороты, которые применяются к родителю автоматически применяются к зависимым от него объектам – то есть они как будто бы привязаны к родителю. Например, если мы подвинем родителя, все зависимые от него объекты также подвинутся. Если повернём – все зависимые объекты относительно него повернутся! Но не наоборот! Как бы мы не вертели не крутили и не двигали зависимые объекты, родителю будет на это всё глубоко параллельно… </span><span id=t10><span id=t11>J</span></span><span id=t9></span></p> <p id=t27><span id=t9>Надеюсь понятно объяснил. Хотелось бы только отметить: если всё же нам нужно будет поместить, передвинуть или повернуть зависимый объект относительно мировой системы координат, то это делается очень просто – в конце добавляется </span><span id=t9>True</span><span id=t9> (что значит, что команда совершается ГЛОБАЛЬНО – то есть относительно мировой системы координат.). Например, если нам камеру надо будет поставить в точку 5,5,-20 относительно мировой системы координат, а не относительно мировой системы родителя - мы просто пишем </span><span id=t28>PositionEntity</span><span id=t28> </span><span id=t31>cam</span><span id=t30>,</span><span id=t29>5</span><span id=t30>,</span><span id=t29>5</span><span id=t30>,-</span><span id=t29>20</span><span id=t30>,</span><span id=t28>True</span><span id=t9> ! И всё! И связь всё равно от этого не потеряется!</span></p> <p id=t27><span id=t30>&nbsp;</span></p> <p id=t8><span id=t9>Ох и сочинение я тут написал! Ну да ладно – запустите программу, и вы увидите, что камера стоит ровно, и следит за кубом. А он ездит (это видно по плоскости, которая пролетает внизу – вот зачем она была нужна!). Чтобы показать, что движение зависимых объектов никак не влияет на родителей, добавим ещё две строчки в цикл:</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t28>If</span><span id=t31> </span><span id=t28>KeyDown</span><span id=t30>(</span><span id=t29>30</span><span id=t30>) </span><span id=t28>MoveEntity</span><span id=t31> cam</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,.</span><span id=t29>1</span></p> <p id=t48><span id=t28>If</span><span id=t31> </span><span id=t28>KeyDown</span><span id=t30>(</span><span id=t29>44</span><span id=t30>) </span><span id=t28>MoveEntity</span><span id=t31> cam</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,-.</span><span id=t29>1</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>В них, как вы видите, условие – если нажата кнопка </span><span id=t9>A </span><span id=t9>– двигать камеру вперёд, а если нажата </span><span id=t9>Z </span><span id=t9>– назад. Куб остаётся на месте </span><span id=t10><span id=t11>J</span></span><span id=t9>!</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Полный код:</span></p> <p id=t8><span id=t9>&nbsp;</span></p> <table id=t24> <tr id=t46> <td id=t47> <p id=t27><span id=t28>Graphics</span><span id=t28>3</span><span id=t28>D </span><span id=t29>640</span><span id=t30>,</span><span id=t29>480</span><span id=t30>,</span><span id=t29>16</span><span id=t30>,</span><span id=t29>1</span></p> <p id=t27><span id=t28>SetBuffer BackBuffer</span><span id=t30>()</span></p> <p id=t27><span id=t29>&nbsp;</span></p> <p id=t27><span id=t31>lit</span><span id=t30>=</span><span id=t28>CreateLight</span><span id=t30>()</span></p> <p id=t27><span id=t30>&nbsp;</span></p> <p id=t27><span id=t31>cub</span><span id=t30>=</span><span id=t28>CreateCube</span><span id=t30>()</span></p> <p id=t27><span id=t28>ScaleEntity</span><span id=t31> cub</span><span id=t30>,</span><span id=t29>1</span><span id=t30>,.</span><span id=t29>5</span><span id=t30>,</span><span id=t29>2</span></p> <p id=t27><span id=t30>&nbsp;</span></p> <p id=t27><span id=t31>cam</span><span id=t30>=</span><span id=t28>CreateCamera</span><span id=t30>(</span><span id=t31>cub</span><span id=t30>)</span></p> <p id=t27><span id=t28>PositionEntity </span><span id=t31>cam</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>5</span><span id=t30>,-</span><span id=t29>10</span><span id=t30></span></p> <p id=t27><span id=t30>&nbsp;</span></p> <p id=t27><span id=t31>pln</span><span id=t30>=</span><span id=t28>CreatePlane</span><span id=t30>()</span></p> <p id=t27><span id=t31>tex</span><span id=t30>=</span><span id=t28>LoadTexture</span><span id=t30>(</span><span id=t52>&quot;Picture.bmp&quot;</span><span id=t30>)</span></p> <p id=t27><span id=t28>ScaleTexture</span><span id=t31> tex</span><span id=t30>,</span><span id=t29>10</span><span id=t30>,</span><span id=t29>10</span><span id=t30></span></p> <p id=t27><span id=t28>EntityTexture</span><span id=t31> pln</span><span id=t30>,</span><span id=t31>tex</span></p> <p id=t27><span id=t28>PositionEntity</span><span id=t31> pln</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,-</span><span id=t29>1</span><span id=t30>,</span><span id=t29>0</span><span id=t30></span></p> <p id=t27><span id=t30>&nbsp;</span></p> <p id=t27><span id=t28>Repeat</span></p> <p id=t27><span id=t28>&nbsp;</span></p> <p id=t27><span id=t28><span id=t15> </span>If KeyDown</span><span id=t30>(</span><span id=t29>200</span><span id=t30>) </span><span id=t28>MoveEntity </span><span id=t31>cub</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,.</span><span id=t29>1</span></p> <p id=t27><span id=t29><span id=t15> </span></span><span id=t28>If KeyDown</span><span id=t30>(</span><span id=t29>208</span><span id=t30>) </span><span id=t28>MoveEntity </span><span id=t31>cub</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,-.</span><span id=t29>1</span></p> <p id=t27><span id=t29><span id=t15> </span></span><span id=t28>If KeyDown</span><span id=t30>(</span><span id=t29>203</span><span id=t30>) </span><span id=t28>TurnEntity </span><span id=t31>cub</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>1</span><span id=t30>,</span><span id=t29>0</span></p> <p id=t27><span id=t29><span id=t15> </span></span><span id=t28>If KeyDown</span><span id=t30>(</span><span id=t29>205</span><span id=t30>) </span><span id=t28>TurnEntity </span><span id=t31>cub</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,-</span><span id=t29>1</span><span id=t30>,</span><span id=t29>0</span></p> <p id=t27><span id=t29><span id=t15> </span></span></p> <p id=t27><span id=t29><span id=t15> </span></span><span id=t28>If</span><span id=t31> </span><span id=t28>KeyDown</span><span id=t30>(</span><span id=t29>30</span><span id=t30>) </span><span id=t28>MoveEntity</span><span id=t31> cam</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,.</span><span id=t29>1</span></p> <p id=t27><span id=t30><span id=t15> </span></span><span id=t28>If</span><span id=t31> </span><span id=t28>KeyDown</span><span id=t30>(</span><span id=t29>44</span><span id=t30>) </span><span id=t28>MoveEntity</span><span id=t31> cam</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,</span><span id=t29>0</span><span id=t30>,-.</span><span id=t29>1</span><span id=t30></span></p> <p id=t27><span id=t29><span id=t15> </span></span></p> <p id=t27><span id=t29><span id=t15> </span></span><span id=t28>UpdateWorld</span></p> <p id=t27><span id=t28><span id=t15> </span>RenderWorld</span></p> <p id=t27><span id=t28>&nbsp;</span></p> <p id=t27><span id=t28><span id=t15> </span>Flip</span></p> <p id=t27><span id=t28>&nbsp;</span></p> <p id=t27><span id=t28>Until KeyHit</span><span id=t30>(</span><span id=t29>1</span><span id=t30>)</span></p> <p id=t27><span id=t30>&nbsp;</span></p> <p id=t54><span id=t28>End</span><span id=t33></span></p> </td> </tr> </table> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t8><span id=t9>Ну, мы раскрыли секрет игр, сделанных от третьего лица </span><span id=t10><span id=t11>J</span></span><span id=t9>! Но использование привязок не ограничивается «следящей» камерой. О том, что ещё можно сделать с привязками, я расскажу в следующей главе.</span></p> <p id=t8>&nbsp;<span id=t9></span></p> </td> <td id=t37> <p id=t8><span id=t9><span id=t15> </span></span><b><span id=t16>Оглавление:</span></b></p> <p id=t8><span id=t9>&nbsp;</span></p> <p id=t17><span id=t18>0.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_0.htm">Введение</a></span></p> <p id=t17><span id=t18>1.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_1.htm">В начале была Тьма</a></span></p> <p id=t17><span id=t18>2.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_2.htm">Есть ли жизнь в <span id=t20>DirectX</span></a></span></p> <p id=t17><span id=t18>3.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_3.htm">Свобода и Власть 3Д (0)</a></span></p> <p id=t17><span id=t18>4.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_4.htm">Свобода и Власть 3Д (1)</a></span></p> <p id=t17><span id=t18>5.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_5.htm">2Д в 3Д</a></span></p> <p id=t17><span id=t18>6.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_6.htm">Трёхмерный курсор</a></span></p> <p id=t17><span id=t18>7.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_7.htm">Родительская зависимость или Привязки</a></span></p> <p id=t17><span id=t18>8.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_8.htm">Фишки с привязками</a></span></p> <p id=t17><span id=t18>9.<span id=t19>&nbsp; </span></span><span id=t18><a href="Blitz_9.htm">Коллизион Детекшн или как устроен мир…</a></span></p> <p id=t21><span id=t18>10.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_10.htm">Первая 3Д игра. Часть 0 – основы движка</a></span></p> <p id=t21><span id=t18>11.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_11.htm">Первая 3Д игра. Часть 1 – разработка движка</a></span></p> <p id=t21><span id=t18>12.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_12.htm">Первая 3Д игра. Часть 2 – устранение багов</a></span></p> <p id=t21><span id=t18>13.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_13.htm">Первая 3Д игра. Часть 3 – внешний вид</a></span></p> <p id=t21><span id=t18>14.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_14.htm">Первая 3Д игра. Часть 4 – от массива к спискам</a></span></p> <p id=t21><span id=t18>15.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_15.htm">Первая 3Д игра. Часть 5 – оптимизация кода</a></span></p> <p id=t21><span id=t18>16.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_16.htm">Первая 3Д игра. Часть 6 – завершение</a></span></p> <p id=t21><span id=t18>17.<span id=t19>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span id=t18><a href="Blitz_17.htm">Выведение</a></span></p> <p id=t8><span id=t18>&nbsp;</span></p> <p id=t6><span id=t18>&nbsp;</span></p> <p id=t8>&nbsp;<span id=t18></span></p> </td> </tr></table><p id=t6>&nbsp;</p></div></body></html>