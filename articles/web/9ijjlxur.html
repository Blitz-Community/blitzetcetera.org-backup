<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru" dir="ltr">	
<!-- Mirrored from localhost/index.php/%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter by HTTrack Website Copier/3.x [XR&CO'2007], Sat, 10 Nov 2007 05:15:25 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />				<meta name="keywords" content="Создаём свой First Person Shooter,Impersonalis" />
		<link rel="shortcut icon" href="http://blitzetcetera.org/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="http://blitzetcetera.org/opensearch_desc.php" title="Blitz Et Cetera (Русский)" />
		<title>Создаём свой First Person Shooter — Blitz Et Cetera</title>		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "bvih5rde.css?63"; /*]]>*/</style>		<link rel="stylesheet" type="text/css" media="print" href="gcxktlm6.css?63" />		<link rel="stylesheet" type="text/css" media="handheld" href="zumsslq_.css?63" />		<!--[if lt IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE50Fixes.css?63";</style><![endif]-->		<!--[if IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE55Fixes.css?63";</style><![endif]-->		<!--[if IE 6]><style type="text/css">@import "/skins/OfflineNew/IE60Fixes.css?63";</style><![endif]-->		<!--[if IE 7]><style type="text/css">@import "/skins/OfflineNew/IE70Fixes.css?63";</style><![endif]-->		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?63"></script>		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->		<script type= "text/javascript">/*<![CDATA[*/
var skin = "OfflineNew";
var stylepath = "/skins";
var wgArticlePath = "/index.php/$1";
var wgScriptPath = "";
var wgServer = "http://blitzetcetera.org/";
var wgCanonicalNamespace = "";
var wgCanonicalSpecialPageName = false;
var wgNamespaceNumber = 0;
var wgPageName = "Создаём_свой_First_Person_Shooter";
var wgTitle = "Создаём свой First Person Shooter";
var wgAction = "view";
var wgArticleId = "1670";
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "ru";
var wgContentLanguage = "ru";
var wgBreakFrames = false;
var wgCurRevisionId = "3570";
/*]]>*/</script>
		<script type="text/javascript" src="2nq-6cel.js?63"><!-- wikibits js --></script>		<script type="text/javascript" src="http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=js"><!-- site js --></script>		<style type="text/css">/*<![CDATA[*/
@import "http://blitzetcetera.org/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=MediaWiki:OfflineNew.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=css&amp;maxage=18000";
/*]]>*/</style>		<!-- Head Scripts -->	</head><body  class="mediawiki ns-0 ltr page-Создаём_свой_First_Person_Shooter">	<div id="globalWrapper">	<div id="logocontainer">		<table align="center">		  <tr>				<td id="blitzetclogo">				</td>			</tr>		</table>	</div>	<div id="magbar">	Журнал о программированнии на языках Blitz3D, BlitzMax, BlitzPlus	</div>		<div id="column-content">	<div id="content">		<a name="top" id="top"></a>				<div id="bodyContent">		<table cellspacing=0 cellpadding=0 width=100%>			<tr>			  <td class="leftside">				</td>				<td class="sheetbody">					<h1 class="sheet">Создаём свой First Person Shooter</h1>			<h3 id="siteSub">Материал из Blitz Et Cetera.</h3>			<div id="contentSub"></div>			<!-- start content -->			<table id="toc" class="toc" summary="Содержание"><tr><td><div id="toctitle"><h2>Содержание</h2></div>
<ul>
<li class="toclevel-1"><a href="#.D0.92.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5"><span class="tocnumber">1</span> <span class="toctext">Введение</span></a></li>
<li class="toclevel-1"><a href="#.D0.9A.D0.BE.D0.B4.D0.B8.D0.BC-.D0.BA.D0.BE.D0.B4.D0.B8.D0.BC..."><span class="tocnumber">2</span> <span class="toctext">Кодим-кодим...</span></a></li>
<li class="toclevel-1"><a href="#.22.D0.A7.D0.B5.D1.81.D1.82.D0.BD.D0.B0.D1.8F.22_.D1.84.D0.B8.D0.B7.D0.B8.D0.BA.D0.B0"><span class="tocnumber">3</span> <span class="toctext">"Честная" физика</span></a></li>
<li class="toclevel-1"><a href="#.D0.9F.D1.80.D0.B8.D1.86.D0.B5.D0.BB"><span class="tocnumber">4</span> <span class="toctext">Прицел</span></a></li>
<li class="toclevel-1"><a href="#.D0.92.D1.8B.D1.81.D1.82.D1.80.D0.B5.D0.BB.D1.8B"><span class="tocnumber">5</span> <span class="toctext">Выстрелы</span></a></li>
<li class="toclevel-1"><a href="#.D0.9A.D0.BE.D0.B2.D0.B0.D1.80.D0.BD.D1.8B.D0.B5_.D0.B1.D0.BE.D1.82.D1.8B"><span class="tocnumber">6</span> <span class="toctext">Коварные боты</span></a></li>
<li class="toclevel-1"><a href="#.D0.91.D0.B0.D0.B3-.D1.84.D0.B8.D0.BA.D1.81"><span class="tocnumber">7</span> <span class="toctext">Баг-фикс</span></a></li>
<li class="toclevel-1"><a href="#.D0.A7.D0.B8.D1.82-.D0.BC.D0.BE.D0.B4"><span class="tocnumber">8</span> <span class="toctext">Чит-мод</span></a></li>
<li class="toclevel-1"><a href="#.D0.A3.D1.85.D0.BE.D0.B4_.D0.BE.D1.82_.D0.BF.D0.BE.D0.BB.D0.BD.D0.BE.D0.B3.D0.BE_.D0.BF.D0.B5.D1.80.D0.B5.D0.B1.D0.BE.D1.80.D0.B0"><span class="tocnumber">9</span> <span class="toctext">Уход от полного перебора</span></a></li>
<li class="toclevel-1"><a href="#.D0.A3.D1.85.D0.BE.D0.B4_.D0.BE.D1.82_.D0.BF.D1.80.D0.B8.D0.B2.D1.8F.D0.B7.D0.BA.D0.B8_.D0.BA_FPS"><span class="tocnumber">10</span> <span class="toctext">Уход от привязки к FPS</span></a></li>
<li class="toclevel-1"><a href="#.D0.9D.D0.B5.D0.B1.D0.B5.D1.81.D0.BD.D0.B0.D1.8F_.D1.81.D1.84.D0.B5.D1.80.D0.B0"><span class="tocnumber">11</span> <span class="toctext">Небесная сфера</span></a></li>
<li class="toclevel-1"><a href="#.D0.96.D0.B8.D0.B2.D1.83.D1.87.D0.B8.D0.B5_.D0.B1.D0.BE.D1.82.D1.8B"><span class="tocnumber">12</span> <span class="toctext">Живучие боты</span></a></li>
<li class="toclevel-1"><a href="#.D0.96.D0.B8.D0.B7.D0.BD.D1.8C_.D0.B2_.D0.BA.D0.BE.D1.80.D0.BE.D0.B1.D0.BA.D0.B5"><span class="tocnumber">13</span> <span class="toctext">Жизнь в коробке</span></a></li>
<li class="toclevel-1"><a href="#.D0.9A.D0.BE.D0.B4.D0.B8.D0.BC-.D0.BA.D0.BE.D0.B4.D0.B8.D0.BC"><span class="tocnumber">14</span> <span class="toctext">Кодим-кодим</span></a></li>
<li class="toclevel-1"><a href="#.D0.9F.D1.80.D1.8B.D0.B6.D0.BA.D0.B8_.D0.B8_.D1.80.D0.B5.D0.B0.D0.BB.D0.B8.D1.81.D1.82.D0.B8.D1.87.D0.BD.D0.BE.D1.81.D1.82.D1.8C_.D1.84.D0.B8.D0.B7.D0.B8.D0.BA.D0.B8"><span class="tocnumber">15</span> <span class="toctext">Прыжки и реалистичность физики</span></a>
<ul>
<li class="toclevel-2"><a href="#.D0.9A.D0.BE.D0.BD.D1.82.D1.80.D0.BE.D0.BB.D1.8C_.D0.B7.D0.B0_.D0.BE.D1.82.D1.80.D1.8B.D0.B2.D0.BE.D0.BC_.D0.BE.D1.82_.D0.B7.D0.B5.D0.BC.D0.BB.D0.B8_.D0.B8_.D0.BC.D0.BE.D0.BC.D0.B5.D0.BD.D1.82.D0.BE.D0.BC_.D1.81.D0.BE.D0.BF.D1.80.D0.B8.D0.BA.D0.BE.D1.81.D0.BD.D0.BE.D0.B2.D0.B5.D0.BD.D0.B8.D1.8F_.D1.81_.D0.BD.D0.B5.D0.B9"><span class="tocnumber">15.1</span> <span class="toctext">Контроль за отрывом от земли и моментом соприкосновения с ней</span></a></li>
<li class="toclevel-2"><a href="#.D0.92.D1.80.D0.B5.D0.BC.D1.8F_.D0.BD.D0.B5.D0.B2.D0.B7.D0.B0.D0.B8.D0.BC.D0.BE.D0.B4.D0.B5.D0.B9.D1.81.D1.82.D0.B2.D0.B8.D1.8F_.D1.81_.D0.B7.D0.B5.D0.BC.D0.BB.D1.91.D0.B9"><span class="tocnumber">15.2</span> <span class="toctext">Время невзаимодействия с землёй</span></a></li>
<li class="toclevel-2"><a href="#.D0.A1.D0.BA.D0.BE.D1.80.D0.BE.D1.81.D1.82.D0.B8_.D0.B4.D0.B2.D0.B8.D0.B6.D0.B5.D0.BD.D0.B8.D1.8F_.D0.B4.D0.BB.D1.8F_.D0.B8.D1.85_.D0.B4.D0.B8.D0.BD.D0.B0.D0.BC.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.BE.D0.B3.D0.BE_.D0.B8.D0.B7.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D1.8F"><span class="tocnumber">15.3</span> <span class="toctext">Скорости движения для их динамического изменения</span></a></li>
<li class="toclevel-2"><a href="#.D0.98.D0.BD.D0.B8.D1.86.D0.B8.D0.B0.D0.BB.D0.B8.D0.B7.D0.B0.D1.86.D0.B8.D1.8F_.D1.81.D0.BE.D0.B1.D1.8B.D1.82.D0.B8.D1.8F_.22.D0.BF.D1.80.D1.8B.D0.B6.D0.BE.D0.BA.22"><span class="tocnumber">15.4</span> <span class="toctext">Инициализация события "прыжок"</span></a></li>
</ul>
</li>
</ul>
</td></tr></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "показать"; var tocHideText = "убрать"; showTocToggle(); } </script>
<a name=".D0.92.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=1" title="Править секцию: Введение">править</a>]</span> <span class="mw-headline">Введение</span></h2>
<p>Всем привет!
</p><p>По опыту знаю: большинство хочет сразу после просмотра сэмплов сесть и написать FPS. И не просто какой-нибудь: УБЕЙ_ИХ_ВСЕХ_2010, а что-нибудь революционно-инновационное – с крутейшей графикой, умнейшим ИИ, и возможностью сетевой игры на разных протоколах и в разных игровых режимах, с абсолютной нелинейностью сюжета, причём всё это будет требовать смехотворно мало ресурсов. Если Вы именно такой пользователь THEN goto основы. Так как начинать с подобного рода программ – отбивать себе всякое желание программить на Блитце – попишите пока тетрисы, змейки и проч.
</p><p>Итак… FPS… конечно же 3D! Запускаем компилятор и смело вбиваем
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>чуть ниже организовываем цикл, это будет главный цикл программы MAIN LOOP. Оформляйте его любыми операторами цикла, я, лично, сделаю так:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Тут всё должно быть ясно как день:
</p>
<ul><li>Цикл крутится пока Не ПрерываниеОтКнопки (Escape)
</li><li>Команда END в данном случае – чистый формализм: после инструкции WEND у нас в коде ничего нет, таким образом, после выхода из цикла программа и так завершится. Но всё же я настоятельно рекомендую не пренебрегать подобными формальностями!
</li></ul>
<p>Уже можно давить F5 – и любоваться  … космосом… без звёзд…
Теперь займёмся камерой… даже - лучше сразу игроком 
Опять же: я настоятельно рекомендую заключать подобные знаковые участки кода в тела функций. Поэтому где-нибудь повыше напишем:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Если Вы затрудняетесь определить: «где же это самое то место» - в принципе Блитцу всё равно, но я настоятельно рекомендую объявлять все функции перед главным циклом (а так как это не С++, то и писать тела функций там же), а поскольку в функции будут использоваться команды работы с 3d-объектами объявить их надо после строчек
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Надеюсь, с местом определились. Теперь передаваемые в функцию аргументы… Думаю, удобно будет задавать ими место появления игрока. С другой стороны, практически всегда у нас он появляется в 0,h#,0 – в центре карты на небольшом расстоянии от земли, поэтому пишем следующее:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Теперь подумаем о физической модели игрока… В масштабах этого манула, позволительно допустить: игрока никто не видит, и камера как в FPS. Значит не стоит отвлекаться на фактический внешний вид игрока. У нас должна быть точка опоры и над ней (на некотором расстоянии) камера. А это, имхо, самый простой и надёжно работающий способ решения:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#</div>
<p>набираем мы в функции. Сам пользователь – это будет сфера (та самая точка) к которой прикреплена камера&nbsp;: в координатах 0,1,-0.5 относительно сферы. Камера прикрепляется сразу после создания, т.к. ей задан родитель (парент) в качестве аргумента. Затем происходит её позиционирование, и затем позиционирование самого игрока.
Запускаем… И снова темнота
А как по-вашему: у нас есть описание действия «создать игрока» и пустой цикл. Для начал надо вызвать функцию создания перед главным циклом:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">create_user<span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Затем: ну да – в памяти мы создали и сферку и камеру – а дальше то что? Как минимум надо это всё обработать как геометрические объекты и отрисовать в BackBuffer . Добавим в главном цикле команду:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Ещё одна неувязочка: на экране находится при двойной буферизации FrontBuffer, а менять содержимое буферов мы будем командой
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Flip</span></div>
<p>После такой перекройки программа должна выглядеть примерно так:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Снова запускаем – и опять темнота… Но на самом деле всё рисуется – сфера которую вы не видите, потому что «не можете наклонить голову» и… всё – больше в мире пока ничего нет.
</p><p>Нам нужна земная твердь. И обязательно текстурка для неё. Ведь компьютер без дополнительных инструкций строит идеальные видео образы – абсолютно ровную поверхность земли (на самом деле мелкие неровности пока тоже ничего бы не дали – нет освещения – которое и позволяет видеть объёмную картину мира , без света всё будет казаться «плосокватым») так что вы просто увидите светлый прямоугольник занимающий часть экрана. Для примера возьмем стандартную Блитц-текстуру.
</p><p>Опять же прибегая к упрощениям – земля будет в виде бесконечной ровной поверхности – создадим её плэйном:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-Terrain.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-Terrain.jpg" src="lvn6fvb4.jpg" width="256" height="256" /></a></span></div></div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>затем загрузим текстурку
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span></div>
<p>и наложим её на поверхность
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex</div>
<p>ну и для профилактики очистим память из под текстуры – она нам больше не понадобится:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex</div>
<p>Ах да всё это должно быть набрано после инициализации графики но перед циклом.
И ещё немного подумав, объединим вызов ф-ции создания игрока и создание мира в одну функцию:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Та-дам! Запускаем, наслаждаемся&nbsp;:D
</p>
<a name=".D0.9A.D0.BE.D0.B4.D0.B8.D0.BC-.D0.BA.D0.BE.D0.B4.D0.B8.D0.BC..."></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=2" title="Править секцию: Кодим-кодим...">править</a>]</span> <span class="mw-headline">Кодим-кодим...</span></h2>
<p>Для практики: закомментируем команду текстурирования террайна и посмотрим на выполнение.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;EntityTexture terrain,tertex</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Как я и обещал, видим светлый прямоугольник отхапавший часть экрана. Раскомментируем строчку обратно. 
Кстати о комментариях: не стоит ими пренебрегать но и объяснять всё подряд не стоит. 
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились&nbsp;:)</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Надеюсь, вы уже обучили Блитц понимать русский язык?  <a href="http://community.boolean.name/index.php?act=ST&amp;f=4&amp;t=25|Только" class="external text" title="http://community.boolean.name/index.php?act=ST&amp;f=4&amp;t=25|Только" rel="nofollow">по секрету</a>. Не стоит также пренебрегать грамотным форматированием кода:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились&nbsp;:)</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Вот…
</p><p>Так-с-с&nbsp;: на поверхность посмотрели – пора двигаться дальше. Будем учить игрока двигаться:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;обновление игрока</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Так получается, что к глазам игрока (камере) и его ногам (сфере) будут обращаться вне функции создания игрока. А значит надо сделать хендлы камеры и сферы глобальными. Для этого подготовим для их хранения глобальные переменные:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera</div>
<p>Теперь это уже не локальные переменные функции create_user, а глобальные всей программы.
Игрока мы будем обновлять на каждой итерации главного цикла, поэтому сразу допишем вызов соответствующей функции:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;обновление игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились&nbsp;:)</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Так… перейдём к программированию движений: для удобства объявим в нашей функции переменную, отвечающую за смещения по осям (никто не мешает вам сделать разную скорость для движения вперёд, назад и шагов влево-вправо)
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">V#=<span style="color: #33ffdd;">0.5</span></div>
<p>и кодируем движения нашей сферки (напомню: на ней укреплена камера)
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<p><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
</p>
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#</div>
<p>Запустим… результат, конечно зависит от производительности вашей машины, но, думаю, он не будет сильно разнится: при движении земля жутко мельтишит под ногами, так что невозможно даже оценить – в какую сторону мы сейчас двигаемся. Для устранения этого надо или понизить коэффициент скорости, или (что мы и сделаем ) растянуть текстурку:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tertex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><span style="color: #ffee00">;вот тута новое</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex</div>
<p>мир по-прежнему имеет весьма сомнительный вид, но уже лучше, чем было.Теперь займёмся обзорами местности.
Будем вращать камеру вверх-вниз в зависимости от смещения мыши по Y-оси и влево-вправо от смещения по X-оси.
Угу: как же ну смотрю я вправо… ещё вправо… опа: курсор упёрся в правый край экрана и всё. Значит после оценки изменений мы должны вернуть мышь на исходную – самое логичное, в центр экрана. Получить текущий размер экрана в пикселях по X и по Y можно функциями 
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>соответственно. Т.е. задвинуть мышь в центр экрана:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span></div>
<p>А снять перемещение мыши – измерив её скорость по осям:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Но вот ещё загвоздка: если мы будем крутить только камеру, то получается: мы развернули камеру влево и нажали кнопку ВПЕРЁД, но наша опора то как стояла, так и стоит неразвёрнутой – в результате смотрим вбок и прём вперёд, а надо бы идти, туда куда смотрим. С другой стороны вращать только основу мы не можем по схожей причине: Уставились мы в небо и нажали ВПЕРЁД и наша основа полетела тоже в небо (даже если мы включим гравитацию, эффект останется – модуль скорости будет равен проекции вектора скорости на поверхность т.е. если мы задерём голову вверх – cos(90)=0 и мы не сможем двигаться).
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span></div>
<p>т.е. после доработок:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><br />
V#=<span style="color: #33ffdd;">0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Ндя…  неприятный осадок всё же остался: как это можно так задрать голову, что увидеть происходящее за спиной и ниже и сделать 360 градусный проворт головы?!
Модифим – теперь камера не будет превышать указанный нами угол вверх и вниз:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><br />
V#=<span style="color: #33ffdd;">0.5</span><br />
u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<ul><li>ABS-модуль
</li><li>EntityPitch# ( entity[,global] ) – угол вращения в плоскости Y0Z, т.е. вокруг оси X
</li><li>SGN – функция-знак
</li></ul>
<p>Если что не понятно - ставим курсор на функцию и кликаем 2 раза F1. 
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;обновление игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
V#=<span style="color: #33ffdd;">0.5</span><br />
u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tertex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились&nbsp;:)</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<a name=".22.D0.A7.D0.B5.D1.81.D1.82.D0.BD.D0.B0.D1.8F.22_.D1.84.D0.B8.D0.B7.D0.B8.D0.BA.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=3" title="Править секцию: &quot;Честная&quot; физика">править</a>]</span> <span class="mw-headline">"Честная" физика</span></h2>
<p>Так-с приступим к добавлению гравитации. Объявим где-нибудь в глобале переменную ускорения свободного падения
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> G#=<span style="color: #33ffdd;">1</span></div>
<p>Обратите внимание на идентификатор const (константа) и тип переменной (#-с плавающей точкой). Теперь надо реализовать контроль за отрывом от поверхности... Это можно сделать 2 способами через просчёт столкновений (Collisions) и через "пики" (Pick). С одной стороны, так как Collisions обрабатывается дольше, сложнее в коде... и самое главное так или иначе автоматически производит response - один из 3-х методов обработки столкновения:
</p>
<ol><li> stop 
</li><li> slide1 - full sliding collision 
</li><li> slide2 - prevent entities from sliding down slopes
</li></ol>
<p>С другой стороны обрабатывать это будет проще... впал в раздумья... короче делаем через collision. Добавим в глобал константы типов
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> USERT=<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;for user</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> TERRT=<span style="color: #33ffdd;">2</span><span style="color: #ffee00">;for terrain</span></div>
<p>Переходим в Create_user() и делаем следующее.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">EntityType</span> user,USERT</div>
<p>Переходим в Create_world() и делаем следующее.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">EntityType</span> terrain,TERRT</div>
<p>и после вызова create_user()
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span></div>
<p>в главном цикле допишем
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>и наконец в update_user() нацарапем
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;физика</span><br />
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#,<span style="color: #33ffdd;">0</span></div>
<p>/сразу предупреждаю физиков: это не окончательный вараинт кода/
И мы смело двигаем пользователя вниз ф-цией TranslateEntity. TranslateEntity отличается от MoveEntity безразличем к пространственной ориентации самой модели. Пример: если объект перевернуть "на голову", то команда move вниз приведёт к движению этого объекта вверх, Translate же будет двигать объект вниз. Перейдём в create_user() и подправим кое-что:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">10</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<p><br />
</p>
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">-0.5</span></div>
<p>Можно запускать! В начале текста я немного занизил высоту камеры относительно "ног", что сейчас и исправил. Теперь, между прочим, стала заметна сфера. Вернёмся к ф-ции создания:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> user,<span style="color: #33ffdd;">0</span></div>
<p>Этим мы задали нулевую "альфу" для сферы - т.е. сделали её полностью прозрачной.
</p><p>Термины "полностью прозрачный" и "невидимый" здесь не одно и то же. Если первый сводится к изменению альфы (и объект просто не видим для камер), то второй реализуется командой HideEntity (и объект убирается из процедуры рендера движка). Но об этом как-нибудь в другой раз. Как очевидно, код:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#,<span style="color: #33ffdd;">0</span></div>
<p>не совсем то, что нам нужно. Хотя вблизи земли разницы никакой нет (допустимые приближения). Вообще, здесь гравитация (вернее её подобие) нужна не столько для симуляции реалистичной физики, сколько для "прижимания" игрока к земле.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> G#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> USERT=<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;for user</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> TERRT=<span style="color: #33ffdd;">2</span><span style="color: #ffee00">;for terrain</span><br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">10</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> user,<span style="color: #33ffdd;">0</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> user,USERT<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;обновление игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
V#=<span style="color: #33ffdd;">0.5</span><br />
u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #ffee00">;физика</span><br />
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tertex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> terrain,TERRT<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились &nbsp;</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Конечно, ничто кроме фантазии программиста не ограничивает возможности языка - так что, никто не мешает Вам, немного поразмыслив, реализовать настоящую модель гравитации. Обратите внимание: я стараюсь заменять конструкции типа x/2 на x*0.5 - это связано со спецификой обработки этих мат.операций процессором (спросите у SubZer0) 
</p>
<a name=".D0.9F.D1.80.D0.B8.D1.86.D0.B5.D0.BB"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=4" title="Править секцию: Прицел">править</a>]</span> <span class="mw-headline">Прицел</span></h2>
<p>Тыкс загрузим картинку прицела в глобале
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-Crosshair.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-Crosshair.png" src="iqbbkrqy.png" width="81" height="67" /></a></span></div></div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> pricel=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Crosshair.png&quot;</span><span style=" ">&#41;</span></div>
<p>назначаем начало координат картинки в её центре
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">MidHandle</span> pricel</div>
<p>А это
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">DrawImage</span> pricel,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>нужно вписть в главном цикле... вот не скажу где. Если вы использовали мой прицел, то увидите, что отображается он несовсем как хотелось бы.
Установим Mask-цвет - белый:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> pricel=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Crosshair.png&quot;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">MidHandle</span> pricel<br />
</p>
<span style="color: #aaffff; font-weight: bold;">MaskImage</span> pricel,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span></div>
<p>Так: немного подправим код для удобства:
внесём прицел в функцию создания перса, м немного морфируем физ. модель игрока. Теперь уже понятно почему и когда мы крутим камеру и основание. И теперь для удобства просчёта коллизий камеру поместим в центр прозрачной сферы.
И ещё
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">CameraRange</span> camera,<span style="color: #33ffdd;">0.1</span>,<span style="color: #33ffdd;">100</span></div>
<p>установит минимальный и максимальный радиусы рендеринга
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> G#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> USERT=<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;for user</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> TERRT=<span style="color: #33ffdd;">2</span><span style="color: #ffee00">;for terrain</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> pricel=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Crosshair.png&quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">10</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">MidHandle</span> pricel<br />
<span style="color: #aaffff; font-weight: bold;">MaskImage</span> pricel,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
k#=<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> user,k#,k#,k#<br />
<span style="color: #aaffff; font-weight: bold;">EntityRadius</span> user,k#<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">CameraRange</span> camera,<span style="color: #33ffdd;">0.1</span>,<span style="color: #33ffdd;">100</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> user,USERT<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;обновление игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
V#=<span style="color: #33ffdd;">0.5</span><br />
u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #ffee00">;физика</span><br />
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tertex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> terrain,TERRT<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились &nbsp;</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">DrawImage</span> pricel,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<a name=".D0.92.D1.8B.D1.81.D1.82.D1.80.D0.B5.D0.BB.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=5" title="Править секцию: Выстрелы">править</a>]</span> <span class="mw-headline">Выстрелы</span></h2>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> shot_sprite=<span style="color: #aaffff; font-weight: bold;">LoadSprite</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Shot.png&quot;</span><span style=" ">&#41;</span></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-Shot.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-Shot.png" src="bs9a_fmr.png" width="64" height="64" /></a></span></div></div>
<p>Это будет спрайт выстрела. В создании мира добавим
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">HideEntity</span> shot_sprite</div>
<p>скрыв таким образом загруженный спрайт. Создадим функцию порождения выстрела
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> create_Shot<span style=" ">&#40;</span>x#,y#,z#,pitch#,yaw#,roll#<span style=" ">&#41;</span><br />
<p>&nbsp;<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>6 аргументов описывают вектор выстрела: з координаты и углы вращения по осям
Создадим тип выстрела:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> shot<br />
<p><span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>Далее...
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> create_Shot<span style=" ">&#40;</span>x#,y#,z#,pitch#,yaw#,roll#<span style=" ">&#41;</span><br />
<p>s.shot=<span style="color: #aaffff; font-weight: bold;">New</span> shot<br />
s\entity=<span style="color: #aaffff; font-weight: bold;">CopyEntity</span><span style=" ">&#40;</span>shot_sprite<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> s\entity,x#,y#,z#,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> s\entity,pitch#,yaw#,roll#,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>В первой строке при помощи опереатора NEW создаём новый элемент типа shot. Теперь через S мы можем обратиться к любому полю данного элемента типа shot. s\entity - обращаемся к полю entity вновь созданного элемента. Сохраняем туда handle копии спрайта. Далее позиционируем вновь созданный (скопированный) спрайт и разворачиваем его. Последний аргумент 1 (true) означает, что действия будут выполнятся относительно мировых координат и осей.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>vs#=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>For a.shot=Each shot - на первый взгляд, заковыпистая конструкция. Такой цикл будет помещать по очереди в переменную а хендлы всех элементов указанного типа (в данном случае shot). Таким образом данный цикл продвинет все спрайты выстрелов на vs# вдоль оси Z. Добавляем update_shot() в главный цикл. Добавим строку
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span></div>
<p>В ф-цию обновления игрока. Уже можно посмотреть в действии:
</p><p><br />
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS01.gif" src="w6g-fznr.gif" width="205" height="228" /></a></span></div></div>
<p><br />
вот так будут улетать вдаль спрайты. Слово далеко относится к неопределённой логике. Ограничим расстояние полёта.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Field</span> dist#</div>
<p>добавим ещё одно поле в тип. И обработаем его:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>vs#=<span style="color: #33ffdd;">1</span><br />
max_dist#=<span style="color: #33ffdd;">1000</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
&nbsp;a\dist#=a\dist#+vs#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>будем накапливать всоответствующем поле пройденное "снарядом" расстояние, и если оно больше максимального, то: очистим память, занимаемую спрайтом, затем удалим этот элемент типа. В том, что всё работает как надо Вы можите убедиться поэкспериментировав со значением max_dist# и сделав кучу выстрелов (после исчезновения выстрелов фпс возвращается в стабильное состояние).
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> SHOTT=<span style="color: #33ffdd;">3</span><span style="color: #ffee00">;for shot</span></div>
<p>в глобал.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Collisions</span> SHOTT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span></div>
<p>в создание мира
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">EntityType&lt;.b&gt; s\entity,SHOTT</div>
<p>в создании выстрела.
Если запустить программу теперь, то можно наблюдать забавный эффект - поверхность стала уловителем выстрелов:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS02.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS02.jpg" src="pu0dd22o.jpg" width="522" height="206" /></a></span></div></div>
<p>Обновим условие в цикле обработки выстрелов
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
<span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,TERRT<span style=" ">&#41;</span> &lt; &gt; <span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
</p>
<span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>Теперь при столкновении текущего спрайта с объектом, у которого коллизионный тип (а не "обычный" тип - как shot) TERRT, происходит удаление выстрела.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> G#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> USERT=<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;for user</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> TERRT=<span style="color: #33ffdd;">2</span><span style="color: #ffee00">;for terrain</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> SHOTT=<span style="color: #33ffdd;">3</span><span style="color: #ffee00">;for shot</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> pricel=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Crosshair.png&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> shot_sprite=<span style="color: #aaffff; font-weight: bold;">LoadSprite</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Shot.png&quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> shot<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> dist#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">10</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">MidHandle</span> pricel<br />
<span style="color: #aaffff; font-weight: bold;">MaskImage</span> pricel,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
k#=<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> user,k#,k#,k#<br />
<span style="color: #aaffff; font-weight: bold;">EntityRadius</span> user,k#<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">CameraRange</span> camera,<span style="color: #33ffdd;">0.1</span>,<span style="color: #33ffdd;">100</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> user,USERT<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;обновление игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
V#=<span style="color: #33ffdd;">0.5</span><br />
u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;физика</span><br />
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_Shot<span style=" ">&#40;</span>x#,y#,z#,pitch#,yaw#,roll#<span style=" ">&#41;</span><br />
s.shot=<span style="color: #aaffff; font-weight: bold;">New</span> shot<br />
s\entity=<span style="color: #aaffff; font-weight: bold;">CopyEntity</span><span style=" ">&#40;</span>shot_sprite<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> s\entity,SHOTT<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> s\entity,x#,y#,z#,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> s\entity,pitch#,yaw#,roll#,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
vs#=<span style="color: #33ffdd;">1</span><br />
max_dist#=<span style="color: #33ffdd;">1000</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
&nbsp;a\dist#=a\dist#+vs#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,TERRT<span style=" ">&#41;</span> &lt; &gt; <span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">HideEntity</span> shot_sprite<br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tertex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> terrain,TERRT<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> SHOTT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились &nbsp;</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">DrawImage</span> pricel,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Наряду с описанными в хелпе функциями, для работы с типами, есть и недокументированные команды Object и Handle, которые облегчают программирование доступа к конкретному элементу типа. Об этом в другой раз.
</p>
<a name=".D0.9A.D0.BE.D0.B2.D0.B0.D1.80.D0.BD.D1.8B.D0.B5_.D0.B1.D0.BE.D1.82.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=6" title="Править секцию: Коварные боты">править</a>]</span> <span class="mw-headline">Коварные боты</span></h2>
<p>Итак, оружие есть - надо и поохотиться. Создадим тип для ботов
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> bot<br />
<p><span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>Далее как обычно:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> create_bot<span style=" ">&#40;</span>x#,y#,z#<span style=" ">&#41;</span><br />
<p>b.bot=<span style="color: #aaffff; font-weight: bold;">New</span> bot<br />
b\entity=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> b\entity,x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Для простоты визуализация бота будет сведена отображению на экране сферы.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>v#=<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.bot=<span style="color: #aaffff; font-weight: bold;">Each</span> bot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PointEntity</span> a\entity,user<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,v#<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Тут всё ясно как день. За исключением, быть может, команды PointEntity entity,target[,roll#] . Так как основы создания искусственного 
интеллекта на базе нейроподобных сетей здесь рассматривать не имеет смысла. А ур-ий, по которым бот, так или иначе, будет за вами двигаться, можно придумать достаточно много, то ограничимся результатом работы самой простой (в исполнении Блитца) команды. После её выполнения объект entity будет развёрнут "лицом" (т.е. в сторону положительного направления Z-оси) к объекту target. Это допустимо, так как в нашем случае действие происходит на плоскости. Не забываем про главный цикл программы. Чуть не забыл (куда это добавлять - должно быть уже очевидно, если нет - в конце я прилагаю исходный код всей программы):
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> BOTT=<span style="color: #33ffdd;">4</span><span style="color: #ffee00">;for bot</span><br />
<p><br />
...<br />
<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> b\entity,BOTT<br />
<br />
...<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,USERT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">Collisions</span> SHOTT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span></div>
<p>а в функции создания мира
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">create_bot<span style=" ">&#40;</span><span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">50</span><span style=" ">&#41;</span></div>
<p>Можно запустить и посмотреть. Как видно, на некотором расстоянии от игрока, бот остановится и начнёт совершать непонятные движения - это он наткнулся на прозрачную сферу, которой окружён игрок. Перепишем ф-цию обновления выстрелов:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>vs#=<span style="color: #33ffdd;">1</span><br />
max_dist#=<span style="color: #33ffdd;">1000</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
&nbsp;a\dist#=a\dist#+vs#<br />
&nbsp;bot_h=<span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,BOTT<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,TERRT<span style=" ">&#41;</span> &lt; &gt; <span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> bot_h &lt; &gt; <span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> q.bot=<span style="color: #aaffff; font-weight: bold;">Each</span> bot<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> q\entity=bot_h<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> q<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Фууу... меня очень угнетает цикл с перебором всех ботов в поисках записи о подбитом, но объяснять как это можно сделать проще, а главное быстрее пока не буду. И чтобы превратить игру в бесконечно долгую, перепишем условие уничтожения бота:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h<br />
<p><span style="color: #aaffff; font-weight: bold;">Delete</span> q<br />
create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Exit</span></div>
<p>Теперь за каждого убитого бота около игрока (в радиусе 100) будет "респиться" новый бот. Причём сколько было ботов при загрузке - такое их кол-во и будет поддерживаться в игре. Перепишем функцию создания мира:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">c_bot=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;input Amount&quot;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> c_bot<br />
&nbsp;create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Next</span></div>
<p>При загрузке будет запрос на ввод кол-ва ботов.
Попробуйте указать 20 и ничего не делайте - вскоре боты заблокируют вас полностью. Понаблюдайте за обработкой коллизий.
</p><p>Даже если Вы работаете с типами впервые, рассмотренного здесь вполне достаточно, чтобы реализовать "жизни" для ботов и зарезервировать поля для хранения промежуточных результатов работы ИИ. Для придания объёма (это надо было ещё вначале сделать) я добавил в create_world() создание и ротацию света:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">light=<span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> light,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span></div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> G#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> USERT=<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;for user</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> TERRT=<span style="color: #33ffdd;">2</span><span style="color: #ffee00">;for terrain</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> SHOTT=<span style="color: #33ffdd;">3</span><span style="color: #ffee00">;for shot</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> BOTT=<span style="color: #33ffdd;">4</span><span style="color: #ffee00">;for bot</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> pricel=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Crosshair.png&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> shot_sprite=<span style="color: #aaffff; font-weight: bold;">LoadSprite</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Shot.png&quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> shot<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> dist#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> bot<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">10</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">MidHandle</span> pricel<br />
<span style="color: #aaffff; font-weight: bold;">MaskImage</span> pricel,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
k#=<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> user,k#,k#,k#<br />
<span style="color: #aaffff; font-weight: bold;">EntityRadius</span> user,k#<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">CameraRange</span> camera,<span style="color: #33ffdd;">0.1</span>,<span style="color: #33ffdd;">100</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> user,USERT<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;обновление игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
V#=<span style="color: #33ffdd;">0.5</span><br />
u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;физика</span><br />
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_Shot<span style=" ">&#40;</span>x#,y#,z#,pitch#,yaw#,roll#<span style=" ">&#41;</span><br />
s.shot=<span style="color: #aaffff; font-weight: bold;">New</span> shot<br />
s\entity=<span style="color: #aaffff; font-weight: bold;">CopyEntity</span><span style=" ">&#40;</span>shot_sprite<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> s\entity,SHOTT<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> s\entity,x#,y#,z#,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> s\entity,pitch#,yaw#,roll#,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
vs#=<span style="color: #33ffdd;">1</span><br />
max_dist#=<span style="color: #33ffdd;">1000</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
&nbsp;a\dist#=a\dist#+vs#<br />
&nbsp;bot_h=<span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,BOTT<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,TERRT<span style=" ">&#41;</span> &lt; &gt; <span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> bot_h &lt; &gt; <span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> q.bot=<span style="color: #aaffff; font-weight: bold;">Each</span> bot<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> q\entity=bot_h<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> q<br />
&nbsp; &nbsp; create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_bot<span style=" ">&#40;</span>x#,y#,z#<span style=" ">&#41;</span><br />
b.bot=<span style="color: #aaffff; font-weight: bold;">New</span> bot<br />
b\entity=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> b\entity,BOTT<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> b\entity,x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
v#=<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.bot=<span style="color: #aaffff; font-weight: bold;">Each</span> bot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PointEntity</span> a\entity,user<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,v#<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
light=<span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> light,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">HideEntity</span> shot_sprite<br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tertex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> terrain,TERRT<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
c_bot=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;input Amount&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> c_bot<br />
&nbsp;create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> SHOTT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,USERT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> SHOTT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились &nbsp;</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">DrawImage</span> pricel,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<a name=".D0.91.D0.B0.D0.B3-.D1.84.D0.B8.D0.BA.D1.81"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=7" title="Править секцию: Баг-фикс">править</a>]</span> <span class="mw-headline">Баг-фикс</span></h2>
<p>Я всё-таки почти человек, поэтому ничего странного, что забыл дописать ещё вот что:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>v#=<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.bot=<span style="color: #aaffff; font-weight: bold;">Each</span> bot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PointEntity</span> a\entity,user<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,v#<br />
<span style="color: #ffee00">;физика</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>теперь ботов будет притягивать вниз.
</p>
<a name=".D0.A7.D0.B8.D1.82-.D0.BC.D0.BE.D0.B4"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=8" title="Править секцию: Чит-мод">править</a>]</span> <span class="mw-headline">Чит-мод</span></h2>
<p>Попробуйте включить в функцию обработки игрока строку
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span></div>
<p>И стрелять, используя удержание правой кнопки мыши.
</p>
<a name=".D0.A3.D1.85.D0.BE.D0.B4_.D0.BE.D1.82_.D0.BF.D0.BE.D0.BB.D0.BD.D0.BE.D0.B3.D0.BE_.D0.BF.D0.B5.D1.80.D0.B5.D0.B1.D0.BE.D1.80.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=9" title="Править секцию: Уход от полного перебора">править</a>]</span> <span class="mw-headline">Уход от полного перебора</span></h2>
<p>Расскажу, как улучшить цикл обработки выстрелов. В Блитце есть недокументированные команды Handle и Object. Благодаря команде Handle можно получить "указатель" на объект типа (использование термина "указатель" весьма спорно для Блитца). Например:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">P.Player=<span style="color: #aaffff; font-weight: bold;">New</span> Player<br />
pHANDLE=Handle<span style=" ">&#40;</span>P<span style=" ">&#41;</span></div>
<p>а затем, используя сохранённое значение (здесь в переменной pHANDLE) получить доступ к элементу типа:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">P.PLAYER=Object.PLAYER<span style=" ">&#40;</span>pHANDLE<span style=" ">&#41;</span></div>
<p>Модифицируем функцию create_bot
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> create_bot<span style=" ">&#40;</span>x#,y#,z#<span style=" ">&#41;</span><br />
<p>b.bot=<span style="color: #aaffff; font-weight: bold;">New</span> bot<br />
b\entity=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> b\entity,BOTT<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> b\entity,x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">NameEntity</span> b\entity,Handle<span style=" ">&#40;</span>b<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Командой NameEntity присвоим объекту B\entity имя - в данном случае, совпадающее с хендлом элемента типа, 
содержащего данный объект. Теперь модифим кусок функции update_shot()
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>vs#=<span style="color: #33ffdd;">1</span><br />
max_dist#=<span style="color: #33ffdd;">1000</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
&nbsp;a\dist#=a\dist#+vs#<br />
&nbsp;bot_h=<span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,BOTT<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,TERRT<span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> bot_h&lt;&gt;<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp; bhandle=<span style="color: #aaffff; font-weight: bold;">EntityName</span><span style=" ">&#40;</span>bot_h<span style=" ">&#41;</span><br />
&nbsp; bc.bot=Object.bot<span style=" ">&#40;</span>bhandle<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> bc<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h<br />
&nbsp; create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Здесь мы получаем указатель на элемент типа из имени бота (имени объекта, который его визуализирует - сферы)
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">bhandle=<span style="color: #aaffff; font-weight: bold;">EntityName</span><span style=" ">&#40;</span>bot_h<span style=" ">&#41;</span></div>
<p>далее удалям запись об этом боте (удаляем соответствующий элемент типа)
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">bc.bot=Object.bot<span style=" ">&#40;</span>bhandle<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Delete</span> bc</div>
<p>И, наконец, удаляем сам объект (используя его хендл)
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h</div>
<p>Таким образом, мы избавились от цикла и сохранили прежнюю функциональность, повысив при этом 
производительность.
</p>
<a name=".D0.A3.D1.85.D0.BE.D0.B4_.D0.BE.D1.82_.D0.BF.D1.80.D0.B8.D0.B2.D1.8F.D0.B7.D0.BA.D0.B8_.D0.BA_FPS"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=10" title="Править секцию: Уход от привязки к FPS">править</a>]</span> <span class="mw-headline">Уход от привязки к FPS</span></h2>
<p>В текущей версии программы события (а именно: обновление ботов, игрока, выстрелов) будут происходить с частотой вызова соответствующих ф-ций. Т.е. (как видно из записи главного цикла) с частотой прорисовки - ФПС. А значит напрямую будут зависеть от производительности системы. Избавиться можно 2мя способами:
</p>
<ol><li> Производить обновление N раз в секунду - что приведёт к принудительному занижению высоких ФПС и скачкообразной анимации.
</li><li> Рассчитывать переменные скорости, ускорения и проч. в соответствии с дельтой времени. Что сейчас и сделаем.
</li></ol>
<p>Так как в следующих версиях алгоритма или уже в этой ( при большом кол-ве ботов) время начала обработки первого и последнего ботов вероятно будет отличаться на целое кол-во мс и так же потому, что глобальные переменные делают программу, имхо, менее удобочитаемой и переносимой, а так же плодят логические ошибки (из-за ошибок при вводе имени) - для каждого бота сделаем собственное время последнего обновления.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> bot<br />
<p><span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> time<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>v#=<span style="color: #33ffdd;">0.03</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.bot=<span style="color: #aaffff; font-weight: bold;">Each</span> bot<br />
<span style="color: #ffee00">;=</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\time=<span style="color: #33ffdd;">0</span> a\time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;new_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;delta_t=new_time-a\time<br />
&nbsp;a\time=new_time<br />
<span style="color: #ffee00">;=</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PointEntity</span> a\entity,user<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,v#*delta_t<br />
<span style="color: #ffee00">;физика</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#*delta_t,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Ёлки-палки - только сейчас заметил, что боты притягиваются с коэффицентом 1 а не G. Переменная v# должна получиться универсальным значением для всех ПК (однако Вы можете откалибровать её по-точнее). Проделаем операцию ухода... для выстрелов:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> shot<br />
<p><span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> dist#<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> time<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>v#=<span style="color: #33ffdd;">0.1</span><br />
max_dist#=<span style="color: #33ffdd;">1000</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
<span style="color: #ffee00">;=</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\time=<span style="color: #33ffdd;">0</span> a\time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;new_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;delta_t=new_time-a\time<br />
&nbsp;a\time=new_time<br />
&nbsp;vs#=v*delta_t<br />
<span style="color: #ffee00">;=</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
&nbsp;a\dist#=a\dist#+vs#<br />
&nbsp;bot_h=<span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,BOTT<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,TERRT<span style=" ">&#41;</span><span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> bot_h0<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp; bhandle=<span style="color: #aaffff; font-weight: bold;">EntityName</span><span style=" ">&#40;</span>bot_h<span style=" ">&#41;</span><br />
&nbsp; bc.bot=Object.bot<span style=" ">&#40;</span>bhandle<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> bc<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h<br />
&nbsp; create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Обратите внимание здесь рассчитанная по дельте скорость используется не идиножды - сохраняем в отдельную переменную.Теперь сам игрок. Поскольку мультиплеером в игре и не пахнет - игрок реализован не типизированным объектом и он один. Заведём для его обновления глобальную переменную:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> user_time</div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #ffee00">;=</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> user_time=<span style="color: #33ffdd;">0</span> user_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
new_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
delta_t=new_time-user_time<br />
user_time=new_time<br />
<span style="color: #ffee00">;=</span><br />
V#=<span style="color: #33ffdd;">0.02</span>*delta_t<br />
u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;физика</span><br />
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#*delta_t,<span style="color: #33ffdd;">0</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Осталось откалибровать коэффициент гравитации.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> G#=<span style="color: #33ffdd;">0.1</span></div>
<p>Пока поставил такое значение. 
</p>
<a name=".D0.9D.D0.B5.D0.B1.D0.B5.D1.81.D0.BD.D0.B0.D1.8F_.D1.81.D1.84.D0.B5.D1.80.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=11" title="Править секцию: Небесная сфера">править</a>]</span> <span class="mw-headline">Небесная сфера</span></h2>
<p>Вопреки названию, будем создавать не сферу, а SkyBox - коробку, так как для неё проще изготовить текстуру и смотрится, имхо, она красивее. Возьмём стандартную функцию создания из примеров блитца (\Samples\Blitz 3D Samples\AGore\GrassDemo).
</p><p><br />
Понадобятся следующие изображения:
</p>
<center>
<p><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyBK.jpg" class="image" title="Изображение:FPS-SkyBK.jpg"><img alt="Изображение:FPS-SkyBK.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyBK.jpg" src="l3rsckue.jpg" width="256" height="256" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyFR.jpg" class="image" title="Изображение:FPS-SkyFR.jpg"><img alt="Изображение:FPS-SkyFR.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyFR.jpg" src="my5k8fnu.jpg" width="256" height="256" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyLF.jpg" class="image" title="Изображение:FPS-SkyLF.jpg"><img alt="Изображение:FPS-SkyLF.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyLF.jpg" src="xpo6wlx1.jpg" width="256" height="256" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyRT.jpg" class="image" title="Изображение:FPS-SkyRT.jpg"><img alt="Изображение:FPS-SkyRT.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyRT.jpg" src="aabmo546.jpg" width="256" height="256" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyUP.jpg" class="image" title="Изображение:FPS-SkyUP.jpg"><img alt="Изображение:FPS-SkyUP.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyUP.jpg" src="7yc_v-nx.jpg" width="256" height="256" /></a>
</p>
</center>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> MakeSkyBox<span style=" ">&#40;</span> file$ <span style=" ">&#41;</span><br />
<p><br />
m=<span style="color: #aaffff; font-weight: bold;">CreateMesh</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;front face</span><br />
b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;FR.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
<span style="color: #ffee00">;right face</span><br />
b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;LF.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
<span style="color: #ffee00">;back face</span><br />
b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;BK.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
<span style="color: #ffee00">;left face</span><br />
b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;RT.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
<span style="color: #ffee00">;top face</span><br />
b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;UP.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> m,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span><br />
<span style="color: #aaffff; font-weight: bold;">FlipMesh</span> m<br />
<span style="color: #aaffff; font-weight: bold;">EntityFX</span> m,<span style="color: #33ffdd;">9</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityOrder</span> m,<span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> m<br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>и скопируем её в наш код. Вот, кстати, довод за использование ф-ций: в любой момент вы можете использовать свои наработки в других проектах.
Переместимся в функцию create_world() 
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><br />
sky=MakeSkyBox<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Sky&quot;</span><span style=" ">&#41;</span><br />
<br />
</p>
c_bot=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;input Amount&quot;</span><span style=" ">&#41;</span></div>
<p>и скопируем текстуры неба из папки с примером в папку нашей программы. Уже сейчас можно посмотреть на результат, правда, сомнительный. Из-за недостаточных размеров skybox`а небо ощутимо квадратное:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS03.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS03.jpg" src="wlqx27bd.jpg" width="200" height="200" /></a></span></div></div>
<p>Отскалим небо
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> sky,<span style="color: #33ffdd;">150</span>,<span style="color: #33ffdd;">150</span>,<span style="color: #33ffdd;">150</span></div>
<p>После этого незамысловатого изменения небо исчезнет совсем =(. Вероятно оно за максимальным радиусом ренедера. Глянем в create_user - именно здесь мы обрезали расстония рендера, правим:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">CameraRange</span> camera,<span style="color: #33ffdd;">0.1</span>,<span style="color: #33ffdd;">10000</span></div>
<p>Проверяем - всё работает =)
</p>
<a name=".D0.96.D0.B8.D0.B2.D1.83.D1.87.D0.B8.D0.B5_.D0.B1.D0.BE.D1.82.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=12" title="Править секцию: Живучие боты">править</a>]</span> <span class="mw-headline">Живучие боты</span></h2>
<p>Бот, умирающий от одного залпа, - это, кончено весело, но не интересно. Добавим ботам шкалу жизни. Итак, переходим в объявление типа и правим:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> bot<br />
<p><span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> time<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> Survivability<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>В создании бота припишем:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">b\Survivability=<span style="color: #33ffdd;">100</span></div>
<p>Теперь надо растянуть смерть бота, а значит переходим в ф-цию update_shot()
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">ElseIf</span> bot_h&lt;&gt;<span style="color: #33ffdd;">0</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;bhandle=<span style="color: #aaffff; font-weight: bold;">EntityName</span><span style=" ">&#40;</span>bot_h<span style=" ">&#41;</span><br />
&nbsp;bc.bot=Object.bot<span style=" ">&#40;</span>bhandle<span style=" ">&#41;</span><br />
&nbsp;bc\Survivability=bc\Survivability<span style="color: #33ffdd;">-16</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> bc\Survivability&lt;=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> bc<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h<br />
&nbsp; create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>Если есть столкновение пули с ботом, то удаляем пулю и её информационный элемент, получаем хендл элемента типа для бота, получаем доступ к элементу типа, вычитаем из значения живучести бота число. Если живучесть бота меньше или равна 0, то удаляем информацию о боте, удаляем тело бота, создаём нового бота.
Теперь равновесие сместилось в пользу ботов - за это понизим им скорость передвижения:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
v#=<span style="color: #33ffdd;">0.01</span></div>
<a name=".D0.96.D0.B8.D0.B7.D0.BD.D1.8C_.D0.B2_.D0.BA.D0.BE.D1.80.D0.BE.D0.B1.D0.BA.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=13" title="Править секцию: Жизнь в коробке">править</a>]</span> <span class="mw-headline">Жизнь в коробке</span></h2>
<p>Рано или поздно, надо чётко обазначить границы игрового мира. После добавления в игру SkyBox, это становится необходимо сделать. Модифицируем ф-цию создания неба и сохраним её под новым именем (прототип тоже надо оставить в коде):
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> MakeBox<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><br />
m=<span style="color: #aaffff; font-weight: bold;">CreateMesh</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;front face</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #ffee00">;right face</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #ffee00">;back face</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #ffee00">;left face</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #ffee00">;top face</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> m,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span><br />
<span style="color: #aaffff; font-weight: bold;">FlipMesh</span> m<br />
<span style="color: #aaffff; font-weight: bold;">EntityFX</span> m,<span style="color: #33ffdd;">9</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityOrder</span> m,<span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> m<br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Теперь функция возвращает хендл простой неоттекстурированной корбки. Зайдём в create_world():
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">border=MakeBox<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #ffee00">;ScaleEntity border,140,140,140</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> border,.<span style="color: #33ffdd;">5</span></div>
<p>Запустим прогамму. Если некоторое время идти в одном направлении, можно увидеть коробку, ограничивающую уровень:
</p><p><br />
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS04.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS04.jpg" src="sp4mtdzn.jpg" width="200" height="200" /></a></span></div></div>
<p><br />
Теперь поставим этой коробке в соответствие тип для колизии
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> BORDERT=<span style="color: #33ffdd;">5</span><span style="color: #ffee00">;for box</span><br />
<p><br />
...<br />
<br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> border,.<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> border,BORDERT<br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,BORDERT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span></div>
<p>Боты могут проходить сквозь эту стену - на случай если игрок будет в крайнем положении, в следствие чего бот создастся за стеной. Поэтому коллизию с типом ботов не ставим. Спрайтам выстрелов это тоже не нужно. Теперь, если идти в одну сторону, в какой-то момент вы просто упрётесь в стену. Ставим стене нулевую альфу и растягиваем её.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">border=MakeBox<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> border,<span style="color: #33ffdd;">140</span>,<span style="color: #33ffdd;">140</span>,<span style="color: #33ffdd;">140</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> border,<span style="color: #33ffdd;">0</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">EntityType</span> border,BORDERT</div>
<a name=".D0.9A.D0.BE.D0.B4.D0.B8.D0.BC-.D0.BA.D0.BE.D0.B4.D0.B8.D0.BC"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=14" title="Править секцию: Кодим-кодим">править</a>]</span> <span class="mw-headline">Кодим-кодим</span></h2>
<p>Что-то управление больно казуальным вышло. Перенастроим движение на W,S,A,D. Функция update_user()
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">30</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<p><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">32</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">17</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
</p>
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">31</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#</div>
<a name=".D0.9F.D1.80.D1.8B.D0.B6.D0.BA.D0.B8_.D0.B8_.D1.80.D0.B5.D0.B0.D0.BB.D0.B8.D1.81.D1.82.D0.B8.D1.87.D0.BD.D0.BE.D1.81.D1.82.D1.8C_.D1.84.D0.B8.D0.B7.D0.B8.D0.BA.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=15" title="Править секцию: Прыжки и реалистичность физики">править</a>]</span> <span class="mw-headline">Прыжки и реалистичность физики</span></h2>
<p>Давно пора было это сделать. Для нормальной реализации кинематики нам понадобится:
</p>
<a name=".D0.9A.D0.BE.D0.BD.D1.82.D1.80.D0.BE.D0.BB.D1.8C_.D0.B7.D0.B0_.D0.BE.D1.82.D1.80.D1.8B.D0.B2.D0.BE.D0.BC_.D0.BE.D1.82_.D0.B7.D0.B5.D0.BC.D0.BB.D0.B8_.D0.B8_.D0.BC.D0.BE.D0.BC.D0.B5.D0.BD.D1.82.D0.BE.D0.BC_.D1.81.D0.BE.D0.BF.D1.80.D0.B8.D0.BA.D0.BE.D1.81.D0.BD.D0.BE.D0.B2.D0.B5.D0.BD.D0.B8.D1.8F_.D1.81_.D0.BD.D0.B5.D0.B9"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=16" title="Править секцию: Контроль за отрывом от земли и моментом соприкосновения с ней">править</a>]</span> <span class="mw-headline">Контроль за отрывом от земли и моментом соприкосновения с ней</span></h3>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">EntityPickMode</span> terrain,<span style="color: #33ffdd;">2</span></div>
<p>Теперь к земле можно применить операцию pick.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> jump_bool</div>
<p>Переменная под логику отрыва от поверхности.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;физика</span><br />
<p>jump_bool=<span style="color: #aaffff; font-weight: bold;">True</span><br />
pick_ent=<span style="color: #aaffff; font-weight: bold;">LinePick</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-3</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">If</span> pick_ent jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span></div>
<p>Допишем в функции обновления игрока. И добавим
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #00ff66;">&quot;jump_bool=&quot;</span>+jump_bool<br />
<span style="color: #aaffff; font-weight: bold;">Flip</span></div>
<p>в главном цикле. Запустим. И увидим, что программа работает неверно.jump_bool=1, т.е. условие If pick_ent не срабатывает, т.е. LinePick возвращает 0, т.е. на расстоянии 3 ед. под игроком ничего "не цепляется" командой Pick =(. Вообще в этой точке будет как раз соприкосновение сферы игрока и земли, так что надо попробовать увеличить расстояние - методом калибровки подбираем значение=3.6
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">pick_ent=<span style="color: #aaffff; font-weight: bold;">LinePick</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-3.6</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span></div>
<p>Ориентировочное значение три я взял, исходя из ф-ции создания игрока:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>k#=<span style="color: #33ffdd;">3</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> user,k#,k#,k#</div>
<p>и если был бы внимательнее, посмотрел чуть ниже
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">EntityRadius</span> user,k#</div>
<p>Радиус коллизи тоже равен 3, что как раз и объясняет возникшее затруднение. Наше расстояние должно быть немногим больше 3, как оказалось = 3.6. Теперь значение jump_bool характеризует состояние игрока - есть или нет сцепления.
</p>
<a name=".D0.92.D1.80.D0.B5.D0.BC.D1.8F_.D0.BD.D0.B5.D0.B2.D0.B7.D0.B0.D0.B8.D0.BC.D0.BE.D0.B4.D0.B5.D0.B9.D1.81.D1.82.D0.B2.D0.B8.D1.8F_.D1.81_.D0.B7.D0.B5.D0.BC.D0.BB.D1.91.D0.B9"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=17" title="Править секцию: Время невзаимодействия с землёй">править</a>]</span> <span class="mw-headline">Время невзаимодействия с землёй</span></h3>
<p>Перепишем обновление игрока ещё раз:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;физика</span><br />
<p><br />
pick_ent=<span style="color: #aaffff; font-weight: bold;">LinePick</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-3.6</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> pick_ent <br />
&nbsp;jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span> <br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp;jump_bool=<span style="color: #aaffff; font-weight: bold;">True</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>Время взаимодействия как-таковое нам нужно между обновлениями,а оно у нас уже есть.
</p>
<a name=".D0.A1.D0.BA.D0.BE.D1.80.D0.BE.D1.81.D1.82.D0.B8_.D0.B4.D0.B2.D0.B8.D0.B6.D0.B5.D0.BD.D0.B8.D1.8F_.D0.B4.D0.BB.D1.8F_.D0.B8.D1.85_.D0.B4.D0.B8.D0.BD.D0.B0.D0.BC.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.BE.D0.B3.D0.BE_.D0.B8.D0.B7.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D1.8F"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=18" title="Править секцию: Скорости движения для их динамического изменения">править</a>]</span> <span class="mw-headline">Скорости движения для их динамического изменения</span></h3>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> user_vy#</div>
<p>Снова переписываем:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">pick_ent=<span style="color: #aaffff; font-weight: bold;">LinePick</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-3.6</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">If</span> pick_ent <br />
&nbsp;jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span> <br />
&nbsp;user_vy#=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp;jump_bool=<span style="color: #aaffff; font-weight: bold;">True</span><br />
&nbsp;user_vy#=user_vy#-G#*delta_t<span style="color: #ffee00">;v1=v2-a*t</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,user_vy#*delta_t,<span style="color: #33ffdd;">0</span></div>
<a name=".D0.98.D0.BD.D0.B8.D1.86.D0.B8.D0.B0.D0.BB.D0.B8.D0.B7.D0.B0.D1.86.D0.B8.D1.8F_.D1.81.D0.BE.D0.B1.D1.8B.D1.82.D0.B8.D1.8F_.22.D0.BF.D1.80.D1.8B.D0.B6.D0.BE.D0.BA.22"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=19" title="Править секцию: Инициализация события &quot;прыжок&quot;">править</a>]</span> <span class="mw-headline">Инициализация события "прыжок"</span></h3>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,user_vy#*delta_t,<span style="color: #33ffdd;">0</span><br />
<p><span style="color: #ffee00">;;;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">57</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span> <span style="color: #aaffff; font-weight: bold;">Then</span> user_vy#=<span style="color: #33ffdd;">50</span></div>
<p>однако - не работает =(. После некоторых раздумий подправим физику
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">pick_ent=<span style="color: #aaffff; font-weight: bold;">LinePick</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-3.6</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,user_vy#*delta_t,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">True</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> pick_ent<br />
&nbsp;jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span><br />
&nbsp;user_vy=<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp;jump_bool=<span style="color: #aaffff; font-weight: bold;">True</span><br />
&nbsp;user_vy#=user_vy#-G#*delta_t<span style="color: #ffee00">;v1=v2-a*t</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #ffee00">;;;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">57</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span> <span style="color: #aaffff; font-weight: bold;">Then</span> user_vy#=<span style="color: #33ffdd;">1</span></div>
<p>и гравитацию на 0.001. Однако теперь объект не смещается вниз, пока его не сдвинут вперёд-назад или влево-вправо. Я думаю, логика игры не пострадает, если предположить, что человек, прыгая вверх чуть-чуть смещается вперёд.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,user_vy#*delta_t,user_vy#*<span style="color: #33ffdd;">0.01</span>,<span style="color: #aaffff; font-weight: bold;">True</span></div>
<p>Вот полный код:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> G#=<span style="color: #33ffdd;">0.001</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> USERT=<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;for user</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> TERRT=<span style="color: #33ffdd;">2</span><span style="color: #ffee00">;for terrain</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> SHOTT=<span style="color: #33ffdd;">3</span><span style="color: #ffee00">;for shot</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> BOTT=<span style="color: #33ffdd;">4</span><span style="color: #ffee00">;for bot</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> BORDERT=<span style="color: #33ffdd;">5</span><span style="color: #ffee00">;for box</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> jump_bool<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user_time<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user_vy#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> pricel=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Crosshair.png&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> shot_sprite=<span style="color: #aaffff; font-weight: bold;">LoadSprite</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Shot.png&quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> shot<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> dist#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> time<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> bot<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> time<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> Survivability<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">10</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">MidHandle</span> pricel<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">MaskImage</span> pricel,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
&nbsp; <br />
&nbsp; user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; k#=<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> user,k#,k#,k#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityRadius</span> user,k#<br />
&nbsp; camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">CameraRange</span> camera,<span style="color: #33ffdd;">0.1</span>,<span style="color: #33ffdd;">10000</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityType</span> user,USERT<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;обновление игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffee00">;=</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> user_time=<span style="color: #33ffdd;">0</span> user_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; new_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; delta_t=new_time-user_time<br />
&nbsp; user_time=new_time<br />
&nbsp; <span style="color: #ffee00">;=</span><br />
&nbsp; V#=<span style="color: #33ffdd;">0.02</span>*delta_t<br />
&nbsp; u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">30</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">32</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">17</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">31</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; <br />
<br />
&nbsp; <span style="color: #ffee00">;физика</span><br />
&nbsp; <br />
&nbsp; <br />
&nbsp; pick_ent=<span style="color: #aaffff; font-weight: bold;">LinePick</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-3.6</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,user_vy#*delta_t,user_vy#*<span style="color: #33ffdd;">0.01</span>,<span style="color: #aaffff; font-weight: bold;">True</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pick_ent<br />
&nbsp; &nbsp; jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span><br />
&nbsp; &nbsp; user_vy=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">True</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; jump_bool=<span style="color: #aaffff; font-weight: bold;">True</span><br />
&nbsp; &nbsp; user_vy#=user_vy#-G#*delta_t<span style="color: #ffee00">;v1=v2-a*t</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp; <span style="color: #ffee00">;;;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">57</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span> <span style="color: #aaffff; font-weight: bold;">Then</span> user_vy#=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_Shot<span style=" ">&#40;</span>x#,y#,z#,pitch#,yaw#,roll#<span style=" ">&#41;</span><br />
&nbsp; s.shot=<span style="color: #aaffff; font-weight: bold;">New</span> shot<br />
&nbsp; s\entity=<span style="color: #aaffff; font-weight: bold;">CopyEntity</span><span style=" ">&#40;</span>shot_sprite<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityType</span> s\entity,SHOTT<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> s\entity,x#,y#,z#,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> s\entity,pitch#,yaw#,roll#,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; v#=<span style="color: #33ffdd;">0.1</span><br />
&nbsp; max_dist#=<span style="color: #33ffdd;">1000</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
&nbsp; &nbsp; <span style="color: #ffee00">;=</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> a\time=<span style="color: #33ffdd;">0</span> a\time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; new_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; delta_t=new_time-a\time<br />
&nbsp; &nbsp; a\time=new_time<br />
&nbsp; &nbsp; vs#=v*delta_t<br />
&nbsp; &nbsp; <span style="color: #ffee00">;=</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
&nbsp; &nbsp; a\dist#=a\dist#+vs#<br />
&nbsp; &nbsp; bot_h=<span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,BOTT<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,TERRT<span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">ElseIf</span> bot_h&lt;&gt;<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp; &nbsp; &nbsp; bhandle=<span style="color: #aaffff; font-weight: bold;">EntityName</span><span style=" ">&#40;</span>bot_h<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; bc.bot=Object.bot<span style=" ">&#40;</span>bhandle<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; bc\Survivability=bc\Survivability<span style="color: #33ffdd;">-16</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> bc\Survivability&lt;=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> bc<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h<br />
&nbsp; &nbsp; &nbsp; &nbsp; create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_bot<span style=" ">&#40;</span>x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp; b.bot=<span style="color: #aaffff; font-weight: bold;">New</span> bot<br />
&nbsp; b\Survivability=<span style="color: #33ffdd;">100</span><br />
&nbsp; b\entity=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityType</span> b\entity,BOTT<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> b\entity,x#,y#,z#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">NameEntity</span> b\entity,Handle<span style=" ">&#40;</span>b<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; v#=<span style="color: #33ffdd;">0.01</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> a.bot=<span style="color: #aaffff; font-weight: bold;">Each</span> bot<br />
&nbsp; &nbsp; <span style="color: #ffee00">;=</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> a\time=<span style="color: #33ffdd;">0</span> a\time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; new_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; delta_t=new_time-a\time<br />
&nbsp; &nbsp; a\time=new_time<br />
&nbsp; &nbsp; <span style="color: #ffee00">;=</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PointEntity</span> a\entity,user<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,v#*delta_t<br />
&nbsp; &nbsp; <span style="color: #ffee00">;физика</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#*delta_t,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; light=<span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> light,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">HideEntity</span> shot_sprite<br />
&nbsp; terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tertex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityType</span> terrain,TERRT<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityPickMode</span> terrain,<span style="color: #33ffdd;">2</span><br />
&nbsp; create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <br />
&nbsp; sky=MakeSkyBox<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Sky&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> sky,<span style="color: #33ffdd;">150</span>,<span style="color: #33ffdd;">150</span>,<span style="color: #33ffdd;">150</span><br />
&nbsp; border=MakeBox<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> border,<span style="color: #33ffdd;">140</span>,<span style="color: #33ffdd;">140</span>,<span style="color: #33ffdd;">140</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> border,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityType</span> border,BORDERT<br />
&nbsp; <br />
&nbsp; c_bot=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;input Amount&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> c_bot<br />
&nbsp; &nbsp; create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,BORDERT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> SHOTT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,USERT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> SHOTT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> MakeSkyBox<span style=" ">&#40;</span> file$ <span style=" ">&#41;</span><br />
<br />
&nbsp; m=<span style="color: #aaffff; font-weight: bold;">CreateMesh</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffee00">;front face</span><br />
&nbsp; b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;FR.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
&nbsp; <span style="color: #ffee00">;right face</span><br />
&nbsp; b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;LF.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
&nbsp; <span style="color: #ffee00">;back face</span><br />
&nbsp; b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;BK.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
&nbsp; <span style="color: #ffee00">;left face</span><br />
&nbsp; b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;RT.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
&nbsp; <span style="color: #ffee00">;top face</span><br />
&nbsp; b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;UP.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> m,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FlipMesh</span> m<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityFX</span> m,<span style="color: #33ffdd;">9</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityOrder</span> m,<span style="color: #33ffdd;">10</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> m<br />
&nbsp; <br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> MakeBox<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; m=<span style="color: #aaffff; font-weight: bold;">CreateMesh</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffee00">;front face</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #ffee00">;right face</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #ffee00">;back face</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #ffee00">;left face</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #ffee00">;top face</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> m,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FlipMesh</span> m<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityFX</span> m,<span style="color: #33ffdd;">9</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityOrder</span> m,<span style="color: #33ffdd;">10</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> m<br />
&nbsp; <br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;функции закончились &nbsp;</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
&nbsp; update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">DrawImage</span> pricel,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #00ff66;">&quot;jump_bool=&quot;</span>+jump_bool<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Всё!
</p>
<div align="right"><a href="http://blitzetcetera.org/images/e/e8/FPS.zip" class="internal" title="FPS.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Impersonalis" title="Участник:Impersonalis">Impersonalis</a> (e-mail: impersonalis@boolean.name)
</p><!-- 
Pre-expand include size: 7800 bytes
Post-expand include size: 311 bytes
Template argument size: 14 bytes
Maximum: 2097152 bytes
-->

<!-- Saved in parser cache with key db1:pcache:idhash:1670-0!1!0!!ru!2 and timestamp 20071110032319 -->
<div class="printfooter">
Получено с <a href="9ijjlxur.html">http://blitzetcetera.org/index.php/%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter</a></div>
			<!-- end content -->			<div class="visualClear"></div>				</td>				<td class="rightside">				</td>			</tr>		</table>		</div>	</div>		</div>	
		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</div></body>
<!-- Mirrored from localhost/index.php/%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter by HTTrack Website Copier/3.x [XR&CO'2007], Sat, 10 Nov 2007 05:15:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>