<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru" dir="ltr">	
<!-- Mirrored from localhost/index.php/%D0%A2%D0%B5%D0%BA%D1%81%D1%82%D0%BE%D0%B2%D1%8B%D0%B5_%D0%B0%D0%B4%D0%B2%D0%B5%D0%BD%D1%82%D1%8E%D1%80%D1%8B by HTTrack Website Copier/3.x [XR&CO'2007], Sat, 10 Nov 2007 05:16:43 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />				<meta name="keywords" content="Текстовые адвентюры,Matt Merkulov" />
		<link rel="shortcut icon" href="http://blitzetcetera.org/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="http://blitzetcetera.org/opensearch_desc.php" title="Blitz Et Cetera (Русский)" />
		<title>Текстовые адвентюры — Blitz Et Cetera</title>		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "bvih5rde.css?63"; /*]]>*/</style>		<link rel="stylesheet" type="text/css" media="print" href="gcxktlm6.css?63" />		<link rel="stylesheet" type="text/css" media="handheld" href="zumsslq_.css?63" />		<!--[if lt IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE50Fixes.css?63";</style><![endif]-->		<!--[if IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE55Fixes.css?63";</style><![endif]-->		<!--[if IE 6]><style type="text/css">@import "/skins/OfflineNew/IE60Fixes.css?63";</style><![endif]-->		<!--[if IE 7]><style type="text/css">@import "/skins/OfflineNew/IE70Fixes.css?63";</style><![endif]-->		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?63"></script>		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->		<script type= "text/javascript">/*<![CDATA[*/
var skin = "OfflineNew";
var stylepath = "/skins";
var wgArticlePath = "/index.php/$1";
var wgScriptPath = "";
var wgServer = "http://blitzetcetera.org/";
var wgCanonicalNamespace = "";
var wgCanonicalSpecialPageName = false;
var wgNamespaceNumber = 0;
var wgPageName = "Текстовые_адвентюры";
var wgTitle = "Текстовые адвентюры";
var wgAction = "view";
var wgArticleId = "611";
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "ru";
var wgContentLanguage = "ru";
var wgBreakFrames = false;
var wgCurRevisionId = "3557";
/*]]>*/</script>
		<script type="text/javascript" src="2nq-6cel.js?63"><!-- wikibits js --></script>		<script type="text/javascript" src="http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=js"><!-- site js --></script>		<style type="text/css">/*<![CDATA[*/
@import "http://blitzetcetera.org/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=MediaWiki:OfflineNew.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=css&amp;maxage=18000";
/*]]>*/</style>		<!-- Head Scripts -->	</head><body  class="mediawiki ns-0 ltr page-Текстовые_адвентюры">	<div id="globalWrapper">	<div id="logocontainer">		<table align="center">		  <tr>				<td id="blitzetclogo">				</td>			</tr>		</table>	</div>	<div id="magbar">	Журнал о программированнии на языках Blitz3D, BlitzMax, BlitzPlus	</div>		<div id="column-content">	<div id="content">		<a name="top" id="top"></a>				<div id="bodyContent">		<table cellspacing=0 cellpadding=0 width=100%>			<tr>			  <td class="leftside">				</td>				<td class="sheetbody">					<h1 class="sheet">Текстовые адвентюры</h1>			<h3 id="siteSub">Материал из Blitz Et Cetera.</h3>			<div id="contentSub"></div>			<!-- start content -->			<p>Прежде всего, разъясню само понятие для тех, кто с ним не знаком.  Текстовые адвентюры - это жанр компьютерных игр, в которых пользователь вводит с клавиатуры команды (как то "взять камень" или "срубить топором дерево"), а компьютер распознает эти команды и, соответственно, реагирует. Игровой мир классических программ этого жанра состоит из локаций - абстрактных мест, где герой (а также другие объекты) может находиться. Между локациями можно перемещаться (иногда достаточно просто пойти в нужном направлении, а иногда - найти ключ, отпереть им дверь и войти в нее), в них можно производить действия с объектами. Некоторые объекты игрового мира можно взять, тогда они переносятся в инвентарь (обычно, это изолированная локация) и главный герой сможет ими воспользоваться, имея их всегда под рукой.
</p><p>Львиная доля текстовых адвентюр написана на платформе Спектрума на английском. Английский язык прост и это способствует удобству распознавания фразы (иногда идут на компромисс - описание локаций на русском, объекты и ввод фразы - на английском). Это процесс (в самых простых играх) происходит следующим образом: удаляются предлоги, выделяются три слова: глагол, первое существительное, второе существительное. Они урезаются до 3-5 букв (чем активно пользовались составители адвентюр с вводом фраз на русском) и передаются в процедуру, которая производит вся манипуляции с игровым миром. Тот состоит из массива локаций (широко применялся прием - для каждой локации можно было задать возможность перемещения в одном из 6 направлений (на север, на запад, на юг, на восток, вверх, вниз)) и массива объектов (каждый объект привязан к определенной локации). Это все старые технологии и мы ими пользоваться не будем.
</p><p>Стоит еще упомянуть также сплавы адвентюр на IBM PC и Commodore: первые версии Leisure Suit Larry, King's Quest, Future Wars, Hero's Quest, Hugo, Maniac Mansion, Police Quest. В них совмещено перемещение по игровому пространству с помощью клавиш или мыши и ввод команд с клавиатуры. Большинство из этих игр плавно перекочевали в жанр квестов. По сути, квесты вобще появились в результате эволюции текстовых адвентюр, но потеряли при этом такие аспекты, как налаживание диалога с программой, разнообразие возможностей. Елки-палки, все на откуп казуалам отдали (ну разве что, кроме походовых стратегий). Ну да ладно.
</p><p>Перед тем, как засесть за разработку программы, я поставил себе цель создать гибкую систему, в полной мере подходящую для написания текстовых адвентюр. В прошлом, я уже создавал гибкий движок ввода слов на русском. Решив использовать для хранения данных древовидную иерархическую структуру, я написал под нее движок с нуля, добавив некоторые улучшения. Когда я стал разрабатывать процедуру обработки введенной фразы, то увидел, что такая система подходит и для других игр. С ее помощью можно вдохнуть в жестко ограниченные игровые миры (будь то 3D-боевик, где можно только убивать или взрывать, либо закованная в кандалы правил AD&amp;D ролевуха, да и другие жанры) свободу (например, возможность все потрогать, осмотреть, открыть) и жизнь (смоделировать действия NPC в зависимости от состояния системы). Поэтому, статью можно назвать и так "создание гибкой системы взаимодействия с игровым миром с помощью древовидной структуры на примере текстовых адвентюр", длинно, зато в полной мере отражает суть.
</p><p>Гибкость системы базируется на простоте установки связи между объектами. К примеру: вот комната, в ней стоит стол, на столе лежит книга. Нужно не просто создать объекты "комната", "стол", "тетрадь", а еще и установить зависимости: "стол - в комнате", "тетрадь - на столе". Пойдем дальше - стол это составной объект, он состоит из столешницы и 4-х ножек, тетрадь состоит из обложки и листов, а комната - из стен, пола и потолка. Нужно, чтобы система позволяла действовать, как с объектом, так и с его составляющими. Далее, так как однотипных объектов может быть много, нужно ввести возможность сгруппировать в один, с указанием количества (не все же тетрадные листы заносить, как отдельные объекты). Данный процесс разложения на составляющие можно проводить сколь угодно долго - уровень, на котором мы остановимся зависит от выбранной степени детализации, которая, в свою очередь, вычисляется исходя из целей и ресурсов.
</p><p>Возникает вопрос: какими критериями руководствоваться в выборе структуры данных, чтобы достичь желаемой максимальной гибкости? Первое: чем меньше типов объектов в системе - тем лучше. Чем больше объектов, тем больше возможных типов связей может понадобиться - квадратичная зависимость. Например, если есть всего один тип объекта, то тип связи один - объект с объектом. В случае 2-х типов объектов, связей больше - об1-&gt;об1, об2-&gt;об2, об1-&gt;об2, об2-&gt;об1 - четыре и т. д. Второе: в идеале, каждый объект должен иметь возможность связи с любым другим. Чем больше ограничений - тем хуже. Третье: система должна быть простой в использовании, обладать быстродействием и потреблять минимум ресурсов.
</p><p>Древовидная структура: 1) обладает единственным типом данных, 2) каждый объект может быть включать в себя группу из других объектов и, в свою очередь, состоять в группе с другими (но не теми же) объектами. Этот недостаток не позволяет приписать объекту какие-либо свойства (наример, что все элементы стола - деревянные, привязать все эти объекты к объекту "деревянный"), но его, однако, можно устранить. Система "вложений" вполне удовлетворяет пространственным размещениям объектов (тетрадь лежит на столе, стол находится в комнате; если проанализировать "ветвь" комнаты, то окажется, что и стол и тетрадь находятся в комнате, хотя и находятся на разных уровнях иерархии). 3) Система удобна - можно брать целые ветви и прикреплять их к другому объекту (переносить), ресурсы - 4 ссылки + дополнительные данные, скорость операций с элементами высока.
</p><p>Недостаток возможности приписывания определенном объекту свойств можно устранить следующим образом: перечислить свойства объекта в текстовой переменной через запятую. Этот способ, конечно, медленный и ресурсозатратный, однако для адвентюрных игр он вполне подойдет, к тому же, при его использовании удобно вводить данные. Его вполне можно оптимизировать, но это долгая работа, поэтому останавливаться на этом вопросе пока не будем.
</p><p>Организация данных. Первый уровень иерархии (после root) будет включать в себя локации. Первая локация - всегда присутствующие объекты: "руки" - там будет храниться объект, который играющий в данный момент держит в руках, "тело" - там будет одежда и "все" - объект, заменяющий доступные. Остальные локации будут включать в себя объекты, те, в свою очередь, то, что в них находится и свои компоненты. Каждый объект имеет имя и флаги, характеризующие его состояние и свойства:
</p>
<ul><li>[Локация] - можно осуществить переход в данную локацию с помощью объекта
</li><li>Ж / С / М - женский род / средний род / множественное число (мужской по умолчанию)
</li><li>Скр - скрытый объект (появлятся, после того, как осмотреть корневой)
</li><li>Откр / Закр - состояние для объектов, которые могут открываться / закрываться
</li><li>Отп / Зап - состояние для объектов, которые могут отпираться / запираться
</li><li>Кл_на / Кл_в / Кл_под - на / в / под этот объект можно положить предмет
</li><li>На / В / Под - предмет лежит на / в / под корневым объектом
</li><li>Одеть - предмет можно одеть
</li><li>Карман - будучи одет, этот объект позволяет "вкладывать в себя" мелкие предметы
</li><li>Взять - объект является мелким предметом и его можно положить в карман или взять в руки
</li><li>Рук - объект является большим предметом и его можно только взять в руки
</li><li>Цел / Разб - состояние для объектов, которые можно разбить
</li><li>Сух / Мок - состояние для объектов, которые можно намочить
</li><li>Вода - данный объект наполнен водой
</li><li>Рез - объект можно разрезать осколком
</li><li>Пов_на - на этот объект можно повесить другой
</li><li>М_вис - этот объект можно повесить на другой
</li><li>Вис - объект висит на корневом объекте
</li></ul>
<p>Теперь о текстовом движке. Стоит отметить, что самую сложную команду можно представить в виде набора команд типа "(глагол) (объект1) (предлог) (объект2)". Иногда второй объект не требуется (да и первый тоже, например, команда "осмотреться"). Итак, необходим список глаголов. Если быть точнее  - необходим список форматов команд (так как существительные имеют падежи) в следующем виде: "(глагол) (падеж 1-го объекта, если он нужен) (предлог) (падеж 2-го объекта, если он нужен)". Далее, может потребоваться взять каждое существительное и прилагательное в названии объекта в одном из 6 падежей, поэтому нужен список возможных окончаний. В теле имени изменяющееся окончание пусть будет заменено ссылкой "#N", где N - номер набора окончаний. Почему бы не воспользоваться методом урезания окончаний? Все дело в том, что вводить фразу полностью черсчур медленно, а сокращения типа "сруб топо дере" плохо смотрятся. Да и сама урезка сопряжена с определенными трудностями, например для слова "яма" или ситуации, когда меняются местами существительные (фразы "срубить топором дерево" и "срубить топор деревом" компьютер может расценить одинаково). Поэтому, будем делать упор на "предсказывание" компьютером слова в процессе ввода.
</p><p>Предсказывание будет осуществляться следующим образом: из списка возможных объектов берется первый попавшийся, первые буквы которого совпадают с уже введенным куском. Однако, слово "осмотреться" придется вводить почти целиком, потому что ранее в списке идет "осмотреть". Это неудобно, поэтому включим возможность перебирать возможные варианты с помощью клавиш PgUp / PgDn. Если удалось найти слово, не введенная часть добавляется, написанная зеленым цветом. Если нет - введенная часть помечается красным цветом. Пробел или запятая расцениваются, как конец слова и переход к началу набора следующего.
</p><p>Сначала предсказывается форма - подбор ведется по имени глагола (кстати, недостаток движка - если команды имеют одинаковое имя глагола, но разные предлоги (например, "положить А в Б" и "положить А на Б"), то ввести их не удастся, поэтому придется переключать их с помощью PgUp / PgDn, а предлог показывать в скобках). Если введена запятая - подбираем еще одну команду, идентичную по форме первой, если пробел -переходим к следующему этапу - подбирается объект (по имени). Здесь нужен список из ссылок на подходящие объекты (те, что в данной локации и в инвентаре, включая вложенные, кроме скрытых, а также объект "все"). После еще одного пробела, подбирается еще один (если нужен). Enter завершает ввод фразы и передает ее интерпретатору.
</p><p>На первом этапе, интерпретатор разбивает команды на элементарные - сначала идет перебор глаголов, затем 1-х объектов, затем 2-х. Например, команда "взять, одеть брюки, пиджак" будет разбита на "взять брюки", "одеть брюки", "взять пиджак", "одеть пиджак". Объект "все" заменяется перечислением всех доступных объектов.
</p><p>Второй этап интерпретации - самый важный. Процедура получает данные в виде (команда), (объект1), (объект2). Необходимо изменить базу данных и выдать нужную информацию. Прежде всего, зададим фразу для непредусмотренных действий - "не получается". Введем переменную loc, чтобы хранить локацию, где находится главный герой. Чтобы перемещаться между локациями, меняем переменную и обновляем список ссылок на доступные объектов (в него входят объекты в текущей локации, кроме скрытых и из локации "всегда присутствующие объекты"). Команда "идти" вычленяет у 1-го объекта флаг перемещения и перемещает игрока в локацию с указанным именем. При этом, если 1-й объект закрыт (для дверей) или не найден соотв. флаг, то перемещение невозможно, о чем и сообщается игроку. Команда "взять" более комплексна (это я для примера разнообразия возможностей усложнил) - если предмет маленький и его можно положить в карман (присутствует флаг "взять"), а на играющем одежда с карманом/ами (флаг "Карман") - предмет перемещается в карман предмета одежды. Если одежи нет или предмет не поместится в карман, но его можно взять в руки (присутствует флаг "Рук"), то если руки не заняты - взять в руки. При этом, объект перемещается в группу соответствующего (пиджака, брюк или рук) вместе со всеми вложениями (например, можно положить матрац на стул, рубашку и галстук на матрац и взять стул в руки - игрок будет нести все в руках; я не сделал ограничения по весу или объему, т. к. предметов мало, но это вполне реально воплотить). Так же можно логически описать и другие команды - смотрите комментарии.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> element<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> name$,flag$<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> root.element,prev.element,nxt.element,sub.element<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> eref<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> e.element<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> verb<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> name$,n<span style=" ">&#91;</span><span style="color: #33ffdd;">1</span><span style=" ">&#93;</span>,adverb$<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> cmd<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> e.element, v.verb, typ<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> tysiz=<span style="color: #33ffdd;">14</span>,xsiz=<span style="color: #33ffdd;">590</span>,ysiz=<span style="color: #33ffdd;">600</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> root.element=<span style="color: #aaffff; font-weight: bold;">New</span> element<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> loc.element,hands.element,body.element,all.element,shared.element<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> ty<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> try.cmd<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>, fcmd.cmd<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">FrontBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">SetFont</span> <span style="color: #aaffff; font-weight: bold;">LoadFont</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Arial Cyr&quot;</span>,<span style="color: #33ffdd;">16</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;Загрузка окончаний</span><br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> en$<span style=" ">&#40;</span><span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">6</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;n1=n1<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Read</span> m$<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> m$=<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;q$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> n2=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">6</span><br />
&nbsp; en$<span style=" ">&#40;</span>n1,n2<span style=" ">&#41;</span>=rustrim$<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,n2*<span style="color: #33ffdd;">3</span><span style="color: #33ffdd;">-2</span>,<span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<br />
<span style="color: #ffee00">;Загрузка глаголов</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Read</span> m$<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> m$=<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;v.verb=<span style="color: #aaffff; font-weight: bold;">New</span> verb<br />
&nbsp;i=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>m$,<span style="color: #00ff66;">&quot;#&quot;</span><span style=" ">&#41;</span><br />
&nbsp;v\name$=<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>m$,i<span style="color: #33ffdd;">-2</span><span style=" ">&#41;</span><br />
&nbsp;v\n<span style=" ">&#91;</span><span style="color: #33ffdd;">0</span><span style=" ">&#93;</span>=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,i<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #ffee00">;Определение второго глагола (если присутствует)</span><br />
&nbsp;ii=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>m$,<span style="color: #00ff66;">&quot;#&quot;</span>,i<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> ii&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; v\n<span style=" ">&#91;</span><span style="color: #33ffdd;">1</span><span style=" ">&#93;</span>=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,ii<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; v\adverb$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,i<span style="color: #33ffdd;">+3</span>,ii-i<span style="color: #33ffdd;">-3</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #ffee00">;Эта строка - для отладки</span><br />
&nbsp;<span style="color: #ffee00">;Print v\name$+&quot; &quot;+v\n[0]+&quot; &quot;+v\adverb$+&quot; &quot;+v\n[1]</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<span style="color: #ffee00">;WaitKey</span><br />
<br />
<span style="color: #ffee00">;Формирование базы данных</span><br />
e.element=root.element<br />
oldsp=<span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Read</span> m$<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> m$=<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;<span style="color: #ffee00">;Определение уровня (в зависимости от пробелов в начале)</span><br />
&nbsp;sp=<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>m$<span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>rustrim$<span style=" ">&#40;</span>m$<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> sp&lt;oldsp<br />
&nbsp; e=e\root<br />
&nbsp; oldsp=oldsp<span style="color: #33ffdd;">-1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> sp&gt;oldsp <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; e=einsertin<span style=" ">&#40;</span>e,<span style="color: #aaffff; font-weight: bold;">Null</span><span style=" ">&#41;</span><br />
&nbsp; oldsp=oldsp<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; e=einsertafter<span style=" ">&#40;</span>e,<span style="color: #aaffff; font-weight: bold;">Null</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #ffee00">;Флаги</span><br />
&nbsp;i=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>m$,<span style="color: #00ff66;">&quot;:&quot;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> i <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; e\flag$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,i<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;,&quot;</span><br />
&nbsp; e\name$=rustrim$<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>m$,i<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; e\name$=rustrim$<span style=" ">&#40;</span>m$<span style=" ">&#41;</span> <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #ffee00">;Эта строка - для отладки</span><br />
&nbsp;<span style="color: #ffee00">;viewpad e</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<br />
shared=root\sub<br />
all=<span style="color: #aaffff; font-weight: bold;">After</span> shared<br />
hands=<span style="color: #aaffff; font-weight: bold;">After</span> all<br />
body=<span style="color: #aaffff; font-weight: bold;">After</span> hands<br />
<br />
moveplayer <span style="color: #00ff66;">&quot;комната&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">0</span><br />
tprint <span style="color: #00ff66;">&quot;Переключите клавиатуру на русский регистр и отключите CapsLock.&quot;</span><br />
tprint <span style="color: #00ff66;">&quot;Используйте кл. PgUp и PgDn для выбора подходящего слова.&quot;</span><br />
<br />
look<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;inputphrase<br />
<br />
&nbsp;k=<span style="color: #33ffdd;">-1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> c.cmd=<span style="color: #aaffff; font-weight: bold;">Each</span> cmd<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> c\e=all <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;<span style="color: #ffee00">;Вставка объектов вместо слова &quot;все&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> r.eref=<span style="color: #aaffff; font-weight: bold;">Each</span> eref<br />
&nbsp; &nbsp; e=r\e<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> e&lt;&gt;all <span style="color: #aaffff; font-weight: bold;">And</span> e&lt;&gt;hands <span style="color: #aaffff; font-weight: bold;">And</span> e&lt;&gt;body <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;cc.cmd=<span style="color: #aaffff; font-weight: bold;">New</span> cmd<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Insert</span> cc <span style="color: #aaffff; font-weight: bold;">After</span> c<br />
&nbsp; &nbsp; &nbsp;cc\e=e<br />
&nbsp; &nbsp; &nbsp;cc\typ=c\typ<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span> &nbsp; <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Delete</span> c<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Определение первой команды каждого типа</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> k&lt;&gt;c\typ <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; k=c\typ<br />
&nbsp; &nbsp; try<span style=" ">&#40;</span>k<span style=" ">&#41;</span>=c<br />
&nbsp; &nbsp; fcmd<span style=" ">&#40;</span>k<span style=" ">&#41;</span>=c<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Разбивка фразы на элементарные</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> try<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>\v\n<span style=" ">&#91;</span><span style="color: #33ffdd;">0</span><span style=" ">&#93;</span>=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; processcmd<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp;processcmd<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> try<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp;try<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">After</span> try<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> try<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=fcmd<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; try<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=fcmd<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; try<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">After</span> try<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> try<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=fcmd<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;try<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=fcmd<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> try<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp; &nbsp;try<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">After</span> try<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> try<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span> <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Forever</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span> <br />
<br />
<span style="color: #ffee00">;наборы окончаний для каждого из 6 падежей (по 3 символа)</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;а &nbsp;и &nbsp;е &nbsp;у &nbsp;ой е &nbsp;&quot;</span><span style="color: #ffee00">;01</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;а &nbsp;ы &nbsp;е &nbsp;у &nbsp;ой е &nbsp;&quot;</span><span style="color: #ffee00">;02</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;я &nbsp;и &nbsp;е &nbsp;ю &nbsp;ей е &nbsp;&quot;</span><span style="color: #ffee00">;03</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;о &nbsp;а &nbsp;у &nbsp;о &nbsp;ом е &nbsp;&quot;</span><span style="color: #ffee00">;04</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;ь &nbsp;и &nbsp;и &nbsp;ь &nbsp;ью и &nbsp;&quot;</span><span style="color: #ffee00">;05</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp; а &nbsp;у &nbsp; &nbsp; ом е &nbsp;&quot;</span><span style="color: #ffee00">;06</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp; а &nbsp;у &nbsp; &nbsp; ем е &nbsp;&quot;</span><span style="color: #ffee00">;07</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;ая ей ей ую ей ей &quot;</span><span style="color: #ffee00">;08</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;ая ой ой ую ой ой &quot;</span><span style="color: #ffee00">;09</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;ь &nbsp;я &nbsp;ю &nbsp;ь &nbsp;ем е &nbsp;&quot;</span><span style="color: #ffee00">;10</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;ый огоомуый ым ом &quot;</span><span style="color: #ffee00">;11</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;ий егоемуий им ем &quot;</span><span style="color: #ffee00">;12</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;и &nbsp; &nbsp; ам и &nbsp;амиах &quot;</span><span style="color: #ffee00">;13</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;е &nbsp;егоемуе &nbsp;ем ем &quot;</span><span style="color: #ffee00">;14</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;ое огоомуое ым ом &quot;</span><span style="color: #ffee00">;15</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;и &nbsp;ов ам и &nbsp;амиах &quot;</span><span style="color: #ffee00">;16</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;&quot;</span><br />
<br />
<span style="color: #ffee00">;глаголы</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;взять #4&quot;</span>,<span style="color: #00ff66;">&quot;брать #4&quot;</span>,<span style="color: #00ff66;">&quot;бросить #4&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;положить #4 на #4&quot;</span>,<span style="color: #00ff66;">&quot;класть #4 на #4&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;повесить #4 на #4&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;идти в #4&quot;</span>,<span style="color: #00ff66;">&quot;идти по #3&quot;</span>,<span style="color: #00ff66;">&quot;прыгнуть в #4&quot;</span>,<span style="color: #00ff66;">&quot;войти в #4&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;открыть #4&quot;</span>,<span style="color: #00ff66;">&quot;закрыть #4&quot;</span>,<span style="color: #00ff66;">&quot;отпереть #4 #5&quot;</span>,<span style="color: #00ff66;">&quot;запереть #4 #5&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;сломать #4 #5&quot;</span>,<span style="color: #00ff66;">&quot;разбить #4 #5&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;одеть #4&quot;</span>,<span style="color: #00ff66;">&quot;надеть #4&quot;</span>,<span style="color: #00ff66;">&quot;снять #4&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;положить #4 в #4&quot;</span>,<span style="color: #00ff66;">&quot;положить #4 под #4&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;осмотреть #4&quot;</span>,<span style="color: #00ff66;">&quot;обследовать #4&quot;</span>,<span style="color: #00ff66;">&quot;осмотреться #0&quot;</span>,<span style="color: #00ff66;">&quot;инвентарь #0&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;бросить #4 в #4&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;резать #4 #5&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;&quot;</span><br />
<br />
<span style="color: #ffee00">;иерархия объектов</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;всегда присутствующие объекты&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; вс#14:С&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; рук#13:М&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; тел#04:С&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;майк#01:Рук,Одеть,Ж,Сух,Рез&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;комнат#02:Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; двер#05:Откр,Ж,&gt;прихожая&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; шкаф#06:Закр,Кл_на,Кл_в&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;дверц#02:Скр,Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;вешалк#01:Скр,Рук,Ж,В,Пов_на&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp; пиджак#06:Скр,Рук,Одеть,Вис,Сух,Рез,Карман&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp; брюк#13:Скр,Рук,Одеть,Вис,М,Сух,Рез,Карман&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp; рубашк#01:Скр,Рук,Одеть,Вис,Ж,Сух,Рез&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;галстук#06:Скр,Рук,Одеть,На,Сух,Рез&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; окн#04:Закр,С&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;стекл#04:Скр,С&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;рам#02:Скр,Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; кроват#05:Кл_на,Ж,Кл_под&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;матрац#06:Скр,Рук,Кл_на,На,Сух,Кл_под,Рез&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; стул#06:Рук,Кл_на,Сух&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;прихож#08:Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; двер#05 комнаты:Откр,Ж,&gt;комната&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; двер#05 ванной:Закр,Ж,&gt;ванная&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; двер#05 туалета:Закр,Ж,&gt;туалет&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; двер#05 кухни:Откр,Ж,&gt;кухня&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; входн#09 двер#05:Закр,Зап,Ж,&gt;лестничная клетка&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; коврик#06:Рук,Кл_на,Кл_под,Сух&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; настенн#09 вешалк#01:Пов_на,Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;ключ:Скр,Вис,Кл_на,Взять&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;ванн#09:Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; двер#05:Откр,Ж,&gt;прихожая&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; ванн#02:Кл_в,Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;красн#11 вентил#10 ванны:Скр,Закр&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;син#12 вентил#10 ванны:Скр,Закр&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;кран#06 ванны:Скр&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;вентил#10 душа:Скр,Откр&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;душ#07:Скр,Пов_на&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;слив#06 ванны:Скр&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; раковин#02:Кл_в,Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;красн#11 вентил#10 раковины:Скр,Закр&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;син#12 вентил#10 раковины:Скр,Закр&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;кран#06 раковины:Скр&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;слив#06 раковины:Скр&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;туалет#06&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; двер#05:Откр,Ж,&gt;прихожая&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; унитаз#06:Кл_в,Вода&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; бач^ок#06:Кл_на&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;кухн#03:Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; двер#05:Откр,&gt;прихожая&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; плит#02:Кл_на,Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; шкафчик#06:Закр,Кл_на&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; окн#04:Закр,С&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;стекл#04:Скр,С&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; &nbsp;рам#02:Скр,Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;лестничн#09 клетк#01:Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; входн#09 двер#05:Откр,Ж,Отп,&gt;прихожая&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; красн#09 двер#05:Зап,Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; черн#09 двер#05:Зап,Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; лестниц#02 вниз:Кл_на,Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot; лестниц#02 наверх:Кл_на,Ж&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> einsertafter.element<span style=" ">&#40;</span>afterwhat.element,what.element<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> what=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> what=<span style="color: #aaffff; font-weight: bold;">New</span> element <span style="color: #aaffff; font-weight: bold;">Else</span> epush what<br />
what\prev=afterwhat<br />
what\nxt=afterwhat\nxt<br />
<span style="color: #aaffff; font-weight: bold;">If</span> afterwhat\nxt&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> afterwhat\nxt\prev=what<br />
afterwhat\nxt=what<br />
what\root=afterwhat\root<br />
<span style="color: #aaffff; font-weight: bold;">Return</span> what<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> einsertbefore.element<span style=" ">&#40;</span>beforewhat.element,what.element<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> what=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> what=<span style="color: #aaffff; font-weight: bold;">New</span> element <span style="color: #aaffff; font-weight: bold;">Else</span> epush what<br />
what\prev=beforewhat\prev<br />
what\nxt=beforewhat<br />
<span style="color: #aaffff; font-weight: bold;">If</span> beforewhat\prev&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> beforewhat\prev\nxt=what<br />
what\root=beforewhat\root<br />
<span style="color: #aaffff; font-weight: bold;">If</span> what\prev=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> what\root\sub=what<br />
beforewhat\prev=what<br />
<span style="color: #aaffff; font-weight: bold;">Return</span> what<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> einsertin.element<span style=" ">&#40;</span>inwhat.element,what.element<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> what=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> what=<span style="color: #aaffff; font-weight: bold;">New</span> element <span style="color: #aaffff; font-weight: bold;">Else</span> epush what<br />
what\prev=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> inwhat\sub=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;what\nxt=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp;what\nxt=inwhat\sub<br />
&nbsp;inwhat\sub\prev=what<br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
inwhat\sub=what<br />
what\root=inwhat<br />
<span style="color: #aaffff; font-weight: bold;">Return</span> what<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> eremove<span style=" ">&#40;</span>what.element,care=<span style="color: #aaffff; font-weight: bold;">True</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> care <span style="color: #aaffff; font-weight: bold;">Then</span> epush what<br />
e.element=what\sub<br />
<span style="color: #aaffff; font-weight: bold;">While</span> e&lt;&gt;Null<br />
&nbsp;e2.element=e<br />
&nbsp;e=e\nxt<br />
&nbsp;eremove e2,<span style="color: #aaffff; font-weight: bold;">False</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">Delete</span> what<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> epush<span style=" ">&#40;</span>what.element<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> what\prev&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> what\prev\nxt=what\nxt <span style="color: #aaffff; font-weight: bold;">Else</span> what\root\sub=what\nxt<br />
<span style="color: #aaffff; font-weight: bold;">If</span> what\nxt&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> what\nxt\prev=what\prev<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Реальное название объекта с заменой ссылок на окончания (с учетом падежа)</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> realname$<span style=" ">&#40;</span>e.element,pad<span style=" ">&#41;</span><br />
m$=e\name$<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;i=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>m$,<span style="color: #00ff66;">&quot;#&quot;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;m$=<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>m$,i<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>+en$<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,i<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>,pad<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,i<span style="color: #33ffdd;">+3</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;i=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>m$,<span style="color: #00ff66;">&quot;^&quot;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;m$=<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>m$,i<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,i<span style="color: #33ffdd;">+1</span>+<span style=" ">&#40;</span>pad&gt;<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">And</span> pad&lt;&gt;<span style="color: #33ffdd;">5</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> m$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Функция удаления пробелов с краев строки, корректно работающая с русским шрифтом</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> rustrim$<span style=" ">&#40;</span>m$<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>m$<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,n,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #00ff66;">&quot; &quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
m$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,n<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>m$<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,n,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #00ff66;">&quot; &quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>m$,n<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Корректное перемещение в локацию</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> moveplayer<span style=" ">&#40;</span>lname$<span style=" ">&#41;</span><br />
e.element=root\sub<br />
<span style="color: #ffee00">;Поиск локации по названию</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> e&lt;&gt;Null<br />
&nbsp;m$=realname$<span style=" ">&#40;</span>e,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> m$=lname$ <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;e=e\nxt<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> e=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Stop</span><br />
<span style="color: #ffee00">;Формирование списка доступных объектов</span><br />
<span style="color: #aaffff; font-weight: bold;">Delete</span> <span style="color: #aaffff; font-weight: bold;">Each</span> eref<br />
<span style="color: #ffee00">;Добавление всегда присутствующих объектов</span><br />
addbranch shared<br />
<span style="color: #ffee00">;Добавление всегда объектов локации</span><br />
addbranch e<br />
loc=e<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Вспомогательная функция для занесения объектов в список доступных</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> addbranch<span style=" ">&#40;</span>what.element<span style=" ">&#41;</span><br />
e.element=what\sub<br />
<span style="color: #aaffff; font-weight: bold;">While</span> e&lt;&gt;Null<br />
&nbsp;<span style="color: #ffee00">;Скрытые объекты не заносятся</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>e,<span style="color: #00ff66;">&quot;Скр&quot;</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; r.eref=<span style="color: #aaffff; font-weight: bold;">New</span> eref<br />
&nbsp; r\e=e<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;e=nextobj<span style=" ">&#40;</span>what,e<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Просмотр названия объекта в разных падежах</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> viewpad<span style=" ">&#40;</span>e.element<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #ffee00">;Просмотр названия объекта во всех падежах (отладка)</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,realname$<span style=" ">&#40;</span>e,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">15</span>,<span style="color: #00ff66;">&quot;нет &quot;</span>+realname$<span style=" ">&#40;</span>e,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">30</span>,<span style="color: #00ff66;">&quot;дать &quot;</span>+realname$<span style=" ">&#40;</span>e,<span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">45</span>,<span style="color: #00ff66;">&quot;винить &quot;</span>+realname$<span style=" ">&#40;</span>e,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">60</span>,<span style="color: #00ff66;">&quot;творить &quot;</span>+realname$<span style=" ">&#40;</span>e,<span style="color: #33ffdd;">5</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">75</span>,<span style="color: #00ff66;">&quot;говорить о &quot;</span>+realname$<span style=" ">&#40;</span>e,<span style="color: #33ffdd;">6</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">WaitKey</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Функция ввода фразы</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> inputphrase$<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Очистка списка составляющих команды</span><br />
<span style="color: #aaffff; font-weight: bold;">Delete</span> <span style="color: #aaffff; font-weight: bold;">Each</span> cmd<br />
cur.cmd=<span style="color: #aaffff; font-weight: bold;">New</span> cmd<br />
fc.cmd=cur<br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,ty,<span style="color: #00ff66;">&quot;|&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;i=<span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> i<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">8</span><span style="color: #ffee00">;Backspace</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> part$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; part$=<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>part$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>part$<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> fc&lt;&gt; cur <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;cur=<span style="color: #aaffff; font-weight: bold;">Before</span> cur<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Delete</span> <span style="color: #aaffff; font-weight: bold;">Last</span> cmd<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">27</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">44</span>, <span style="color: #33ffdd;">32</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Проверка на возможность ввода 1-го и 2-го объектов</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> fc\v\n<span style=" ">&#91;</span><span style="color: #33ffdd;">0</span><span style=" ">&#93;</span>&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> i=<span style="color: #33ffdd;">44</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> cur\typ&lt;<span style="color: #33ffdd;">2</span>-<span style=" ">&#40;</span>fc\v\n<span style=" ">&#91;</span><span style="color: #33ffdd;">1</span><span style=" ">&#93;</span>=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> i=<span style="color: #33ffdd;">44</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Если найдено подходящее слово - создаем новый элемент команды</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> fnd <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; t=cur\typ<br />
&nbsp; &nbsp; &nbsp; cur=<span style="color: #aaffff; font-weight: bold;">New</span> cmd<br />
&nbsp; &nbsp; &nbsp; fnd=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Если введена запятая, а не пробел, то следующий объект будет такого же типа</span><br />
&nbsp; &nbsp; &nbsp;cur\typ=t+<span style=" ">&#40;</span>i=<span style="color: #33ffdd;">32</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp;part$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #ffee00">;Проверка на возможность ввода фразы</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">13</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> cur\e=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> i=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> fc&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">If</span> fc\v&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">If</span> fc\v\n<span style=" ">&#91;</span><span style="color: #33ffdd;">0</span><span style=" ">&#93;</span>=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> i=<span style="color: #33ffdd;">13</span><br />
&nbsp; <span style="color: #ffee00">;Изменение номера подходящего объекта</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">5</span><br />
&nbsp; &nbsp;q=q<span style="color: #33ffdd;">+1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">6</span><br />
&nbsp; &nbsp;q=q<span style="color: #33ffdd;">-1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Default</span><br />
&nbsp; &nbsp;part$=part$+<span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span>i<span style=" ">&#41;</span> &nbsp;<br />
&nbsp; &nbsp;q=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<br />
&nbsp;pl=<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>part$<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> part$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; n=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> cur\typ=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Поиск подходящего глагола (тип 0)</span><br />
&nbsp; &nbsp;fv.verb=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> v.verb=<span style="color: #aaffff; font-weight: bold;">Each</span> verb <br />
&nbsp; &nbsp; <span style="color: #ffee00">;Проверка на совпадение введенной части с началом глагола</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>v\name$,<span style="color: #33ffdd;">1</span>,pl<span style=" ">&#41;</span>=part$ <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Проверка на совпадение формы (для дополнительных глаголов)</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> fc=cur <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; k=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> v\n<span style=" ">&#91;</span><span style="color: #33ffdd;">0</span><span style=" ">&#93;</span>=fc\v\n<span style=" ">&#91;</span><span style="color: #33ffdd;">0</span><span style=" ">&#93;</span> <span style="color: #aaffff; font-weight: bold;">And</span> v\n<span style=" ">&#91;</span><span style="color: #33ffdd;">1</span><span style=" ">&#93;</span>=fc\v\n<span style=" ">&#91;</span><span style="color: #33ffdd;">1</span><span style=" ">&#93;</span> <span style="color: #aaffff; font-weight: bold;">And</span> v\adverb$=fc\v\adverb$ <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; k=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; k=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> k <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; n=n<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;Определение первого или последнего найденного объекта (в зависимости от</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; целей</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> n=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> q=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> fv=v<br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;При встрече q-го объекта - выход (объект найден)</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> q=n <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Если объекта с таким номером (q) нет, значит либо это последний объект</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">; (перескок с 1-го, q=1-1=0) либо первый (с последнего)</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> fv&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">And</span> v=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; v=fv<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> q=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> q=n <span style="color: #aaffff; font-weight: bold;">Else</span> q=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> v&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> fnd=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;cur\v=v<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Аналогичный поиск 1-го или 2-го объекта по названию</span><br />
&nbsp; &nbsp;fr.eref=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> r.eref=<span style="color: #aaffff; font-weight: bold;">Each</span> eref<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>r\e\name$,<span style="color: #33ffdd;">1</span>,pl<span style=" ">&#41;</span>=part$ <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;n=n<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> n=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> q=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> fr=r<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> q=n <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> fr&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">And</span> r=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; r=fr<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> q=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> q=n <span style="color: #aaffff; font-weight: bold;">Else</span> q=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> r&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; fnd=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; cur\e=r\e<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; cur\e=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;m$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp;<span style="color: #ffee00">;Отображение команды на экране</span><br />
&nbsp;<span style="color: #ffee00">;Очистка полосы</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Rect</span> <span style="color: #33ffdd;">0</span>,ty,<span style="color: #33ffdd;">800</span>,tysiz*<span style="color: #33ffdd;">2</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> c.cmd=<span style="color: #aaffff; font-weight: bold;">Each</span> cmd<br />
&nbsp; <span style="color: #ffee00">;Печать пробела (между командами разных типов) или запятой</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> c&lt;&gt;fc <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> c\typ=oldtyp <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; m$=m$+<span style="color: #00ff66;">&quot;, &quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; m$=m$+<span style="color: #00ff66;">&quot; &quot;</span> &nbsp; &nbsp;<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> c\typ=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m$=m$+fc\v\adverb$<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; oldtyp=c\typ<br />
&nbsp; <span style="color: #ffee00">;Печать последнего (вводимого) слова</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> c=cur <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Если слово не удалось подобрать - печать красным, выход</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> c\e=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">And</span> c\v=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,ty,m$<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; pl=<span style="color: #aaffff; font-weight: bold;">StringWidth</span><span style=" ">&#40;</span>m$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Text</span> pl,ty,part$+<span style="color: #00ff66;">&quot;|&quot;</span><br />
&nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Печать предыдущих слов и введенной части белым</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> i&lt;&gt;<span style="color: #33ffdd;">13</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; pl=<span style="color: #aaffff; font-weight: bold;">StringWidth</span><span style=" ">&#40;</span>m$+part$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,ty,m$+part$<br />
&nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #ffee00">;Добавление в фразу последнего слова</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> c\typ=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;m$=m$+c\v\name$<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;m$=m$+realname$<span style=" ">&#40;</span>c\e,fc\v\n<span style=" ">&#91;</span>c\typ<span style="color: #33ffdd;">-1</span><span style=" ">&#93;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=<span style="color: #33ffdd;">13</span> <span style="color: #aaffff; font-weight: bold;">And</span> c=cur <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;tprint m$<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #ffee00">;Добавление предлога в скобках (если вводится глагол с предлогом)</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> cur\typ=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> fc\v&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> fc\v\adverb$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m$=m$+<span style="color: #00ff66;">&quot; (&quot;</span>+rustrim$<span style=" ">&#40;</span>fc\v\adverb$<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;)&quot;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Печать зеленым оставшейся части &quot;предсказанного&quot; слова</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> m$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Text</span> pl,ty,<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>part$<span style=" ">&#41;</span><span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;|&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Процедура обработки элементарных команд</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> processcmd<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">0</span><br />
v.verb=try<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>\v<br />
verb$=v\name$<br />
adv$=v\adverb$<br />
<span style="color: #aaffff; font-weight: bold;">If</span> try<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;n1.element=try<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>\e<br />
&nbsp;n1n$=realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> try<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;n2.element=try<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>\e<br />
&nbsp;n2n$=realname$<span style=" ">&#40;</span>n2,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Select</span> verb$<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;взять&quot;</span>,<span style="color: #00ff66;">&quot;брать&quot;</span><br />
&nbsp; k=flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Взять&quot;</span><span style=" ">&#41;</span><br />
&nbsp; n2=findobjwithflag<span style=" ">&#40;</span>body,<span style="color: #00ff66;">&quot;Карман&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffee00">;Если одет объект с карманом и предмет достаточно мал - положить его в карман</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> n2&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">And</span> k <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;moveobj n2,n1,<span style="color: #00ff66;">&quot;В&quot;</span><br />
&nbsp; &nbsp;m$=m$+<span style="color: #00ff66;">&quot;Вы положили &quot;</span>+realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; в &quot;</span>+realname$<span style=" ">&#40;</span>n2,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; <span style="color: #ffee00">;Если предмет можно взять в руки и в руках ничего нет, взять его в руки</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ElseIf</span> k <span style="color: #aaffff; font-weight: bold;">Or</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Рук&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> hands\sub=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; moveobj hands,n1<br />
&nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;Теперь у вас в руках &quot;</span>+n1n$<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; m2$=<span style="color: #00ff66;">&quot;У вас заняты руки.&quot;</span><br />
&nbsp; &nbsp; n2=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;положить&quot;</span>,<span style="color: #00ff66;">&quot;бросить&quot;</span>,<span style="color: #00ff66;">&quot;класть&quot;</span><br />
&nbsp; <span style="color: #ffee00">;Если предмет в инвентаре, то ...</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> findobj<span style=" ">&#40;</span>body,n1n$<span style=" ">&#41;</span>&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Or</span> findobj<span style=" ">&#40;</span>hands,n1n$<span style=" ">&#41;</span>&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Задаются флаги местоположения (в случае, если предмет может быть помещен</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">; таким образом)</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> n2&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> adv$=<span style="color: #00ff66;">&quot;на &quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n2,<span style="color: #00ff66;">&quot;Кл_на&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m2$=<span style="color: #00ff66;">&quot;На&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> adv$=<span style="color: #00ff66;">&quot;в &quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n2,<span style="color: #00ff66;">&quot;Кл_в&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m2$=<span style="color: #00ff66;">&quot;В&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> adv$=<span style="color: #00ff66;">&quot;под &quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n2,<span style="color: #00ff66;">&quot;Кл_под&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m2$=<span style="color: #00ff66;">&quot;Под&quot;</span><br />
&nbsp; &nbsp; <span style="color: #ffee00">;Устранение ситуаций типа &quot;матрас на стуле, стул на матрасе&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> m2$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;e.element=n2<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> e&lt;&gt;Null<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> e=n1 <span style="color: #aaffff; font-weight: bold;">Then</span> m2$=<span style="color: #00ff66;">&quot;&quot;</span>:<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp; &nbsp; e=e\root<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> m2$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; moveobj n2,n1,m2$<br />
&nbsp; &nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;Вы избавились от &quot;</span>+realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> m2$=<span style="color: #00ff66;">&quot;В&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> water<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; <span style="color: #ffee00">;Предмет помещается в текущую локацию</span><br />
&nbsp; &nbsp; moveobj loc,n1<br />
&nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;Вы избавились от &quot;</span>+realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Объект, брошеный в открытое / разбитое окно уничтожается</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> adv$=<span style="color: #00ff66;">&quot;в &quot;</span> <span style="color: #aaffff; font-weight: bold;">And</span> n2n$=<span style="color: #00ff66;">&quot;окно&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n2,<span style="color: #00ff66;">&quot;Разб&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> flag<span style=" ">&#40;</span>n2,<span style="color: #00ff66;">&quot;Откр&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;tprint <span style="color: #00ff66;">&quot;Вы выбросили &quot;</span>+realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; в окно.&quot;</span><br />
&nbsp; &nbsp; &nbsp;eremove n1<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp;moveobj loc,n1<br />
&nbsp; &nbsp; &nbsp;m$=cap$<span style=" ">&#40;</span>n1n$<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; отскочил&quot;</span>+vend$<span style=" ">&#40;</span>n1<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; от стекла и упал&quot;</span>+vend$<span style=" ">&#40;</span>n1<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; на пол.&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;m2$=<span style="color: #00ff66;">&quot;У вас нет &quot;</span>+realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;повесить&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;М_вис&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> flag<span style=" ">&#40;</span>n2,<span style="color: #00ff66;">&quot;Пов_на&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;remflag n1,<span style="color: #00ff66;">&quot;Вис&quot;</span><br />
&nbsp; &nbsp;moveobj n1,n2,<span style="color: #00ff66;">&quot;Вис&quot;</span><br />
&nbsp; &nbsp;m$=<span style="color: #00ff66;">&quot;Вы повесили &quot;</span>+realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; на &quot;</span>+realname$<span style=" ">&#40;</span>n2,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;идти по&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>n1n$,<span style="color: #33ffdd;">8</span><span style=" ">&#41;</span>=<span style="color: #00ff66;">&quot;лестница&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;tprint <span style="color: #00ff66;">&quot;Вы пошли по лестнице. Вот идете Вы, идете, а ступеньки вдруг возьми, &quot;</span><br />
&nbsp; &nbsp;tprint <span style="color: #00ff66;">&quot; да обвались. И полетели Вы вниз, в пустоту недоделанного уровня... The End.&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">WaitKey</span>:<span style="color: #aaffff; font-weight: bold;">End</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;идти в&quot;</span>,<span style="color: #00ff66;">&quot;прыгнуть в&quot;</span>,<span style="color: #00ff66;">&quot;войти в&quot;</span><br />
&nbsp; k=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>n1\flag$,<span style="color: #00ff66;">&quot;&gt;&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffee00">;Обработка прыжка в окно</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> n1n$=<span style="color: #00ff66;">&quot;окно&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;k2=flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Разб&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Откр&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> k2=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> verb$=<span style="color: #00ff66;">&quot;прыгнуть в&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;Своим телом Вы разбили стекло и ужасно порезались.&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> k2 <span style="color: #aaffff; font-weight: bold;">Or</span> m$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; tprint <span style="color: #00ff66;">&quot;Вы выпрыгнули в окно.&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> m$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> tprint m$<br />
&nbsp; &nbsp; tprint <span style="color: #00ff66;">&quot;С дикими воплями, размахивая руками Вы летели вниз, пока не шмякнулись&quot;</span><br />
&nbsp; &nbsp; tprint <span style="color: #00ff66;">&quot; о поверхность, испещренную надписями 'Under Construction'. The End.&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">WaitKey</span>: <span style="color: #aaffff; font-weight: bold;">End</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #ffee00">;Переход в другую локацию</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> k <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Закр&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; m2$=<span style="color: #00ff66;">&quot;Закрыто.&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; tprint <span style="color: #00ff66;">&quot;ОК.&quot;</span><br />
&nbsp; &nbsp; <span style="color: #ffee00">;Вычленяется имя локации и осуществляется переход в нее</span><br />
&nbsp; &nbsp; k2=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>n1\flag$,<span style="color: #00ff66;">&quot;,&quot;</span>,k<span style=" ">&#41;</span><br />
&nbsp; &nbsp; moveplayer <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>n1\flag$,k<span style="color: #33ffdd;">+1</span>,k2-k<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffee00">;Перейдя, осматриваемся</span><br />
&nbsp; &nbsp; look<br />
&nbsp; &nbsp; <span style="color: #ffee00">;Остальные команды игнорируются (т. к. могут оказаться некорректными)</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> <span style="color: #aaffff; font-weight: bold;">Each</span> cmd<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;открыть&quot;</span><br />
&nbsp; <span style="color: #ffee00">;Если объект закрыт ...</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Закр&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;И не заперт...</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Зап&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; m2$=<span style="color: #00ff66;">&quot;Заперто.&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; <span style="color: #ffee00">;То поменять флаг</span><br />
&nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;Вы открыли &quot;</span>+realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; &nbsp; remflag n1,<span style="color: #00ff66;">&quot;Закр&quot;</span><br />
&nbsp; &nbsp; addflag n1,<span style="color: #00ff66;">&quot;Откр&quot;</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffee00">;Изменение наполненности водой</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>n1n$,<span style="color: #00ff66;">&quot;ванны&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> n1=findobj<span style=" ">&#40;</span>root,<span style="color: #00ff66;">&quot;ванна&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Else</span> n1=findobj<span style=" ">&#40;</span>root,<span style="color: #00ff66;">&quot;раковина&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Вода&quot;</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> addflag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Вода&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; water<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Иначе, если он открыт (то есть, вообще открывается) ...</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ElseIf</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Откр&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;m$=cap$<span style=" ">&#40;</span>n1n$<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; уже открыт&quot;</span>+vend$<span style=" ">&#40;</span>n1<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;закрыть&quot;</span><br />
&nbsp; <span style="color: #ffee00">;Аналогично</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Закр&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;m$=cap$<span style=" ">&#40;</span>n1n$<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; уже закрыт&quot;</span>+vend$<span style=" ">&#40;</span>n1<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ElseIf</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Откр&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;m$=<span style="color: #00ff66;">&quot;Вы закрыли &quot;</span>+n1n$<br />
&nbsp; &nbsp;addflag n1,<span style="color: #00ff66;">&quot;Закр&quot;</span><br />
&nbsp; &nbsp;remflag n1,<span style="color: #00ff66;">&quot;Откр&quot;</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Изменение наполненности водой</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>n1n$,<span style="color: #00ff66;">&quot;ванны&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>findobj<span style=" ">&#40;</span>loc,<span style="color: #00ff66;">&quot;красный вентиль ванны&quot;</span><span style=" ">&#41;</span>,<span style="color: #00ff66;">&quot;Закр&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>findobj<span style=" ">&#40;</span>loc,<span style="color: #00ff66;">&quot;синий вентиль ванны&quot;</span><span style=" ">&#41;</span>,<span style="color: #00ff66;">&quot;Закр&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; remflag findobj<span style=" ">&#40;</span>loc,<span style="color: #00ff66;">&quot;ванна&quot;</span><span style=" ">&#41;</span>,<span style="color: #00ff66;">&quot;Вода&quot;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>findobj<span style=" ">&#40;</span>loc,<span style="color: #00ff66;">&quot;красный вентиль раковины&quot;</span><span style=" ">&#41;</span>,<span style="color: #00ff66;">&quot;Закр&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>findobj<span style=" ">&#40;</span>loc,<span style="color: #00ff66;">&quot;синий вентиль раковины&quot;</span><span style=" ">&#41;</span>,<span style="color: #00ff66;">&quot;Закр&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; remflag findobj<span style=" ">&#40;</span>loc,<span style="color: #00ff66;">&quot;раковина&quot;</span><span style=" ">&#41;</span>,<span style="color: #00ff66;">&quot;Вода&quot;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;сломать&quot;</span>,<span style="color: #00ff66;">&quot;разбить&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Разб&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;m2$=cap$<span style=" ">&#40;</span>n1n$<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;Уже разбит&quot;</span>+vend$<span style=" ">&#40;</span>n2<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ElseIf</span> n1n$=<span style="color: #00ff66;">&quot;стекло&quot;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> n1n$=<span style="color: #00ff66;">&quot;окно&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Предмет можно разбить только кулаком или стулом</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> n2n$=<span style="color: #00ff66;">&quot;стул&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;Вы разбили окно стулом.&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> n2=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;Вы разбили окно кулаком, но при этом сильно порезались.&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; m2$=cap$<span style=" ">&#40;</span>n2n$<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; отскочил&quot;</span>+vend$<span style=" ">&#40;</span>n2<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; от стекла.&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Добавляем новый объект - осколки стекла</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> m$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; n2=einsertin<span style=" ">&#40;</span>loc,<span style="color: #aaffff; font-weight: bold;">Null</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; n2\name$=<span style="color: #00ff66;">&quot;осколк#13 стекла&quot;</span><br />
&nbsp; &nbsp; n2\flag$=<span style="color: #00ff66;">&quot;Взять,М,Остр&quot;</span><br />
&nbsp; &nbsp; r.eref=<span style="color: #aaffff; font-weight: bold;">New</span> eref<br />
&nbsp; &nbsp; r\e=n2<br />
&nbsp; &nbsp; <span style="color: #ffee00">;Вне зависимости от того, что били, разбиваем и окно и стекло</span><br />
&nbsp; &nbsp; addflag findobj<span style=" ">&#40;</span>loc,<span style="color: #00ff66;">&quot;стекло&quot;</span><span style=" ">&#41;</span>,<span style="color: #00ff66;">&quot;Разб&quot;</span><br />
&nbsp; &nbsp; addflag findobj<span style=" ">&#40;</span>loc,<span style="color: #00ff66;">&quot;окно&quot;</span><span style=" ">&#41;</span>,<span style="color: #00ff66;">&quot;Разб&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span> &nbsp;<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;одеть&quot;</span>,<span style="color: #00ff66;">&quot;надеть&quot;</span><br />
&nbsp; <span style="color: #ffee00">;Является ли объект одеждой?</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Одеть&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;<span style="color: #ffee00">;Находится ли он в руках</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> hands\sub=n1 <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; einsertin body,n1<br />
&nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;На вас теперь &quot;</span>+n1n$+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; m2$=cap$<span style=" ">&#40;</span>realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; нужно сначала взять в руки.&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;снять&quot;</span><br />
&nbsp; <span style="color: #ffee00">;Аналогично</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> hands=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;m2$=<span style="color: #00ff66;">&quot;У вас заняты руки.&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ElseIf</span> existin<span style=" ">&#40;</span>body,n1n$<span style=" ">&#41;</span><br />
&nbsp; &nbsp;einsertin hands,n1<br />
&nbsp; &nbsp;m$=<span style="color: #00ff66;">&quot;Вы сняли &quot;</span>+n1n$+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;m$=<span style="color: #00ff66;">&quot;У вас нет &quot;</span>+realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;отпереть&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Зап&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> n2n$=<span style="color: #00ff66;">&quot;ключ&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> n2n$=<span style="color: #00ff66;">&quot;ключ&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;Вы отперли &quot;</span>+realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; &nbsp; remflag n1,<span style="color: #00ff66;">&quot;Зап&quot;</span><br />
&nbsp; &nbsp; addflag n1,<span style="color: #00ff66;">&quot;Отп&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ElseIf</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Отп&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;m$=cap$<span style=" ">&#40;</span>n1n$<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; уже отперт&quot;</span>+vend$<span style=" ">&#40;</span>n1<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;запереть&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Отп&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> n2n$=<span style="color: #00ff66;">&quot;ключ&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;Вы заперли &quot;</span>+realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; &nbsp; remflag n1,<span style="color: #00ff66;">&quot;Отп&quot;</span><br />
&nbsp; &nbsp; addflag n1,<span style="color: #00ff66;">&quot;Зап&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ElseIf</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Зап&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;m$=cap$<span style=" ">&#40;</span>n1n$<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; уже заперт&quot;</span>+vend$<span style=" ">&#40;</span>n1<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;осмотреть&quot;</span>,<span style="color: #00ff66;">&quot;обследовать&quot;</span><br />
&nbsp; e.element=n1\sub<br />
&nbsp; <span style="color: #ffee00">;Цикл по всем объектам в группе обследуемого</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> e&lt;&gt;Null<br />
&nbsp; &nbsp;m2$=realname$<span style=" ">&#40;</span>e,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Вывод информации в зависимости от положения</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>e,<span style="color: #00ff66;">&quot;На&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; m$=m$+<span style="color: #00ff66;">&quot;наверху - &quot;</span>+m2$+<span style="color: #00ff66;">&quot;, &quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> flag<span style=" ">&#40;</span>e,<span style="color: #00ff66;">&quot;Под&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; m$=m$+<span style="color: #00ff66;">&quot;под ним - &quot;</span>+m2$+<span style="color: #00ff66;">&quot;, &quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> flag<span style=" ">&#40;</span>e,<span style="color: #00ff66;">&quot;В&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Закр&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp;m2$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp;m$=m$+<span style="color: #00ff66;">&quot;внутри - &quot;</span>+m2$+<span style="color: #00ff66;">&quot;, &quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> flag<span style=" ">&#40;</span>e,<span style="color: #00ff66;">&quot;Вис&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;m$=m$+<span style="color: #00ff66;">&quot;висит &quot;</span>+m2$+<span style="color: #00ff66;">&quot;, &quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; m$=m$+<span style="color: #00ff66;">&quot;есть &quot;</span>+m2$+<span style="color: #00ff66;">&quot;, &quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Скрытые объекты становятся видимыми</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> m2$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>e,<span style="color: #00ff66;">&quot;Скр&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;r.eref=<span style="color: #aaffff; font-weight: bold;">New</span> eref<br />
&nbsp; &nbsp; &nbsp;r\e=e<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp; remflag <span style=" ">&#40;</span>e,<span style="color: #00ff66;">&quot;Скр&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;e=e\nxt<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
&nbsp; m2$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; <span style="color: #ffee00">;Информация о состоянии объекта</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Откр&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m2$=m2$+<span style="color: #00ff66;">&quot;, открыт&quot;</span>+vend$<span style=" ">&#40;</span>n1<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Закр&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m2$=m2$+<span style="color: #00ff66;">&quot;, закрыт&quot;</span>+vend$<span style=" ">&#40;</span>n1<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Зап&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m2$=m2$+<span style="color: #00ff66;">&quot;, заперт&quot;</span>+vend$<span style=" ">&#40;</span>n1<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Разб&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m2$=m2$+<span style="color: #00ff66;">&quot;, разбит&quot;</span>+vend$<span style=" ">&#40;</span>n1<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Мокр&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m2$=m2$+<span style="color: #00ff66;">&quot;, пропитан&quot;</span>+vend$<span style=" ">&#40;</span>n1<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; водой&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Вода&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m2$=m2$+<span style="color: #00ff66;">&quot;, наполнен&quot;</span>+vend$<span style=" ">&#40;</span>n1<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; водой&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> m$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> m2$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> m$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m$=<span style="color: #00ff66;">&quot;: &quot;</span>+<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>m$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>m$<span style=" ">&#41;</span><span style="color: #33ffdd;">-2</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> m2$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m2$,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+m$<br />
&nbsp; &nbsp;m$=cap$<span style=" ">&#40;</span>n1n$<span style=" ">&#41;</span>+m$+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp; m2$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; <span style="color: #ffee00">;Если вентиль душа открыт - вода будет течь из крана ванной, иначе - из крана душа</span><br />
&nbsp; k=flag<span style=" ">&#40;</span>findobj<span style=" ">&#40;</span>root,<span style="color: #00ff66;">&quot;вентиль душа&quot;</span><span style=" ">&#41;</span>,<span style="color: #00ff66;">&quot;Закр&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>n1n$=<span style="color: #00ff66;">&quot;кран ванны&quot;</span> <span style="color: #aaffff; font-weight: bold;">And</span> k=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> <span style=" ">&#40;</span>n1n$=<span style="color: #00ff66;">&quot;душ&quot;</span> <span style="color: #aaffff; font-weight: bold;">And</span> k=<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m2$=<span style="color: #00ff66;">&quot;ванны&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> n1n$=<span style="color: #00ff66;">&quot;кран раковины&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m2$=<span style="color: #00ff66;">&quot;раковины&quot;</span><br />
&nbsp; <span style="color: #ffee00">;Температура воды зависит от того, какие краны открыты (если оба закрыты, то вода</span><br />
&nbsp; <span style="color: #ffee00">; не потечет)</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> m2$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;k=flag<span style=" ">&#40;</span>findobj<span style=" ">&#40;</span>loc,<span style="color: #00ff66;">&quot;синий вентиль &quot;</span>+m2$<span style=" ">&#41;</span>,<span style="color: #00ff66;">&quot;Откр&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>findobj<span style=" ">&#40;</span>loc,<span style="color: #00ff66;">&quot;красный вентиль &quot;</span>+m2$<span style=" ">&#41;</span>,<span style="color: #00ff66;">&quot;Откр&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> k <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;m$=<span style="color: #00ff66;">&quot;теплая вода&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp;m$=<span style="color: #00ff66;">&quot;горячая вода&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> k <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;холодная вода&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span> <br />
&nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span> &nbsp; <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> m$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m$=<span style="color: #00ff66;">&quot;Из &quot;</span>+realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; течет &quot;</span>+m$+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> m$=<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m$=<span style="color: #00ff66;">&quot;Осмотрев &quot;</span>+realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;, Вы не обнаружили ничего особенного.&quot;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;осмотреться&quot;</span><br />
&nbsp; look<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;инвентарь&quot;</span><br />
&nbsp; m$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; <span style="color: #ffee00">;Осмотр своего тела на предмет одежды</span><br />
&nbsp; e=body\sub<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> e&lt;&gt;Null<br />
&nbsp; &nbsp;m$=m$+realname$<span style=" ">&#40;</span>e,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;, &quot;</span><br />
&nbsp; &nbsp;e=e\nxt<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> m$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> tprint <span style="color: #00ff66;">&quot;Вы одеты в &quot;</span>+<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>m$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>m$<span style=" ">&#41;</span><span style="color: #33ffdd;">-2</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
<br />
&nbsp; <span style="color: #ffee00">;Осмотр рук</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> hands\sub=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;m$=<span style="color: #00ff66;">&quot;ничего нет, &quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;m$=realname$<span style=" ">&#40;</span>hands\sub,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;, &quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; tprint <span style="color: #00ff66;">&quot;У Вас в руках &quot;</span>+<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>m$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>m$<span style=" ">&#41;</span><span style="color: #33ffdd;">-2</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; m$=<span style="color: #00ff66;">&quot;&quot;</span><br />
<br />
&nbsp; <span style="color: #ffee00">;Осмотр карманов</span><br />
&nbsp; e=body\sub<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> e&lt;&gt;Null<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>e,<span style="color: #00ff66;">&quot;Одеть&quot;</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m$=m$+realname$<span style=" ">&#40;</span>e,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;, &quot;</span><br />
&nbsp; &nbsp;e=nextobj<span style=" ">&#40;</span>body,e<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> m$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> tprint <span style="color: #00ff66;">&quot;В карманах у Вас &quot;</span>+<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>m$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>m$<span style=" ">&#41;</span><span style="color: #33ffdd;">-2</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;резать&quot;</span>,<span style="color: #00ff66;">&quot;разрезать&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>n1,<span style="color: #00ff66;">&quot;Рез&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>n2n$,<span style="color: #33ffdd;">5</span><span style=" ">&#41;</span>=<span style="color: #00ff66;">&quot;оскол&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> hands\sub=n2 <span style="color: #aaffff; font-weight: bold;">Or</span> hands\sub=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;m$=<span style="color: #00ff66;">&quot;Вы разрезали &quot;</span>+realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Изменение названия предмета, чтобы получить куски</span><br />
&nbsp; &nbsp; &nbsp;n1\name$=<span style="color: #00ff66;">&quot;куск#16 &quot;</span>+realname$<span style=" ">&#40;</span>n1,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Удаление возможности одеть и разрезать</span><br />
&nbsp; &nbsp; &nbsp;remflag n1,<span style="color: #00ff66;">&quot;Рез&quot;</span><br />
&nbsp; &nbsp; &nbsp;remflag n1,<span style="color: #00ff66;">&quot;Одеть&quot;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Бросить на пол</span><br />
&nbsp; &nbsp; &nbsp;moveobj loc,n1<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp;m$=<span style="color: #00ff66;">&quot;У Вас заняты руки.&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;Чем?&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<br />
<span style="color: #ffee00">;Обработка неудавшегося действия</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> m$=<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;m$=cap$<span style=" ">&#40;</span>verb$<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot; &quot;</span>+realname$<span style=" ">&#40;</span>n1,v\n<span style=" ">&#91;</span><span style="color: #33ffdd;">0</span><span style=" ">&#93;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> n2&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> m$=m$+<span style="color: #00ff66;">&quot; &quot;</span>+v\adverb$+realname$<span style=" ">&#40;</span>n2,v\n<span style=" ">&#91;</span><span style="color: #33ffdd;">1</span><span style=" ">&#93;</span><span style=" ">&#41;</span><br />
&nbsp;m$=m$+<span style="color: #00ff66;">&quot; не получается. &quot;</span>+m2$<br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
tprint m$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Функция, проверяющая наличие данного флага у объекта</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> flag<span style=" ">&#40;</span>e.element,flag$<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>e\flag$,flag$+<span style="color: #00ff66;">&quot;,&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Добавление флага в строку флагов объекта</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> addflag<span style=" ">&#40;</span>e.element,flag$<span style=" ">&#41;</span><br />
e\flag$=e\flag$+flag$+<span style="color: #00ff66;">&quot;,&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Удаление флага из строки флагов объекта</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> remflag<span style=" ">&#40;</span>e.element,flag$<span style=" ">&#41;</span><br />
m$=e\flag$<br />
i=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>m$,flag$+<span style="color: #00ff66;">&quot;,&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span><br />
e\flag$=<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>m$,i<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,i+<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>flag$<span style=" ">&#41;</span><span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Проверка наличия объекта с данным именем в группе данного</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> existin<span style=" ">&#40;</span>inwhat.element,what$<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> inwhat=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span><br />
inwhat=inwhat\sub<br />
<span style="color: #aaffff; font-weight: bold;">While</span> inwhat&lt;&gt;Null<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> realname$<span style=" ">&#40;</span>inwhat,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=what$ <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #33ffdd;">1</span><br />
&nbsp;inwhat=<span style="color: #aaffff; font-weight: bold;">After</span> inwhat<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Функция, делающая начальную букву строки заглавной</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> cap$<span style=" ">&#40;</span>m$<span style=" ">&#41;</span><br />
m$=<span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>m$,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">-32</span><span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> m$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Функция, подбирающее окончание, в зависимости от рода</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> vend$<span style=" ">&#40;</span>e.element<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>e,<span style="color: #00ff66;">&quot;Ж&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #00ff66;">&quot;а&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>e,<span style="color: #00ff66;">&quot;С&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #00ff66;">&quot;о&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>e,<span style="color: #00ff66;">&quot;М&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #00ff66;">&quot;ы&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Выполнение команды &quot;осмотреться&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> look<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
e.element=loc\sub<br />
<span style="color: #ffee00">;Перечисление объектов, входящих в ветвь локации (кроме скрытых)</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> e&lt;&gt;Null<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>e,<span style="color: #00ff66;">&quot;Скр&quot;</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m$=m$+realname$<span style=" ">&#40;</span>e,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;, &quot;</span><br />
&nbsp;e=nextobj<span style=" ">&#40;</span>loc,e<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> m$=<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m$=<span style="color: #00ff66;">&quot;ничего нет &nbsp;&quot;</span><br />
tprint <span style="color: #00ff66;">&quot;Вы находитесь в &quot;</span>+realname$<span style=" ">&#40;</span>loc,<span style="color: #33ffdd;">3</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
tprint <span style="color: #00ff66;">&quot;Перед вами &quot;</span>+<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>m$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>m$<span style=" ">&#41;</span><span style="color: #33ffdd;">-2</span><span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Корректная печать текста (с переносом и сдвигом экрана)</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> tprint<span style=" ">&#40;</span>m$<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;l=<span style="color: #aaffff; font-weight: bold;">StringWidth</span><span style=" ">&#40;</span>m$<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> l&lt;=xsiz <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;n$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>m$<span style=" ">&#41;</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+n$<br />
&nbsp;m$=<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>m$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>m$<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> ty+tysiz*<span style="color: #33ffdd;">2</span>&gt;ysiz <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;cr=<span style="color: #aaffff; font-weight: bold;">ColorRed</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;cg=<span style="color: #aaffff; font-weight: bold;">ColorGreen</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;cb=<span style="color: #aaffff; font-weight: bold;">ColorBlue</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">CopyRect</span> <span style="color: #33ffdd;">0</span>,ysiz-ty,xsiz,ty,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Rect</span> <span style="color: #33ffdd;">0</span>,ty,xsiz,tysiz*<span style="color: #33ffdd;">2</span><br />
&nbsp;ty=ty*<span style="color: #33ffdd;">2</span>-ysiz<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Color</span> cr,cg,cb<br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,ty,m$<br />
ty=ty+tysiz<br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> n$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> tprint n$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Рекусривная функция поиска объекта в ветви данного по названию</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> findobj.element<span style=" ">&#40;</span>inwhat.element,what$<span style=" ">&#41;</span><br />
inwhat=inwhat\sub<br />
<span style="color: #aaffff; font-weight: bold;">While</span> inwhat&lt;&gt;Null<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> realname$<span style=" ">&#40;</span>inwhat,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=what$ <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> inwhat<br />
&nbsp;<span style="color: #ffee00">;Проверка наличия элемента в ветви</span><br />
&nbsp;e.element=findobj<span style=" ">&#40;</span>inwhat,what$<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> e&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> e<br />
&nbsp;inwhat=inwhat\nxt<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Функция нахождения следующего объекта в ветви inwhat (полезна для осуществления</span><br />
<span style="color: #ffee00">; перебора элементов ветви)</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> nextobj.element<span style=" ">&#40;</span>inwhat.element,current.element<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> current\sub=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> current\nxt=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> current\root=inwhat <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; current=current\root<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> current\nxt<br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> current\sub<br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Функция поиска объекта с данным флагом в даной ветви</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> findobjwithflag.element<span style=" ">&#40;</span>inwhat.element,what$<span style=" ">&#41;</span><br />
e.element=inwhat\sub<br />
<span style="color: #aaffff; font-weight: bold;">While</span> e&lt;&gt;Null<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> flag<span style=" ">&#40;</span>e,what$<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> e<br />
&nbsp;e=nextobj<span style=" ">&#40;</span>inwhat,e<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Корректное перемещение объекта</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> moveobj<span style=" ">&#40;</span>inwhat.element,what.element,flag$=<span style="color: #00ff66;">&quot;&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Убираются флаги местоположения</span><br />
remflag what,<span style="color: #00ff66;">&quot;На&quot;</span><br />
remflag what,<span style="color: #00ff66;">&quot;В&quot;</span><br />
remflag what,<span style="color: #00ff66;">&quot;Под&quot;</span><br />
remflag what,<span style="color: #00ff66;">&quot;Вис&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> flag$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> addflag what,flag$<br />
einsertin inwhat,what<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Пропитывание объектов водой</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> water<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
src.element=loc\sub<br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> src&lt;&gt;Null<br />
&nbsp;k=flag<span style=" ">&#40;</span>src,<span style="color: #00ff66;">&quot;Вода&quot;</span><span style=" ">&#41;</span><br />
&nbsp;dst.element=src\sub<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> dst&lt;&gt;Null<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> k <span style="color: #aaffff; font-weight: bold;">And</span> flag<span style=" ">&#40;</span>dst,<span style="color: #00ff66;">&quot;Сух&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;remflag dst,<span style="color: #00ff66;">&quot;Сух&quot;</span><br />
&nbsp; &nbsp;addflag dst,<span style="color: #00ff66;">&quot;Мокр&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; dst=dst\nxt<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span> <br />
&nbsp;src=src\nxt<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span> <br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Программа плохо протестирована, возможны баги и неучтенные ситуации. Зато она хорошо иллюстрирует возможности изложенного подхода. Кстати - заметьте следующую вещь: изначально дверь в комнате закрыта, а в прихожей та же дверь открыта. Это сделано потому, что попасть в прихожую, не открыв дверь нельзя, а дверь в локации "прихожая" недоступна из локации "комната". Для кольцевых путей пришлось бы делать синхронизацию дверей.
</p><p>В принципе, система позволяет неограниченно усложнять структуру базы данных, вводить дополнительные команды и разрабатывать нетривиальные способы взаимодействий, без особой потери производительности. Хотя на данный момент, некоторые очень полезные возможности не внесены, этим мы займемся в следующей статье.
</p>
<div align="right"><a href="http://blitzetcetera.org/images/f/f4/TextAdventure.bb" class="internal" title="TextAdventure.bb">скачать исходный код</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)
</p><!-- 
Pre-expand include size: 32507 bytes
Post-expand include size: 353 bytes
Template argument size: 23 bytes
Maximum: 2097152 bytes
-->

<!-- Saved in parser cache with key db1:pcache:idhash:611-0!1!0!!ru!2 and timestamp 20071110040808 -->
<div class="printfooter">
Получено с <a href="96p7sf2z.html">http://blitzetcetera.org/index.php/%D0%A2%D0%B5%D0%BA%D1%81%D1%82%D0%BE%D0%B2%D1%8B%D0%B5_%D0%B0%D0%B4%D0%B2%D0%B5%D0%BD%D1%82%D1%8E%D1%80%D1%8B</a></div>
			<!-- end content -->			<div class="visualClear"></div>				</td>				<td class="rightside">				</td>			</tr>		</table>		</div>	</div>		</div>	
		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</div></body>
<!-- Mirrored from localhost/index.php/%D0%A2%D0%B5%D0%BA%D1%81%D1%82%D0%BE%D0%B2%D1%8B%D0%B5_%D0%B0%D0%B4%D0%B2%D0%B5%D0%BD%D1%82%D1%8E%D1%80%D1%8B by HTTrack Website Copier/3.x [XR&CO'2007], Sat, 10 Nov 2007 05:16:43 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>