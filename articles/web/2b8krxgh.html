<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru" dir="ltr">	
<!-- Mirrored from localhost/index.php/%D0%A0%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%BE%D1%80_%D0%B4%D0%B2%D1%83%D0%BC%D0%B5%D1%80%D0%BD%D1%8B%D1%85_%D0%BA%D1%80%D0%B8%D0%B2%D1%8B%D1%85 by HTTrack Website Copier/3.x [XR&CO'2007], Sat, 10 Nov 2007 05:16:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />				<meta name="keywords" content="Редактор двумерных кривых,Matt Merkulov" />
		<link rel="shortcut icon" href="http://blitzetcetera.org/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="http://blitzetcetera.org/opensearch_desc.php" title="Blitz Et Cetera (Русский)" />
		<title>Редактор двумерных кривых — Blitz Et Cetera</title>		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "bvih5rde.css?63"; /*]]>*/</style>		<link rel="stylesheet" type="text/css" media="print" href="gcxktlm6.css?63" />		<link rel="stylesheet" type="text/css" media="handheld" href="zumsslq_.css?63" />		<!--[if lt IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE50Fixes.css?63";</style><![endif]-->		<!--[if IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE55Fixes.css?63";</style><![endif]-->		<!--[if IE 6]><style type="text/css">@import "/skins/OfflineNew/IE60Fixes.css?63";</style><![endif]-->		<!--[if IE 7]><style type="text/css">@import "/skins/OfflineNew/IE70Fixes.css?63";</style><![endif]-->		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?63"></script>		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->		<script type= "text/javascript">/*<![CDATA[*/
var skin = "OfflineNew";
var stylepath = "/skins";
var wgArticlePath = "/index.php/$1";
var wgScriptPath = "";
var wgServer = "http://blitzetcetera.org/";
var wgCanonicalNamespace = "";
var wgCanonicalSpecialPageName = false;
var wgNamespaceNumber = 0;
var wgPageName = "Редактор_двумерных_кривых";
var wgTitle = "Редактор двумерных кривых";
var wgAction = "view";
var wgArticleId = "703";
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "ru";
var wgContentLanguage = "ru";
var wgBreakFrames = false;
var wgCurRevisionId = "3572";
/*]]>*/</script>
		<script type="text/javascript" src="2nq-6cel.js?63"><!-- wikibits js --></script>		<script type="text/javascript" src="http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=js"><!-- site js --></script>		<style type="text/css">/*<![CDATA[*/
@import "http://blitzetcetera.org/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=MediaWiki:OfflineNew.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=css&amp;maxage=18000";
/*]]>*/</style>		<!-- Head Scripts -->	</head><body  class="mediawiki ns-0 ltr page-Редактор_двумерных_кривых">	<div id="globalWrapper">	<div id="logocontainer">		<table align="center">		  <tr>				<td id="blitzetclogo">				</td>			</tr>		</table>	</div>	<div id="magbar">	Журнал о программированнии на языках Blitz3D, BlitzMax, BlitzPlus	</div>		<div id="column-content">	<div id="content">		<a name="top" id="top"></a>				<div id="bodyContent">		<table cellspacing=0 cellpadding=0 width=100%>			<tr>			  <td class="leftside">				</td>				<td class="sheetbody">					<h1 class="sheet">Редактор двумерных кривых</h1>			<h3 id="siteSub">Материал из Blitz Et Cetera.</h3>			<div id="contentSub"></div>			<!-- start content -->			<a name=".D0.9F.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80.D1.8B_.D0.BA.D1.80.D0.B8.D0.B2.D0.BE.D0.B9_.D0.B8_.D0.B5.D0.B5_.D0.BF.D0.BE.D1.81.D1.82.D1.80.D0.BE.D0.B5.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A0%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%BE%D1%80_%D0%B4%D0%B2%D1%83%D0%BC%D0%B5%D1%80%D0%BD%D1%8B%D1%85_%D0%BA%D1%80%D0%B8%D0%B2%D1%8B%D1%85&amp;action=edit&amp;section=1" title="Править секцию: Параметры кривой и ее построение">править</a>]</span> <span class="mw-headline">Параметры кривой и ее построение</span></h2>
<p>В прошлом выпуске была статья о кубической интерполяции. В последнем примере с двигающимся объектом есть одна особенность: перемещаясь, он описывает кривую. Так почему же не создать на основе той же интерполяции алгоритм построения кривых? В этой статье будет объяснено, как создать редактор таких кривых.
</p><p>Напомню, для того, чтобы построить траекторию, были созданы две интерполяционные функции - x = f<sup>1</sup>(t) и y = f<sup>2</sup>(t), 0&lt;=t&lt;=1. Если Вы редактировали кривые в векторных редакторах, например в CorelDraw или Macromedia Flash, то могли заметить, что от каждой вершины отходят два отрезка с точками на концах. Если присмотреться, то можно увидеть, что эти отрезки - касательные к частям кривой, подходящим к этой точке.  Когда отрезки параллельны - кривая плавно закругляется в вершине, в противном случае получается излом. Будем называть эти отрезки векторами (так как можно задать направление - от вершины).
</p><p>Для начала, определим тип, отвечающий за точки. Каждая точка имеет координаты, также нужно зафиксировать координаты векторов (они будут равны разности между конечными точками отрезков и координатами вершины). Для построения простейшей кривой необходимо минимум две точки - зададим их в начале программы.
</p><p>Теперь можно создать процедуру рисования кривой. Как вычислить коэффициенты, было рассказано в предыдущем выпуске, а построить кривую легко можно в цикле отрезками по точкам. Разбиение кривой на 100 отрезков (шаг 1/100) быстро строит вполне качественную кривую. Но какие производные подставлять в формулы? Можно просто подставить приращения отрезков, умноженные на константу (скажем, 20), но удобнее для редактирования будет, если эта константа будет зависеть от расстояния между вершинами кривой. Теперь можно поэкспериментировать с векторами:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> dot<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x,y,dx1,dy1,dx2,dy2<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> xres=<span style="color: #33ffdd;">800</span>, yres=<span style="color: #33ffdd;">600</span>, stp#=.<span style="color: #33ffdd;">01</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> seldot.dot, bi, sel<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> a#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,b#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,c#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,d#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> xres,yres,<span style="color: #33ffdd;">32</span><br />
<br />
<span style="color: #ffee00">;Задание начальных точек</span><br />
dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
dt\x=.<span style="color: #33ffdd;">5</span>*xres<br />
dt\y=.<span style="color: #33ffdd;">25</span>*yres<br />
dt\dx2=<span style="color: #33ffdd;">50</span><br />
dt\dy2=<span style="color: #33ffdd;">50</span><br />
dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
dt\x=.<span style="color: #33ffdd;">5</span>*xres<br />
dt\y=.<span style="color: #33ffdd;">75</span>*yres<br />
dt\dx1=<span style="color: #33ffdd;">40</span><br />
dt\dy1=<span style="color: #33ffdd;">-60</span><br />
<br />
<br />
drawcurve <span style="color: #aaffff; font-weight: bold;">First</span> dot<br />
<span style="color: #aaffff; font-weight: bold;">WaitKey</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> drawcurve<span style=" ">&#40;</span>dt1.dot<span style=" ">&#41;</span><br />
dt2.dot=<span style="color: #aaffff; font-weight: bold;">After</span> dt1<br />
<br />
<span style="color: #ffee00">;Вычисление расстояния между вершинами кривой для вычисления производных</span><br />
r#=.<span style="color: #33ffdd;">05</span>*<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span><span style=" ">&#40;</span>dt1\x-dt2\x<span style=" ">&#41;</span>*<span style=" ">&#40;</span>dt1\x-dt2\x<span style=" ">&#41;</span>+<span style=" ">&#40;</span>dt1\y-dt2\y<span style=" ">&#41;</span>*<span style=" ">&#40;</span>dt1\y-dt2\y<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;Вычисление коэффициентов кривой</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> nn=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> nn <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; v1=dt1\y<br />
&nbsp; v2=dt2\y<br />
&nbsp; c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=dt1\dy2*r#<br />
&nbsp; dy2#=dt2\dy1*r#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; v1=dt1\x<br />
&nbsp; v2=dt2\x<br />
&nbsp; c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=dt1\dx2*r#<br />
&nbsp; dy2#=dt2\dx1*r#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=v1<br />
&nbsp;b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=<span style="color: #33ffdd;">3.0</span>*v2-dy2#<span style="color: #33ffdd;">-2.0</span>*c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><span style="color: #33ffdd;">-3.0</span>*d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><br />
&nbsp;a#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=<span style=" ">&#40;</span>dy2#<span style="color: #33ffdd;">-2</span>*b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>-c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">3.0</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #ffee00">;Построение кривой</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> t#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> stp<br />
&nbsp;tt#=t#*t#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> nn=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; oc<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=a#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*tt#*t#+b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*tt#+c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*t#+d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> t#&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Line</span> oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,x,y<br />
&nbsp;x=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;y=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #ffee00">;Отображение направляющих отрезков, относящихся к кривой, и ее вершин</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> dt1\dx2&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> dt1\dy2&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> dt1\x,dt1\y,dt1\x+dt1\dx2,dt1\y+dt1\dy2<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Oval</span> dt1\x+dt1\dx2<span style="color: #33ffdd;">-1</span>,dt1\y+dt1\dy2<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> dt2\dx1&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> dt2\dy1&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> dt2\x,dt2\y,dt2\x-dt2\dx1,dt2\y-dt2\dy1<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Oval</span> dt2\x-dt2\dx1<span style="color: #33ffdd;">-1</span>,dt2\y-dt2\dy1<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.98.D0.BD.D1.82.D0.B5.D1.80.D1.84.D0.B5.D0.B9.D1.81"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A0%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%BE%D1%80_%D0%B4%D0%B2%D1%83%D0%BC%D0%B5%D1%80%D0%BD%D1%8B%D1%85_%D0%BA%D1%80%D0%B8%D0%B2%D1%8B%D1%85&amp;action=edit&amp;section=2" title="Править секцию: Интерфейс">править</a>]</span> <span class="mw-headline">Интерфейс</span></h2>
<p>Возможные операции: перемещение / вставка / удаление точки, изменение координат векторов. Здесь возникает следующая задача: необходима функция, распознающая объект под курсором мыши. Придется перебирать каждый объект и проверять его.
</p><p>Для вершин существуют несколько методов проверки на касание курсором: проверка на совпадение координат (недостаток - сложно выделить объект, нужна большая точность), квадратная зона вокруг вершины (путем отсечения полуплоскостей) и круглая зона (вычисление расстояния между курсором и вершиной). Воспользуемся вторым методом.
</p><p>При выделении кривой можно использовать подобные методы, проверяя промежуточные точки, но очевидным недостатком будут разрывы в области поиска при "разрежении" массива точек. Поэтому, будет лучше использовать другой метод - разбиение кривой на отрезки и проверка на пересечение ее зоны коллизии и курсора. Это довольно интересная задача: сначала нужно определить, находится ли курсор в прямоугольнике, который ограничивает отрезок (берем минимальные и максимальные значения x и y вершин отрезка и добавляем бордюр в 3 пиксела). Затем определяется расстояние до линии, которой принадлежит отрезок и если оно меньше или равно 3, значит можно выделять линию. Найти коэффициенты уравнения линии, проходящей через 2 точки отрезка можно следующим образом:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Curves01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Curves01.gif" src="yl_v2up6.gif" width="277" height="63" /></a></span></div></div>
<p>Теперь можно найти расстояние от точки до этой линии:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Curves02.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Curves02.gif" src="s9cph788.gif" width="439" height="43" /></a></span></div></div>
<p>Переменная sel определяет текущий выбранный объект: 0 - ничего, 1 - вершина, 2 - кривая. Когда курсор проходит над объектом - объект выделяется, если курсор уходит от объекта - выделение снимается. Еще немного кода и можно перемещать вершины и делить кривую новой вершиной (ПКМ). Но для того, чтобы редактировать вектора нужно, чтобы определенная вершина была выделена независимо от положения курсора. Для этого введем новое значение - sel=3 (вершина выделяется ЛКМ). При этом, клавишами "1" и "2" можно изменять первый или второй, а клавишей "3" - оба вектора сразу. "0" обнуляет вектора, "Del" удаляет вершину. Добавим возможность загрузки и записи кривой в файл "data.bb".
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> dot<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x,y,dx1,dy1,dx2,dy2<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> xres=<span style="color: #33ffdd;">800</span>, yres=<span style="color: #33ffdd;">600</span>, stp#=.<span style="color: #33ffdd;">01</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> seldot.dot, sel, mx, my<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> a#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,b#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,c#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,d#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> xres,yres,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<br />
dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
dt\x=.<span style="color: #33ffdd;">5</span>*xres<br />
dt\y=.<span style="color: #33ffdd;">25</span>*yres<br />
dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
dt\x=.<span style="color: #33ffdd;">5</span>*xres<br />
dt\y=.<span style="color: #33ffdd;">75</span>*yres<br />
<br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
&nbsp;redraw<br />
<br />
&nbsp;mx=<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;my=<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #ffee00">;Эта переменная будет принимать значение 1, если нажата левая и 2, если правая</span><br />
&nbsp;<span style="color: #ffee00">; кнопка мыши</span><br />
&nbsp;mb=<span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+2</span>*<span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Выбор действия в зависимости от нажатой кнопки и выбранного объекта</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> mb+sel*<span style="color: #33ffdd;">10</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">11</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Если нажата левая кнопка мыши и под курсором находится вершина - фиксируем ее</span><br />
&nbsp; &nbsp;sel=<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">31</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Если нажата левая кнопка мыши при зафиксированной вершине - перепроверяем</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">; выделение</span><br />
&nbsp; &nbsp;sel=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;redraw<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> sel=<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">12</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Нажата правая кнопка мыши при выбранной вершине - перемещаем вершину</span><br />
&nbsp; &nbsp;seldot\x=mx<br />
&nbsp; &nbsp;seldot\y=my<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">22</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Нажата правая кнопка мыши при выбранной линии - вставляем вершину</span><br />
&nbsp; &nbsp;dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
&nbsp; &nbsp;dt\x=mx<br />
&nbsp; &nbsp;dt\y=my<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Insert</span> dt <span style="color: #aaffff; font-weight: bold;">After</span> seldot<br />
&nbsp; &nbsp;seldot=dt<br />
&nbsp; &nbsp;sel=<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Блок изменения векторов</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">3</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Нажата клавиша &quot;2&quot; - изменяем второй вектор</span><br />
&nbsp; &nbsp;seldot\dx1=seldot\x-mx<br />
&nbsp; &nbsp;seldot\dy1=seldot\y-my<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">4</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Изменяем первый вектор</span><br />
&nbsp; &nbsp;seldot\dx2=mx-seldot\x<br />
&nbsp; &nbsp;seldot\dy2=my-seldot\y<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">4</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #ffee00">;И второй, если нажата клавиша &quot;3&quot; а не &quot;2&quot;</span><br />
&nbsp; &nbsp; seldot\dx1=mx-seldot\x<br />
&nbsp; &nbsp; seldot\dy1=my-seldot\y<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Если выбрана вершина, то...</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> sel=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #ffee00">;Удаление точки(&quot;Del&quot;)</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">211</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">After</span> <span style="color: #aaffff; font-weight: bold;">First</span> dot&lt;&gt;Last dot <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Delete</span> seldot<br />
&nbsp; &nbsp;sel=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #ffee00">;Обнуление векторов, если нажат &quot;0&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">11</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;seldot\dx1=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;seldot\dy1=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;seldot\dx2=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;seldot\dy2=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Запись кривой</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">60</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; f=<span style="color: #aaffff; font-weight: bold;">WriteFile</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;data.bb&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> dt.dot=<span style="color: #aaffff; font-weight: bold;">Each</span> dot<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">WriteLine</span> f,<span style="color: #00ff66;">&quot;Data &quot;</span>+dt\x+<span style="color: #00ff66;">&quot;,&quot;</span>+dt\y+<span style="color: #00ff66;">&quot;,&quot;</span>+dt\dx1+<span style="color: #00ff66;">&quot;,&quot;</span>+dt\dy1+<span style="color: #00ff66;">&quot;,&quot;</span>+dt\dx2+<span style="color: #00ff66;">&quot;,&quot;</span>+dt\dy2 &nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">CloseFile</span> f<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span> <br />
<br />
&nbsp;<span style="color: #ffee00">;Загрузка кривой</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">61</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> <span style="color: #aaffff; font-weight: bold;">Each</span> dot<br />
&nbsp; f=<span style="color: #aaffff; font-weight: bold;">ReadFile</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;data.bb&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">Eof</span><span style=" ">&#40;</span>f<span style=" ">&#41;</span><br />
&nbsp; &nbsp;dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
&nbsp; &nbsp;m$=<span style="color: #00ff66;">&quot;,&quot;</span>+<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">ReadLine</span><span style=" ">&#40;</span>f<span style=" ">&#41;</span>,<span style="color: #33ffdd;">6</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">6</span><br />
&nbsp; &nbsp; m$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>m$,<span style="color: #00ff66;">&quot;,&quot;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Select</span> n<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span>:dt\x=m$<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span>:dt\y=m$<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">3</span>:dt\dx1=m$<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">4</span>:dt\dy1=m$<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">5</span>:dt\dx2=m$<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">6</span>:dt\dy2=m$<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">CloseFile</span> f<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> redraw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Если выделение не зафиксировано, оно обновляется</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> sel&lt;<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span> sel=<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #ffee00">;Проверка на коллизию с точкой</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> dt.dot=<span style="color: #aaffff; font-weight: bold;">Each</span> dot<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>mx-dt\x<span style=" ">&#41;</span>&lt;=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>my-dt\y<span style=" ">&#41;</span>&lt;=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span> seldot=dt: sel=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> dt.dot=<span style="color: #aaffff; font-weight: bold;">Each</span> dot<br />
&nbsp;<span style="color: #ffee00">;Выделение точки</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Oval</span> dt\x<span style="color: #33ffdd;">-1</span>,dt\y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp;drawcurve dt<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> sel <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Oval</span> seldot\x<span style="color: #33ffdd;">-3</span>,seldot\y<span style="color: #33ffdd;">-3</span>,<span style="color: #33ffdd;">7</span>,<span style="color: #33ffdd;">7</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> drawcurve<span style=" ">&#40;</span>dt1.dot<span style=" ">&#41;</span><br />
dt2.dot=<span style="color: #aaffff; font-weight: bold;">After</span> dt1<br />
<span style="color: #aaffff; font-weight: bold;">If</span> dt2=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span><br />
<br />
r#=.<span style="color: #33ffdd;">05</span>*<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span><span style=" ">&#40;</span>dt1\x-dt2\x<span style=" ">&#41;</span>*<span style=" ">&#40;</span>dt1\x-dt2\x<span style=" ">&#41;</span>+<span style=" ">&#40;</span>dt1\y-dt2\y<span style=" ">&#41;</span>*<span style=" ">&#40;</span>dt1\y-dt2\y<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> nn=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> nn <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; v1=dt1\y<br />
&nbsp; v2=dt2\y<br />
&nbsp; c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=dt1\dy2*r#<br />
&nbsp; dy2#=dt2\dy1*r#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; v1=dt1\x<br />
&nbsp; v2=dt2\x<br />
&nbsp; c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=dt1\dx2*r#<br />
&nbsp; dy2#=dt2\dx1*r#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=v1<br />
&nbsp;b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=<span style="color: #33ffdd;">3.0</span>*v2-dy2#<span style="color: #33ffdd;">-2.0</span>*c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><span style="color: #33ffdd;">-3.0</span>*d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><br />
&nbsp;a#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=<span style=" ">&#40;</span>dy2#<span style="color: #33ffdd;">-2</span>*b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>-c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">3.0</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> t#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> stp<br />
&nbsp;tt#=t#*t#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> nn=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; oc<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=a#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*tt#*t#+b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*tt#+c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*t#+d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> t#&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">4</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Выделение текущей кривой</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> xx=<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> yy=<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+xx,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+yy,x+xx,y+yy<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,x,y<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Проверка на коллизию с отрезком кривой</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #ffee00">;Проверка нахождения курсора внутри ограничивающего прямоугольника</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> mx&gt;=min<span style=" ">&#40;</span>x,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">-3</span> <span style="color: #aaffff; font-weight: bold;">And</span> mx&lt;=max<span style=" ">&#40;</span>x,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+3</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> my&gt;=min<span style=" ">&#40;</span>y,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">-3</span> <span style="color: #aaffff; font-weight: bold;">And</span> my&lt;=max<span style=" ">&#40;</span>y,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+3</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; aa#=y-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; bb#=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>-x<br />
&nbsp; &nbsp; <span style="color: #ffee00">;Проверка расстояния от прямой</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>aa#*<span style=" ">&#40;</span>mx-x<span style=" ">&#41;</span>+bb#*<span style=" ">&#40;</span>my-y<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;=<span style="color: #33ffdd;">3.0</span>*<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>aa#*aa#+bb#*bb#<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;seldot=dt1<br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Это хитрый способ повторить построение кривой, выделив ее и заодно</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; при этом избавиться от проверки</span><br />
&nbsp; &nbsp; &nbsp;sel=<span style="color: #33ffdd;">4</span><br />
&nbsp; &nbsp; &nbsp;t#=-stp<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;x=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;y=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #ffee00">;Восстанавливаем значение sel</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">4</span> <span style="color: #aaffff; font-weight: bold;">Then</span> sel=<span style="color: #33ffdd;">2</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> dt1\dx2&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> dt1\dy2&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> dt1\x,dt1\y,dt1\x+dt1\dx2,dt1\y+dt1\dy2<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Oval</span> dt1\x+dt1\dx2<span style="color: #33ffdd;">-1</span>,dt1\y+dt1\dy2<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> dt2\dx1&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> dt2\dy1&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> dt2\x,dt2\y,dt2\x-dt2\dx1,dt2\y-dt2\dy1<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Oval</span> dt2\x-dt2\dx1<span style="color: #33ffdd;">-1</span>,dt2\y-dt2\dy1<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> min<span style=" ">&#40;</span>v1,v2<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> v1&lt;v2 <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> v1 <span style="color: #aaffff; font-weight: bold;">Else</span> <span style="color: #aaffff; font-weight: bold;">Return</span> v2<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> max<span style=" ">&#40;</span>v1,v2<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> v1&gt;v2 <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> v1 <span style="color: #aaffff; font-weight: bold;">Else</span> <span style="color: #aaffff; font-weight: bold;">Return</span> v2<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/b/ba/2D_Curves.zip" class="internal" title="2D Curves.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)
</p><!-- 
Pre-expand include size: 7709 bytes
Post-expand include size: 409 bytes
Template argument size: 20 bytes
Maximum: 2097152 bytes
-->

<!-- Saved in parser cache with key db1:pcache:idhash:703-0!1!0!!ru!2 and timestamp 20071110033630 -->
<div class="printfooter">
Получено с <a href="2b8krxgh.html">http://blitzetcetera.org/index.php/%D0%A0%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%BE%D1%80_%D0%B4%D0%B2%D1%83%D0%BC%D0%B5%D1%80%D0%BD%D1%8B%D1%85_%D0%BA%D1%80%D0%B8%D0%B2%D1%8B%D1%85</a></div>
			<!-- end content -->			<div class="visualClear"></div>				</td>				<td class="rightside">				</td>			</tr>		</table>		</div>	</div>		</div>	
		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</div></body>
<!-- Mirrored from localhost/index.php/%D0%A0%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%BE%D1%80_%D0%B4%D0%B2%D1%83%D0%BC%D0%B5%D1%80%D0%BD%D1%8B%D1%85_%D0%BA%D1%80%D0%B8%D0%B2%D1%8B%D1%85 by HTTrack Website Copier/3.x [XR&CO'2007], Sat, 10 Nov 2007 05:16:17 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>