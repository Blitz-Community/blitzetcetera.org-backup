<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru" dir="ltr">	
<!-- Mirrored from localhost/index.php/%D0%A2%D1%83%D1%82%D0%BE%D1%80%D0%B8%D0%B0%D0%BB_%C2%AB%D0%97%D0%BC%D0%B5%D0%B9%D0%BA%D0%B0%C2%BB by HTTrack Website Copier/3.x [XR&CO'2007], Sat, 10 Nov 2007 05:15:23 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />				<meta name="keywords" content="Туториал «Змейка»,SubZer0" />
		<link rel="shortcut icon" href="http://blitzetcetera.org/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="http://blitzetcetera.org/opensearch_desc.php" title="Blitz Et Cetera (Русский)" />
		<title>Туториал «Змейка» — Blitz Et Cetera</title>		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "bvih5rde.css?63"; /*]]>*/</style>		<link rel="stylesheet" type="text/css" media="print" href="gcxktlm6.css?63" />		<link rel="stylesheet" type="text/css" media="handheld" href="zumsslq_.css?63" />		<!--[if lt IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE50Fixes.css?63";</style><![endif]-->		<!--[if IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE55Fixes.css?63";</style><![endif]-->		<!--[if IE 6]><style type="text/css">@import "/skins/OfflineNew/IE60Fixes.css?63";</style><![endif]-->		<!--[if IE 7]><style type="text/css">@import "/skins/OfflineNew/IE70Fixes.css?63";</style><![endif]-->		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?63"></script>		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->		<script type= "text/javascript">/*<![CDATA[*/
var skin = "OfflineNew";
var stylepath = "/skins";
var wgArticlePath = "/index.php/$1";
var wgScriptPath = "";
var wgServer = "http://blitzetcetera.org/";
var wgCanonicalNamespace = "";
var wgCanonicalSpecialPageName = false;
var wgNamespaceNumber = 0;
var wgPageName = "Туториал_«Змейка»";
var wgTitle = "Туториал «Змейка»";
var wgAction = "view";
var wgArticleId = "663";
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "ru";
var wgContentLanguage = "ru";
var wgBreakFrames = false;
var wgCurRevisionId = "3533";
/*]]>*/</script>
		<script type="text/javascript" src="2nq-6cel.js?63"><!-- wikibits js --></script>		<script type="text/javascript" src="http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=js"><!-- site js --></script>		<style type="text/css">/*<![CDATA[*/
@import "http://blitzetcetera.org/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=MediaWiki:OfflineNew.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=css&amp;maxage=18000";
/*]]>*/</style>		<!-- Head Scripts -->	</head><body  class="mediawiki ns-0 ltr page-Туториал_«Змейка»">	<div id="globalWrapper">	<div id="logocontainer">		<table align="center">		  <tr>				<td id="blitzetclogo">				</td>			</tr>		</table>	</div>	<div id="magbar">	Журнал о программированнии на языках Blitz3D, BlitzMax, BlitzPlus	</div>		<div id="column-content">	<div id="content">		<a name="top" id="top"></a>				<div id="bodyContent">		<table cellspacing=0 cellpadding=0 width=100%>			<tr>			  <td class="leftside">				</td>				<td class="sheetbody">					<h1 class="sheet">Туториал «Змейка»</h1>			<h3 id="siteSub">Материал из Blitz Et Cetera.</h3>			<div id="contentSub"></div>			<!-- start content -->			<p>Доброго времени суток!
</p><p>Заметил я, что юные программисты часто сталкиваются с проблемой написания простой змейки! Попробуем это исправить, подсказав как это можно реализовать!
</p><p>Значит, задача: сделать "змейку", как на старом добром карманном "тетрисе"... чтоб она что-нибудь ела и при этом росла, ну и чтобы нельзя было себя за хвост "укусить", оградим игровое поле гранитом, чтоб нашей змее не удалось ее прогрызть и выбраться наружу (для удобства описания обзовем нашу змею кольчатым червем, и соответственно отдельные "куски" змеи - кольцами).
</p><p>Но, прежде чем займемся кодом, немножко теории:
</p><p>В наипростейшем случае змейка представляет собой массив ячеек в которых хранятся координаты положения колец змейки т.е. все тело змейки представляет собой примерно такую конструкцию:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake01.gif" src="bwzmd-d_.gif" width="363" height="73" /></a></span></div></div>
<p>В ячейке с номером "1" хранится голова змеи, в ячейке под номером "2" - первое кольцо, в "3" - второе и т.п.&lt;.p&gt;
</p><p>Наверное вы уже догадываетесь, как будет организовано ползание змеи... всё просто... при перемещении головы змеи, за ней должен двигаться весь ее хвост. Но программировать это придется детально. Нужно первое кольцо передвинуть на место, где раньше была голова, второе кольцо передвинуть туда, где раньше было первое. Третье туда, где было второе и так до саамого конца хвоста.
</p><p>Если все это перевести в логику программирования, то получится так, что координатам ячейки головы присваиваются новые координаты (она передвинулась) затем координаты головы присваиваются координатам первого кольца, координаты первого кольца присваиваются координатам второго кольца и в таком духе обрабатывается весь хвост. Схематично это можно отобразить так:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake02.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake02.gif" src="hqffj7w5.gif" width="347" height="127" /></a></span></div></div>
<p>Вот и весь секрет змейки... но во всем вышенаписанном есть один небольшой недостаток, змейка двигается не плавно... Чтобы это исправить, у меня появилась такая идея (может кто делает по-другому, а я делаю так): нужно не сразу координатам первого кольца присваивать координаты головы, а немножко погодя... хммм... но их нужно ведь где-то сохранять... для этого увеличивается количество ячеек змейки, и кольца делаются зависимыми от ячеек через определенное "расстояние", допустим каждая пятая ячейка будет кольцом, а остальные будут промежуточными хранилищами координат... Схематично можно отобразить это так:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake03.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake03.gif" src="qh9vyv3f.gif" width="612" height="145" /></a></span></div></div>
<p>Ну теперь уж точно всё! Теперь все секреты змеи раскрыты, приступим к программированию. Будем писать, используя динамичный массив типов. Создадим тип массива для змеи:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>Значения переменных:
</p>
<ul><li>h - будет хранить хендл объекта головы или кольца змеи
</li><li>s - будет использоваться только в первом элементе массива, и будет задавать количество "хранилищ" координат между кольцами змеи
</li><li>x, y и z - будут хранить сами координаты кольца, или просто промежуточные координаты.
</li></ul>
<p><br />
Создадим саму змею т.е. создадим динамичный массив и заполним его первыми характеристиками:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
<p><br />
Snake\h%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
Snake\s%=<span style="color: #33ffdd;">5</span><br />
Snake\x#=<span style="color: #33ffdd;">0</span><br />
Snake\y#=<span style="color: #33ffdd;">0</span><br />
</p>
Snake\z#=<span style="color: #33ffdd;">0</span></div>
<p>Вот мы создали голову змеи, в h занесем сам объект для отображения головы, в s запишем сколько будет хранилищ координат до первого кольца. Присвоим голове змеи изначальные координаты, в этом случае это будут 0,0,0 (середина мира). Создадим одно кольцо для змеи:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">Snake.sn=<span style="color: #aaffff; font-weight: bold;">First</span> sn<br />
<p>j=Snake\s%<br />
x=Snake\x#<br />
y=Snake\y#<br />
z=Snake\z#<br />
<br />
Snake.sn = <span style="color: #aaffff; font-weight: bold;">Last</span> sn<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i%=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> j<br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> i%=j% <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; <br />
&nbsp;k%=k%<span style="color: #33ffdd;">+1</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Next</span></div>
<p>Для создания кольца, нам нужно "спросить" у головы сколько создавать резервных хранилищ... перемещаем индикатор указателя в массиве в самое начало (Snake.sn=First sn) затем присваиваем какой-нить резервной переменной количество хранилищ (j=Snake\s%). Я еще сохранял резервные координаты, чтоб змея появилась в одной точке, это не особо-важно, можно не делать.
</p><p>Далее, переместим индикатор указателя в конец массива и приступим к созданию: запускаем цикл создающий резервные хранилища, и в этом цикле зададим условие (If i%=j%) если цикл идет последний раз, то надо вместо простого хранилища создать само кольцо... на самом деле хранилище отличается от кольца только наличием объекта отображающегося на экране... запишем в s идентификатор какого-нибудь объекта... теперь уже становится интересней... чтобы отобразить змейку на экране, используется такой код:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
<p>&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h,Snake\x,Snake\y,Snake\z<br />
</p>
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span></div>
<p>Здесь мы просто запускаем цикл, и если в переменной h что-нибудь записано (какой-нибудь объект) то позиционируем его согласно новых позиций.
</p><p>Ну а теперь самое интересное.. процедура перемещения координат от головы к хвосту... в нормальном случае, используя массив, цикл должен запускаться от конца к началу, чтобы не затирать старые координаты новыми, но за неимением такового цикла в блице, и из-за сложности адресации в типах сделаем все проще и понятней:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">x1#=x#<br />
<p>y1#=y#<br />
z1#=z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> z=z<span style="color: #33ffdd;">+0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> z=z<span style="color: #33ffdd;">-0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> x=x<span style="color: #33ffdd;">-0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> x=x<span style="color: #33ffdd;">+0.2</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> x1#&lt;&gt;x# <span style="color: #aaffff; font-weight: bold;">Or</span> y1#&lt;&gt;y# <span style="color: #aaffff; font-weight: bold;">Or</span> z1#&lt;&gt;z# <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<span style="color: #ffee00">; rotate snake</span><br />
<br />
x2#=x#<br />
y2#=y#<br />
z2#=z#<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
<br />
&nbsp; &nbsp;x1#=Snake\x<br />
&nbsp; &nbsp;y1#=Snake\y<br />
&nbsp; &nbsp;z1#=Snake\z<br />
<br />
&nbsp; &nbsp;Snake\x=x#<br />
&nbsp; &nbsp;Snake\y=y#<br />
&nbsp; &nbsp;Snake\z=z#<br />
<br />
&nbsp; &nbsp;x#=x1#<br />
&nbsp; &nbsp;y#=y1#<br />
&nbsp; &nbsp;z#=z1#<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
x#=x2#<br />
y#=y2#<br />
</p>
z#=z2#</div>
<p>В переменных x, y и z хранятся координаты головы. Сначала сохраняем координаты в каких-нибудь резервных переменных, затем спрашиваем игрока не соизволит ли он нажать какую-нибудь клавишу (если соизволит, то изменим соответствующие координаты). После этого проверяем, изменилось ли значение переменных координат, путем сравнения их с резервными переменными, в них ведь старые координаты лежат.
</p><p>Если координаты изменились, то запускаем процедуру перемещения всей змеи. Для выполнения процедуры нам потребуется сохранить переменные координат, поскольку после прохождения цикла в них будет не то, что было раньше. сама процедура состоит из одного цикла, который пройдет по всем ячейкам змеи.
</p><p>В цикле: временно сохраним координаты (для следующего шага) (x1#=Snake\x), присвоим новые координаты этой ячейке (Snake\x=x#), и затем присвоим временно сохраненные координаты основным переменным для того, чтобы на следующем шаге цикла присвоить их следующей ячейке массива (x#=x1#)... после прохождения цикла в переменных x, y и z хранятся координаты последнего кольца змеи... восстановим их, чтобы там снова хранились координаты головы змеи (x#=x2#)
</p><p>Вот, в принципе, и всё! Теперь собрав весь код вместе уже можно получить змею, которая будет ползать, изменяя направление, в зависимости от нажатия клавиш...
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
x#=<span style="color: #33ffdd;">0</span><br />
y#=<span style="color: #33ffdd;">0</span><br />
z#=<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">-20</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<br />
<span style="color: #ffee00">; create snake</span><br />
<br />
Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
<br />
Snake\h%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
Snake\s%=<span style="color: #33ffdd;">5</span><br />
Snake\x#=<span style="color: #33ffdd;">0</span><br />
Snake\y#=<span style="color: #33ffdd;">0</span><br />
Snake\z#=<span style="color: #33ffdd;">0</span><br />
<br />
<br />
<span style="color: #ffee00">; add segment</span><br />
<br />
Snake.sn=<span style="color: #aaffff; font-weight: bold;">First</span> sn<br />
j=Snake\s%<br />
x=Snake\x#<br />
y=Snake\y#<br />
z=Snake\z#<br />
<br />
Snake.sn = <span style="color: #aaffff; font-weight: bold;">Last</span> sn<br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i%=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> j<br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> i%=j% <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; <br />
&nbsp;k%=k%<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
x1#=x#<br />
y1#=y#<br />
z1#=z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> z=z<span style="color: #33ffdd;">+0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> z=z<span style="color: #33ffdd;">-0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> x=x<span style="color: #33ffdd;">-0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> x=x<span style="color: #33ffdd;">+0.2</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> x1#&lt;&gt;x# <span style="color: #aaffff; font-weight: bold;">Or</span> y1#&lt;&gt;y# <span style="color: #aaffff; font-weight: bold;">Or</span> z1#&lt;&gt;z# <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<span style="color: #ffee00">; rotate snake</span><br />
<br />
x2#=x#<br />
y2#=y#<br />
z2#=z#<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
<br />
&nbsp; &nbsp;x1#=Snake\x<br />
&nbsp; &nbsp;y1#=Snake\y<br />
&nbsp; &nbsp;z1#=Snake\z<br />
<br />
&nbsp; &nbsp;Snake\x=x#<br />
&nbsp; &nbsp;Snake\y=y#<br />
&nbsp; &nbsp;Snake\z=z#<br />
<br />
&nbsp; &nbsp;x#=x1#<br />
&nbsp; &nbsp;y#=y1#<br />
&nbsp; &nbsp;z#=z1#<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
x#=x2#<br />
y#=y2#<br />
z#=z2#<br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h,Snake\x,Snake\y,Snake\z<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<table id="toc" class="toc" summary="Содержание"><tr><td><div id="toctitle"><h2>Содержание</h2></div>
<ul>
<li class="toclevel-1"><a href="#.D0.9F.D0.B5.D1.80.D0.B5.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D0.BA.D0.B0_.D0.BA.D0.BE.D0.B4.D0.B0"><span class="tocnumber">1</span> <span class="toctext">Переработка кода</span></a></li>
<li class="toclevel-1"><a href="#.D0.A3.D0.B3.D0.BB.D1.8B"><span class="tocnumber">2</span> <span class="toctext">Углы</span></a></li>
<li class="toclevel-1"><a href="#.D0.A1.D0.BA.D0.BE.D1.80.D0.BE.D1.81.D1.82.D1.8C"><span class="tocnumber">3</span> <span class="toctext">Скорость</span></a></li>
<li class="toclevel-1"><a href="#.D0.98.D0.B3.D1.80.D0.BE.D0.B2.D0.BE.D0.B5_.D0.BF.D0.BE.D0.BB.D0.B5"><span class="tocnumber">4</span> <span class="toctext">Игровое поле</span></a></li>
<li class="toclevel-1"><a href="#.D0.95.D0.94.D0.90"><span class="tocnumber">5</span> <span class="toctext">ЕДА</span></a></li>
</ul>
</td></tr></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "показать"; var tocHideText = "убрать"; showTocToggle(); } </script>
<a name=".D0.9F.D0.B5.D1.80.D0.B5.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D0.BA.D0.B0_.D0.BA.D0.BE.D0.B4.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D1%83%D1%82%D0%BE%D1%80%D0%B8%D0%B0%D0%BB_%C2%AB%D0%97%D0%BC%D0%B5%D0%B9%D0%BA%D0%B0%C2%BB&amp;action=edit&amp;section=1" title="Править секцию: Переработка кода">править</a>]</span> <span class="mw-headline">Переработка кода</span></h2>
<p>Продолжим разработку нашего кольцевого червя! Но, прежде чем мы будем совершенствовать код, немножко теории: код в теперешнем состоянии имеет кучу недостатков. Первый из них - это используемая оперативная память... массив змейки выглядит примерно так:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake04.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake04.gif" src="p11fkg25.gif" width="549" height="329" /></a></span></div></div>
<p>В каждой ячейке есть место под координаты, под хендлы объектов колец змеи и под количество сегментов... Для резервных хранилищ не нужны переменные объектов и практически все элементы массива содержат лишние переменные s, используется-то переменная всего лишь единожды, и на протяжении всего массива эта переменная забивается нулями... Это очень плохо, занимать много оперативной памяти, не используя ее... надо исправить.
</p><p>Второй недостаток - то, что если мы по интуиции, чтобы увеличить скорость передвижения змеи, будем увеличивать ее шаг, то она будет "растягиваться"... решается этот недостаток несколькими путями: можно сделать динамическое количество промежуточных резервных хранилищ, а можно перемещать змейку на равный шаг, но с определенной частотой... возьмем второй метод на вооружение...
</p><p>Еще недостаток - весь код в таком состоянии, как будто он создан в GWBasic, надо маленько все распихать по функциям, таким образом, добавить всему коду "юзабельность"...
</p><p>Приступим к коду. Новые типы для змейки выглядят так:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>В нашем предыдущем коде можно было создать только одну змейку, чтобы их можно было создавать не одну, а больше, их нужно как-то отделять в общем массиве друг от друга, для этого вводим переменную id% которая будет содержать идентификатор змейки... Кроме этого, создаем еще один параллельный тип, в котором будем хранить координаты головы змеи, чтобы не прочесывать каждый раз основной массив в поисках головы для перемещения ее на новые координаты. Теперь функции:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
<p>&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Создание змеи. Сперва подсчитываем, сколько змей уже создано, чтобы новой змее выдать следующий уникальный номер. Здесь создаем голову змеи в основном массиве Snake и во вспомогательном SnakeManager создаем запись с координатами головы змеи. Ну и, естественно, возвращаем номер змеи для последующего использования:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
<p><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> s%=SnakeManager\s%<br />
&nbsp; x#=SnakeManager\x#<br />
&nbsp; y#=SnakeManager\y#<br />
&nbsp; z#=SnakeManager\z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; Snake\id%=id%<br />
&nbsp; Snake\x#=x#<br />
&nbsp; Snake\y#=y#<br />
&nbsp; Snake\z#=z#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Добавление кольца змеи. Здесь все немножко видоизменено, теперь нам не надо обращаться к первому элементу массива для получения количества промежуточных хранилищ... Теперь эта информация хранится в другом массиве... Ищем ее там и если есть змея с таким id%, то сохраним во временную переменную s% количество хранилищ, затем создадим нужное количество хранилищ и, самым последним, новое кольцо.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp;SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp;SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp;x#=SnakeManager\x#<br />
&nbsp; &nbsp;y#=SnakeManager\y#<br />
&nbsp; &nbsp;z#=SnakeManager\z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;x1#=Snake\x<br />
&nbsp; &nbsp;y1#=Snake\y<br />
&nbsp; &nbsp;z1#=Snake\z<br />
&nbsp; &nbsp;Snake\x=x#<br />
&nbsp; &nbsp;Snake\y=y#<br />
&nbsp; &nbsp;Snake\z=z#<br />
&nbsp; &nbsp;x#=x1#<br />
&nbsp; &nbsp;y#=y1#<br />
&nbsp; &nbsp;z#=z1#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Перемещение змеи. Этот код тоже немного изменен... Теперь у нас нет переменных x, y и z, которые хранили координаты головы, теперь это все хранится во вспомогательном массиве. Ищем их там по id% и если есть змея с таким id%, то добавляем к координатам головы координаты, поступившие в функцию, и сохраняем новые значения координат в переменные x, y и z для следующего цикла... Затем выбираем из массива все части змеи с идентификатором текущей и "продвигаем" координаты от головы к хвосту...
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h,Snake\x,Snake\y,Snake\z<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Обновление позиций объектов колец змеи. Здесь все без изменений... Теперь можно создавать не одну змейку, теперь нет лишней переменной s% которая просто так занимала бы место в массиве... Кроме этого все стало более приятно глазу и легко в использовании.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">-20</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<br />
a%=SnakeCreate<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">6</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">10</span><br />
&nbsp;SnakeAddSegment<span style=" ">&#40;</span>a,<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
b%=SnakeCreate<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">6</span>,<span style="color: #33ffdd;">-3</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">10</span><br />
&nbsp;SnakeAddSegment<span style=" ">&#40;</span>b,<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
time%=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
&nbsp;speed#=<span style="color: #33ffdd;">0.3</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed#<span style=" ">&#41;</span>:SnakeMove<span style=" ">&#40;</span>b,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed#<span style=" ">&#41;</span>:SnakeMove<span style=" ">&#40;</span>b,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>:SnakeMove<span style=" ">&#40;</span>b,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>:SnakeMove<span style=" ">&#40;</span>b,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<br />
&nbsp;SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-time&lt;=<span style="color: #33ffdd;">20</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> s%=SnakeManager\s%<br />
&nbsp; x#=SnakeManager\x#<br />
&nbsp; y#=SnakeManager\y#<br />
&nbsp; z#=SnakeManager\z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; Snake\id%=id%<br />
&nbsp; Snake\x#=x#<br />
&nbsp; Snake\y#=y#<br />
&nbsp; Snake\z#=z#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> <br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp;SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp;SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp;x#=SnakeManager\x#<br />
&nbsp; &nbsp;y#=SnakeManager\y#<br />
&nbsp; &nbsp;z#=SnakeManager\z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;x1#=Snake\x<br />
&nbsp; &nbsp;y1#=Snake\y<br />
&nbsp; &nbsp;z1#=Snake\z<br />
&nbsp; &nbsp;Snake\x=x#<br />
&nbsp; &nbsp;Snake\y=y#<br />
&nbsp; &nbsp;Snake\z=z#<br />
&nbsp; &nbsp;x#=x1#<br />
&nbsp; &nbsp;y#=y1#<br />
&nbsp; &nbsp;z#=z1#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h,Snake\x,Snake\y,Snake\z<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.A3.D0.B3.D0.BB.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D1%83%D1%82%D0%BE%D1%80%D0%B8%D0%B0%D0%BB_%C2%AB%D0%97%D0%BC%D0%B5%D0%B9%D0%BA%D0%B0%C2%BB&amp;action=edit&amp;section=2" title="Править секцию: Углы">править</a>]</span> <span class="mw-headline">Углы</span></h2>
<p>Посмотрим, что у нас получилось... Змея уже умеет ползать, супер! Только если бы мы ее сделали из кубиков, то заметили бы, что она не поворачивает голову и все остальные кольца тоже постоянно находятся в одном положении... Это надо исправить... Итак, приступим к делу!
</p><p>С углами работа точно такаяже как и с координатами, их надо прописывать голове и потом в процедуру сдвига координат от головы к хвосту добавить сдвиг углов... Возьмем клаву в ежовые рукавицы!!!
</p><p>Добавим в типы поля для сохранения углов объектов:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>В процедуру создания добавим сохранение текущего угла головы змеи в поля для углов, чтобы в последствии двигать его по всему телу.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
<p>&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;SnakeManager\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;Snake\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>В процедуру создания змеи поступает идентификатор объекта, из него берем углы функциями EntityPitch(h%), EntityYaw(h%), EntityRoll(h%) и прописываем их как в основной, так и во вспомогательный массив, во вспомогательный заносится для последующей ротации, а в основной, чтоб змея появилась нормально до первого ее движения. Чтоб функция SnakeUpdate могла сразу обработать созданную змею.
</p><p>Не забудем и процедуру добавления сегмента, туда тоже добавим обработку углов:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> s%=SnakeManager\s%<br />
&nbsp; x#=SnakeManager\x#<br />
&nbsp; y#=SnakeManager\y#<br />
&nbsp; z#=SnakeManager\z#<br />
&nbsp; ax#=SnakeManager\ax#<br />
&nbsp; ay#=SnakeManager\ay#<br />
&nbsp; az#=SnakeManager\az#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; Snake\id%=id%<br />
&nbsp; Snake\x#=x#<br />
&nbsp; Snake\y#=y#<br />
&nbsp; Snake\z#=z#<br />
&nbsp; Snake\ax#=ax#<br />
&nbsp; Snake\ay#=ay#<br />
&nbsp; Snake\az#=az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Здесь мы берем углы из вспомогательного массива SnakeManager (угол положения головы) и присваиваем его очередному кольцу. Процедуру обновления обновляем одной командой установления угла очередному кольцу. Код:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h%,Snake\x#,Snake\y#,Snake\z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> Snake\h%,Snake\ax#,Snake\ay#,Snake\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Ну и, наконец, процедура сдвига координат... В ней нужно добавить обработку углов... Добавляем:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp;SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp;SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp;x#=SnakeManager\x#<br />
&nbsp; &nbsp;y#=SnakeManager\y#<br />
&nbsp; &nbsp;z#=SnakeManager\z#<br />
&nbsp; &nbsp;ax#=SnakeManager\ax#<br />
&nbsp; &nbsp;ay#=SnakeManager\ay#<br />
&nbsp; &nbsp;az#=SnakeManager\az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;x1#=Snake\x<br />
&nbsp; &nbsp;y1#=Snake\y<br />
&nbsp; &nbsp;z1#=Snake\z<br />
&nbsp; &nbsp;ax1#=Snake\ax<br />
&nbsp; &nbsp;ay1#=Snake\ay<br />
&nbsp; &nbsp;az1#=Snake\az<br />
&nbsp; &nbsp;Snake\x=x#<br />
&nbsp; &nbsp;Snake\y=y#<br />
&nbsp; &nbsp;Snake\z=z#<br />
&nbsp; &nbsp;Snake\ax=ax#<br />
&nbsp; &nbsp;Snake\ay=ay#<br />
&nbsp; &nbsp;Snake\az=az#<br />
&nbsp; &nbsp;x#=x1#<br />
&nbsp; &nbsp;y#=y1#<br />
&nbsp; &nbsp;z#=z1#<br />
&nbsp; &nbsp;ax#=ax1#<br />
&nbsp; &nbsp;ay#=ay1#<br />
&nbsp; &nbsp;az#=az1#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Берем координаты головы из вспомогательного массива SnakeManager и присваиваем их следующему кольцу (или временному хранилищу)... короче все точно также как и с координатами...
</p><p>Кроме всего этого, добавляем в код функцию поворота головы змеи. Код:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetAngle<span style=" ">&#40;</span>id%,ax#,ay#,az#<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\ax#=ax#<br />
&nbsp; &nbsp;SnakeManager\ay#=ay#<br />
&nbsp; &nbsp;SnakeManager\az#=az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Здесь все просто... ищем во вспомогательном массиве нужную змею (id%) и прописываем углы... в последующем процедура SnakeMove возьмет отсюда эти углы и присвоит их голове а в последствии и всем кольцам тела змеи.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">-20</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<br />
t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.8</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
<br />
t1%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t1%,<span style="color: #33ffdd;">-0.5</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t1%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t1%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
t2%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t2%,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t2%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t2%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
<br />
<br />
a%=SnakeCreate<span style=" ">&#40;</span>t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
j1#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">10</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1.5</span>*j1#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>*j1#<span style=" ">&#41;</span><span style="color: #33ffdd;">-1.2</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;SnakeAddSegment<span style=" ">&#40;</span>a%,t%<span style=" ">&#41;</span><br />
&nbsp;j1#=j1#<span style="color: #33ffdd;">-0.07</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
time%=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
&nbsp;speed#=<span style="color: #33ffdd;">0.1</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed#<span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed#<span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">180</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">270</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<br />
&nbsp;SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-time&lt;=<span style="color: #33ffdd;">20</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">Str</span><span style=" ">&#40;</span>SnakeTime%<span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetAngle<span style=" ">&#40;</span>id%,ax#,ay#,az#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\ax#=ax#<br />
&nbsp; &nbsp;SnakeManager\ay#=ay#<br />
&nbsp; &nbsp;SnakeManager\az#=az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp;SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp;SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp;x#=SnakeManager\x#<br />
&nbsp; &nbsp;y#=SnakeManager\y#<br />
&nbsp; &nbsp;z#=SnakeManager\z#<br />
&nbsp; &nbsp;ax#=SnakeManager\ax#<br />
&nbsp; &nbsp;ay#=SnakeManager\ay#<br />
&nbsp; &nbsp;az#=SnakeManager\az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;x1#=Snake\x<br />
&nbsp; &nbsp;y1#=Snake\y<br />
&nbsp; &nbsp;z1#=Snake\z<br />
&nbsp; &nbsp;ax1#=Snake\ax<br />
&nbsp; &nbsp;ay1#=Snake\ay<br />
&nbsp; &nbsp;az1#=Snake\az<br />
&nbsp; &nbsp;Snake\x=x#<br />
&nbsp; &nbsp;Snake\y=y#<br />
&nbsp; &nbsp;Snake\z=z#<br />
&nbsp; &nbsp;Snake\ax=ax#<br />
&nbsp; &nbsp;Snake\ay=ay#<br />
&nbsp; &nbsp;Snake\az=az#<br />
&nbsp; &nbsp;x#=x1#<br />
&nbsp; &nbsp;y#=y1#<br />
&nbsp; &nbsp;z#=z1#<br />
&nbsp; &nbsp;ax#=ax1#<br />
&nbsp; &nbsp;ay#=ay1#<br />
&nbsp; &nbsp;az#=az1#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;SnakeManager\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;Snake\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> s%=SnakeManager\s%<br />
&nbsp; x#=SnakeManager\x#<br />
&nbsp; y#=SnakeManager\y#<br />
&nbsp; z#=SnakeManager\z#<br />
&nbsp; ax#=SnakeManager\ax#<br />
&nbsp; ay#=SnakeManager\ay#<br />
&nbsp; az#=SnakeManager\az#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; Snake\id%=id%<br />
&nbsp; Snake\x#=x#<br />
&nbsp; Snake\y#=y#<br />
&nbsp; Snake\z#=z#<br />
&nbsp; Snake\ax#=ax#<br />
&nbsp; Snake\ay#=ay#<br />
&nbsp; Snake\az#=az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h%,Snake\x#,Snake\y#,Snake\z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> Snake\h%,Snake\ax#,Snake\ay#,Snake\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.A1.D0.BA.D0.BE.D1.80.D0.BE.D1.81.D1.82.D1.8C"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D1%83%D1%82%D0%BE%D1%80%D0%B8%D0%B0%D0%BB_%C2%AB%D0%97%D0%BC%D0%B5%D0%B9%D0%BA%D0%B0%C2%BB&amp;action=edit&amp;section=3" title="Править секцию: Скорость">править</a>]</span> <span class="mw-headline">Скорость</span></h2>
<p>Сделаем змее изменение скорости. Как уже упоминалось, если сделать интуитивно, т.е. увеличить шаг змеи, то получится нежелательный эффект "растягивания" змеи. Можно конечно это компенсировать динамичным количеством промежуточных хранилищ координат, если скорость (шаг) увеличивается, то уменьшать количество промежуточных хранилищ и наоборот. Но мы поступим по-другому: мы введем время, через которое будет делаться шаг. Получится меньше геморроя в коде и, соответственно, потратится меньше трудов на его составление.
</p><p>Поехали.
</p><p>Время будет меряться следующим образом: будут две дополнительные переменные, в одной будет храниться текущее время, а в другой, сколько его было с самого начала, чтоб можно было не один раз время отмерять... И в самой процедуре передвижения мы будем вычитать из переменной текущего времени единицу и если переменная стала нулем или меньше, то сделаем шаг и восстановим значение времени на первоначальное, взяв его из переменной, которая его надежно хранила выжидав этого момента.
</p><p>Ну хватит теории, приступим к коду! Добавим в тип вспомагательного массива эти самые две переменные:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> t%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> mt%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>Переменная t% будет хранить текущее время, а mt% будет хранить изначальное время для последующего его восстановления... Добавим в процедуру создания змеи значение времени, чтобы можно было сразу при создании задать скорость змее.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,t%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
<p>&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\mt%=t%<br />
&nbsp;SnakeManager\t%=t%<br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;SnakeManager\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;Snake\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Занесем значение времени как в текущее. Так и в резерв для восстановления, чтобы змея при создании сразу не сорвалась с места, а ждала нужное время. Внесем изменения в процедуру движения змеи.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\t%=SnakeManager\t%<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> SnakeManager\t%&lt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; SnakeManager\t%=SnakeManager\mt%<br />
&nbsp; &nbsp; SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp; SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp; SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp; x#=SnakeManager\x#<br />
&nbsp; &nbsp; y#=SnakeManager\y#<br />
&nbsp; &nbsp; z#=SnakeManager\z#<br />
&nbsp; &nbsp; ax#=SnakeManager\ax#<br />
&nbsp; &nbsp; ay#=SnakeManager\ay#<br />
&nbsp; &nbsp; az#=SnakeManager\az#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; x1#=Snake\x<br />
&nbsp; &nbsp; &nbsp; y1#=Snake\y<br />
&nbsp; &nbsp; &nbsp; z1#=Snake\z<br />
&nbsp; &nbsp; &nbsp; ax1#=Snake\ax<br />
&nbsp; &nbsp; &nbsp; ay1#=Snake\ay<br />
&nbsp; &nbsp; &nbsp; az1#=Snake\az<br />
&nbsp; &nbsp; &nbsp; Snake\x=x#<br />
&nbsp; &nbsp; &nbsp; Snake\y=y#<br />
&nbsp; &nbsp; &nbsp; Snake\z=z#<br />
&nbsp; &nbsp; &nbsp; Snake\ax=ax#<br />
&nbsp; &nbsp; &nbsp; Snake\ay=ay#<br />
&nbsp; &nbsp; &nbsp; Snake\az=az#<br />
&nbsp; &nbsp; &nbsp; x#=x1#<br />
&nbsp; &nbsp; &nbsp; y#=y1#<br />
&nbsp; &nbsp; &nbsp; z#=z1#<br />
&nbsp; &nbsp; &nbsp; ax#=ax1#<br />
&nbsp; &nbsp; &nbsp; ay#=ay1#<br />
&nbsp; &nbsp; &nbsp; az#=az1#<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Здесь уменьшаем значение текущего времени на единицу, если оно получилось ноль или меньше, то восстанавливаем значение времени и передвигаем змею на шаг...
</p><p>Я переместил процедуру ротации координат основного массива внутрь цикла поиска змеи (зеленое), чтобы не писать условие времени дважды, да и при таком расположении не будет лишнего "прогона" цикла обработки основного массива при несуществующем идентификаторе...
</p><p>Добавим процедуру изменения скорости, чтобы можно было в программе изменить скорость змеи
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetSpeed<span style=" ">&#40;</span>id%,t%<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\mt%=t%<br />
&nbsp; &nbsp;SnakeManager\t%=t%<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Здесь, как и в остальных процедурах, ищем нужную змею по id% и заменяем значения времени новыми, при этом надо заменить оба значения: mt% для восстановления времени, t% - новое значение текущего времени при уменьшении скорости, если текущее время будет больше чем теперь. Вообще, возможно, мы можем потерять несколько шагов или иными словами сказать "змея будет не сразу реагировать на изменение скорости".
</p><p>Вот и всё! теперь можно изменять скорость передвижения змеи без ее растягивания...
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> t%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> mt%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">-20</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<br />
t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.8</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
<br />
t1%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t1%,<span style="color: #33ffdd;">-0.5</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t1%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t1%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
t2%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t2%,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t2%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t2%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
<br />
<br />
a%=SnakeCreate<span style=" ">&#40;</span>t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
SnakesetSpeed<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<br />
j1#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">10</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1.5</span>*j1#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>*j1#<span style=" ">&#41;</span><span style="color: #33ffdd;">-1.2</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;SnakeAddSegment<span style=" ">&#40;</span>a%,t%<span style=" ">&#41;</span><br />
&nbsp;j1#=j1#<span style="color: #33ffdd;">-0.07</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
time%=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
&nbsp;speed#=<span style="color: #33ffdd;">0.1</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed#<span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed#<span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">180</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">270</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<br />
&nbsp;SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-time&lt;=<span style="color: #33ffdd;">20</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">Str</span><span style=" ">&#40;</span>SnakeTime%<span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetSpeed<span style=" ">&#40;</span>id%,t%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\mt%=t%<br />
&nbsp; &nbsp;SnakeManager\t%=t%<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetAngle<span style=" ">&#40;</span>id%,ax#,ay#,az#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\ax#=ax#<br />
&nbsp; &nbsp;SnakeManager\ay#=ay#<br />
&nbsp; &nbsp;SnakeManager\az#=az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\t%=SnakeManager\t%<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> SnakeManager\t%&lt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; SnakeManager\t%=SnakeManager\mt%<br />
&nbsp; &nbsp; SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp; SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp; SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp; x#=SnakeManager\x#<br />
&nbsp; &nbsp; y#=SnakeManager\y#<br />
&nbsp; &nbsp; z#=SnakeManager\z#<br />
&nbsp; &nbsp; ax#=SnakeManager\ax#<br />
&nbsp; &nbsp; ay#=SnakeManager\ay#<br />
&nbsp; &nbsp; az#=SnakeManager\az#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; x1#=Snake\x<br />
&nbsp; &nbsp; &nbsp; y1#=Snake\y<br />
&nbsp; &nbsp; &nbsp; z1#=Snake\z<br />
&nbsp; &nbsp; &nbsp; ax1#=Snake\ax<br />
&nbsp; &nbsp; &nbsp; ay1#=Snake\ay<br />
&nbsp; &nbsp; &nbsp; az1#=Snake\az<br />
&nbsp; &nbsp; &nbsp; Snake\x=x#<br />
&nbsp; &nbsp; &nbsp; Snake\y=y#<br />
&nbsp; &nbsp; &nbsp; Snake\z=z#<br />
&nbsp; &nbsp; &nbsp; Snake\ax=ax#<br />
&nbsp; &nbsp; &nbsp; Snake\ay=ay#<br />
&nbsp; &nbsp; &nbsp; Snake\az=az#<br />
&nbsp; &nbsp; &nbsp; x#=x1#<br />
&nbsp; &nbsp; &nbsp; y#=y1#<br />
&nbsp; &nbsp; &nbsp; z#=z1#<br />
&nbsp; &nbsp; &nbsp; ax#=ax1#<br />
&nbsp; &nbsp; &nbsp; ay#=ay1#<br />
&nbsp; &nbsp; &nbsp; az#=az1#<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,t%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\mt%=t%<br />
&nbsp;SnakeManager\t%=t%<br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;SnakeManager\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;Snake\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> s%=SnakeManager\s%<br />
&nbsp; x#=SnakeManager\x#<br />
&nbsp; y#=SnakeManager\y#<br />
&nbsp; z#=SnakeManager\z#<br />
&nbsp; ax#=SnakeManager\ax#<br />
&nbsp; ay#=SnakeManager\ay#<br />
&nbsp; az#=SnakeManager\az#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; Snake\id%=id%<br />
&nbsp; Snake\x#=x#<br />
&nbsp; Snake\y#=y#<br />
&nbsp; Snake\z#=z#<br />
&nbsp; Snake\ax#=ax#<br />
&nbsp; Snake\ay#=ay#<br />
&nbsp; Snake\az#=az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h%,Snake\x#,Snake\y#,Snake\z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> Snake\h%,Snake\ax#,Snake\ay#,Snake\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.98.D0.B3.D1.80.D0.BE.D0.B2.D0.BE.D0.B5_.D0.BF.D0.BE.D0.BB.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D1%83%D1%82%D0%BE%D1%80%D0%B8%D0%B0%D0%BB_%C2%AB%D0%97%D0%BC%D0%B5%D0%B9%D0%BA%D0%B0%C2%BB&amp;action=edit&amp;section=4" title="Править секцию: Игровое поле">править</a>]</span> <span class="mw-headline">Игровое поле</span></h2>
<p>Создадим "квадратное" игровое поле, и заставим змею двигаться по квадратам...
</p><p>Сейчас будет в основном рутинное программирование, поэтому приступим сразу к разборке кода... Для начала добавим несколько полезных функций:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakePosition<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\x#=x#<br />
&nbsp; &nbsp;SnakeManager\y#=y#<br />
&nbsp; &nbsp;SnakeManager\z#=z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetX<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\x#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetZ<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\z#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetY<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\y#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleX#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\ax#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleY#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\ay#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleZ#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Функции просты, но полезны, думаю, объяснять их функционирование не стоит, а назначение: запрос угла, запрос позиции и установка позиции головы змеи... Так, змею пока трогать не будем, займемся самим игровым полем! Создадим его для начала:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">15</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">15</span><br />
&nbsp; t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span> <span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t%,i*<span style="color: #33ffdd;">10</span><span style="color: #33ffdd;">-5</span>,<span style="color: #33ffdd;">0</span>,j*<span style="color: #33ffdd;">10</span><span style="color: #33ffdd;">-5</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">0.5</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Next</span></div>
<p>Эти два цикла разметят кусок мирового пространства на клетки... 15 на 15, размер каждой клетки будет 10 на 10 единиц...
</p><p>-5 это корректировка (сдвиг) игрового поля, чтобы позиция 0,0 как раз была в центре первой клетки... оно нам пригодится для дальнейших расчетов. Теперь самое интересное на этот момент: движение змеи! До этого мы управляли ей клавишами, но теперь нам надо чтоб она сама ползала... Код управления будет следующим:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">speed#=<span style="color: #33ffdd;">0.7</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span>,SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">2</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">180</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">180</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span>,SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">90</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">3</span> &nbsp; <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">270</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">270</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
</p>
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>Этот код каждый может составить по своему усмотрению. Мне понравился такой способ реализации.
</p><p>Значит так: вводим дополнительную переменную Direction%, эта переменная будет отвечать за направление движения... У нас ведь всего 4-х стороннее движение (налево, направо, вверх, вниз), по диагонали нам ездить не надо... Для быстрого понимания всего, советую представить себе часы: "12" - направление вверх обозначим числом "0", "3" - направление вправо числом "1", "6" - направление вниз, числом "2", 9 - направление влево числом "3"... Теперь пишем в главном цикле условия движения змеи, чтоб змея в любом случае куда-то передвинулась независимо от того, нажали мы какую-то кнопку или нет... если код направления движения равен нулю то двигаем змею вверх, если единице, то влево и т.д.
</p><p>Далее обработку клавиш... теперь нам надо при нажатии клавиш только менять направления... о передвижении змеи заботится предыдущий блок условий... НО! просто так нам изменять направления нельзя, нам нужно еще изменить угол головы змеи и проверять находится ли змея на середине квадрата игрового поля...
</p><p>"If (SnakeGetX(a) Mod 10)=0" проверяет находится ли змея на середине квадрата! Путем сравнения не пойдет, потому, что если шаг будет равен, например, 0.3, то попадание на ровное число 10 будет очень редким... Поэтому здесь вычисляется остаток от деления на 10 (размер квадрата): если он равен нулю, то змея находится на позиции кратной 10, а такие позиции находятся ровно в центре квадратов (для этого мы и сдвигали игровое поле на -5). Таким образом, если змея находится на позиции кратной 10, то изменяем ее направление, и при этом проверяем угол головы, если голова "повернута" не в том направлении, то поворачиваем ее в нужное и выравниваем позицию змеи... Чтобы змея находилась именно посередине квадрата... поскольку на момент поворота она может быть и не в середине.
</p><p>Теперь есть поле, по которому змея может ползать... и поворачивать можно только "по квадратам".. Вот рабочий код на этом шаге:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> t%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> mt%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">75</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,<span style="color: #33ffdd;">60</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> Map<span style=" ">&#40;</span><span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">15</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">15</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">15</span><br />
&nbsp; t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span> <span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t%,i*<span style="color: #33ffdd;">10</span><span style="color: #33ffdd;">-5</span>,<span style="color: #33ffdd;">0</span>,j*<span style="color: #33ffdd;">10</span><span style="color: #33ffdd;">-5</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">0.5</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">10</span><br />
&nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t%,i*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">1</span>,i*<span style="color: #33ffdd;">10</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> t%,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">5</span><br />
&nbsp;Map<span style=" ">&#40;</span>i,i<span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
<br />
t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.8</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<br />
t1%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t1%,<span style="color: #33ffdd;">-0.5</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t1%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t1%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
t2%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t2%,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t2%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t2%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> t%,<span style="color: #33ffdd;">2.5</span>,<span style="color: #33ffdd;">2.5</span>,<span style="color: #33ffdd;">2.5</span><br />
<br />
<br />
<br />
a%=SnakeCreate<span style=" ">&#40;</span>t%,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
j1#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">10</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">2</span>*j1#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>*j1#<span style=" ">&#41;</span><span style="color: #33ffdd;">-0.2</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> t%,<span style="color: #33ffdd;">2.5</span>,<span style="color: #33ffdd;">2.5</span>,<span style="color: #33ffdd;">2.5</span><br />
&nbsp;SnakeAddSegment<span style=" ">&#40;</span>a%,t%<span style=" ">&#41;</span><br />
&nbsp;j1#=j1#<span style="color: #33ffdd;">-0.07</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
<br />
time%=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;Direction%=<span style="color: #33ffdd;">0</span><br />
<br />
SnakeSetSpeed<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
&nbsp;speed#=<span style="color: #33ffdd;">0.7</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span>,SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">2</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">180</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">180</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span>,SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">90</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">3</span> &nbsp; <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">270</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">270</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<br />
<br />
&nbsp;SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-time&lt;=<span style="color: #33ffdd;">16</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakePosition<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\x#=x#<br />
&nbsp; &nbsp;SnakeManager\y#=y#<br />
&nbsp; &nbsp;SnakeManager\z#=z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetX<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\x#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetZ<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\z#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetY<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\y#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleX#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\ax#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleY#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\ay#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleZ#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetSpeed<span style=" ">&#40;</span>id%,t%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\mt%=t%<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetAngle<span style=" ">&#40;</span>id%,ax#,ay#,az#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\ax#=ax#<br />
&nbsp; &nbsp;SnakeManager\ay#=ay#<br />
&nbsp; &nbsp;SnakeManager\az#=az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\t%=SnakeManager\t%<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> SnakeManager\t%&lt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; SnakeManager\t%=SnakeManager\mt%<br />
&nbsp; &nbsp; SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp; SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp; SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp; x#=SnakeManager\x#<br />
&nbsp; &nbsp; y#=SnakeManager\y#<br />
&nbsp; &nbsp; z#=SnakeManager\z#<br />
&nbsp; &nbsp; ax#=SnakeManager\ax#<br />
&nbsp; &nbsp; ay#=SnakeManager\ay#<br />
&nbsp; &nbsp; az#=SnakeManager\az#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; x1#=Snake\x<br />
&nbsp; &nbsp; &nbsp; y1#=Snake\y<br />
&nbsp; &nbsp; &nbsp; z1#=Snake\z<br />
&nbsp; &nbsp; &nbsp; ax1#=Snake\ax<br />
&nbsp; &nbsp; &nbsp; ay1#=Snake\ay<br />
&nbsp; &nbsp; &nbsp; az1#=Snake\az<br />
&nbsp; &nbsp; &nbsp; Snake\x=x#<br />
&nbsp; &nbsp; &nbsp; Snake\y=y#<br />
&nbsp; &nbsp; &nbsp; Snake\z=z#<br />
&nbsp; &nbsp; &nbsp; Snake\ax=ax#<br />
&nbsp; &nbsp; &nbsp; Snake\ay=ay#<br />
&nbsp; &nbsp; &nbsp; Snake\az=az#<br />
&nbsp; &nbsp; &nbsp; x#=x1#<br />
&nbsp; &nbsp; &nbsp; y#=y1#<br />
&nbsp; &nbsp; &nbsp; z#=z1#<br />
&nbsp; &nbsp; &nbsp; ax#=ax1#<br />
&nbsp; &nbsp; &nbsp; ay#=ay1#<br />
&nbsp; &nbsp; &nbsp; az#=az1#<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,t%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\mt%=t%<br />
&nbsp;SnakeManager\t%=<span style="color: #33ffdd;">0</span><br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;SnakeManager\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;Snake\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> s%=SnakeManager\s%<br />
&nbsp; x#=SnakeManager\x#<br />
&nbsp; y#=SnakeManager\y#<br />
&nbsp; z#=SnakeManager\z#<br />
&nbsp; ax#=SnakeManager\ax#<br />
&nbsp; ay#=SnakeManager\ay#<br />
&nbsp; az#=SnakeManager\az#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; Snake\id%=id%<br />
&nbsp; Snake\x#=x#<br />
&nbsp; Snake\y#=y#<br />
&nbsp; Snake\z#=z#<br />
&nbsp; Snake\ax#=ax#<br />
&nbsp; Snake\ay#=ay#<br />
&nbsp; Snake\az#=az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h%,Snake\x#,Snake\y#,Snake\z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> Snake\h%,Snake\ax#,Snake\ay#,Snake\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.95.D0.94.D0.90"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D1%83%D1%82%D0%BE%D1%80%D0%B8%D0%B0%D0%BB_%C2%AB%D0%97%D0%BC%D0%B5%D0%B9%D0%BA%D0%B0%C2%BB&amp;action=edit&amp;section=5" title="Править секцию: ЕДА">править</a>]</span> <span class="mw-headline">ЕДА</span></h2>
<p>Научим нашу змею есть и покажем что в этом мире бывают еще препятствия, которые кусать нежелательно...
</p><p>Нам нужно как-то представить весь игровой мир... В простых случаях (как наш) его представляют массивом (в сложном случае - базой данных)... Представим его трехмерным массивом map, в котором первое измерение - координаты по X, второе измерение - координаты по Y и третье измерение - типы объектов (0 - код объекта, 1 хендл объекта)... Третье измерение нужно нам для хранения кода препятствия, у нас ведь будут различные типы препятствий (стена и еда), ну и чтобы в любом случае можно было что-нибудь с объектом (препятствием) сделать, а не искать его и не заводить кучу дополнительный переменных, тоже нужно поле массива.
</p><p>НЕ советую юзать проверку на столкновения объектов, поскольку на проверку этого уйдет наааамного больше компьютерного времени, по сравнению с проверкой на наличие элемента в массиве по нужным координатам...
</p><p>Значит так: создание мира:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Dim</span> Map%<span style=" ">&#40;</span><span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span></div>
<p>Мир создан (богом быть все-таки легко), идем далее... Добавим несколько препятствий:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">10</span><br />
<p>&nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t%,i*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">1</span>,i*<span style="color: #33ffdd;">10</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> t%,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">5</span><br />
&nbsp;Map<span style=" ">&#40;</span>i,i,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
&nbsp;Map<span style=" ">&#40;</span>i,i,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=t%<br />
</p>
<span style="color: #aaffff; font-weight: bold;">Next</span></div>
<p>Для препятствий будет код "1", его и надо записать в нулевой индекс третьего измерения массива, в первый индекс запишем сам хендл, в случае если нам придется убрать препятствие или анимацию запускать надо будет, да мало ли чего... Покажем нашей змее, что в этом мире не только она одна бывает .
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<p>&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span><br />
</p>
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>Думаю тут объяснять много не надо... Просто берем координату головы змеи и проверяем есть ли по "кратным" координатам в массиве стена (код 1). В коде условие двойное...  Объясняется это отсутствием функции округления... На самом деле, функция int() не округляет, а отбрасывает все, что после запятой, и получается, что если у нас змея находится по Х координате примерно на 4.5, то физически будет отображено так, что половина головы будет уже в следующей клетке, а результат вычисления будет показывать, что она еще полностью в предыдущей... Для избегания таких случаев делается коррекция. Заключается она в дополнительной проверке других координат (как бы координат объекта, расположенного немножко в другом месте)...
</p><p>Покажем змее, что мир не безграничный, а что это всего лишь карта 14 на 14 клеток
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&lt;<span style="color: #33ffdd;">-3</span> <span style="color: #aaffff; font-weight: bold;">Or</span> SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">143</span> <span style="color: #aaffff; font-weight: bold;">Or</span> SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&lt;<span style="color: #33ffdd;">-3</span> <span style="color: #aaffff; font-weight: bold;">Or</span> SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">143</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
<p><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
</p>
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>Здесь вообще все просто... проверяем "выход" координат змеи за границы карты если да, то выходим...
</p><p>Теперь змея уже что-то видит... Займемся едой: заведем переменную FoodT% которая будет определять есть ли еда на поле, создавать второй кусок еды, если нет, и будет служить задержкой... т.е. чтоб еда не появлялась сразу, как ее только съели (так не интересно играть), а чтоб появлялась немного позже...
</p><p>Теперь идем в главный цикл и пишем код создания куска еды:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">; ----- Create a Food --------------------------------------------</span><br />
<p><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> FoodT%&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> FoodT%=FoodT%<span style="color: #33ffdd;">-1</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> FoodT%=<span style="color: #33ffdd;">0</span> <br />
<br />
&nbsp; FoodX%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; FoodZ%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;FoodX%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;FoodZ%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
&nbsp; map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityColor</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">50</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,FoodX%*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">2</span>,FoodZ%*<span style="color: #33ffdd;">10</span><br />
<br />
&nbsp; map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">2</span><br />
<br />
&nbsp; FoodT%=<span style="color: #33ffdd;">-1</span> <br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
</p>
<span style="color: #ffee00">; ----------------------------------------------------------------</span></div>
<p>Смотрим: если FoodT% больше нуля, значит еда съедена и запущен таймер, по истечении времени которого надо создать еду... Уменьшаем таймер на единицу... Если FoodT равно нулю, то или истекло время или только зашли в игру... Приступаем к созданию куска еды: делаем случайные координаты и запускаем цикл генерации новых координат, пока по этим координатам не будет пустота в массиве map, чтобы кусок еды нечаянно не создался в стене (как его потом оттудова выгрызать?)... Цикл будет крутиться, пока не будут найдены координаты пустой ячейки массива, значит, на выходе у нас будут координаты в которых можно создавать еду...
</p><p>Создаем объект еды CreateSphere(), красим его в красный цвет, скалим, позиционируем где надо, и записываем в массив map код еды "2" и сам хендл объекта тоже сохраняем, это для того, чтобы при съедании еды объект можно было удалить...
</p><p>И не забываем FoodT% поставить в такое состояние, чтобы эта процедура не вызвалась второй раз и чтоб не отмерялось время... Если мы здесь присвоим что-нибудь положительное, то автоматически запустим таймер и еда будет создаваться независимо от того, съели ли предыдущую...
</p><p>Приступаем к поеданию еды:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Or</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<p><br />
&nbsp; &nbsp;FoodT%=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">300</span><span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">FreeEntity</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
<br />
&nbsp; &nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1.5</span>*j1#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>*j1#<span style=" ">&#41;</span><span style="color: #33ffdd;">-0.2</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;SnakeAddSegment<span style=" ">&#40;</span>a%,t%<span style=" ">&#41;</span><br />
&nbsp; &nbsp;j1#=j1#<span style="color: #33ffdd;">-0.05</span><br />
<br />
</p>
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>По принципу проверки на коллизию со стенкой, проверяем на коллизию с едой... Если true, то приступаем к поеданию... Для начала, запустим таймер еды, поскольку эта будет съедена и надо будет создавать другую... Затем удаляем с поля объект еды (FreeEntity), хендл еды хранится в соответствующей ячейке массива map... Так, еду удалили, теоретически она должна быть в животе у змеи и змея должна от этого вырасти - реализуем это на практике путем создания дополнительного сегмента... Тут все просто: создаем сферу, скалим ее, позиционируем, и вызываем функцию добавления.
</p><p>Кстати про функцию добавления... Ее пришлось маленько переписать... В прошлом мы брали позицию головы и создавали в ней очередной сегмент... Теперь нам надо создавать новый сегмент в хвосте, иначе видно мигание куска хвоста в голове... Новая процедура выглядит следующим образом:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;s%=SnakeManager\s%<br />
&nbsp; &nbsp;SnakeManager\c%=SnakeManager\c%<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; &nbsp; x#=Snake\x#<br />
&nbsp; &nbsp; y#=Snake\y#<br />
&nbsp; &nbsp; z#=Snake\z#<br />
&nbsp; &nbsp; ax#=Snake\ax#<br />
&nbsp; &nbsp; ay#=Snake\ay#<br />
&nbsp; &nbsp; az#=Snake\az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; &nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; &nbsp; Snake\id%=id%<br />
&nbsp; &nbsp; Snake\x#=x#<br />
&nbsp; &nbsp; Snake\y#=y#<br />
&nbsp; &nbsp; Snake\z#=z#<br />
&nbsp; &nbsp; Snake\ax#=ax#<br />
&nbsp; &nbsp; Snake\ay#=ay#<br />
&nbsp; &nbsp; Snake\az#=az#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Здесь мы, в случае нахождения куска от нужной змеи, сохраняем координаты... В конце цикла переменные, куда мы сохраняли координаты, будут содержать координаты последнего элемента (не забываем и про углы)... Теперь мы при создании очередных резервных хранилищ и сегмента оперируем координатами предыдущего...
</p><p>Ну вот вроде бы и все... Теперь змея умеет есть, видеть препятствия и ей запрещено выходить за границы карты...
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> t%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> mt%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> c%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">16</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #ffee00">;Graphics3D 1024,768,16,1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">SeedRnd</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">75</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,<span style="color: #33ffdd;">60</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> Map%<span style=" ">&#40;</span><span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">15</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">15</span><br />
&nbsp; t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span> <span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t%,i*<span style="color: #33ffdd;">10</span><span style="color: #33ffdd;">-5</span>,<span style="color: #33ffdd;">0</span>,j*<span style="color: #33ffdd;">10</span><span style="color: #33ffdd;">-5</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">0.5</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">14</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">14</span><br />
&nbsp; map<span style=" ">&#40;</span>i,j,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp; map<span style=" ">&#40;</span>i,j,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">10</span><br />
&nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t%,i*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">1</span>,i*<span style="color: #33ffdd;">10</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> t%,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">5</span><br />
&nbsp;Map<span style=" ">&#40;</span>i,i,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
&nbsp;Map<span style=" ">&#40;</span>i,i,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=t%<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
<br />
t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.8</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<br />
t1%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t1%,<span style="color: #33ffdd;">-0.5</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t1%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t1%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
t2%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t2%,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t2%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t2%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> t%,<span style="color: #33ffdd;">2.5</span>,<span style="color: #33ffdd;">2.5</span>,<span style="color: #33ffdd;">2.5</span><br />
<br />
<br />
<br />
a%=SnakeCreate<span style=" ">&#40;</span>t%,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
j1#=<span style="color: #33ffdd;">2.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1.5</span>*j1#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>*j1#<span style=" ">&#41;</span><span style="color: #33ffdd;">-0.2</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;SnakeAddSegment<span style=" ">&#40;</span>a%,t%<span style=" ">&#41;</span><br />
&nbsp;j1#=j1#<span style="color: #33ffdd;">-0.01</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
<br />
time%=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;Direction%=<span style="color: #33ffdd;">0</span><br />
<br />
SnakeSetSpeed<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<br />
<br />
FoodT%=<span style="color: #33ffdd;">0</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
<span style="color: #ffee00">; ----- Create a Food --------------------------------------------</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> FoodT%&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> FoodT%=FoodT%<span style="color: #33ffdd;">-1</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> FoodT%=<span style="color: #33ffdd;">0</span> <br />
<br />
&nbsp; FoodX%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; FoodZ%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;FoodX%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;FoodZ%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
&nbsp; map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityColor</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">50</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,FoodX%*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">2</span>,FoodZ%*<span style="color: #33ffdd;">10</span><br />
<br />
&nbsp; map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">2</span><br />
<br />
&nbsp; FoodT%=<span style="color: #33ffdd;">-1</span> <br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #ffee00">; ----------------------------------------------------------------</span><br />
<br />
<br />
<br />
<span style="color: #ffee00">; ----- Eat a Food -----------------------------------------------</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Or</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<br />
&nbsp; &nbsp;FoodT%=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">300</span><span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">FreeEntity</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1.5</span>*j1#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>*j1#<span style=" ">&#41;</span><span style="color: #33ffdd;">-0.2</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;SnakeAddSegment<span style=" ">&#40;</span>a%,t%<span style=" ">&#41;</span><br />
&nbsp; &nbsp;j1#=j1#<span style="color: #33ffdd;">-0.05</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #ffee00">; ----------------------------------------------------------------</span><br />
<br />
<br />
<span style="color: #ffee00">; ----- Check Collisions -----------------------------------------</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">14</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">14</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> map<span style=" ">&#40;</span>i,j,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span> map<span style=" ">&#40;</span>i,j,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> SnakeSegmentCount<span style=" ">&#40;</span>a<span style=" ">&#41;</span><br />
&nbsp; &nbsp;t%=SnakeGetSegment<span style=" ">&#40;</span>a,i<span style=" ">&#41;</span><br />
&nbsp; &nbsp;map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>t%<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>t%<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #ffee00">; ----------------------------------------------------------------</span><br />
<br />
<span style="color: #ffee00">; ----- Check outside --------------------------------------------</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&lt;<span style="color: #33ffdd;">-3</span> <span style="color: #aaffff; font-weight: bold;">Or</span> SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">143</span> <span style="color: #aaffff; font-weight: bold;">Or</span> SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&lt;<span style="color: #33ffdd;">-3</span> <span style="color: #aaffff; font-weight: bold;">Or</span> SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">143</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<br />
<span style="color: #ffee00">; ----------------------------------------------------------------</span><br />
<br />
<br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
&nbsp;speed#=<span style="color: #33ffdd;">0.7</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span> <span style=" ">&#40;</span><span style="color: #33ffdd;">16</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1.5</span>*j1#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>*j1#<span style=" ">&#41;</span><span style="color: #33ffdd;">-0.2</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; SnakeAddSegment<span style=" ">&#40;</span>a%,t%<span style=" ">&#41;</span><br />
&nbsp; j1#=j1#<span style="color: #33ffdd;">-0.03</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span>,SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">2</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">180</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">180</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span>,SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">90</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">3</span> &nbsp; <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">270</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">270</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<br />
<br />
&nbsp;SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-time&lt;=<span style="color: #33ffdd;">16</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSegmentCount%<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\c%<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetSegment%<span style=" ">&#40;</span>id%,count%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">And</span> Snake\h%&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;count%=count%<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> count%=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> Snake\h%<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakePosition<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\x#=x#<br />
&nbsp; &nbsp;SnakeManager\y#=y#<br />
&nbsp; &nbsp;SnakeManager\z#=z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetX<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\x#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetZ<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\z#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetY<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\y#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleX#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\ax#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleY#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\ay#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleZ#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetSpeed<span style=" ">&#40;</span>id%,t%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\mt%=t%<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetAngle<span style=" ">&#40;</span>id%,ax#,ay#,az#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\ax#=ax#<br />
&nbsp; &nbsp;SnakeManager\ay#=ay#<br />
&nbsp; &nbsp;SnakeManager\az#=az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\t%=SnakeManager\t%<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> SnakeManager\t%&lt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; SnakeManager\t%=SnakeManager\mt%<br />
&nbsp; &nbsp; SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp; SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp; SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp; x#=SnakeManager\x#<br />
&nbsp; &nbsp; y#=SnakeManager\y#<br />
&nbsp; &nbsp; z#=SnakeManager\z#<br />
&nbsp; &nbsp; ax#=SnakeManager\ax#<br />
&nbsp; &nbsp; ay#=SnakeManager\ay#<br />
&nbsp; &nbsp; az#=SnakeManager\az#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; x1#=Snake\x<br />
&nbsp; &nbsp; &nbsp; y1#=Snake\y<br />
&nbsp; &nbsp; &nbsp; z1#=Snake\z<br />
&nbsp; &nbsp; &nbsp; ax1#=Snake\ax<br />
&nbsp; &nbsp; &nbsp; ay1#=Snake\ay<br />
&nbsp; &nbsp; &nbsp; az1#=Snake\az<br />
&nbsp; &nbsp; &nbsp; Snake\x=x#<br />
&nbsp; &nbsp; &nbsp; Snake\y=y#<br />
&nbsp; &nbsp; &nbsp; Snake\z=z#<br />
&nbsp; &nbsp; &nbsp; Snake\ax=ax#<br />
&nbsp; &nbsp; &nbsp; Snake\ay=ay#<br />
&nbsp; &nbsp; &nbsp; Snake\az=az#<br />
&nbsp; &nbsp; &nbsp; x#=x1#<br />
&nbsp; &nbsp; &nbsp; y#=y1#<br />
&nbsp; &nbsp; &nbsp; z#=z1#<br />
&nbsp; &nbsp; &nbsp; ax#=ax1#<br />
&nbsp; &nbsp; &nbsp; ay#=ay1#<br />
&nbsp; &nbsp; &nbsp; az#=az1#<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,t%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\mt%=t%<br />
&nbsp;SnakeManager\t%=<span style="color: #33ffdd;">0</span><br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\c%=<span style="color: #33ffdd;">1</span><br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;SnakeManager\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;Snake\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;s%=SnakeManager\s%<br />
&nbsp; &nbsp;SnakeManager\c%=SnakeManager\c%<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; &nbsp; x#=Snake\x#<br />
&nbsp; &nbsp; y#=Snake\y#<br />
&nbsp; &nbsp; z#=Snake\z#<br />
&nbsp; &nbsp; ax#=Snake\ax#<br />
&nbsp; &nbsp; ay#=Snake\ay#<br />
&nbsp; &nbsp; az#=Snake\az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; &nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; &nbsp; Snake\id%=id%<br />
&nbsp; &nbsp; Snake\x#=x#<br />
&nbsp; &nbsp; Snake\y#=y#<br />
&nbsp; &nbsp; Snake\z#=z#<br />
&nbsp; &nbsp; Snake\ax#=ax#<br />
&nbsp; &nbsp; Snake\ay#=ay#<br />
&nbsp; &nbsp; Snake\az#=az#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h%,Snake\x#,Snake\y#,Snake\z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> Snake\h%,Snake\ax#,Snake\ay#,Snake\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/b/b5/Snake.zip" class="internal" title="Snake.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:SubZer0" title="Участник:SubZer0">SubZer0</a> (e-mail: SubZer0@boolean.name)
</p><!-- 
Pre-expand include size: 25932 bytes
Post-expand include size: 483 bytes
Template argument size: 16 bytes
Maximum: 2097152 bytes
-->

<!-- Saved in parser cache with key db1:pcache:idhash:663-0!1!0!!ru!2 and timestamp 20071110032305 -->
<div class="printfooter">
Получено с <a href="k9pd6le_.html">http://blitzetcetera.org/index.php/%D0%A2%D1%83%D1%82%D0%BE%D1%80%D0%B8%D0%B0%D0%BB_%C2%AB%D0%97%D0%BC%D0%B5%D0%B9%D0%BA%D0%B0%C2%BB</a></div>
			<!-- end content -->			<div class="visualClear"></div>				</td>				<td class="rightside">				</td>			</tr>		</table>		</div>	</div>		</div>	
		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</div></body>
<!-- Mirrored from localhost/index.php/%D0%A2%D1%83%D1%82%D0%BE%D1%80%D0%B8%D0%B0%D0%BB_%C2%AB%D0%97%D0%BC%D0%B5%D0%B9%D0%BA%D0%B0%C2%BB by HTTrack Website Copier/3.x [XR&CO'2007], Sat, 10 Nov 2007 05:15:24 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>