<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru" dir="ltr">	
<!-- Mirrored from localhost/index.php/%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D1%85%D1%83%D0%B4%D0%BE%D0%B6%D0%BD%D0%B8%D0%BA:_%D0%B4%D0%B5%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8F by HTTrack Website Copier/3.x [XR&CO'2007], Sat, 10 Nov 2007 05:16:17 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />				<meta name="keywords" content="Виртуальный художник: деформация,Matt Merkulov" />
		<link rel="shortcut icon" href="http://blitzetcetera.org/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="http://blitzetcetera.org/opensearch_desc.php" title="Blitz Et Cetera (Русский)" />
		<title>Виртуальный художник: деформация — Blitz Et Cetera</title>		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "bvih5rde.css?63"; /*]]>*/</style>		<link rel="stylesheet" type="text/css" media="print" href="gcxktlm6.css?63" />		<link rel="stylesheet" type="text/css" media="handheld" href="zumsslq_.css?63" />		<!--[if lt IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE50Fixes.css?63";</style><![endif]-->		<!--[if IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE55Fixes.css?63";</style><![endif]-->		<!--[if IE 6]><style type="text/css">@import "/skins/OfflineNew/IE60Fixes.css?63";</style><![endif]-->		<!--[if IE 7]><style type="text/css">@import "/skins/OfflineNew/IE70Fixes.css?63";</style><![endif]-->		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?63"></script>		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->		<script type= "text/javascript">/*<![CDATA[*/
var skin = "OfflineNew";
var stylepath = "/skins";
var wgArticlePath = "/index.php/$1";
var wgScriptPath = "";
var wgServer = "http://blitzetcetera.org/";
var wgCanonicalNamespace = "";
var wgCanonicalSpecialPageName = false;
var wgNamespaceNumber = 0;
var wgPageName = "Виртуальный_художник:_деформация";
var wgTitle = "Виртуальный художник: деформация";
var wgAction = "view";
var wgArticleId = "562";
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "ru";
var wgContentLanguage = "ru";
var wgBreakFrames = false;
var wgCurRevisionId = "3574";
/*]]>*/</script>
		<script type="text/javascript" src="2nq-6cel.js?63"><!-- wikibits js --></script>		<script type="text/javascript" src="http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=js"><!-- site js --></script>		<style type="text/css">/*<![CDATA[*/
@import "http://blitzetcetera.org/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=MediaWiki:OfflineNew.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=css&amp;maxage=18000";
/*]]>*/</style>		<!-- Head Scripts -->	</head><body  class="mediawiki ns-0 ltr page-Виртуальный_художник_деформация">	<div id="globalWrapper">	<div id="logocontainer">		<table align="center">		  <tr>				<td id="blitzetclogo">				</td>			</tr>		</table>	</div>	<div id="magbar">	Журнал о программированнии на языках Blitz3D, BlitzMax, BlitzPlus	</div>		<div id="column-content">	<div id="content">		<a name="top" id="top"></a>				<div id="bodyContent">		<table cellspacing=0 cellpadding=0 width=100%>			<tr>			  <td class="leftside">				</td>				<td class="sheetbody">					<h1 class="sheet">Виртуальный художник: деформация</h1>			<h3 id="siteSub">Материал из Blitz Et Cetera.</h3>			<div id="contentSub"></div>			<!-- start content -->			<table id="toc" class="toc" summary="Содержание"><tr><td><div id="toctitle"><h2>Содержание</h2></div>
<ul>
<li class="toclevel-1"><a href="#.D0.92.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5"><span class="tocnumber">1</span> <span class="toctext">Введение</span></a></li>
<li class="toclevel-1"><a href="#.D0.91.D0.B8.D0.BB.D0.B8.D0.BD.D0.B5.D0.B9.D0.BD.D0.B0.D1.8F_.D1.84.D0.B8.D0.BB.D1.8C.D1.82.D1.80.D0.B0.D1.86.D0.B8.D1.8F"><span class="tocnumber">2</span> <span class="toctext">Билинейная фильтрация</span></a></li>
<li class="toclevel-1"><a href="#.D0.A3.D0.B2.D0.B5.D0.BB.D0.B8.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D1.82.D0.BE.D1.87.D0.BD.D0.BE.D1.81.D1.82.D0.B8"><span class="tocnumber">3</span> <span class="toctext">Увеличение точности</span></a></li>
<li class="toclevel-1"><a href="#.D0.94.D0.B5.D0.BC.D0.BE.D0.BD.D1.81.D1.82.D1.80.D0.B0.D1.86.D0.B8.D0.BE.D0.BD.D0.BD.D0.B0.D1.8F_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D0.BC.D0.B0"><span class="tocnumber">4</span> <span class="toctext">Демонстрационная программа</span></a></li>
<li class="toclevel-1"><a href="#.D0.91.D0.BE.D0.BB.D0.B5.D0.B5_.D1.81.D0.BB.D0.BE.D0.B6.D0.BD.D1.8B.D0.B5_.D1.8D.D1.84.D1.84.D0.B5.D0.BA.D1.82.D1.8B"><span class="tocnumber">5</span> <span class="toctext">Более сложные эффекты</span></a></li>
<li class="toclevel-1"><a href="#.D0.9F.D1.80.D0.BE.D0.B8.D0.B7.D0.B2.D0.BE.D0.BB.D1.8C.D0.BD.D0.B0.D1.8F_.D1.82.D1.80.D0.B0.D0.BD.D1.81.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.86.D0.B8.D1.8F"><span class="tocnumber">6</span> <span class="toctext">Произвольная трансформация</span></a></li>
</ul>
</td></tr></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "показать"; var tocHideText = "убрать"; showTocToggle(); } </script>
<a name=".D0.92.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D1%85%D1%83%D0%B4%D0%BE%D0%B6%D0%BD%D0%B8%D0%BA:_%D0%B4%D0%B5%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8F&amp;action=edit&amp;section=1" title="Править секцию: Введение">править</a>]</span> <span class="mw-headline">Введение</span></h2>
<p>Деформация изображения заключается в том, что пиксел (x, y) закрашивается цветом пиксела (x', y'), координаты которого могут вычисляться каким угодно образом через исходные:
</p>
<ul><li>x' = f<sub>1</sub>(x, y)
</li><li>y' = f<sub>2</sub>(x, y)
</li></ul>
<p>Цвет пикселей, выходящих за пределы изображения, пусть будет черным. Простейшие трансформации - это сдвиг, масштабирование, поворот, отражения от прямой и точки, а также наклон. В общем виде формула этих преобразований выглядит так:
</p>
<ul><li>x' = a<sub>1</sub> * x + b<sub>1</sub> * y + c<sub>1</sub>
</li><li>y' = a<sub>2</sub> * x + b<sub>2</sub> * y + c<sub>2</sub>
</li></ul>
<a name=".D0.91.D0.B8.D0.BB.D0.B8.D0.BD.D0.B5.D0.B9.D0.BD.D0.B0.D1.8F_.D1.84.D0.B8.D0.BB.D1.8C.D1.82.D1.80.D0.B0.D1.86.D0.B8.D1.8F"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D1%85%D1%83%D0%B4%D0%BE%D0%B6%D0%BD%D0%B8%D0%BA:_%D0%B4%D0%B5%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8F&amp;action=edit&amp;section=2" title="Править секцию: Билинейная фильтрация">править</a>]</span> <span class="mw-headline">Билинейная фильтрация</span></h2>
<p>Как Вы могли заметить, трансформированные (особенно увеличенные) изображения выглядят довольно коряво, а именно, хорошо видны квадраты, представляющие пиксели, границы между ними режут глаз. Для борьбы с этим неприятным эффектом применяется метод билинейной фильтрации. При его использовании, координаты пиксела не округляются, как раньше (в итоге получался цвет ближайшего пиксела), дробная часть влияет на конечный цвет. Другими словами, между соседними пикселами получается плавный переход, чем ближе точка с дробными координатами, цвет которой нужно вычислить к точке, представляющей пиксел (ее координаты - целые), тем большее влияние цвет этого пиксела оказывает на конечный цвет. Принцип действия простейшего алгоритма таков: определяются соседние пикселы, ограничивающие точку. Затем берутся цвета двух верхних пикселов и смешиваются, соответственно коэффициентам (в пределах 0...1), определяемым координатой х (чем она дальше от координаты x цвета, тем его коэффициент меньше). Так же поступают и с нижними пикселами. Полученные два цвета смешиваются в зависимости от координаты y - полученный цвет и будет результатом.
</p>
<a name=".D0.A3.D0.B2.D0.B5.D0.BB.D0.B8.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D1.82.D0.BE.D1.87.D0.BD.D0.BE.D1.81.D1.82.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D1%85%D1%83%D0%B4%D0%BE%D0%B6%D0%BD%D0%B8%D0%BA:_%D0%B4%D0%B5%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8F&amp;action=edit&amp;section=3" title="Править секцию: Увеличение точности">править</a>]</span> <span class="mw-headline">Увеличение точности</span></h2>
<p>Еще один негативный эффект проявляется при уменьшении изображения - результат выглядит немного "блочным". Это происходит из-за того, что берется один пиксел из нескольких, остальные просто не берутся в расчет. Ситуацию можно улучшить, если кроме исходного пиксела с целыми координатами, находить также значения цвета для пикселов с дробными координатами вида (x+dx, y+dy), где 0 &lt; dx,dy &lt; 1, а затем брать среднее арифметическое:
</p>
<a name=".D0.94.D0.B5.D0.BC.D0.BE.D0.BD.D1.81.D1.82.D1.80.D0.B0.D1.86.D0.B8.D0.BE.D0.BD.D0.BD.D0.B0.D1.8F_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D0.BC.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D1%85%D1%83%D0%B4%D0%BE%D0%B6%D0%BD%D0%B8%D0%BA:_%D0%B4%D0%B5%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8F&amp;action=edit&amp;section=4" title="Править секцию: Демонстрационная программа">править</a>]</span> <span class="mw-headline">Демонстрационная программа</span></h2>
<p>В данной программе демонстрируются вышеизложенные преобразования и эффекты. При некоторых преобразованиях билинейная фильтрация может не оказывать практически никакого эффекта, поэтому ее лучше отключить. Также можно подбирать оптимальную точность для отдельно взятого преобразования. Вот картинка (640x480 JPG):
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:182px;"><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Painter2.jpg" class="internal" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Painter2.jpg" class="thumbimage" src="nfkp-cl0.jpg" width="180" height="135" /></a>  <div class="thumbcaption"><div class="magnify" style="float:right"><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Painter2.jpg" class="internal" title="Увеличить"><img src="gau13a4-.png" width="15" height="11" alt="" /></a></div></div></div></div></div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> xsiz=<span style="color: #33ffdd;">640</span>,ysiz=<span style="color: #33ffdd;">480</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Global</span> ib,x2#,y2#,r,g,b<br />
<br />
<span style="color: #ffee00">;Const fx=1,prec=1,bf=0;пикселизация</span><br />
<span style="color: #ffee00">;Const fx=2,prec=1,bf=0;блочность</span><br />
<br />
<span style="color: #ffee00">;Const fx=1, prec=1, bf=1</span><br />
<span style="color: #ffee00">;Const fx=2, prec=4, bf=0</span><br />
<span style="color: #ffee00">;Const fx=3, prec=2, bf=1</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> fx=<span style="color: #33ffdd;">4</span>, prec=<span style="color: #33ffdd;">2</span>, bf=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> stp#=<span style="color: #33ffdd;">1.0</span>/prec, div=prec*prec<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> xsiz,ysiz,<span style="color: #33ffdd;">32</span><br />
<br />
i=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Painter2.jpg&quot;</span><span style=" ">&#41;</span><br />
ib=<span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>i<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> y#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> ysiz<span style="color: #33ffdd;">-1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> x#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> xsiz<span style="color: #33ffdd;">-1</span><br />
&nbsp; r=<span style="color: #33ffdd;">0</span>:g=<span style="color: #33ffdd;">0</span>:b=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> xx#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> .<span style="color: #33ffdd;">9999</span> <span style="color: #aaffff; font-weight: bold;">Step</span> stp#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> yy#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> .<span style="color: #33ffdd;">9999</span> <span style="color: #aaffff; font-weight: bold;">Step</span> stp#<br />
&nbsp; &nbsp; x2#=x#+xx#<br />
&nbsp; &nbsp; y2#=y#+yy#<br />
&nbsp; &nbsp; move <span style="color: #33ffdd;">-320</span>,<span style="color: #33ffdd;">-240</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Select</span> fx<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; scale .<span style="color: #33ffdd;">33</span>,.<span style="color: #33ffdd;">33</span><br />
&nbsp; &nbsp; &nbsp; move <span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">100</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span><br />
&nbsp; &nbsp; &nbsp; scale <span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; &nbsp; &nbsp; x2#=-x2#<span style="color: #ffee00">;отражение от оси OY</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">3</span><br />
&nbsp; &nbsp; &nbsp; rotate <span style="color: #33ffdd;">30</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">4</span><br />
&nbsp; &nbsp; &nbsp; scale <span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">2</span><br />
&nbsp; &nbsp; &nbsp; rotate <span style="color: #33ffdd;">10</span><br />
&nbsp; &nbsp; &nbsp; bevel .<span style="color: #33ffdd;">4</span>,.<span style="color: #33ffdd;">4</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp; &nbsp; move <span style="color: #33ffdd;">320</span>,<span style="color: #33ffdd;">240</span><br />
&nbsp; &nbsp; pixelcol<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; r=r/div<br />
&nbsp; g=g/div<br />
&nbsp; b=b/div<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">WritePixel</span> x#,y#,r <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">16</span>+g <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">8</span>+b<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">WaitKey</span>:<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> pixelcol<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> x2#&lt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> x2#&gt;=xsiz <span style="color: #aaffff; font-weight: bold;">Or</span> y2#&lt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> y2#&gt;=ysiz <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span><br />
xx=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>x2#-.<span style="color: #33ffdd;">5</span><span style=" ">&#41;</span><br />
yy=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>y2#-.<span style="color: #33ffdd;">5</span><span style=" ">&#41;</span><br />
p00=<span style="color: #aaffff; font-weight: bold;">ReadPixel</span><span style=" ">&#40;</span>xx,yy,ib<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> bf <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;p01=<span style="color: #aaffff; font-weight: bold;">ReadPixel</span><span style=" ">&#40;</span>xx,yy<span style="color: #33ffdd;">+1</span>,ib<span style=" ">&#41;</span><br />
&nbsp;p10=<span style="color: #aaffff; font-weight: bold;">ReadPixel</span><span style=" ">&#40;</span>xx<span style="color: #33ffdd;">+1</span>,yy,ib<span style=" ">&#41;</span><br />
&nbsp;p11=<span style="color: #aaffff; font-weight: bold;">ReadPixel</span><span style=" ">&#40;</span>xx<span style="color: #33ffdd;">+1</span>,yy<span style="color: #33ffdd;">+1</span>,ib<span style=" ">&#41;</span><br />
&nbsp;dx2#=x2#-xx<br />
&nbsp;dx1#=<span style="color: #33ffdd;">1.0</span>-dx2#<br />
&nbsp;r1#=dx1#*<span style=" ">&#40;</span>p00 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span>+dx2#*<span style=" ">&#40;</span>p10 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;g1#=dx1#*<span style=" ">&#40;</span>p00 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span>+dx2#*<span style=" ">&#40;</span>p10 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;b1#=dx1#*<span style=" ">&#40;</span>p00 <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span>+dx2#*<span style=" ">&#40;</span>p10 <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;r2#=dx1#*<span style=" ">&#40;</span>p01 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span>+dx2#*<span style=" ">&#40;</span>p11 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;g2#=dx1#*<span style=" ">&#40;</span>p01 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span>+dx2#*<span style=" ">&#40;</span>p11 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;b2#=dx1#*<span style=" ">&#40;</span>p01 <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span>+dx2#*<span style=" ">&#40;</span>p11 <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;dx2#=y2#-yy<br />
&nbsp;dx1#=<span style="color: #33ffdd;">1.0</span>-dx2#<br />
&nbsp;r=r+<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>dx1#*r1#+dx2#*r2#<span style=" ">&#41;</span><br />
&nbsp;g=g+<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>dx1#*g1#+dx2#*g2#<span style=" ">&#41;</span><br />
&nbsp;b=b+<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>dx1#*b1#+dx2#*b2#<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp;r=r+<span style=" ">&#40;</span>p00 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;g=g+<span style=" ">&#40;</span>p00 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;b=b+<span style=" ">&#40;</span>p00 <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Сдвиг</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> move<span style=" ">&#40;</span>dx#,dy#<span style=" ">&#41;</span><br />
x2#=x2#+dx#<br />
y2#=y2#+dy#<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Масштабирование</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> scale<span style=" ">&#40;</span>mx#,my#<span style=" ">&#41;</span><br />
x2#=x2#*mx#<br />
y2#=y2#*my#<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Поворот</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> rotate<span style=" ">&#40;</span>ang#<span style=" ">&#41;</span><br />
xx2#=x2#<br />
x2#=x2#*<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>+y2#*<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span><br />
y2#=y2#*<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>-xx2#*<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Отражение от точки</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> mirrordot<span style=" ">&#40;</span>x#,y#<span style=" ">&#41;</span><br />
x2#=<span style="color: #33ffdd;">2</span>*x#-x2#<br />
y2#=<span style="color: #33ffdd;">2</span>*y#-y2#<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Отражение от прямой</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> mirrorline<span style=" ">&#40;</span>a#,b#,c#<span style=" ">&#41;</span><br />
c2#=a#*x2#-b*y2#<br />
k#=<span style="color: #33ffdd;">1.0</span>/<span style=" ">&#40;</span>a#*a#+b#*b#<span style=" ">&#41;</span><br />
x2#=<span style=" ">&#40;</span>-a#*c#-b#*c2#<span style=" ">&#41;</span>*k#<br />
y2#=<span style=" ">&#40;</span>a#*c2#-b#*c#<span style=" ">&#41;</span>*k#<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Наклон</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> bevel<span style=" ">&#40;</span>dx#,dy#<span style=" ">&#41;</span><br />
xx2#=x2#<br />
x2#=x2#+y2#*dx#<br />
y2#=y2#+xx2#*dy#<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.91.D0.BE.D0.BB.D0.B5.D0.B5_.D1.81.D0.BB.D0.BE.D0.B6.D0.BD.D1.8B.D0.B5_.D1.8D.D1.84.D1.84.D0.B5.D0.BA.D1.82.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D1%85%D1%83%D0%B4%D0%BE%D0%B6%D0%BD%D0%B8%D0%BA:_%D0%B4%D0%B5%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8F&amp;action=edit&amp;section=5" title="Править секцию: Более сложные эффекты">править</a>]</span> <span class="mw-headline">Более сложные эффекты</span></h2>
<p>Используя более комплексные формулы, можно получить более интересные искажения: стягивание удаляет окружность с центром в данной точке и определенным радиусом за счет стягивания точек кольца вокруг нее с внешним радиусом вдвое больше; вихрь поворачивает точку вокруг центра изображения, на угол, зависящий от расстояния до центра; рябь получается сдвигом точек в зависимости от расстояния до центра.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> xsiz=<span style="color: #33ffdd;">640</span>,ysiz=<span style="color: #33ffdd;">480</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Global</span> ib,x2#,y2#,r,g,b<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> prec=<span style="color: #33ffdd;">1</span>, bf=<span style="color: #33ffdd;">0</span>, fx=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> stp#=<span style="color: #33ffdd;">1.0</span>/prec, div=prec*prec<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> xsiz,ysiz,<span style="color: #33ffdd;">32</span><br />
<br />
i=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Painter2.jpg&quot;</span><span style=" ">&#41;</span><br />
ib=<span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>i<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> y#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> ysiz<span style="color: #33ffdd;">-1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> x#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> xsiz<span style="color: #33ffdd;">-1</span><br />
&nbsp; r=<span style="color: #33ffdd;">0</span>:g=<span style="color: #33ffdd;">0</span>:b=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> xx#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> .<span style="color: #33ffdd;">9999</span> <span style="color: #aaffff; font-weight: bold;">Step</span> stp#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> yy#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> .<span style="color: #33ffdd;">9999</span> <span style="color: #aaffff; font-weight: bold;">Step</span> stp#<br />
&nbsp; &nbsp; x2#=x#+xx#<br />
&nbsp; &nbsp; y2#=y#+yy#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Select</span> fx<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span><span style="color: #ffee00">;Cтягивание</span><br />
&nbsp; &nbsp; &nbsp; dx#=x2#<span style="color: #33ffdd;">-460.0</span><br />
&nbsp; &nbsp; &nbsp; dy#=y2#<span style="color: #33ffdd;">-360.0</span><br />
&nbsp; &nbsp; &nbsp; rad#=<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>dx#*dx#+dy#*dy#<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> rad#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> rad#=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> rad#&lt;<span style="color: #33ffdd;">100.0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;x2#=dx#*<span style=" ">&#40;</span>.<span style="color: #33ffdd;">5</span><span style="color: #33ffdd;">+50.0</span>/rad#<span style=" ">&#41;</span><span style="color: #33ffdd;">+460.0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;y2#=dy#*<span style=" ">&#40;</span>.<span style="color: #33ffdd;">5</span><span style="color: #33ffdd;">+50.0</span>/rad#<span style=" ">&#41;</span><span style="color: #33ffdd;">+360.0</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span><span style="color: #ffee00">;Вихрь</span><br />
&nbsp; &nbsp; &nbsp; x2#=x2#<span style="color: #33ffdd;">-320.0</span><br />
&nbsp; &nbsp; &nbsp; y2#=y2#<span style="color: #33ffdd;">-240.0</span><br />
&nbsp; &nbsp; &nbsp; ang#=<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>x2#*x2#+y2#*y2#<span style=" ">&#41;</span>*.<span style="color: #33ffdd;">3</span><span style="color: #33ffdd;">-90</span><span style="color: #ffee00">;&quot;разворачивающийся&quot;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;ang#=360/(Sqr(x2#*x2#+y2#*y2#)*.05+1);&quot;сворачивающийся&quot;</span><br />
&nbsp; &nbsp; &nbsp; xx2#=x2#<br />
&nbsp; &nbsp; &nbsp; x2#=x2#*<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>+y2#*<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; y2#=y2#*<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>-xx2#*<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; x2#=x2#<span style="color: #33ffdd;">+320.0</span><br />
&nbsp; &nbsp; &nbsp; y2#=y2#<span style="color: #33ffdd;">+240.0</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">3</span><span style="color: #ffee00">;Рябь</span><br />
&nbsp; &nbsp; &nbsp; dx#=x2#<span style="color: #33ffdd;">-320.0</span><br />
&nbsp; &nbsp; &nbsp; dy#=y2#<span style="color: #33ffdd;">-240.0</span><br />
&nbsp; &nbsp; &nbsp; ang#=<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>dx#*dx#+dy#*dy#<span style=" ">&#41;</span>*<span style="color: #33ffdd;">4</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;x2#=x2#-Cos(ang#)*15</span><br />
&nbsp; &nbsp; &nbsp; y2#=y2#-<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>*<span style="color: #33ffdd;">15</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp; &nbsp; pixelcol<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; r=r/div<br />
&nbsp; g=g/div<br />
&nbsp; b=b/div<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">WritePixel</span> x#,y#,r <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">16</span>+g <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">8</span>+b<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">WaitKey</span>:<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> pixelcol<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> x2#&lt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> x2#&gt;=xsiz <span style="color: #aaffff; font-weight: bold;">Or</span> y2#&lt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> y2#&gt;=ysiz <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span><br />
xx=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>x2#-.<span style="color: #33ffdd;">5</span><span style=" ">&#41;</span><br />
yy=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>y2#-.<span style="color: #33ffdd;">5</span><span style=" ">&#41;</span><br />
p00=<span style="color: #aaffff; font-weight: bold;">ReadPixel</span><span style=" ">&#40;</span>xx,yy,ib<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> bf <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;p01=<span style="color: #aaffff; font-weight: bold;">ReadPixel</span><span style=" ">&#40;</span>xx,yy<span style="color: #33ffdd;">+1</span>,ib<span style=" ">&#41;</span><br />
&nbsp;p10=<span style="color: #aaffff; font-weight: bold;">ReadPixel</span><span style=" ">&#40;</span>xx<span style="color: #33ffdd;">+1</span>,yy,ib<span style=" ">&#41;</span><br />
&nbsp;p11=<span style="color: #aaffff; font-weight: bold;">ReadPixel</span><span style=" ">&#40;</span>xx<span style="color: #33ffdd;">+1</span>,yy<span style="color: #33ffdd;">+1</span>,ib<span style=" ">&#41;</span><br />
&nbsp;dx2#=x2#-xx<br />
&nbsp;dx1#=<span style="color: #33ffdd;">1.0</span>-dx2#<br />
&nbsp;r1#=dx1#*<span style=" ">&#40;</span>p00 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span>+dx2#*<span style=" ">&#40;</span>p10 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;g1#=dx1#*<span style=" ">&#40;</span>p00 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span>+dx2#*<span style=" ">&#40;</span>p10 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;b1#=dx1#*<span style=" ">&#40;</span>p00 <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span>+dx2#*<span style=" ">&#40;</span>p10 <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;r2#=dx1#*<span style=" ">&#40;</span>p01 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span>+dx2#*<span style=" ">&#40;</span>p11 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;g2#=dx1#*<span style=" ">&#40;</span>p01 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span>+dx2#*<span style=" ">&#40;</span>p11 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;b2#=dx1#*<span style=" ">&#40;</span>p01 <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span>+dx2#*<span style=" ">&#40;</span>p11 <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;dx2#=y2#-yy<br />
&nbsp;dx1#=<span style="color: #33ffdd;">1.0</span>-dx2#<br />
&nbsp;r=r+<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>dx1#*r1#+dx2#*r2#<span style=" ">&#41;</span><br />
&nbsp;g=g+<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>dx1#*g1#+dx2#*g2#<span style=" ">&#41;</span><br />
&nbsp;b=b+<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>dx1#*b1#+dx2#*b2#<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp;r=r+<span style=" ">&#40;</span>p00 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;g=g+<span style=" ">&#40;</span>p00 <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp;b=b+<span style=" ">&#40;</span>p00 <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.9F.D1.80.D0.BE.D0.B8.D0.B7.D0.B2.D0.BE.D0.BB.D1.8C.D0.BD.D0.B0.D1.8F_.D1.82.D1.80.D0.B0.D0.BD.D1.81.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.86.D0.B8.D1.8F"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D1%85%D1%83%D0%B4%D0%BE%D0%B6%D0%BD%D0%B8%D0%BA:_%D0%B4%D0%B5%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8F&amp;action=edit&amp;section=6" title="Править секцию: Произвольная трансформация">править</a>]</span> <span class="mw-headline">Произвольная трансформация</span></h2>
<p>В данной программе задаются точки на изображении и их конечная позиция на экране (нажмите левую кнопку мыши на исходной точке, передвиньте курсор в конечную и отпустите кнопку; правая кнопка мыши - применить трансформацию). Таким образом, задается сложная трансформация на основе расстояний от точек, с помошью которой можно делать шаржи. Закрепим точки по углам исходного изображения, чтобы деформации затронули только его внутреннюю часть.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> dot<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#,y#,dx#,dy#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<br />
i=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Painter2.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">DrawBlock</span> i,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> x=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">639</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">639</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">479</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">479</span><br />
&nbsp; d.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
&nbsp; d\x=x<br />
&nbsp; d\y=y<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> md=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; md=<span style="color: #33ffdd;">1</span><br />
&nbsp; d.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
&nbsp; d\x=<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; d\y=<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> md <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; d\dx=d\x-<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; d\dy=d\y-<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Line</span> d\x,d\y,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; md=<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">479</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> x=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">639</span><br />
&nbsp; vx#=<span style="color: #33ffdd;">0</span><br />
&nbsp; vy#=<span style="color: #33ffdd;">0</span><br />
&nbsp; k#=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> d=<span style="color: #aaffff; font-weight: bold;">Each</span> dot<br />
&nbsp; &nbsp;dx#=x-d\x<br />
&nbsp; &nbsp;dy#=y-d\y<br />
&nbsp; &nbsp;r#=<span style="color: #33ffdd;">1.0</span>/<span style=" ">&#40;</span>dx#*dx#+dy#*dy#+.<span style="color: #33ffdd;">001</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;vx#=vx#+r#*d\dx<br />
&nbsp; &nbsp;vy#=vy#+r#*d\dy<br />
&nbsp; &nbsp;k#=k#+r#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; vx#=vx#/k#<br />
&nbsp; vy#=vy#/k#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">WritePixel</span> x,y,<span style="color: #aaffff; font-weight: bold;">ReadPixel</span> <span style=" ">&#40;</span>x+vx#,y+vy#,<span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>i<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">WaitKey</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/8/82/Virtual_Painter_-_Deformation.zip" class="internal" title="Virtual Painter - Deformation.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)
</p><!-- 
Pre-expand include size: 5765 bytes
Post-expand include size: 468 bytes
Template argument size: 40 bytes
Maximum: 2097152 bytes
-->

<!-- Saved in parser cache with key db1:pcache:idhash:562-0!1!0!!ru!2 and timestamp 20071110040210 -->
<div class="printfooter">
Получено с <a href="kf_ed_bx.html">http://blitzetcetera.org/index.php/%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D1%85%D1%83%D0%B4%D0%BE%D0%B6%D0%BD%D0%B8%D0%BA:_%D0%B4%D0%B5%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8F</a></div>
			<!-- end content -->			<div class="visualClear"></div>				</td>				<td class="rightside">				</td>			</tr>		</table>		</div>	</div>		</div>	
		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</div></body>
<!-- Mirrored from localhost/index.php/%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D1%85%D1%83%D0%B4%D0%BE%D0%B6%D0%BD%D0%B8%D0%BA:_%D0%B4%D0%B5%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8F by HTTrack Website Copier/3.x [XR&CO'2007], Sat, 10 Nov 2007 05:16:18 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>