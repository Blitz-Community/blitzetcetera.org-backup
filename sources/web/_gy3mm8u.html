<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru" dir="ltr">	
<!-- Mirrored from localhost/index.php/%D0%9A%D0%BE%D0%B4:SMTPMailLibrary.bb by HTTrack Website Copier/3.x [XR&CO'2007], Sat, 10 Nov 2007 05:56:12 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />				<meta name="keywords" content="Код:SMTPMailLibrary.bb" />
		<link rel="shortcut icon" href="http://localhost/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="http://localhost/opensearch_desc.php" title="Blitz Et Cetera (Русский)" />
		<title>Код:SMTPMailLibrary.bb — Blitz Et Cetera</title>		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "bvih5rde.css?63"; /*]]>*/</style>		<link rel="stylesheet" type="text/css" media="print" href="gcxktlm6.css?63" />		<link rel="stylesheet" type="text/css" media="handheld" href="zumsslq_.css?63" />		<!--[if lt IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE50Fixes.css?63";</style><![endif]-->		<!--[if IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE55Fixes.css?63";</style><![endif]-->		<!--[if IE 6]><style type="text/css">@import "/skins/OfflineNew/IE60Fixes.css?63";</style><![endif]-->		<!--[if IE 7]><style type="text/css">@import "/skins/OfflineNew/IE70Fixes.css?63";</style><![endif]-->		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?63"></script>		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->		<script type= "text/javascript">/*<![CDATA[*/
var skin = "OfflineNew";
var stylepath = "/skins";
var wgArticlePath = "/index.php/$1";
var wgScriptPath = "";
var wgServer = "http://localhost/";
var wgCanonicalNamespace = "";
var wgCanonicalSpecialPageName = false;
var wgNamespaceNumber = 0;
var wgPageName = "Код:SMTPMailLibrary.bb";
var wgTitle = "Код:SMTPMailLibrary.bb";
var wgAction = "view";
var wgArticleId = "1631";
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "ru";
var wgContentLanguage = "ru";
var wgBreakFrames = false;
var wgCurRevisionId = "2417";
/*]]>*/</script>
		<script type="text/javascript" src="2nq-6cel.js?63"><!-- wikibits js --></script>		<script type="text/javascript" src="http://localhost/index.php?title=-&amp;action=raw&amp;gen=js"><!-- site js --></script>		<style type="text/css">/*<![CDATA[*/
@import "http://localhost/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://localhost/index.php?title=MediaWiki:OfflineNew.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://localhost/index.php?title=-&amp;action=raw&amp;gen=css&amp;maxage=18000";
/*]]>*/</style>		<!-- Head Scripts -->	</head><body  class="mediawiki ns-0 ltr page-Код_SMTPMailLibrary_bb">	<div id="globalWrapper">	<div id="logocontainer">		<table align="center">		  <tr>				<td id="blitzetclogo">				</td>			</tr>		</table>	</div>	<div id="magbar">	Журнал о программированнии на языках Blitz3D, BlitzMax, BlitzPlus	</div>		<div id="column-content">	<div id="content">		<a name="top" id="top"></a>				<div id="bodyContent">		<table cellspacing=0 cellpadding=0 width=100%>			<tr>			  <td class="leftside">				</td>				<td class="sheetbody">					<h1 class="sheet">Код:SMTPMailLibrary.bb</h1>			<h3 id="siteSub">Материал из Blitz Et Cetera.</h3>			<div id="contentSub"></div>			<!-- start content -->			<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;********************************************************************************************</span><br />
<p><span style="color: #ffee00">;*** &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Blitz Mail Library</span><br />
<span style="color: #ffee00">;*** &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Version 2.0</span><br />
<span style="color: #ffee00">;********************************************************************************************</span><br />
<br />
<span style="color: #ffee00">;Version 1.0</span><br />
<span style="color: #ffee00">;Release...Err...2001 sometime&nbsp;:o/</span><br />
<br />
<span style="color: #ffee00">;Version 1.1</span><br />
<span style="color: #ffee00">;Release 03/12/04 - Fixed multi Line response bug.</span><br />
<span style="color: #ffee00">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Added Base64 decoder and SASL 'LOGIN' authorisation.</span><br />
<br />
<span style="color: #ffee00">;Version 2.0</span><br />
<span style="color: #ffee00">;Release 05/05/05 - Rewrote send_mail$(), it should be easier to follow and add stuff now.</span><br />
<span style="color: #ffee00">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Added SASL 'CRAM-MD5' authorisation.</span><br />
<span style="color: #ffee00">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Added SASL 'PLAIN' authorisation.</span><br />
<span style="color: #ffee00">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Added the option of supplying a server port.</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> AUTH_NONE = <span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> AUTH_PLAIN = <span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> AUTH_LOGIN = <span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> AUTH_CRAMMD5 = <span style="color: #33ffdd;">4</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> AUTH_ALL = AUTH_PLAIN <span style="color: #aaffff; font-weight: bold;">Or</span> AUTH_LOGIN <span style="color: #aaffff; font-weight: bold;">Or</span> AUTH_CRAMMD5<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> MAIL_DEBUG = <span style="color: #aaffff; font-weight: bold;">False</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> MD5_k<span style=" ">&#40;</span><span style="color: #33ffdd;">63</span><span style=" ">&#41;</span>, MD5_r<span style=" ">&#40;</span><span style="color: #33ffdd;">15</span><span style=" ">&#41;</span>, MD5_data<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
init_MD5<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">SeedRnd</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> html_image<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> filename$, cid$, idata$<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> inc_data<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> filename$, idata$<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #ffee00">; Sends the processed mail.</span><br />
<span style="color: #ffee00">; mailfrom$ &nbsp; = A string holding the senders mail address</span><br />
<span style="color: #ffee00">; fromname$ &nbsp; = A string holding the senders name</span><br />
<span style="color: #ffee00">; mailto$ &nbsp; &nbsp; = A string holding the recipients mail address</span><br />
<span style="color: #ffee00">; toname$ &nbsp; &nbsp; = A string holding the recipients name - optional</span><br />
<span style="color: #ffee00">; subject$ &nbsp; &nbsp;= A string holding the subject of the mail</span><br />
<span style="color: #ffee00">; body$ &nbsp; &nbsp; &nbsp; = A string holding the processed MIME mail</span><br />
<span style="color: #ffee00">; mailserver$ = A string holding the ESMTP/SMTP servers IP address or FQDN.</span><br />
<span style="color: #ffee00">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; You can add an optional port number (default = 25).</span><br />
<span style="color: #ffee00">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; example &gt;&gt;&gt; &quot;mail.myisp.net&quot; Or &quot;mail.myisp.net:25&quot;</span><br />
<span style="color: #ffee00">; username$ &nbsp; = A string holding the account username</span><br />
<span style="color: #ffee00">; userpass$ &nbsp; = A string holding the account password</span><br />
<span style="color: #ffee00">; This function returns a string containing&nbsp;;success; if successful or an error message if not</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> send_mail$<span style=" ">&#40;</span>mailfrom$, fromname$, mailto$, toname$ = <span style="color: #00ff66;">&quot;&quot;</span>, subject$, body$, mailserver$, username$=<span style="color: #00ff66;">&quot;&quot;</span>, userpass$=<span style="color: #00ff66;">&quot;&quot;</span>, auth_type = AUTH_NONE<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> server, code, resp$, client_ip$, ip_count, port<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> toname$ = <span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> toname$ = mailto$<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; ip_count = <span style="color: #aaffff; font-weight: bold;">CountHostIPs</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> ip_count<br />
&nbsp; &nbsp; &nbsp; &nbsp; client_ip$ = <span style="color: #00ff66;">&quot;[&quot;</span> + <span style="color: #aaffff; font-weight: bold;">DottedIP</span>$<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">HostIP</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> + <span style="color: #00ff66;">&quot;]&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; client_ip$ = <span style="color: #00ff66;">&quot;[127.0.0.1]&quot;</span> &nbsp;<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>mailserver$, <span style="color: #00ff66;">&quot;:&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; port = <span style="color: #aaffff; font-weight: bold;">Right</span>$<span style=" ">&#40;</span>maileserver$, <span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>mailserver$<span style=" ">&#41;</span> - <span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>mailserver$, <span style="color: #00ff66;">&quot;:&quot;</span><span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; port = <span style="color: #33ffdd;">25</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; server = <span style="color: #aaffff; font-weight: bold;">OpenTCPStream</span><span style=" ">&#40;</span>mailserver$, port<span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffee00">;Is there a connection?</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Not</span> server <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #00ff66;">&quot;Failed to connect to `&quot;</span> + mailserver$ + <span style="color: #00ff66;">&quot;`&quot;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; resp$ = get<span style=" ">&#40;</span>server<span style=" ">&#41;</span> <br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffee00">;Is the mail server available?</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Select</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">421</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CloseTCPStream</span> server<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #00ff66;">&quot;Service not available&quot;</span><span style="color: #ffee00">; &gt;&gt;&gt;&gt;&gt;&gt; ERROR EXIT</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">220</span> <span style="color: #ffee00">; Server available, lets get logged on.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; put<span style=" ">&#40;</span>server, <span style="color: #00ff66;">&quot;EHLO &quot;</span> + client_ip$<span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; resp$ = get<span style=" ">&#40;</span>server<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;An ESMTP server?</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> = <span style="color: #33ffdd;">250</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; If a username and password supplied, do SASL stuff.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>username$ &lt;&gt; <span style="color: #00ff66;">&quot;&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style=" ">&#40;</span>userpass$ &lt;&gt; <span style="color: #00ff66;">&quot;&quot;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style=" ">&#40;</span>auth_type &lt;&gt; AUTH_NONE<span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Select</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style=" ">&#40;</span>auth_type <span style="color: #aaffff; font-weight: bold;">And</span> AUTH_CRAMMD5<span style=" ">&#41;</span> <span style="color: #ffee00">; Do CRAM-MD5</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; auth_type = auth_type <span style="color: #aaffff; font-weight: bold;">And</span> ~AUTH_CRAMMD5<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; put<span style=" ">&#40;</span>server, <span style="color: #00ff66;">&quot;AUTH CRAM-MD5&quot;</span><span style=" ">&#41;</span> <span style="color: #ffee00">; CRAM-MD5? &nbsp; &nbsp; &nbsp; &nbsp;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; resp$ = get<span style=" ">&#40;</span>server<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> = <span style="color: #33ffdd;">334</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; put<span style=" ">&#40;</span>server, base64_enc<span style=" ">&#40;</span>username$ + <span style="color: #00ff66;">&quot; &quot;</span> + cram_md5<span style=" ">&#40;</span>userpass$, base64_dec<span style=" ">&#40;</span>get_message<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; resp$ = get<span style=" ">&#40;</span>server<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> &lt;&gt; <span style="color: #33ffdd;">235</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CloseTCPStream</span> server<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> resp$ <span style="color: #ffee00">; &gt;&gt;&gt;&gt;&gt;&gt; ERROR EXIT</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style=" ">&#40;</span>auth_type <span style="color: #aaffff; font-weight: bold;">And</span> AUTH_LOGIN<span style=" ">&#41;</span> <span style="color: #ffee00">; Do LOGIN</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; auth_type = auth_type <span style="color: #aaffff; font-weight: bold;">And</span> ~AUTH_LOGIN<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; put<span style=" ">&#40;</span>server, <span style="color: #00ff66;">&quot;AUTH LOGIN&quot;</span><span style=" ">&#41;</span> <span style="color: #ffee00">; LOGIN? &nbsp; &nbsp; &nbsp;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; resp$ = get<span style=" ">&#40;</span>server<span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> = <span style="color: #33ffdd;">334</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> = <span style="color: #00ff66;">&quot;334&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Select</span> <span style="color: #aaffff; font-weight: bold;">Lower</span>$<span style=" ">&#40;</span>base64_dec<span style=" ">&#40;</span>get_message<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;username:&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; put<span style=" ">&#40;</span>server, base64_enc<span style=" ">&#40;</span>username$, <span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; resp$ = get<span style=" ">&#40;</span>Server<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;password:&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; put<span style=" ">&#40;</span>server, base64_enc<span style=" ">&#40;</span>userpass$, <span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; resp$ = get<span style=" ">&#40;</span>Server<span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span> &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> &lt;&gt; <span style="color: #33ffdd;">235</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CloseTCPStream</span> server<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> resp$ <span style="color: #ffee00">; &gt;&gt;&gt;&gt;&gt;&gt; ERROR EXIT</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style=" ">&#40;</span>auth_type <span style="color: #aaffff; font-weight: bold;">And</span> AUTH_PLAIN<span style=" ">&#41;</span> <span style="color: #ffee00">; Do PLAIN</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; auth_type = auth_type <span style="color: #aaffff; font-weight: bold;">And</span> ~AUTH_PLAIN<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; put<span style=" ">&#40;</span>server, <span style="color: #00ff66;">&quot;AUTH PLAIN&quot;</span><span style=" ">&#41;</span> <span style="color: #ffee00">; PLAIN?</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; resp$ = get<span style=" ">&#40;</span>server<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> = <span style="color: #33ffdd;">334</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; put<span style=" ">&#40;</span>server, base64_enc<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span> + username$ + <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span> + userpass$ + <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>, <span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; resp$ = get<span style=" ">&#40;</span>Server<span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> &lt;&gt; <span style="color: #33ffdd;">235</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CloseTCPStream</span> server<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> resp$ <span style="color: #ffee00">; &gt;&gt;&gt;&gt;&gt;&gt; ERROR EXIT</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> auth_type = AUTH_NONE<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CloseTCPStream</span> server<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #00ff66;">&quot;Unsupported SASL Authorisation type&quot;</span> <span style="color: #ffee00">; &gt;&gt;&gt;&gt;&gt;&gt; ERROR EXIT</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Until</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> = <span style="color: #33ffdd;">235</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; put<span style=" ">&#40;</span>server, <span style="color: #00ff66;">&quot;HELO &quot;</span> + client_ip$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; resp$ = get<span style=" ">&#40;</span>server<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> &lt;&gt; <span style="color: #33ffdd;">250</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CloseTCPStream</span> server<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> resp$ <span style="color: #ffee00">; &gt;&gt;&gt;&gt;&gt;&gt; ERROR EXIT</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Default</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CloseTCPStream</span> server<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #00ff66;">&quot;Time Out&quot;</span> <span style="color: #ffee00">; &gt;&gt;&gt;&gt;&gt;&gt; ERROR EXIT</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffee00">;Now we`re logged in, we can send mail</span><br />
&nbsp; &nbsp; put<span style=" ">&#40;</span>server, <span style="color: #00ff66;">&quot;MAIL FROM: &lt;&quot;</span> + mailfrom$ + <span style="color: #00ff66;">&quot;&gt;&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; resp$ = get<span style=" ">&#40;</span>server<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> &lt;&gt; <span style="color: #33ffdd;">250</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CloseTCPStream</span> server<br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> &nbsp;get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> = <span style="color: #33ffdd;">501</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #00ff66;">&quot;Email sender not specified (or invalid address)&quot;</span> <span style="color: #ffee00">; &gt;&gt;&gt;&gt;&gt;&gt; ERROR EXIT</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> resp$ <span style="color: #ffee00">; &gt;&gt;&gt;&gt;&gt;&gt; ERROR EXIT</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; put<span style=" ">&#40;</span>server, <span style="color: #00ff66;">&quot;RCPT TO: &lt;&quot;</span> + mailto$ + <span style="color: #00ff66;">&quot;&gt;&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; resp$ = get<span style=" ">&#40;</span>server<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> &lt;&gt; <span style="color: #33ffdd;">250</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CloseTCPStream</span> server<br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> &nbsp;get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> = <span style="color: #33ffdd;">501</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #00ff66;">&quot;Email recipient not specified (or invalid address)&quot;</span> <span style="color: #ffee00">; &gt;&gt;&gt;&gt;&gt;&gt; ERROR EXIT</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> resp$ <span style="color: #ffee00">; &gt;&gt;&gt;&gt;&gt;&gt; ERROR EXIT</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; put<span style=" ">&#40;</span>server, <span style="color: #00ff66;">&quot;DATA&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; resp$ = get<span style=" ">&#40;</span>server<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> &lt;&gt; <span style="color: #33ffdd;">354</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CloseTCPStream</span> server<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> resp$ <span style="color: #ffee00">; &gt;&gt;&gt;&gt;&gt;&gt; ERROR EXIT</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; put<span style=" ">&#40;</span>server, <span style="color: #00ff66;">&quot;From: &quot;</span> + qt$ + mailname$ + qt$ + <span style="color: #00ff66;">&quot; &lt;&quot;</span> + mailfrom$ + <span style="color: #00ff66;">&quot;&gt;&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; put<span style=" ">&#40;</span>server, <span style="color: #00ff66;">&quot;To: &quot;</span> + qt$ + toname$ + qt$ + <span style="color: #00ff66;">&quot; &lt;&quot;</span> + mailto$ + <span style="color: #00ff66;">&quot;&gt;&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; put<span style=" ">&#40;</span>server, <span style="color: #00ff66;">&quot;Subject: &quot;</span> + subject$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; put<span style=" ">&#40;</span>server, <span style="color: #00ff66;">&quot;X-Mailer: Blitz Mail Library v2.0&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; put<span style=" ">&#40;</span>server, body$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; put<span style=" ">&#40;</span>server, <span style="color: #00ff66;">&quot;.&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; resp$ = get<span style=" ">&#40;</span>server<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> &lt;&gt; <span style="color: #33ffdd;">250</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CloseTCPStream</span> server<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> resp$ <span style="color: #ffee00">; &gt;&gt;&gt;&gt;&gt;&gt; ERROR EXIT</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp; &nbsp; put<span style=" ">&#40;</span>server, <span style="color: #00ff66;">&quot;QUIT&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; resp$ = get<span style=" ">&#40;</span>server<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> get_code<span style=" ">&#40;</span>resp$<span style=" ">&#41;</span> = <span style="color: #33ffdd;">221</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #00ff66;">&quot;success&quot;</span> <span style="color: #ffee00">; &gt;&gt;&gt;&gt;&gt;&gt; SUCCESS EXIT</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> resp$ <span style="color: #ffee00">; &gt;&gt;&gt;&gt;&gt;&gt; ERROR EXIT</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> &nbsp; &nbsp;<br />
<br />
<span style="color: #ffee00">; Encodes the processed HTML text and/or plain text into MIME format</span><br />
<span style="color: #ffee00">; html$ = A string holding the processed HTML text - optional</span><br />
<span style="color: #ffee00">; plain$= A string holding the plain text - optional</span><br />
<span style="color: #ffee00">; This function returns a string containing the MIME mail body text</span><br />
<span style="color: #ffee00">;</span><br />
<span style="color: #ffee00">; You`re probably wondering why BOTH of the parameters are optional?</span><br />
<span style="color: #ffee00">; If you wanted to send a blank mail with just an attachment.</span><br />
<span style="color: #ffee00">; You still need to run this function to MIME encode the attachment - build_mime$()</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> build_mime$<span style=" ">&#40;</span>html$=<span style="color: #00ff66;">&quot;&quot;</span>, plain$=<span style="color: #00ff66;">&quot;&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> out$, nl$ = <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">13</span><span style=" ">&#41;</span> + <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>, qt$ = <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">34</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> bound$ = <span style="color: #00ff66;">&quot;=_PART_00_&quot;</span> + unique<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> bound1$ = <span style="color: #00ff66;">&quot;=_PART_01_&quot;</span> + unique<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> bound2$ = <span style="color: #00ff66;">&quot;=_PART_02_&quot;</span> + unique<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> plain$ = <span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">And</span> html$ &lt;&gt; <span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; plain$ = <span style="color: #00ff66;">&quot;This is a HTML mail. Your mail app may not be able to display the main body of this mail.&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;MIME-Version: 1.0&quot;</span> + nl$<br />
&nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Type: multipart/mixed;&quot;</span> + nl$ + <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">9</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;boundary=&quot;</span> + qt$ + bound$ + qt$ + nl$ + nl$<br />
&nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;This is a MIME encoded message&quot;</span> + nl$ + nl$<br />
&nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;--&quot;</span> + bound$ + nl$<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> html$ &lt;&gt; <span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">First</span> html_image = <span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Type: multipart/alternative;&quot;</span> + nl$ + <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">9</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;boundary=&quot;</span> + qt$ + bound1$ + qt$ + nl$ + nl$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;--&quot;</span> + bound1$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Type: text/plain; charset=&quot;</span> + qt$ + <span style="color: #00ff66;">&quot;iso-8859-1&quot;</span> + qt$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Transfer-Encoding: quoted-printable&quot;</span> + nl$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + qp_enc$<span style=" ">&#40;</span>plain$<span style=" ">&#41;</span> + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;--&quot;</span> + bound1$ + nl$ <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Type: text/html; charset=&quot;</span> + qt$ + <span style="color: #00ff66;">&quot;iso-8859-1&quot;</span> + qt$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Transfer-Encoding: quoted-printable&quot;</span> + nl$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + html$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Type: multipart/related;&quot;</span> + nl$ + <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">9</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;boundary=&quot;</span> + qt$ + bound1$ + qt$ + nl$ + nl$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;--&quot;</span> + bound1$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Type: multipart/alternative;&quot;</span> + nl$ + <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">9</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;boundary=&quot;</span> + qt$ + bound2$ + qt$ + nl$ + nl$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;--&quot;</span> + bound2$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Type: text/plain; charset=&quot;</span> + qt$ + <span style="color: #00ff66;">&quot;iso-8859-1&quot;</span> + qt$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Transfer-Encoding: quoted-printable&quot;</span> + nl$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + qp_enc$<span style=" ">&#40;</span>plain$<span style=" ">&#41;</span> + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;--&quot;</span> + bound2$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Type: text/html; charset=&quot;</span> + qt$ + <span style="color: #00ff66;">&quot;iso-8859-1&quot;</span> + qt$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Transfer-Encoding: quoted-printable&quot;</span> + nl$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + html$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;--&quot;</span> + bound2$ + <span style="color: #00ff66;">&quot;--&quot;</span> + nl$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> image.html_image=<span style="color: #aaffff; font-weight: bold;">Each</span> html_image<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;--&quot;</span> + bound1$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Type: image/&quot;</span> + <span style="color: #aaffff; font-weight: bold;">Right</span>$<span style=" ">&#40;</span>image.html_image\filename$, <span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;; name=&quot;</span> + qt$ + image.html_image\filename$ + qt$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Transfer-Encoding: base64&quot;</span> + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-ID: &lt;&quot;</span> + image.html_image\cid$ + <span style="color: #00ff66;">&quot;&gt;&quot;</span> + nl$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + image.html_image\idata$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;--&quot;</span> + bound1$ + <span style="color: #00ff66;">&quot;--&quot;</span> + nl$ + nl$<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Type: text/plain;&quot;</span> + nl$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Transfer-Encoding: quoted-printable&quot;</span> + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + qp_enc$<span style=" ">&#40;</span>plain$<span style=" ">&#41;</span> + nl$<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">First</span> inc_data &lt;&gt; <span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> inc.inc_data=<span style="color: #aaffff; font-weight: bold;">Each</span> inc_data<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;--&quot;</span> + bound$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Type: application/octete-stream&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;; name=&quot;</span> + qt$ + inc.inc_data\filename$ + qt$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Transfer-Encoding: base64&quot;</span> + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;Content-Disposition: attachment; filename=&quot;</span> + qt$ + inc.inc_data\filename$ + qt$ + nl$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + inc.inc_data\idata$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;--&quot;</span> + bound$ + <span style="color: #00ff66;">&quot;--&quot;</span> + nl$<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> <span style="color: #aaffff; font-weight: bold;">Each</span> html_image<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> <span style="color: #aaffff; font-weight: bold;">Each</span> inc_data<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> out$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">; Converts an external file into a string</span><br />
<span style="color: #ffee00">; inp$ = A string containing the filepath to the required file</span><br />
<span style="color: #ffee00">; This function returns a string containing the files data</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> file_to_string$<span style=" ">&#40;</span>inp$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> file, out$<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; file = <span style="color: #aaffff; font-weight: bold;">ReadFile</span><span style=" ">&#40;</span>inp$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Not</span> file<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">RuntimeError</span> <span style="color: #00ff66;">&quot;Couldn't open '&quot;</span> + inp$ + <span style="color: #00ff66;">&quot;' for encoding.&quot;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">ReadByte</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">Eof</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CloseFile</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> out$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">; Encodes files as attachments</span><br />
<span style="color: #ffee00">; file$ = A string containing the filepath to the required file</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> process_include$<span style=" ">&#40;</span>file$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; inc.inc_data = <span style="color: #aaffff; font-weight: bold;">New</span> inc_data<br />
&nbsp; &nbsp; inc.inc_data\filename$ = file$<br />
&nbsp; &nbsp; inc.inc_data\idata$ = base64_enc$<span style=" ">&#40;</span>file_to_string$<span style=" ">&#40;</span>file$<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">; Scans the HTML string loads and encodes any images and replaces their filename with a ContentIDentifier</span><br />
<span style="color: #ffee00">; inp$ &nbsp;= A string containing the HTML text</span><br />
<span style="color: #ffee00">; dir$ &nbsp;= A string containing the path to the original HTML file - optional (if the HTML file is in the same directory</span><br />
<span style="color: #ffee00">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; as your code)</span><br />
<span style="color: #ffee00">; This function returns a string containing the processed HTML text</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> process_html$<span style=" ">&#40;</span>inp$, dir$=<span style="color: #00ff66;">&quot;&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> out$ = inp$, img$, ifrom, ito = <span style="color: #33ffdd;">1</span>, fnd<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> dir$ &lt;&gt; <span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">Right</span>$<span style=" ">&#40;</span>dir$, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> &lt;&gt; <span style="color: #00ff66;">&quot;\&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> dir$ = dir$ + <span style="color: #00ff66;">&quot;\&quot;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; ifrom = <span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Lower</span>$<span style=" ">&#40;</span>inp$<span style=" ">&#41;</span>, <span style="color: #00ff66;">&quot;&lt;img&quot;</span>, ito<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> ifrom<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ifrom = <span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Lower</span>$<span style=" ">&#40;</span>inp$<span style=" ">&#41;</span>, <span style="color: #00ff66;">&quot;src&quot;</span>, ifrom + <span style="color: #33ffdd;">4</span><span style=" ">&#41;</span> + <span style="color: #33ffdd;">3</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ifrom = <span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Lower</span>$<span style=" ">&#40;</span>inp$<span style=" ">&#41;</span>, <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">34</span><span style=" ">&#41;</span>, ifrom<span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ito = <span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Lower</span>$<span style=" ">&#40;</span>inp$<span style=" ">&#41;</span>, <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">34</span><span style=" ">&#41;</span>, ifrom<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fnd = <span style="color: #aaffff; font-weight: bold;">False</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> image.html_image=<span style="color: #aaffff; font-weight: bold;">Each</span> html_image<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> image.html_image\filename$ = <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>inp$, ifrom, ito - ifrom<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> fnd = <span style="color: #aaffff; font-weight: bold;">True</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Not</span> fnd<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; image.html_image = <span style="color: #aaffff; font-weight: bold;">New</span> html_image<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; image.html_image\filename$ = <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>inp$, ifrom, ito - ifrom<span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; image.html_image\cid$ = unique$<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; image.html_image\idata$ = base64_enc$<span style=" ">&#40;</span>file_to_string$<span style=" ">&#40;</span>dir$ + image.html_image\filename$<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = <span style="color: #aaffff; font-weight: bold;">Replace</span>$<span style=" ">&#40;</span>out$, image.html_image\filename$, <span style="color: #00ff66;">&quot;cid:&quot;</span> + image.html_image\cid$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Until</span> <span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Not</span> ifrom<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> qp_enc$<span style=" ">&#40;</span>out$<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">; Encodes a string using the base64 algorithm</span><br />
<span style="color: #ffee00">; inp$ = A string containing the data to be encoded</span><br />
<span style="color: #ffee00">; add_nl = 1 - adds a newline seguence at the end of the encoded string, 0 - no newline (if string is &lt; 76 chars)</span><br />
<span style="color: #ffee00">; This function returns a string containing the encoded data</span><br />
<span style="color: #ffee00">; You shouldn`t need to call this directly. But feel free.</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> base64_enc$<span style=" ">&#40;</span>inp$, add_nl=<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> b64_enc$ = <span style="color: #00ff66;">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> nl$ = <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">13</span><span style=" ">&#41;</span> + <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> out$, trp$, char, i = <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; trp$ = <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>inp$, i, <span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Select</span> <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>trp$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">3</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>b64_enc$, <span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>trp$, <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>b64_enc$, <span style=" ">&#40;</span><span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>trp$, <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">4</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> <span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>trp$, <span style="color: #33ffdd;">2</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">4</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> $3f<span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>b64_enc$, <span style=" ">&#40;</span><span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>trp$, <span style="color: #33ffdd;">2</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> <span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>trp$, <span style="color: #33ffdd;">3</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">6</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> $3f<span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>b64_enc$, <span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>trp$, <span style="color: #33ffdd;">3</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> $3f<span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>b64_enc$, <span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>trp$, <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>b64_enc$, <span style=" ">&#40;</span><span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>trp$, <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">4</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> <span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>trp$, <span style="color: #33ffdd;">2</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">4</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> $3f<span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>b64_enc$, <span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>trp$, <span style="color: #33ffdd;">2</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> $3f<span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;=&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>b64_enc$, <span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>trp$, <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>b64_enc$, <span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>trp$, <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">4</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> $3f<span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;==&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; i = i + <span style="color: #33ffdd;">3</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; char = char + <span style="color: #33ffdd;">4</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> char = <span style="color: #33ffdd;">76</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; char = <span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Until</span> i &gt; <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>inp$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> char <span style="color: #aaffff; font-weight: bold;">And</span> add_nl <span style="color: #aaffff; font-weight: bold;">Then</span> out$ = out$ + nl$<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> out$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">; Decodes a string that`s been encoded with the base64 algorithm</span><br />
<span style="color: #ffee00">; inp$ = A string containing the encoded data</span><br />
<span style="color: #ffee00">; This function returns a string containing the decoded data</span><br />
<span style="color: #ffee00">; You shouldn`t need to call this directly. But feel free.</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> base64_dec$<span style=" ">&#40;</span>inp$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> b64_enc$ = <span style="color: #00ff66;">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> out$, oct, i = <span style="color: #33ffdd;">1</span>, qc, char <br />
<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; char = <span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>b64_enc$, <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>inp$, i, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> char &gt; <span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> char = <span style="color: #33ffdd;">65</span> <span style="color: #aaffff; font-weight: bold;">Then</span> char = <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oct = <span style=" ">&#40;</span>oct <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">6</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> <span style=" ">&#40;</span><span style=" ">&#40;</span>char - <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> $3f<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; qc = qc + <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> qc = <span style="color: #33ffdd;">4</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style=" ">&#40;</span>oct <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> $ff<span style=" ">&#41;</span> + <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style=" ">&#40;</span>oct <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> $ff<span style=" ">&#41;</span> + <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span>oct <span style="color: #aaffff; font-weight: bold;">And</span> $ff<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oct = <span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; qc = <span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; i = i + <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Until</span> i &gt; <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>inp$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> out$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
<span style="color: #ffee00">; Encodes a string using the quoted printable algorithm</span><br />
<span style="color: #ffee00">; inp$ = A string containing the text to be encoded</span><br />
<span style="color: #ffee00">; This function returns a string containing the encoded text</span><br />
<span style="color: #ffee00">; You shouldn`t need to call this directly. But feel free.</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> qp_enc$<span style=" ">&#40;</span>inp$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> qp_asc$ = <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">9</span><span style=" ">&#41;</span> + <span style="color: #00ff66;">&quot;&nbsp;!#$%&amp;'()*+,-./0123456789:;&lt;&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> nl$ = <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">13</span><span style=" ">&#41;</span> + <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> out$, cnt, char$, i<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; i = i + <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; char$ = <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>inp$, i, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>qp_asc$, char$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + char$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cnt = cnt + <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>inp$, i, <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> &lt;&gt; nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> cnt &gt; <span style="color: #33ffdd;">72</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;=&quot;</span> + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cnt = <span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;=&quot;</span> + <span style="color: #aaffff; font-weight: bold;">Right</span>$<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Hex</span>$<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span>char$<span style=" ">&#41;</span><span style=" ">&#41;</span>, <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cnt = cnt + <span style="color: #33ffdd;">3</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i = i + <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cnt = <span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> cnt = <span style="color: #33ffdd;">75</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #00ff66;">&quot;=&quot;</span> + nl$<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cnt = <span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Until</span> i &gt;= <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>inp$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> cnt <span style="color: #aaffff; font-weight: bold;">Then</span> out$ = out$ + nl$<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> out$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">; Spits out a 24 digit (96 bit) random(ish) hexadecimal string</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> unique$<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> out$, i<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i= <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">12</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #aaffff; font-weight: bold;">Right</span>$<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Hex</span>$<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><span style=" ">&#41;</span>, <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> out$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">; Write a string to the given stream with debug log output</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> put<span style=" ">&#40;</span>stream, out$<span style=" ">&#41;</span> &nbsp;<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">WriteLine</span> stream, out$<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> MAIL_DEBUG<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;BLITZ &nbsp;: &quot;</span> + out$<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">; Read a string from the given stream with debug log output</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> get$<span style=" ">&#40;</span>stream<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> in$<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; in$ = <span style="color: #aaffff; font-weight: bold;">ReadLine</span><span style=" ">&#40;</span>stream<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>in$, <span style="color: #33ffdd;">4</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> = <span style="color: #00ff66;">&quot;-&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> MAIL_DEBUG<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;SERVER&nbsp;: &quot;</span> + in$<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; in$ = <span style="color: #aaffff; font-weight: bold;">ReadLine</span><span style=" ">&#40;</span>stream<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> MAIL_DEBUG<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;SERVER&nbsp;: &quot;</span> + in$<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> in$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">; The next two are pretty pointless, they just make the send_mail$() code easier to read.</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> get_code<span style=" ">&#40;</span>inp$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>inp$, <span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> get_message$<span style=" ">&#40;</span>inp$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">Right</span>$<span style=" ">&#40;</span>inp$, <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>inp$<span style=" ">&#41;</span> - <span style="color: #33ffdd;">4</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">; CRAM-MD5 and associated functions</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> cram_md5$<span style=" ">&#40;</span>key$, tag$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> ikey$<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>key$<span style=" ">&#41;</span> &gt; <span style="color: #33ffdd;">64</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; ikey$ = hex2char$<span style=" ">&#40;</span>md5$<span style=" ">&#40;</span>key$<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; ikey$ = key$ + <span style="color: #aaffff; font-weight: bold;">String</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>, <span style="color: #33ffdd;">64</span> - <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>key$<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> md5$<span style=" ">&#40;</span>xor_string$<span style=" ">&#40;</span>ikey$, $5C<span style=" ">&#41;</span> + hex2char$<span style=" ">&#40;</span>md5$<span style=" ">&#40;</span>xor_string$<span style=" ">&#40;</span>ikey$, $<span style="color: #33ffdd;">36</span><span style=" ">&#41;</span> + tag$<span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> xor_string$<span style=" ">&#40;</span>a$, b<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> c, out$<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> c=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>a$<span style=" ">&#41;</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>a$, c, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Xor</span> b<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> out$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> hex2char$<span style=" ">&#40;</span>hexin$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> c, out$<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> c=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>hexin$<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">2</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span>hex2dec<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span><span style=" ">&#40;</span>hexin$, c, <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> out$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> hex2dec<span style=" ">&#40;</span>hexin$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> c, dec, hexval$ = <span style="color: #00ff66;">&quot;0123456789ABCDEF&quot;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> c=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>hexin$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; dec = <span style=" ">&#40;</span>dec <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">4</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> <span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>hexval$, <span style="color: #aaffff; font-weight: bold;">Upper</span>$<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>hexin$, c, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span> - <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> dec<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> init_MD5<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> c<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Restore</span> MD5_constdata<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> c=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">63</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Read</span> MD5_k<span style=" ">&#40;</span>c<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> c=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">15</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Read</span> MD5_r<span style=" ">&#40;</span>c<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> <br />
<br />
.MD5_constdata<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> $D76AA478, $E8C7B756, $242070DB, $C1BDCEEE, $F57C0FAF, $4787C62A<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> $A8304613, $FD469501, $698098D8, $8B44F7AF, $FFFF5BB1, $895CD7BE<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> $6B901122, $FD987193, $A679438E, $49B40821, $F61E2562, $C040B340<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> $265E5A51, $E9B6C7AA, $D62F105D, $<span style="color: #33ffdd;">02441453</span>, $D8A1E681, $E7D3FBC8<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> $21E1CDE6, $C33707D6, $F4D50D87, $455A14ED, $A9E3E905, $FCEFA3F8<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> $676F02D9, $8D2A4C8A, $FFFA3942, $8771F681, $6D9D6122, $FDE5380C<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> $A4BEEA44, $4BDECFA9, $F6BB4B60, $BEBFBC70, $289B7EC6, $EAA127FA<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> $D4EF3085, $04881D05, $D9D4D039, $E6DB99E5, $1FA27CF8, $C4AC5665<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> $F4292244, $432AFF97, $AB9423A7, $FC93A039, $655B59C3, $8F0CCC92<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> $FFEFF47D, $85845DD1, $6FA87E4F, $FE2CE6E0, $A3014314, $4E0811A1<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> $F7537E82, $BD3AF235, $2AD7D2BB, $EB86D391<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">7</span>, <span style="color: #33ffdd;">12</span>, <span style="color: #33ffdd;">17</span>, <span style="color: #33ffdd;">22</span>, &nbsp;<span style="color: #33ffdd;">5</span>, <span style="color: #33ffdd;">9</span>, <span style="color: #33ffdd;">14</span>, <span style="color: #33ffdd;">20</span>, &nbsp;<span style="color: #33ffdd;">4</span>, <span style="color: #33ffdd;">11</span>, <span style="color: #33ffdd;">16</span>, <span style="color: #33ffdd;">23</span>, &nbsp;<span style="color: #33ffdd;">6</span>, <span style="color: #33ffdd;">10</span>, <span style="color: #33ffdd;">15</span>, <span style="color: #33ffdd;">21</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> MD5$<span style=" ">&#40;</span>in$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> h0 = $<span style="color: #33ffdd;">67452301</span>, h1 = $EFCDAB89, h2 = $98BADCFE, h3 = $<span style="color: #33ffdd;">10325476</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> chunkStart, intCount, i, a, b, c, d, f, t<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; intCount = <span style=" ">&#40;</span><span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>in$<span style=" ">&#41;</span> + <span style="color: #33ffdd;">8</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">6</span><span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">4</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Dim</span> MD5_data<span style=" ">&#40;</span>intCount - <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> c=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>in$<span style=" ">&#41;</span> - <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; MD5_data<span style=" ">&#40;</span>c <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> = MD5_data<span style=" ">&#40;</span>c <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> <span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span><span style=" ">&#40;</span>in$, c + <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style=" ">&#40;</span><span style=" ">&#40;</span>c <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">3</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; MD5_data<span style=" ">&#40;</span>c <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> = MD5_data<span style=" ">&#40;</span>c <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> <span style=" ">&#40;</span>$<span style="color: #33ffdd;">80</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style=" ">&#40;</span><span style=" ">&#40;</span>c <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">3</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; MD5_data<span style=" ">&#40;</span>intCount - <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> = <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>in$<span style=" ">&#41;</span> * <span style="color: #33ffdd;">8</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> chunkStart=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style=" ">&#40;</span>intCount - <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">16</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; a = h0&nbsp;: b = h1&nbsp;: c = h2&nbsp;: d = h3<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">15</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f = d <span style="color: #aaffff; font-weight: bold;">Xor</span> <span style=" ">&#40;</span>b <span style="color: #aaffff; font-weight: bold;">And</span> <span style=" ">&#40;</span>c <span style="color: #aaffff; font-weight: bold;">Xor</span> d<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t = d<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d = c&nbsp;: c = b<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b = Rol<span style=" ">&#40;</span><span style=" ">&#40;</span>a + f + MD5_k<span style=" ">&#40;</span>i<span style=" ">&#41;</span> + MD5_data<span style=" ">&#40;</span>chunkStart + i<span style=" ">&#41;</span><span style=" ">&#41;</span>, MD5_r<span style=" ">&#40;</span>i <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><span style=" ">&#41;</span> + b<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a = t<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">31</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f = c <span style="color: #aaffff; font-weight: bold;">Xor</span> <span style=" ">&#40;</span>d <span style="color: #aaffff; font-weight: bold;">And</span> <span style=" ">&#40;</span>b <span style="color: #aaffff; font-weight: bold;">Xor</span> c<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t = d<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d = c&nbsp;: c = b<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b = Rol<span style=" ">&#40;</span><span style=" ">&#40;</span>a + f + MD5_k<span style=" ">&#40;</span>i<span style=" ">&#41;</span> + MD5_data<span style=" ">&#40;</span>chunkStart + <span style=" ">&#40;</span><span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #33ffdd;">5</span> * i<span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">15</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span>, MD5_r<span style=" ">&#40;</span><span style=" ">&#40;</span>i <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">3</span><span style=" ">&#41;</span> + <span style="color: #33ffdd;">4</span><span style=" ">&#41;</span><span style=" ">&#41;</span> + b<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a = t<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">32</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">47</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f = b <span style="color: #aaffff; font-weight: bold;">Xor</span> c <span style="color: #aaffff; font-weight: bold;">Xor</span> d<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t = d<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d = c&nbsp;: c = b<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b = Rol<span style=" ">&#40;</span><span style=" ">&#40;</span>a + f + MD5_k<span style=" ">&#40;</span>i<span style=" ">&#41;</span> + MD5_data<span style=" ">&#40;</span>chunkStart + <span style=" ">&#40;</span><span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #33ffdd;">3</span> * i<span style=" ">&#41;</span> + <span style="color: #33ffdd;">5</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">15</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span>, MD5_r<span style=" ">&#40;</span><span style=" ">&#40;</span>i <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">3</span><span style=" ">&#41;</span> + <span style="color: #33ffdd;">8</span><span style=" ">&#41;</span><span style=" ">&#41;</span> + b<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a = t<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">48</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">63</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f = c <span style="color: #aaffff; font-weight: bold;">Xor</span> <span style=" ">&#40;</span>b <span style="color: #aaffff; font-weight: bold;">Or</span> ~d<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t = d<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d = c&nbsp;: c = b<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b = Rol<span style=" ">&#40;</span><span style=" ">&#40;</span>a + f + MD5_k<span style=" ">&#40;</span>i<span style=" ">&#41;</span> + MD5_data<span style=" ">&#40;</span>chunkStart + <span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #33ffdd;">7</span> * i<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">15</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span>, MD5_r<span style=" ">&#40;</span><span style=" ">&#40;</span>i <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">3</span><span style=" ">&#41;</span> + <span style="color: #33ffdd;">12</span><span style=" ">&#41;</span><span style=" ">&#41;</span> + b<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a = t<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; h0 = h0 + a&nbsp;: h1 = h1 + b<br />
&nbsp; &nbsp; &nbsp; &nbsp; h2 = h2 + c&nbsp;: h3 = h3 + d<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Dim</span> MD5_data<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">Lower</span>$<span style=" ">&#40;</span>LEHex<span style=" ">&#40;</span>h0<span style=" ">&#41;</span> + LEHex<span style=" ">&#40;</span>h1<span style=" ">&#41;</span> + LEHex<span style=" ">&#40;</span>h2<span style=" ">&#41;</span> + LEHex<span style=" ">&#40;</span>h3<span style=" ">&#41;</span><span style=" ">&#41;</span> &nbsp; &nbsp;<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> Rol<span style=" ">&#40;</span>val, shift<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style=" ">&#40;</span>val <span style="color: #aaffff; font-weight: bold;">Shl</span> shift<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> <span style=" ">&#40;</span>val <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style=" ">&#40;</span><span style="color: #33ffdd;">32</span> - shift<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> LEHex$<span style=" ">&#40;</span>val<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Local</span> c, out$, hexval$ = <span style="color: #aaffff; font-weight: bold;">Hex</span>$<span style=" ">&#40;</span>val<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> c = <span style="color: #33ffdd;">7</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-2</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; out$ = out$ + <span style="color: #aaffff; font-weight: bold;">Mid</span><span style=" ">&#40;</span>hexval$, c, <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> out$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;************************************************************************</span><br />
<span style="color: #ffee00">;*** &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Blitz Mail Library Demo</span><br />
<span style="color: #ffee00">;************************************************************************</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">640</span>, <span style="color: #33ffdd;">480</span>, <span style="color: #33ffdd;">0</span>, <span style="color: #33ffdd;">2</span><br />
<br />
<span style="color: #ffee00">; Add the MIME library</span><br />
<span style="color: #ffee00">; Get the required parameters</span><br />
name_from$ = <span style="color: #aaffff; font-weight: bold;">Input</span>$<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Enter your name&nbsp;: &quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; mail_from$ = <span style="color: #aaffff; font-weight: bold;">Input</span>$<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Enter your e-mail address&nbsp;: &quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Until</span> mail_from$ &lt;&gt; <span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>mail_from$, <span style="color: #00ff66;">&quot;@&quot;</span><span style=" ">&#41;</span> &gt; <span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Print</span><br />
<br />
to_name$ = <span style="color: #aaffff; font-weight: bold;">Input</span>$<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Enter the recipients name&nbsp;: &quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; to_mail$ = <span style="color: #aaffff; font-weight: bold;">Input</span>$<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Enter the recipients e-mail address&nbsp;: &quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Until</span> to_mail$ &lt;&gt; <span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>to_mail$, <span style="color: #00ff66;">&quot;@&quot;</span><span style=" ">&#41;</span> &gt; <span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Print</span><br />
<br />
subject$ = <span style="color: #aaffff; font-weight: bold;">Input</span>$<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Enter subject text&nbsp;: &quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Print</span><br />
<br />
server$ = <span style="color: #aaffff; font-weight: bold;">Input</span>$<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Enter SMTP server name (mail/smtp.yourisp.TLD)&nbsp;: &quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">; Add 'text.zip' as an include</span><br />
<span style="color: #ffee00">;process_include$(&quot;text.zip&quot;)</span><br />
<br />
<span style="color: #ffee00">; We're using an external file for the HTML. So, lets convert it to a string</span><br />
tmp_html$ = file_to_string$<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;htmlmail.htm&quot;</span><span style=" ">&#41;</span><span style="color: #ffee00">;Any HTML page should do</span><br />
<br />
<span style="color: #ffee00">; Lets scan the HTML string for images, load and encode them. Then insert their CID into the relevant image tags</span><br />
<span style="color: #ffee00">; If the HTML was in a different directory to this code - tmp_html$ = process_html$(tmp_html$, &quot;HTML directory\&quot;)</span><br />
tmp_html$ = process_html$<span style=" ">&#40;</span>tmp_html$<span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">; Now assemble all of the data into one MIME mail complete with relevant encoding.</span><br />
html$ = build_mime$<span style=" ">&#40;</span>tmp_html$, <span style="color: #00ff66;">&quot;Some Plain Text in case the receiving mail client can't cope with HTML.&quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">; The above could have been accomplished with...</span><br />
<span style="color: #ffee00">;html$ = build_mime$(process_html$(file_to_string$(&quot;htmlmail.htm&quot;)), &quot;Some Demo Text&quot;)</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Print</span><br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Sending Mail (for dial up networks you may have to connect manually first)&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Print</span><br />
<span style="color: #aaffff; font-weight: bold;">Delay</span> <span style="color: #33ffdd;">100</span><br />
<span style="color: #ffee00">; Now send the mail</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Print</span> send_mail$<span style=" ">&#40;</span>mail_from$, name_from$, to_mail$, to_name$, subject$, html$, server$<span style=" ">&#41;</span><br />
<span style="color: #ffee00">; You may need to use...</span><br />
<span style="color: #ffee00">; Print send_mail$(mail_from$, name_from$, to_mail$, to_name$, subject$, html$, server$, &quot;account username&quot;, &quot;account password&quot;, AUTH_ALL)</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Print</span><br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Any key to exit&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>

<!-- Saved in parser cache with key db1:pcache:idhash:1631-0!1!0!!ru!2 and timestamp 20071110055123 -->
<div class="printfooter">
Получено с <a href="_gy3mm8u.html">http://localhost/index.php/%D0%9A%D0%BE%D0%B4:SMTPMailLibrary.bb</a></div>
			<!-- end content -->			<div class="visualClear"></div>				</td>				<td class="rightside">				</td>			</tr>		</table>		</div>	</div>		</div>	
		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</div></body>
<!-- Mirrored from localhost/index.php/%D0%9A%D0%BE%D0%B4:SMTPMailLibrary.bb by HTTrack Website Copier/3.x [XR&CO'2007], Sat, 10 Nov 2007 05:56:12 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>