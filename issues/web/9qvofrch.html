<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru" dir="ltr">	
<!-- Mirrored from localhost/index.php/%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%963_-_%D0%B0%D0%BF%D1%80%D0%B5%D0%BB%D1%8C_2005 by HTTrack Website Copier/3.x [XR&CO'2007], Mon, 12 Nov 2007 11:20:33 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />				<meta name="keywords" content="Выпуск №3 - апрель 2005,MANIAK dobrii,Matt Merkulov,Tolking" />
		<link rel="shortcut icon" href="http://blitzetcetera.org/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="http://blitzetcetera.org/opensearch_desc.php" title="Blitz Et Cetera (Русский)" />
		<title>Выпуск №3 - апрель 2005 — Blitz Et Cetera</title>		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "bvih5rde.css?63"; /*]]>*/</style>		<link rel="stylesheet" type="text/css" media="print" href="gcxktlm6.css?63" />		<link rel="stylesheet" type="text/css" media="handheld" href="zumsslq_.css?63" />		<!--[if lt IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE50Fixes.css?63";</style><![endif]-->		<!--[if IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE55Fixes.css?63";</style><![endif]-->		<!--[if IE 6]><style type="text/css">@import "/skins/OfflineNew/IE60Fixes.css?63";</style><![endif]-->		<!--[if IE 7]><style type="text/css">@import "/skins/OfflineNew/IE70Fixes.css?63";</style><![endif]-->		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?63"></script>		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->		<script type= "text/javascript">/*<![CDATA[*/
var skin = "OfflineNew";
var stylepath = "/skins";
var wgArticlePath = "/index.php/$1";
var wgScriptPath = "";
var wgServer = "http://blitzetcetera.org/";
var wgCanonicalNamespace = "";
var wgCanonicalSpecialPageName = false;
var wgNamespaceNumber = 0;
var wgPageName = "Выпуск_№3_-_апрель_2005";
var wgTitle = "Выпуск №3 - апрель 2005";
var wgAction = "view";
var wgArticleId = "575";
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "ru";
var wgContentLanguage = "ru";
var wgBreakFrames = false;
var wgCurRevisionId = "3640";
/*]]>*/</script>
		<script type="text/javascript" src="2nq-6cel.js?63"><!-- wikibits js --></script>		<script type="text/javascript" src="http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=js"><!-- site js --></script>		<style type="text/css">/*<![CDATA[*/
@import "http://blitzetcetera.org/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=MediaWiki:OfflineNew.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=css&amp;maxage=18000";
/*]]>*/</style>		<!-- Head Scripts -->	</head><body  class="mediawiki ns-0 ltr page-Выпуск_№3_-_апрель_2005">	<div id="globalWrapper">	<div id="logocontainer">		<table align="center">		  <tr>				<td id="blitzetclogo">				</td>			</tr>		</table>	</div>	<div id="magbar">	Журнал о программированнии на языках Blitz3D, BlitzMax, BlitzPlus	</div>		<div id="column-content">	<div id="content">		<a name="top" id="top"></a>				<div id="bodyContent">		<table cellspacing=0 cellpadding=0 width=100%>			<tr>			  <td class="leftside">				</td>				<td class="sheetbody">					<h1 class="sheet">Выпуск №3 - апрель 2005</h1>			<h3 id="siteSub">Материал из Blitz Et Cetera.</h3>			<div id="contentSub"></div>			<!-- start content -->			<a name="Contents"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%963_-_%D0%B0%D0%BF%D1%80%D0%B5%D0%BB%D1%8C_2005&amp;action=edit&amp;section=1" title="Править секцию: Contents">править</a>]</span> <span class="mw-headline">Contents</span></h2>
<ul><li>Вступление
<ul><li><a href="#Предисловие редактора (выпуск 3)">Предисловие редактора (выпуск 3)</a>
</li><li><a href="#Почта (выпуск 3)">Почта (выпуск 3)</a>
</li></ul>
</li><li>Обзор
<ul><li><a href="#Blitz-сайты">Blitz-сайты</a>
</li><li><a href="#Галерея: стратегии от MicroProse">Галерея: стратегии от MicroProse</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> 
</li></ul>
</li><li>Новичкам
<ul><li><a href="#Переход на BlitzMax с Blitz3D: Синтаксис">Переход на BlitzMax с Blitz3D: Синтаксис</a> - Mark Sibly, перевел <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:MANIAK_dobrii" title="Участник:MANIAK dobrii">MANIAK dobrii</a> 
</li></ul>
</li><li>Разработки
<ul><li><a href="#Алгоритм A* для новичков">Алгоритм A* для новичков</a> - Patrick Lester, перевел Morpher 
</li><li><a href="#Делаем чат">Делаем чат</a> - TankSoft 
</li><li><a href="#Эффекты размытия в реальном времени">Эффекты размытия в реальном времени</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> 
</li><li><a href="#Редактор двумерных кривых">Редактор двумерных кривых</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> 
</li><li><a href="#Тела вращения">Тела вращения</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> 
</li><li><a href="#Бесконечная «Жизнь»">Бесконечная «Жизнь»</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> 
</li><li><a href="#Виртуальный художник: соседние пикселы">Виртуальный художник: соседние пикселы</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> 
</li></ul>
</li><li>Дизайнеру
<ul><li><a href="#МАКСимальная энциклопедия">МАКСимальная энциклопедия</a> - Федор Галков, OCR: Святослав 
</li></ul>
</li><li>Свободный полет
<ul><li><a href="#Курс молодого бойца, часть 3: практические занятия">Курс молодого бойца, часть 3: практические занятия</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Tolking" title="Участник:Tolking">Роман Прядко</a> 
</li></ul>
</li><li>В заключение
<ul><li><a href="#Конкурс! (выпуск 3)">Конкурс! (выпуск 3)</a>
</li><li><a href="#В следующем выпуске (выпуск 3)">В следующем выпуске (выпуск 3)</a>
</li></ul>
</li></ul>
<p></td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Предисловие редактора (выпуск 3)"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Предисловие редактора (выпуск 3)&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Предисловие редактора (выпуск 3)&amp;action=edit">править</a>]</span><span class="mw-headline">Предисловие редактора (выпуск 3)</span></h1>
<p>После долгой задержки вышел наконец-то долгожданный третий выпуск журнала.
</p>
</p><p>Тем, кто ехидничал по поводу задержки на форуме, объясняю: ориентировочно - значит срок, который я запланировал для выхода журнала. По разным причинам он может меняться. Я обещал, что следующий выпуск журнала выйдет и все, что прислано будет опубликовано. И я держу слово. Если Вы думаете, что кроме журнала у меня нет других (в том числе срочных и неотложных) дел, то Вы ошибаетесь. Я трачу на журнал по нескольку десятков часов в месяц, хотя и не получаю за это ни копейки, потому что мне это интересно. Соответственно, когда я хочу отдохнуть или заняться чем-нибудь еще, то не буду напрягаться и заставлять себя сидеть за статьей. Игроделы (многие из которых склонны не доводить свои проекты до конца) меня поймут. К тому же, я не люблю переносить незаконченные статьи на следующий выпуск.
</p><p>Взгляните - третий выпуск вдвое больше первого - объем возрастает. Этот номер перенасыщен сложными алгоритмами и масштабными статьями (все наработанное раньше почти полностью использовано, новые разработки для статей начинаются практически с нуля).
</p><p>Есть еще одно мнение - что-де скоро журнал заглохнет. Хотя, думаю, теперь вряд ли будут верить моим прогнозам, однако скажу: пока будет материал для публикации, будет и журнал. Большинству на форуме, конечно, больше нравится просто читать, но я рад тому, что все больше людей втягиваются в процесс создания выпуска журнала и вкладывают свои силы в подготовку материала. Спасибо им.
</p><p>В этом выпуске - новая статья Романа Прядко в Свободном полете, переводы Михаила Солодовниченко, который продолжает делиться опытом в освоении BlitzMax (один из них - в приложении, полезный учебник), предоставленная Святославом статья про 3DS Max, Morpher прислал огромный перевод статьи про алгоритм поиска кратчайшего пути, поэтапная разработка чата от TankSoft. Я написал статьи о своих разработках в области двумерной и трехмерной графики, а также оригинальном алгоритме реализации игры "Жизнь" на бесконечном поле. Кроме того, у Вас появилась возможность проверить свои способности дизайнера и программиста - смотрите раздел "Конкурс!". В сегодняшней "Галерее" - стратегии от Microprose, а откроет журнал краткий обзор сайтов, посвященных Blitz. 
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Почта (выпуск 3)"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Почта (выпуск 3)&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Почта (выпуск 3)&amp;action=edit">править</a>]</span><span class="mw-headline">Почта (выпуск 3)</span></h1>
</p>
<a name=".D0.9F.D0.B8.D1.81.D1.8C.D0.BC.D0.BE_.D0.BE.D1.82_Luxary"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9F%D0%BE%D1%87%D1%82%D0%B0_%28%D0%B2%D1%8B%D0%BF%D1%83%D1%81%D0%BA_3%29&amp;action=edit&amp;section=1" title="Почта (выпуск 3)">править</a>]</span> <span class="mw-headline">Письмо от Luxary</span></h2>
<p>Добрых суток.
</p><p>Сегодня читая какую то фидошную эху, наткнулся на сабж Blitz (если я не путаю). Заинтересовался, сейчас  качаю его. Но песня совсем не о том... Найдя в инете ваше творение снова согласился с собою, что "опять двадцать пять". Так надоели вечные телепередачи  в стиле "Как научится работать на компьютере". И обещают выходить долго и постояно. Ну с натяжкой по работают месяца два и пока. Хм и долго вы будете учить обьяснять, что "это так, а вовсе не так как кажется"? Вот для этого и сделайте PDF (а еще лучше CHM) книжку которая будет выходить как приложение к журналу. Будет документация в чистом виде. А в журнале должны быть хитрости, советы (не более 15%), обзор редакторов, плагинов и пр, интересных возможностей перечисленых (около 50%). Новости Blitz (и все что около). Ну и "Свободный полет". Добустим ваш обзор игр (№1) - здорово. Можно получить хоть какое то представление о возможностях языка. Много ли нужно номеров журнала что бы расказать основы Blitzа?
</p><p>Ну для примера, журнал о компьютерах. О чем там пишут? О том что телевизор называется монитором? Или что системный блок это не то откуда лезет бумага, бумага лезет из принтера? Нет там делают обзор материнских плат, клавиатурных тренажеров, програм тестирования железа. Для чего вам потом постепенно переходить к этому (правда постепенно не выдет).
</p><p>Ну или совсем ультрированый пример. Если бы ваш журнал был посвящен нейрохуриргии и назывался "Blitz Et Тромб", представляю первые строки раздела "Хирургирование" (оно же "Программирование") "Берем скальпель в правую руку, обратите внимание что лезвие смотрит вниз (меры безопасноти, а то и ассистента можно порезать), орем вовсе горло "Та-а-а-ампо-о-о-онннн!" и акуратно режете лоб (живот, ухо) пациенту."
</p><p>Помне уж лучше если бы писали о новых метадах лечения, советы бывалых (трусов и балбесов),
<p>о новых препаратах и о новом оборудовании для диагностики.
</p>
</p><p>Надеюсь я доступно выразил мысль. Это просто пожелание, ибо если задуматся какая еще может быть нагрузка у журнала посвещеному Blitz?  Есесно все написаное мною весьма относительно, вы редактор вам решать. Просто потом интерес к журналу пропадет. Кому через пару месяцев нужно будет знать следущее "А сегодня мы поговорим о коментариях. точка с запятой означает...."? Все скажут "А эт мы уже прошли позавчера ночью, не интересно!"
</p><p>Большое спасибо за "Игра "Жизнь" (№1). Очень интересно и познавательно. Ну все большое спасибо за внимание. Очень надеюсь что ваш журнал будет очень интересен. Творческих удач!
</p><p>Удачи!<br />
</p>
<p><dl><dd>Luxary (Luxary@mail.ru)
</dd></dl>
</p>
<p>P.S. Теперь начну читать выпуск №2.
</p>
<hr />
<p>Здравствуйте
</p>
<p><dl><dt>Надеюсь я доступно выразил мысль.
</dt></dl>
</p>
<p>Пожалуй, не совсем. Абстрагирование и сарказм, это, конечно, красиво при умелом использовании, но если делать из этого винегрет, причем не всегда по сути, то ничего не понятно. И, хотелось бы, более конкретно, я понял впечатление от первого взгляда на журнал, но не понял, в чем состоит большая часть пожеланий.
</p>
<p><dl><dt>А в журнале должны быть хитрости, советы (не более 15%), обзор редакторов, плагинов и пр, интересных возможностей перечисленых (около 50%). Новости Blitz (и все что около). Ну и "Свободный полет".
</dt></dl>
</p>
<p>Хитростей и советов вполне достаточно (некоторые статьи, собственно, этому и посвящены), а новости-обзоры писать нет желающих (и у меня особого желания тоже нет), к тому же, для этого нужно перепахать солидный объем информации и, само собой, ее искать. На все это требуется много времени. Поэтому, что будет - то будет.
</p>
<p><dl><dt>Добустим ваш обзор игр (№1) - здорово. Можно получить хоть какое то представление о возможностях языка. Много ли нужно номеров журнала что бы расказать основы Blitzа?
</dt></dl>
</p>
<p>Основы очень подробно разжеваны в приложениях, да журнал на них и не базируется.
</p><p>Как я понял, Вы сетуете на "несвежесть" материала и излишнюю подробность объяснения. Ну, во-первых, большинство разработок - авторские и нигде более не публиковались. Естественно, подобные вещи уже могли где-то встречаться, но ценность изобретения даже чего-то уже существующего в том, что оно разработано несколько иным путем, содержит в себе дополнительные возможности, особенности и идеи. Кроме создания поля для публикации новых разработок, в цели журнала также входит сбор всех имеющихся переводов и русскоязычных материалов по Blitz. Во-вторых, чем подробнее объяснение (а объясняются именно алгоритмы), тем материал доступнее для понимания. Многие из читателей еще учатся в школе, большинство не изучало высшую математику, поэтому
<p>подробное разъяснение алгоритмов необходимо. Цель статей - объяснить принцип, а не просто дать готовый код для экспериментов. В третьих, журнал открыт для статей любого типа, кроме откровенного флуда. Такая политика, на мой взгляд, наиболее приемлема для свободного, некоммерческого издания. Кроме того, журнал содержит как уже обкатанные элементы, так и нововведения.
</p>
</p><p>Признаюсь, Ваше письмо дало мне пищу для размышлений. Что-ж, спасибо!
</p><p>Успехов.
</p>
<p><dl><dd>Матвей Меркулов
</dd></dl>
</p>
<p></td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Blitz-сайты"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Blitz-сайты&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Blitz-сайты&amp;action=edit">править</a>]</span><span class="mw-headline">Blitz-сайты</span></h1>
</p>
<a name=".D0.9E.D1.81.D0.BD.D0.BE.D0.B2.D0.BD.D1.8B.D0.B5_.D1.81.D0.B0.D0.B9.D1.82.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Blitz-%D1%81%D0%B0%D0%B9%D1%82%D1%8B&amp;action=edit&amp;section=1" title="Blitz-сайты">править</a>]</span> <span class="mw-headline">Основные сайты</span></h2>
<ul><li><a href="http://www.blitzbasic.com/" class="external text" title="http://www.blitzbasic.com" rel="nofollow">Сайт разработчика языков семейства Blitz</a> - главный Blitz-сайт - центр, где многие опытные Blitz-программисты анонсируют свои работы. Здесь можно узнать новости мира Blitz и подписаться на их рассылку, купить электронные версии Blitz3D, BlitzPlus, BlitzMax, а также утилиты Maplet (создание уровней) и скачать их демоверсии. Еще есть форум с большим количеством посетителей, где ответят на любые вопросы, правда нужно знать английский.
</li><li><a href="http://playerfactory.proboards25.com/" class="external text" title="http://playerfactory.proboards25.com/" rel="nofollow">Blitz Tools Forums</a> - здесь можно скачать наиболее популярные библиотеки для Blitz и найти ответы на вопросы по их использованию.
</li><li><a href="http://blitzgames.vov.ru/cgi-bin/YaBB/YaBB.cgi" class="external text" title="http://blitzgames.vov.ru/cgi-bin/YaBB/YaBB.cgi" rel="nofollow">Русскоязычный форум</a> - главное место общения русскоязычных Blitz-программистов. Здесь отвечают на вопросы, делятся опытом, публикуют разработки, анонсируют программы, просто беседуют. 
</li><li><a href="http://blitz.pp.ru/" class="external text" title="http://blitz.pp.ru" rel="nofollow">blitz.pp.ru</a> - тут можно найти Blitz3D одну из последних версий, BlitzPlus, редакторы: MilkShape (разные модели), CharacterFX (модели персонажей), LithUnwrap (текстуры), оболочка Protean IDE и создатель инсталляторов
</li><li><a href="http://progs.pp.ru/" class="external text" title="http://progs.pp.ru" rel="nofollow">Progs' lair</a> - еще TreeMagik для редактирования деревьев и оболочка VisualBlitz (сам ей, кстати, пользуюсь - очень удобно).
</li></ul>
<p><br />
</p>
<a name=".D0.A1.D0.B0.D0.B9.D1.82.D1.8B_.D1.80.D1.83.D1.81.D1.81.D0.BA.D0.B8.D1.85_.D1.80.D0.B0.D0.B7.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D1.87.D0.B8.D0.BA.D0.BE.D0.B2"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Blitz-%D1%81%D0%B0%D0%B9%D1%82%D1%8B&amp;action=edit&amp;section=2" title="Blitz-сайты">править</a>]</span> <span class="mw-headline">Сайты русских разработчиков</span></h2>
<ul><li><a href="http://www.argames.narod.ru/" class="external text" title="http://www.argames.narod.ru/" rel="nofollow">Another Reality</a> - трехмерные и двумерные битвы на одном компьютере "Deathmatch", трехмерный римейк Battle City, космическая аркада "Space Patrol", утилиты
</li><li><a href="http://www.artfrost.nm.ru/" class="external text" title="http://www.artfrost.nm.ru/" rel="nofollow">Arfrost</a> - двумерная аркада-головоломка "Robo3D" в трехмерном исполнении
</li><li><a href="http://www.flamerites.com/" class="external text" title="http://www.flamerites.com/" rel="nofollow">Flame Rites</a> - римейк Battle City "Tanks Evo"
</li><li><a href="http://www.yourline.ru/~gamemaster/" class="external text" title="http://www.yourline.ru/~gamemaster/" rel="nofollow">Gamemaster</a> - римейки спектрумовских игр, 3D версия Pac-Man, аркада - головоломка "Roads of Fantasy"
</li><li><a href="http://gamems.narod.ru/" class="external text" title="http://gamems.narod.ru/" rel="nofollow">GMS</a> - вертикальный космический боевик, двумерная аркада - вертолетный бой
</li><li><a href="http://www.pluton3d.narod.ru/" class="external text" title="http://www.pluton3d.narod.ru/" rel="nofollow">Pluton 3D</a> - разработка Action / RPG "Игры времени" и "Агония смерти"
</li><li><a href="http://sector-17.narod.ru/" class="external text" title="http://sector-17.narod.ru/" rel="nofollow">Sector-17</a> - тир "Му-му", головоломка "Зона", тетрис, космические гонки "Среди звезд", танковая аркада "Фантом", летный имитатор "Когти дракона", демонстрационные программы
</li><li><a href="http://skazochnik-gamemaker.narod.ru/" class="external text" title="http://skazochnik-gamemaker.narod.ru/" rel="nofollow">Skazochnik</a> - несколько мини-игр и "Черный Ети" - Postal по-русски
</li><li><a href="http://www.swargo.com/" class="external text" title="http://www.swargo.com/" rel="nofollow">Swargo Studio</a> - имитатор подводной лодки, тетрис
</li><li><a href="http://unblitz.narod.ru/" class="external text" title="http://unblitz.narod.ru/" rel="nofollow">Unholy Champions</a> - имитатор катапульты, арканоид, тир (сайт больше не обновляется)
</li><li><a href="http://whitegames.narod.ru/" class="external text" title="http://whitegames.narod.ru/" rel="nofollow">White</a> - римейк Lode Runner, Topplerа, минера, игра про мяч
</li><li><a href="http://www.freewebs.com/kefir/" class="external text" title="http://www.freewebs.com/kefir/" rel="nofollow">Сайт Павла Меренкова</a> - трехмерный редактор "XWorld", реализация алгоритма нахождения пути, утилиты
</li><li><a href="http://forcing.dezigner.ru/" class="external text" title="http://forcing.dezigner.ru/" rel="nofollow">Форсаж</a> - гоночный имитатор
</li><li><a href="http://polynetix.com/" class="external text" title="http://polynetix.com" rel="nofollow">Polynetix Studio</a> - скринсейверы, игры, разработка дизайна сайта
</li></ul>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Галерея: стратегии от MicroProse"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Галерея: стратегии от MicroProse&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Галерея: стратегии от MicroProse&amp;action=edit">править</a>]</span><span class="mw-headline">Галерея: стратегии от MicroProse</span></h1>
<p>Фирма Microprose не нуждается в рекламе и уже завоевала целую главу в истории компьютерных игр. Она была куплена малоизвестной, но богатой Spectrum Holobyte в 1993 году и специализируется на стратегиях и авиасимуляторах. Конечно, у фирмы имеются разработки и в других жанрах, но всемирное признание она получила все-таки благодаря своим оригинальным стратегиям. О них и пойдет речь в этой статье.
</p>
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose01.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose01.jpg" src="vfa18mk2.jpg" width="318" height="66" /></a></span></div></div>
<p>В конце 80-х Сид Мейер и Брюс Шелли решили сделать компьютерный вариант малоизвестной настольной игры "Цивилизация". Правила были расширены, благодаря открывшимся компьютерным возможностям, включились в работу художники и композитор и в 1990г игра вышла в свет. Успех был огромен, игра разошлась гигантским тиражом. Суть ее заключается в том, что Вы принимаете на себя управление одной из цивилизаций с момента ее образования. Вы будете заниматься разведкой, строить города, улучшать их, обрабатывать прилегающую к ним землю, проводить дороги, развивать науку и строить глобальные сооружения, оказывающие влияние на всю цивилизацию в целом - чудеса света. В какой-то момент Вы столкнетесь с другой цивилизацией и Вам решать - заключать ли с ней мир или воевать, отправлять ли к ней торговые караваны или совершать диверсии в городах. Можно завершить игру не только уничтожив или поработив войсковыми армадами другие народы, но и просто построить космический корабль и первым совершить межзвездный перелет.
</p>
<center>
<p><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose02.jpg" class="image" title="Изображение:Microprose02.jpg"><img alt="Изображение:Microprose02.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose02.jpg" src="376nj6en.jpg" width="320" height="200" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose03.jpg" class="image" title="Изображение:Microprose03.jpg"><img alt="Изображение:Microprose03.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose03.jpg" src="8j42bn7x.jpg" width="320" height="200" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose04.jpg" class="image" title="Изображение:Microprose04.jpg"><img alt="Изображение:Microprose04.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose04.jpg" src="e-zoz72u.jpg" width="320" height="200" /></a>
</p>
</center>
<p>Игра очень продвинута в плане исторического соответствия. Можно узнать о событиях, при которых было совершено открытие, построено чудо света, что они из себя представляют и какие блага приносят. Сотни тысяч людей проводили дни за компьютерами, забывая обо всем, кроме Цивилизации. Конечно, такой успешный проект не остался без продолжений - вышли 2 и 3 части, а также Alpha Centauri - развитие событий после прибытия космического корабля на Альфу Центавра, все уже в изометрической проекции.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose05.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose05.jpg" src="86_cj7e5.jpg" width="320" height="200" /></a></span></div></div>
<p>Логическим продолжением идеи (но в совсем иной реализации) выступила игра Колонизация. По сравнению с Цивилизацией, она прошла в общем-то незаметно, но по играбельности почти не уступает ей. Вы вступаете в игру в роли одной из первых экспедиций колонизаторов, плывущих через океан для освоения Нового Света. После высадки на берег нужно будет строить и развивать города, планировать отношения с родным государством, устраивать прибывающих колонистов. Неизбежны встречи с индейцами - можно установить с ними добрососедские отношения и устраивать "религиозное просвещение", а можно пройтись по континенту, грабя и уничтожая поселения. Но самое интересное начинается, когда Вы встречаете конкурирующих колонизаторов - жить в мире, скорее всего, не получится, поэтому готовьтесь к войне на суше и море (можно анонимно заниматься пиратством). А главная цель - объявить независимость и выдержать натиск колониального флота, который поплывет "восстанавливать порядок". Немного раздражает некоторая "мультяшность" графики.
</p>
<center>
<p><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose07.jpg" class="image" title="Изображение:Microprose07.jpg"><img alt="Изображение:Microprose07.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose07.jpg" src="j_3dzi1a.jpg" width="320" height="200" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose08.jpg" class="image" title="Изображение:Microprose08.jpg"><img alt="Изображение:Microprose08.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose08.jpg" src="61_kzgam.jpg" width="320" height="200" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose09.jpg" class="image" title="Изображение:Microprose09.jpg"><img alt="Изображение:Microprose09.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose09.jpg" src="jml3r0h3.jpg" width="320" height="200" /></a>
</p>
</center>
<p>Следующая культовая разработка Microprose называется UFO: Enemy Unknown и в ней Вы командуете силами, борющимися с угрозой вторжения инопланетян на Землю. Большую часть времени Вы будете сражаться с инопланетянами на земле и в воздухе. Каждый наземный бой - маленькая походовая стратегия с случайно генерируемой местностью, которую нужно исследовать. Это может быть штурм подбитого или просто приземлившегося корабля, штурм вражеской базы или защита своей, борьба с террористами. Масса оружия (включая психотропное), разные виды инопланетян и брони, повышение характеристик солдат - в итоге большое количество разнообразных стратегий. Но есть и еще один главный аспект - строительство баз, научные открытия, исследования инопланетных артефактов, допрос пленных инопланетян, торговые операции, производство оружия и летательных аппаратов, наем персонала. И так же, как в Цивилизации здесь есть подробная иллюстрированная энциклопедия по каждому аспекту игры. У нее также были продолжения - UFO 2: Terror from the Deep (по сути - косметическая обработка первой части) и UFO 3: Apocalypse - уже в высоком разрешении.
</p>
<center>
<p><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose10.jpg" class="image" title="Изображение:Microprose10.jpg"><img alt="Изображение:Microprose10.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose10.jpg" src="5ie5a0rn.jpg" width="320" height="200" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose11.jpg" class="image" title="Изображение:Microprose11.jpg"><img alt="Изображение:Microprose11.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose11.jpg" src="ribd0uva.jpg" width="320" height="200" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose12.jpg" class="image" title="Изображение:Microprose12.jpg"><img alt="Изображение:Microprose12.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose12.jpg" src="pjx_q1se.jpg" width="320" height="200" /></a>
</p>
</center>
<p>Кто не знаком с карточной игрой Magic: The Gathering - рекомендую. Очень увлекательная, непредсказуемая и вместе с тем довольно простая игра, где есть над чем напрячь мозги. Какое отношение она имеет к Microprose? Дело в том, что она выпустила игру, совмещающую карточные бои с ролевой системой. Вообще, это, пожалуй, лучшая из компьютерной реализаций MtG.
</p><p>Крис Сойер разработал продолжение EGA-игры RailRoad Tycoon жанра менеджмент - Transport Tycoon. Лубочная детальная и разнообразная графика в высоком разрешении отображает карту с городами и предприятиями в изометрической проекции. Здесь будут проложены дороги, построены станции, аэропорта, депо и автобусные остановки. Разные графики и диаграммы помогут решить, что и куда везти, какие поезда строить. В общем, под спокойный ход игры, особенно с хорошим музыкальным сопровождением - джазовыми композициями, можно расслабиться и хорошо отдохнуть.
</p>
<center>
<p><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose13.jpg" class="image" title="Изображение:Microprose13.jpg"><img alt="Изображение:Microprose13.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose13.jpg" src="-dwzr0sv.jpg" width="320" height="200" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose14.jpg" class="image" title="Изображение:Microprose14.jpg"><img alt="Изображение:Microprose14.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose14.jpg" src="yx_kjho9.jpg" width="320" height="200" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose15.jpg" class="image" title="Изображение:Microprose15.jpg"><img alt="Изображение:Microprose15.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose15.jpg" src="-vgld8st.jpg" width="320" height="200" /></a>
</p>
</center>
<p>Master of Orion - космическая стратегия: освоение планет, космические бои, футуристические технологии. Здесь Вы уже управляете целой расой, которая должна захватить контроль над галактикой. Развитие науки, экономики, распределение ресурсов и гонка вооружений - все это должно быть сбалансировано для эффективного развития, экспансии и защиты своих планет. Помните, что главное - созвездие Орион, где лежат сокровища древней сверхразвитой цивилизации.
</p>
<center>
<p><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose16.jpg" class="image" title="Изображение:Microprose16.jpg"><img alt="Изображение:Microprose16.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose16.jpg" src="oojgjhzb.jpg" width="320" height="200" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose17.jpg" class="image" title="Изображение:Microprose17.jpg"><img alt="Изображение:Microprose17.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose17.jpg" src="1lgtd83l.jpg" width="320" height="200" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose18.jpg" class="image" title="Изображение:Microprose18.jpg"><img alt="Изображение:Microprose18.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose18.jpg" src="o6t46pzz.jpg" width="320" height="200" /></a>
</p>
</center>
<p>Master of Magic сочетает в себе стратегическое планирование развития городов, как в Цивилизации, пошаговые бои а-ля UFO и целую энциклопедию магических заклинаний. В сочетании все это дает коктейль, в котором не так-то просто разобраться. Вообще, стратегии Microprose этим и отличаются - сначала игрока отталкивает обилие возможностей и необходимость изучать правила, но после его обычно за уши от игры не оттянешь. Вселенная Master Of Magic включает в себя два мира - реальный и трансцендентный, в которых живут несколько рас, каждая со своими особенностями. Вы - могущественный маг и можете выбрать свою специализацию и направление развития. Масса ресурсов, возможность дипломатии, нетривиальная система боя - все это способно надолго занять играющего, у которого достаточно терпения.
</p>
<center>
<p><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose19.jpg" class="image" title="Изображение:Microprose19.jpg"><img alt="Изображение:Microprose19.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose19.jpg" src="j47pc8hq.jpg" width="320" height="200" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose20.jpg" class="image" title="Изображение:Microprose20.jpg"><img alt="Изображение:Microprose20.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose20.jpg" src="yti_qbye.jpg" width="320" height="200" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose21.jpg" class="image" title="Изображение:Microprose21.jpg"><img alt="Изображение:Microprose21.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Microprose21.jpg" src="1schzul8.jpg" width="320" height="200" /></a>
</p>
</center>
<p>Была еще старая многими проигнорированная Covert Action про шпионов. Те, кто разобрались в ней, говорят, что в нее очень интересно играть. У Microprose есть еще несколько стратегий, в которые я не играл. Тем, кто решил написать свою походовую стратегию (именно свою, а не клон), рекомендую ознакомиться с творениями этой фирмы - хорошая отправная точка для создания собственной концепции.
</p>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Переход на BlitzMax с Blitz3D: Синтаксис"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Переход на BlitzMax с Blitz3D: Синтаксис&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Переход на BlitzMax с Blitz3D: Синтаксис&amp;action=edit">править</a>]</span><span class="mw-headline">Переход на BlitzMax с Blitz3D: Синтаксис</span></h1>
<p>Тут описаны некоторые изменения в синтаксисе, которыми придется пользоваться.
</p>
</p>
<a name="Graphics"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9F%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4_%D0%BD%D0%B0_BlitzMax_%D1%81_Blitz3D:_%D0%A1%D0%B8%D0%BD%D1%82%D0%B0%D0%BA%D1%81%D0%B8%D1%81&amp;action=edit&amp;section=1" title="Переход на BlitzMax с Blitz3D: Синтаксис">править</a>]</span> <span class="mw-headline">Graphics</span></h2>
<p>У функции Graphics теперь новые параметры: ширина, высота, глубина цвета и частота обновления.
</p><p>Если ты портируешь код Blitz3D, в котором используется последний параметр "режима окна", то ты увидишь, что твоя прога жутко тормозит. Это происходит потому, что BlitzMax по умолчанию ставит частоту обновления игры равной частоте обновления экрана. Если ты поставил последнее значения Graphics равным 1,2 или 3, то прога будет обновляться с частотой 1, 2 или 3 Гц соответственно! Просто убери последний параметр.
</p>
<a name=".D0.9A.D0.B0.D1.80.D1.82.D0.B8.D0.BD.D0.BA.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9F%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4_%D0%BD%D0%B0_BlitzMax_%D1%81_Blitz3D:_%D0%A1%D0%B8%D0%BD%D1%82%D0%B0%D0%BA%D1%81%D0%B8%D1%81&amp;action=edit&amp;section=2" title="Переход на BlitzMax с Blitz3D: Синтаксис">править</a>]</span> <span class="mw-headline">Картинки</span></h2>
<p>Так как 2D движок BlitzMax (Max2D) теперь рендит картинки с использованием OpenGL (ускоряя рисование аппаратно), то теперь возможно выполнение таких операций как масштабирование, поворот и альфа блендинг (т.е. делать их прозрачными) в реальном времени. 
</p><p>В отличии от предыдущих версий Blitz степень поворота, масштабирования и прозрачности ставиться не индивидуально для отдельной картинки, а сразу для всех; теперь вызываются функции SetRotation, SetScale и SetAlpha, использование которых приведет к изменению параметров рисования всех картинок.
</p><p>Это значит, что если ты, например, вызовешь SetScale 0.5, 0.5, то все картинки будут рисоваться в половину от своих реальных ширины и высоты, пока ты не восстановишь нормальное масштабирование командой SetScale 1, 1, и также значит, что тебе придется звать эти функции перед рисованием отдельных картинок, если нужно нарисовать их с другими значениями. Так рисование происходит очень быстро.
</p><p>SetColor делает картинки "подкрашенными". Значения красного, зеленого и синего меняются в зависимомости от значений красного, зеленого и синего, определеных функцией SetColor, таким образом, 255, 255, 255 дают 100% значений красного, зеленого и синего каждого пикселя картинки, картинка нарисуется как обычно; SetColor 127, 127, 127 даст 50% каждого значения, эффективно делая картинку наполовину темнее, SetColor 0, 255, 255 уберет красную составляющую цвета всех пикселей картинки и, наконец, SetColor 255, 0, 0 оставит только красную состовляющую цвета, эффективно подкрашивая картинку красным.
</p><p>Если ты звал SetColor с параметрами, не равными 255, 255, 255 и хочешь, чтобы всё рисовалось как обычно, то пиши SetColor 255, 255, 255. Ты, вероятно, заметишь это, когда твои картинки вдруг замигают разными цветами!
</p>
<a name="KeyDown_.2F_KeyHit"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9F%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4_%D0%BD%D0%B0_BlitzMax_%D1%81_Blitz3D:_%D0%A1%D0%B8%D0%BD%D1%82%D0%B0%D0%BA%D1%81%D0%B8%D1%81&amp;action=edit&amp;section=3" title="Переход на BlitzMax с Blitz3D: Синтаксис">править</a>]</span> <span class="mw-headline">KeyDown / KeyHit</span></h2>
<p>BlitzMax, в отличии от предыдущих Blitz-ов, имеет набор констант, содержащих коды клавиш. Смотри секцию Key Codes в доках (под Module Reference), чтобы их узнать. Конкретно говоря, если использовать обычную "Repeat [... ] Until KeyHit (1)", чтобы отследить нажатие на Esc, поменяй его на "Repeat [... ] Until KeyHit (KEY_ESCAPE)". 1 теперь относится к левой лапе мыши, так что не думай, что у тебя сломался Esc...
</p>
<a name=".D0.A1.D0.BF.D0.B8.D1.81.D0.BA.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9F%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4_%D0%BD%D0%B0_BlitzMax_%D1%81_Blitz3D:_%D0%A1%D0%B8%D0%BD%D1%82%D0%B0%D0%BA%D1%81%D0%B8%D1%81&amp;action=edit&amp;section=4" title="Переход на BlitzMax с Blitz3D: Синтаксис">править</a>]</span> <span class="mw-headline">Списки</span></h2>
<p>Blitz-овские "тип"-объекты раньше автоматически добавлялись к одному списку на тип. Теперь это не так. Так как BlitzMax позволяет использование нескольких списков на тип, то тебе необходимо создать список вручную. К счастью это легко:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">mylist:<span style="color: #ffff00; font-weight: bold;">TList</span> = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Заметь, что переменная списка mylist, была создана как внутренний BlitzMax-овский тип TList. Добовляются объекты к этому списку посредством функции ListAddLast (в примере ниже создается тип "Example "):
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">myobject:Example = <span style="color: #ffff00; font-weight: bold;">New</span> Example<br />
<span style="color: #ffff00; font-weight: bold;">ListAddLast</span> mylist, myobject</div>
<p>Вместо просмотра списка через For... Each, используй For... EachIn&nbsp;:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">For</span> e:Example = <span style="color: #ffff00; font-weight: bold;">EachIn</span> mylist<br />
<p>&nbsp;<span style="color: #ffff00; font-weight: bold;">Print</span> e.<span style="">blah</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">Next</span></div>
<a name=".D0.A1.D0.B8.D0.BD.D1.82.D0.B0.D0.BA.D1.81.D0.B8.D1.81"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9F%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4_%D0%BD%D0%B0_BlitzMax_%D1%81_Blitz3D:_%D0%A1%D0%B8%D0%BD%D1%82%D0%B0%D0%BA%D1%81%D0%B8%D1%81&amp;action=edit&amp;section=5" title="Переход на BlitzMax с Blitz3D: Синтаксис">править</a>]</span> <span class="mw-headline">Синтаксис</span></h2>
<p>Переменные типов теперь декларируются с использованием символа ":" вместо старого ".":
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #B1E7EB;">' Старая версия:</span><br />
<p>p.<span style="">Player</span> = <span style="color: #ffff00; font-weight: bold;">New</span> Player<br />
<br />
<span style="color: #B1E7EB;">' Новая версия:</span><br />
</p>
p:Player = <span style="color: #ffff00; font-weight: bold;">New</span> Player</div>
<p>Доступ к полям типов теперь осуществляется за счет символа "." вместо старого "\"&nbsp;: 
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> Oink<br />
<p>&nbsp;<span style="color: #ffff00; font-weight: bold;">Field</span> x<br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span><br />
<br />
o:Oink = <span style="color: #ffff00; font-weight: bold;">New</span> Oink<br />
o.<span style="">x</span> = <span style="color: #FFFFFF;">1</span><br />
<br />
</p>
<span style="color: #ffff00; font-weight: bold;">Print</span> o.<span style="">x</span></div>
<p>Основные типы переменных используют те же определители, что и раньше, с добавлением "!" для чисел с плавающей точкой двойной точности (64-bit, double-precision floating point variables); теперь можно использовать их имена, если так удобней:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #B1E7EB;">' Целые:</span><br />
<p><br />
i = <span style="color: #FFFFFF;">5</span> <span style="color: #B1E7EB;">' если нет определителя, то тип - целое число...</span><br />
i% = <span style="color: #FFFFFF;">5</span><br />
i:<span style="color: #ffff00; font-weight: bold;">Int</span> = <span style="color: #FFFFFF;">5</span><br />
<br />
<span style="color: #B1E7EB;">' С плавающей точкой:</span><br />
<br />
f# = <span style="color: #FFFFFF;">5.0</span> <span style="color: #B1E7EB;">' (Инфо для пользователей UK Mac: символ # получается нажатием Alt + 3!)</span><br />
f:<span style="color: #ffff00; font-weight: bold;">Float</span> = <span style="color: #FFFFFF;">5.0</span><br />
<br />
<span style="color: #B1E7EB;">' Строки:</span><br />
<br />
s$ = <span style="color: #00FF66;">&quot;Oink&quot;</span><br />
s:<span style="color: #ffff00; font-weight: bold;">String</span> = <span style="color: #00FF66;">&quot;Oink&quot;</span><br />
<br />
<span style="color: #B1E7EB;">' Байтовые:</span><br />
<br />
b:<span style="color: #ffff00; font-weight: bold;">Byte</span> = <span style="color: #FFFFFF;">1</span><br />
<br />
<span style="color: #B1E7EB;">' Shorts:</span><br />
<br />
s:<span style="color: #ffff00; font-weight: bold;">Short</span> = <span style="color: #FFFFFF;">10</span><br />
<br />
<span style="color: #B1E7EB;">' Doubles:</span><br />
<br />
d! = <span style="color: #FFFFFF;">10000</span><br />
</p>
d:<span style="color: #ffff00; font-weight: bold;">Double</span> = <span style="color: #FFFFFF;">10000</span></div>
<a name=".D0.9C.D0.B0.D1.80.D0.BA.D0.B5.D1.80.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9F%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4_%D0%BD%D0%B0_BlitzMax_%D1%81_Blitz3D:_%D0%A1%D0%B8%D0%BD%D1%82%D0%B0%D0%BA%D1%81%D0%B8%D1%81&amp;action=edit&amp;section=6" title="Переход на BlitzMax с Blitz3D: Синтаксис">править</a>]</span> <span class="mw-headline">Маркеры</span></h2>
<p>Маркеры теперь определяются использованием символа "#":
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">#mylabel<br />
<span style="color: #ffff00; font-weight: bold;">If</span> a = <span style="color: #FFFFFF;">1</span> <span style="color: #ffff00; font-weight: bold;">Then</span> <span style="color: #ffff00; font-weight: bold;">Goto</span> mylabel</div>
<a name="Data"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9F%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4_%D0%BD%D0%B0_BlitzMax_%D1%81_Blitz3D:_%D0%A1%D0%B8%D0%BD%D1%82%D0%B0%D0%BA%D1%81%D0%B8%D1%81&amp;action=edit&amp;section=7" title="Переход на BlitzMax с Blitz3D: Синтаксис">править</a>]</span> <span class="mw-headline">Data</span></h2>
<p>Секции Data теперь доступны посредством DefData, RestoreData и ReadData . Вот как это делается:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">RestoreData</span> mydata<br />
<p><br />
<span style="color: #ffff00; font-weight: bold;">For</span> a = <span style="color: #FFFFFF;">1</span> <span style="color: #ffff00; font-weight: bold;">To</span> <span style="color: #FFFFFF;">5</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">ReadData</span> info<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Print</span> info<br />
<span style="color: #ffff00; font-weight: bold;">Next</span><br />
<br />
</p>
<ol><li>mydata<br />
</li></ol>
<span style="color: #ffff00; font-weight: bold;">DefData</span> <span style="color: #FFFFFF;">2</span>, <span style="color: #FFFFFF;">4</span>, <span style="color: #FFFFFF;">6</span>, <span style="color: #FFFFFF;">8</span>, <span style="color: #FFFFFF;">10</span></div>
<a name="Flip_.D0.B8_FlushMem"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9F%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4_%D0%BD%D0%B0_BlitzMax_%D1%81_Blitz3D:_%D0%A1%D0%B8%D0%BD%D1%82%D0%B0%D0%BA%D1%81%D0%B8%D1%81&amp;action=edit&amp;section=8" title="Переход на BlitzMax с Blitz3D: Синтаксис">править</a>]</span> <span class="mw-headline">Flip и FlushMem</span></h2>
<p>ЭТО ВАЖНО: нужно звать FlushMem хотя бы в главном цикле! Просто поменяй все...
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Flip</span></div>
<p>... на...
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">FlushMem; <span style="color: #ffff00; font-weight: bold;">Flip</span></div>
<p>Если не вызывать FlushMem, то прога будет тормозить или даже вылетит, т.к. память резервируется, но не освобождается.
</p><p>Стоит рассказать про FlushMem поподробней. FlushMem удалит все объекты, на которые ничто не ссылается (например, если ты создал объект Rocket через r:Rocket = New Rocket и, затем, поставил r:Rocket равным Null, т.к. он тебе больше не нужен).
</p><p>FlushMem удаляет только объекты, созданные в той-же области, в которой и вызывается FlushMem (область программы - это секция кода, такая как функция или главный цикл). Заметь, что удаляются также объекты, созданные в функциях, выполненных из той же области. Самое основное из всего этого - это то, что тебе нужно звать FlushMem только в главном цикле, но если твои функции тратят много времени на обработку циклом (особенно созданием / удалением объектов), то можно впихнуть FlushMem и в эти циклы тоже.
</p><p>Вот объяснение Марка про FlushMem, которое поможет тебе разобраться получше для чего нужен FlushMem:
<p><i>FlushMem удаляет все неиспользуемые объекты и временные резервации памяти (которые являются специальными объектами). Временные резервации памяти могут появляться по разным причинам, включая конкатенацию ("блин, а такое слово есть?... не знаю что это значит" - прим. пер.) строк, преобразование Blitz-овских строк в C-строки и т.д. Также, вызываемые тобой функции могут сами создавать временные объекты и т.п.</i>
</p>
</p><p>Так почему же не сделать это автоматическим?
</p><p><i>Это дает пользователю очень плотный контроль за происходящим, когда появляется "коллекция мусора". Я чувствую, что это лучшее решение для игр и бэкграундных прог, вместо полностью автоматического управления памятью, когда система сама придумывает - куда бы впихнуть FlushMem, что может привести к странным эффектам.</i>
</p><p>Используй MemAlloced (текущее резервирование памяти) и MemUsage (всё резервирование памяти с самого начала проги), чтобы узнать как используется память твоей прогой.
</p>
<hr />
<p>Перевод: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:MANIAK_dobrii" title="Участник:MANIAK dobrii">MANIAK dobrii</a> (e-mail: MANIAK_dobrii@list.ru, сайт: <a href="http://www.maniak-dobrii.nm.ru/" class="external free" title="http://www.maniak-dobrii.nm.ru/" rel="nofollow">http://www.maniak-dobrii.nm.ru/</a>)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Алгоритм A* для новичков"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Алгоритм A* для новичков&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Алгоритм A* для новичков&amp;action=edit">править</a>]</span><span class="mw-headline">Алгоритм A* для новичков</span></h1>
<p>Данная статья переведена на Испанский и Французский. Другие переводы приветствуются.
</p>
</p><p>Алгоритм A* (произносится как "А звездочка"), возможно, немного трудноват для новичков. И хотя в сети существует множество материалов, объясняющих A*, большинство из них написаны для людей, которые уже понимают основы. Эта же статья действительно написана для новичков. 
</p><p>Статья не пытается быть исчерпывающим материалом по данной теме. Вместо этого она описывает фундаментальные понятия и подготавливает вас к тому, чтобы прочитать все те материалы и понять о чем в них идет речь. Ссылки на некоторые из них прилагаются в конце статьи (под заголовком "Дальнейшее изучение").
</p><p>Также эта статья не направлена на определенный язык программирования - вы сможете адаптировать ее к любому из них. Как вы, должно быть, и ожидали, я добавил пример реализации в конце статьи.
</p><p>Но пора приступать к делу. Давайте начнем с самого начала...
</p>
<a name=".D0.92.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5:_.D0.9E.D0.B1.D0.BB.D0.B0.D1.81.D1.82.D1.8C_.D0.9F.D0.BE.D0.B8.D1.81.D0.BA.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_A%2A_%D0%B4%D0%BB%D1%8F_%D0%BD%D0%BE%D0%B2%D0%B8%D1%87%D0%BA%D0%BE%D0%B2&amp;action=edit&amp;section=1" title="Алгоритм A* для новичков">править</a>]</span> <span class="mw-headline">Введение: Область Поиска</span></h2>
<p>Давайте представим себе, что у нас есть кто-то, кто хочет попасть из точки А в точку B. Эти две точки разделены стеной. На иллюстрации ниже зеленый квадрат это стартовая точка A, красный квадрат - целевая точка B, а несколько синих квадратов - стена между ними.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:AStar01.jpg" class="image" title="Рис. 1"><img alt="Рис. 1" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:AStar01.jpg" src="mpnkixfi.jpg" width="362" height="256" /></a></span></div></div>
<p>Первое, на что вы должны обратить внимание, то, что мы разделили нашу область поиска на сетку с квадратными ячейками. Упрощение области поиска это первый шаг в поиске пути. Этот метод упрощает нашу область поиска до простого двумерного массива. Каждый элемент массива представляет одну из клеток сетки, а его значением будет проходимость этой клетки (проходима и непроходима). Для нахождения пути нам необходимо определить, какие нам нужны клетки для перемещения из точки A в точку B. Как только путь будет найден, наш путник начнет двигаться с центра одной клетки на центр следующей до тех пор, пока не достигнет целевой клетки. 
</p><p>Эти центральные точки называют "вершинами". Когда вы что-нибудь читаете про поиск пути, то часто можно столкнуться с обсуждением вершин. Почему бы просто не назвать их клетками? Потому что всегда возможно разделить вашу область поиска на что-то отличное от квадратов. Например, на прямоугольники, шестиугольники, треугольники, или любую другую фигуру. И вершины могут располагаться где угодно - в центре, вдоль граней или еще где-нибудь. Мы используем эту систему, поскольку она самая простая.
</p>
<a name=".D0.9D.D0.B0.D1.87.D0.B0.D0.BB.D0.BE_.D0.9F.D0.BE.D0.B8.D1.81.D0.BA.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_A%2A_%D0%B4%D0%BB%D1%8F_%D0%BD%D0%BE%D0%B2%D0%B8%D1%87%D0%BA%D0%BE%D0%B2&amp;action=edit&amp;section=2" title="Алгоритм A* для новичков">править</a>]</span> <span class="mw-headline">Начало Поиска</span></h2>
<p>Как только мы упростили нашу область поиска до некоторого числа вершин, нам нужно начать поиск для нахождения кратчайшего пути. Начнем с точки A, проверяя соседние клетки и двигаясь дальше до тех пор, пока не найдем целевую точку.
</p><p>Начинаем поиск пути, выполняя следующее:
</p>
<ul><li>Начинаем со стартовой точки A и добавляем ее в "открытый список" клеток, которые нужно обработать. Открытый список это что-то наподобие списка покупок. В данный момент есть только один элемент в списке, но позже мы добавим еще. Список содержит клетки, которые может быть находятся вдоль пути, который вы выберете, а может и нет. Проще говоря, это список клеток, которые нужно проверить. 
</li><li>Ищем доступные или проходимые клетки, граничащие со стартовой точкой, игнорируя клетки со стенами, водой или другой непроходимой областью. И также добавляем их в открытый список. Для каждой из этих клеток сохраняем точку A, как "родительскую клетку". Эта родительская клетка важна, когда мы будем прослеживать наш путь. Это будет описано намного позже. 
</li><li>Удаляем стартовую точку A с вашего открытого списка и добавляем ее в "закрытый список" клеток, которые вам больше не нужно проверять. 
</li></ul>
<p>Теперь у вас должно быть что-то похожее на следующую иллюстрацию. На этой иллюстрации темно-зеленый квадрат в центре - ваша стартовая точка. Она выделена голубым цветом для отображения того, что она находится в закрытом списке. Все соседние клетки в данный момент находятся в открытом списке. Они выделены светло-зеленым цветом. Каждая имеет серый указатель, направленный на родительскую клетку, которая в нашем случае является стартовой точкой. 
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:AStar02.jpg" class="image" title="Рис. 2"><img alt="Рис. 2" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:AStar02.jpg" src="xxsrtaeb.jpg" width="151" height="150" /></a></span></div></div>
<p>Дальше мы выберем одну из соседних клеток в открытом списке и практически повторим вышеописанный процесс. Но какую клетку мы выберем? Ту, у которой меньше стоимость F.
</p>
<a name=".D0.9E.D1.86.D0.B5.D0.BD.D0.BA.D0.B0_.D0.BF.D1.83.D1.82.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_A%2A_%D0%B4%D0%BB%D1%8F_%D0%BD%D0%BE%D0%B2%D0%B8%D1%87%D0%BA%D0%BE%D0%B2&amp;action=edit&amp;section=3" title="Алгоритм A* для новичков">править</a>]</span> <span class="mw-headline">Оценка пути</span></h2>
<p>Способом определения того, какую же клетку использовать, является следующие выражение:
</p>
<ul><li>F = G + H
</li></ul>
<p>где
</p>
<ul><li>G = стоимость передвижения из стартовой точки A к данной клетке, следуя найденному пути к этой клетке.
</li><li>H = примерная стоимость передвижения от данной клетки до целевой, то есть точки B. Она обычно является эвристической функцией. Причина, из-за которой она так называется, заключается в том, что это предположение. Мы действительно не узнаем длину пути, пока не найдем сам путь, потому что в процессе поиска нам может встретиться множество вещей (например, стены и вода). В этой статье вам предложили один способ вычислить H, но существует множество способов, которые можно найти в других статьях. 
</li></ul>
<p>Наш путь генерируется путем повторного прохода через открытый список и выбора клетки с наименьшей стоимостью F. Этот процесс будет описан в статье более подробно, но немного позже. Прежде всего, давайте внимательно рассмотрим вычисление стоимости F.
</p><p>Как описано выше, G является стоимостью передвижения со стартовой клетки до текущей, используя найденный к ней путь. В этом примере мы присвоим стоимость 10 к горизонтальным и вертикальным передвижениям, а к диагональным - 14. Мы используем эти числа потому, что пройденное по диагонали расстояние примерно в 1,414 раз (корень с 2) больше стоимости передвижения по горизонтали или вертикали. Для простоты мы используем 10 и 14. Соотношение соблюдается, и мы избегаем вычисления квадратных корней и десятичной дроби. Это не просто потому, что мы дураки и не любим математику. Использование целых чисел вроде этих, намного быстрее для компьютера. Как вы скоро узнаете, поиск пути может быть очень медленным, если вы не используете упрощения наподобие этих. 
</p><p>Так как мы вычисляем стоимость G вдоль пути к текущей точке, способ ее установить состоит в том, чтобы взять G родительской клетки и прибавить 10 или 14, в зависимости от диагонального или ортогонального (не диагонального) расположения текущей клетки относительно родительской клетки. Необходимость использования этого метода станет очевидной немного позже, когда мы отдалимся от стартовой точки более чем на одну клетку.
</p><p>Стоимость H может быть вычислена множеством способов. Метод, который мы используем, называется методом Манхеттена (Manhattan method), где вы считаете общее количество клеток, необходимых для достижения целевой точки от текущей, по горизонтали и вертикали, игнорируя диагональные перемещения и любые препятствия, которые могут оказаться на пути. Затем мы умножаем общее количество полученых клеток на 10.
</p><p>Читая это описание, вы, должно быть, решили, что эвристика - просто приблизительное определение оставшегося расстояния между текущей клеткой и целью по прямой. Но это не так. Мы пытаемся установить оставшееся расстояние вдоль пути (который обычно идет не по прямой), но алгоритм требует от нас не переоценить это расстояние, иначе он может найти не верный путь. Использованный здесь метод гарантирует предоставить нам правильный путь. Хотите узнать про эвристику больше? Вы найдете выражения и дополнительные сведенья здесь.
</p><p>Стоимость F вычисляется путем сложения стоимостей G и H. Результаты первого шага нашего поиска пути проиллюстрированы ниже. Значения F, G и H записаны в каждой клетке. Как видим по клетке справа от стартовой точки, F выводится в верхнем левом углу, G выводится в нижнем левом углу, а H выводится в нижнем правом углу. 
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:AStar03.jpg" class="image" title="Рис. 3"><img alt="Рис. 3" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:AStar03.jpg" src="76gvsb59.jpg" width="362" height="255" /></a></span></div></div>
<p>Давайте посмотрим на некоторые из этих клеток. В клетке с буквами G = 10. Это потому, что она находится на расстоянии в одну клетку от стартовой точки, при том по горизонтали. Также G = 10 у клеток прямо сверху, снизу и слева от стартовой точки. У диагональных клеток G = 14. 
</p><p>Стоимость H посчитана с помощью вычисления Манхэттенского расстояния к красной целевой клетке, двигаясь только по горизонтали и вертикали, игнорируя все стены на пути. У клетки, прямо справа от стартовой, расстояние до цели 3 клетки. Используя этот метод, видим, что H = 30. У клетки прямо над ней, расстояние уже 4 клетки (помните, что надо двигаться только по горизонтали и вертикали). И ее значение стоимости H будет равно 40. Вы, вероятно, можете догадаться, как вычисляются стоимости H для других клеток. 
</p><p>Стоимость F для каждой клетки вычисляется простым суммированием G и H.
</p>
<a name=".D0.9F.D1.80.D0.BE.D0.B4.D0.BE.D0.BB.D0.B6.D0.B0.D0.B5.D0.BC_.D0.BF.D0.BE.D0.B8.D1.81.D0.BA"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_A%2A_%D0%B4%D0%BB%D1%8F_%D0%BD%D0%BE%D0%B2%D0%B8%D1%87%D0%BA%D0%BE%D0%B2&amp;action=edit&amp;section=4" title="Алгоритм A* для новичков">править</a>]</span> <span class="mw-headline">Продолжаем поиск</span></h2>
<p>Для продолжения поиска мы просто выбираем клетку с наименьшей стоимостью F из всех клеток, находящихся в открытом списке. Затем с выбранной клеткой мы производим такие действия: 
</p>
<ul><li>Удаляем ее из открытого списка и добавляем в закрытый список.
</li><li>Проверяем все соседние клетки. Игнорируем те, которые находятся в закрытом списке или непроходимы (поверхность со стенами, водой), остальные добавляем в открытый список, если они там еще не находятся. Делаем выбранную клетку "родительской" для всех этих клеток.
</li><li>Если соседняя клетка уже находится в открытом списке, проверяем, а не короче ли путь по этой клетке? Иными словами, сравниваем значения стоимости G этих двух клеток. Если при использовании этой клетки стоимость G выше, чем при использовании текущей клетки, то не предпринимаем ничего.
</li></ul>
<p>Если же она ниже, то меняем "родителя" этой клетки на выбранную клетку. Затем вычисляем стоимости F и G этой клетки. Если это выглядит для вас немного запутанным, далее вы можете увидеть это на иллюстрации. 
</p><p>Хорошо, давайте посмотрим, как это работает. С наших начальных 9 клеток, осталось 8 в открытом списке, а стартовая клетка была внесена в закрытый список. Клетка с наименьшей стоимостью F находится прямо справа от стартовой клетки, и ее стоимость F = 40. Поэтому мы выбираем эту клетку как нашу следующую клетку. Она выделена голубым цветом на этой иллюстрации.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:AStar04.jpg" class="image" title="Рис. 4"><img alt="Рис. 4" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:AStar04.jpg" src="riwlxzxe.jpg" width="357" height="256" /></a></span></div></div>
<p>Сначала мы удаляем ее из открытого списка и добавляем в закрытый список (вот почему она выделена голубым цветом). Затем мы проверяем соседние клетки. Клетки, сразу справа от этой клетки - стены, поэтому мы их игнорируем. Клетка, прямо слева - стартовая клетка. Она находится в закрытом списке, поэтому мы ее тоже игнорируем. 
</p><p>Оставшиеся 4 клетки уже находятся в открытом списке, поэтому мы должны проверить, не короче ли пути по этим клеткам, используя текущую клетку. Сравнивать будем по стоимости G. Давайте посмотрим на клетку, прямо под нашей выбранной клеткой. Ее стоимость G равна 14. Если мы будем двигаться по этой клетке, стоимость G будет равна 20 (10, стоимость G чтобы добраться к текущей клетке плюс 10 для движения вертикально вверх, к соседней клетке). Стоимость G = 20 больше, чем G = 14, потому это будет не лучший путь. Это станет понятным, если взглянуть на диаграмму. Более целесообразным будет движение по диагонали на одну клетку, чем движение на одну клетку по горизонтали, а потом одну по вертикали. 
</p><p>Когда мы повторим этот процесс для всех 4-х соседних клеток, которые находятся в открытом списке, то узнаем, что ни один из путей не улучшится при движении по этим клеткам через выбранную, потому ничего не меняем. Теперь, когда мы осмотрели все соседние клетки, то закончили с текущей клеткой и готовы двигаться к следующей. 
</p><p>Теперь мы проходим весь открытый список, который уменьшился до 7-ми клеток, и выбираем клетку с наименьшей стоимостью F. Интересно, что в этом случае существует 2 клетки со стоимостью 54. Так какую мы выберем? Это не имеет никакого значения. В целях увеличения скорости поиска можно выбрать последнюю клетку, которую мы добавили в открытый список. Это предупредит поиск в выборе клеток, к которым можно будет обратиться позже, когда мы подберемся ближе к цели. Но в действительности это не так уж важно. (Вот почему две версии A* могут найти разные пути с одинаковой длиной.)
</p><p>Так что давайте выберем клетку, прямо внизу, справа от стартовой, как показано на рисунке.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:AStar05.jpg" class="image" title="Рис. 5"><img alt="Рис. 5" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:AStar05.jpg" src="ucoucatc.jpg" width="357" height="254" /></a></span></div></div>
<p>В этот раз, когда мы проверяем соседние клетки, видим, что клетка, прямо справа - стена и мы ее пропускаем. Так же поступаем и с клеткой, которая находится прямо над ней. Так же мы игнорируем клетку, которая находится прямо под ней. Почему? Потому, что вы не можете добраться до той клетки без среза угла ближайшей стены. Сначала вы должны спуститься вниз, а только потом двигаться на эту клетку. (Замечание: Это правило среза углов необязательно. Его использование зависит от расположения ваших вершин.)
</p><p>Остается еще 5 клеток. 2 клетки, находящиеся под текущей, еще не в открытом списке, потому мы их добавляем в открытый список и назначаем текущую клетку их "родителем". Из 3-х других клеток 2 уже находятся в закрытом списке (стартовая клетка и клетка, прямо над ней, на диаграмме обе подсвечены голубым цветом) и мы их игнорируем. Последняя клетка, которая находится прямо слева от текущей, проверяется на длину пути по текущей клетке через эту клетку по стоимости G. Нет, путь будет не короче. Так что мы здесь закончили и готовы проверить следующую клетку в открытом списке. 
</p><p>Повторяем этот процесс до тех пор, пока не добавим целевую клетку в открытый список. К этому времени у вас получится что-то похожее на иллюстрацию ниже.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:AStar06.jpg" class="image" title="Рис. 6"><img alt="Рис. 6" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:AStar06.jpg" src="i69l4h1l.jpg" width="404" height="307" /></a></span></div></div>
<p>Заметьте, что родительская клетка для клетки, находящейся в 2-х клетках под стартовой изменилась по сравнению с предыдущей иллюстрацией. Перед этим у нее стоимость G была равна 28 и указатель был направлен вверх и влево. Теперь стоимость G равна 20, а указатель направлен прямо вверх. Это произошло где-то в процессе нашего поиска, когда была проверена стоимость G и оказалось, что путь через эту клетку будет более коротким. Поэтому поменялась ее родительская клетка и были пересчитаны стоимости G и F. И хотя в этом примере это не кажется очень важным, существует множество ситуаций, когда такая проверка 
будет сильно влиять на выбор более короткого пути к цели.
</p><p>Так как же мы определим сам путь? Очень просто. Начнем с красной целевой клетки и будем двигаться назад с клетки на ее родителя, следуя указателям. Это доставит вас к стартовой клетке и это и будет ваш путь. Получится, как показано на иллюстрации ниже. Движение от стартовой точки A к целевой точке B будет просто передвижением от центра каждой клетки (вершины) к центру следующей клетки до тех пор, пока вы не достигните цели.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:AStar07.jpg" class="image" title="Рис. 7"><img alt="Рис. 7" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:AStar07.jpg" src="15edp543.jpg" width="411" height="308" /></a></span></div></div>
<a name=".D0.98.D1.82.D0.BE.D0.B3.D0.B8_.D0.BC.D0.B5.D1.82.D0.BE.D0.B4.D0.B0_A.2A"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_A%2A_%D0%B4%D0%BB%D1%8F_%D0%BD%D0%BE%D0%B2%D0%B8%D1%87%D0%BA%D0%BE%D0%B2&amp;action=edit&amp;section=5" title="Алгоритм A* для новичков">править</a>]</span> <span class="mw-headline">Итоги метода A*</span></h2>
<p>Хорошо, вы прошли все объяснение, давайте посмотрим на пошаговое представление этого метода: 
</p>
<ol><li>Добавляем стартовую клетку в открытый список.
</li><li>Повторяем следующее:
<ol><li>Ищем в открытом списке клетку с наименьшей стоимостью F. Делаем ее текущей клеткой.
</li><li>Помещаем ее в закрытый список. (И удаляем с открытого)
</li><li>Для каждой из соседних 8-ми клеток ...
<ul><li>Если клетка непроходимая или она находится в закрытом списке, игнорируем ее. В противном случае делаем следующее.
</li><li>Если клетка еще не в открытом списке, то добавляем ее туда. Делаем текущую клетку родительской для этой клетки. Рассчитываем стоимости F, G и H клетки.
</li><li>Если клетка уже в открытом списке, то проверяем, не дешевле ли будет путь через эту клетку. Для сравнения используем стоимость G. Более низкая стоимость G указывает на то, что путь будет дешевле. Если это так, то меняем родителя клетки на текущую клетку и пересчитываем для нее стоимости G и F. Если вы сортируете открытый список по стоимости F, то вам надо отсортировать весь список в соответствии с изменениями.
</li></ul>
</li><li>Останавливаемся если:
<ul><li>Добавили целевую клетку в открытый список, в этом случае путь найден.
</li><li>Или открытый список пуст и мы не дошли до целевой клетки. В этом случае путь отсутствует.
</li></ul>
</li></ol>
</li><li>Сохраняем путь. Двигаясь назад от целевой точки, проходя от каждой точки к ее родителю до тех пор, пока не дойдем до стартовой точки. Это и будет наш путь.
</li></ol>
<a name=".D0.9F.D0.BE.D1.81.D0.BB.D0.B5.D1.81.D0.BB.D0.BE.D0.B2.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_A%2A_%D0%B4%D0%BB%D1%8F_%D0%BD%D0%BE%D0%B2%D0%B8%D1%87%D0%BA%D0%BE%D0%B2&amp;action=edit&amp;section=6" title="Алгоритм A* для новичков">править</a>]</span> <span class="mw-headline">Послесловие</span></h2>
<p>Для использования алгоритма A*, вам необходимо включить элементы, описанные выше -- открытый и закрытый списки, стоимости F, G, и H. Существует множество других алгоритмов поиска пути, но эти методы не A*, который считается лучшим из многих. Брайан Стаут (Bryan Stout) обсуждает многие из них в статье, ссылка на которую расположена чуть дальше. Некоторые альтернативные методы будут лучше при некоторых обстоятельствах, но вы должны понимать, что вам надо. Ладно, хватит разглагольствований. Вернемся к нашей статье. 
</p>
<a name=".D0.97.D0.B0.D0.BC.D0.B5.D1.82.D0.BA.D0.B8_.D0.BA_.D1.80.D0.B5.D0.B0.D0.BB.D0.B8.D0.B7.D0.B0.D1.86.D0.B8.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_A%2A_%D0%B4%D0%BB%D1%8F_%D0%BD%D0%BE%D0%B2%D0%B8%D1%87%D0%BA%D0%BE%D0%B2&amp;action=edit&amp;section=7" title="Алгоритм A* для новичков">править</a>]</span> <span class="mw-headline">Заметки к реализации</span></h2>
<p>Теперь, когда вы понимаете основы метода, вот несколько тем к размышлению, когда вы начнете писать свою программу.
</p>
<ol><li>Другие юниты (уклонение от столкновений) Если вы присмотритесь внимательней к моему примеру реализации алгоритма, вы заметите, что он полностью игнорирует все остальные юниты на экране. Юниты спокойно проходят сквозь друг друга. В зависимости от игры, это может быть приемлемым, но может и не быть. Если вы хотите чтобы юниты обходили друг друга, то я предлагаю вам несколько методов. Можно обрабатывать юниты, которые не двигаются или находятся близко к юниту, для которого ищется путь, а остальные просто игнорировать. Если же вы хотите обрабатывать юниты, которые двигаются и находятся на расстоянии более чем в одну вершину, то вам нужно будет разработать метод для установления их положения в пространстве в любое время, чтобы они могли должным образом уклониться. Иначе в дальнейшем вы можете столкнуться со странными путями, где юниты двигаются по зигзагообразной траектории, пытаясь объехать другие юниты, которых там давно нет. Вам также потребуется система определения столкновений, так как не важно насколько хорош ваш путь, со временем многие вещи могут измениться. Когда происходит столкновение, для юнита надо просчитать новый путь или, если это не лобовое столкновение, подождать пока другой юнит отойдет с дороги, перед тем, как двигаться дальше.
</li></ol>
<p>Вот некоторые ссылки, которые могут вам пригодиться:
</p>
<ol><li><ul><li><a href="http://www.red3d.com/cwr/steer/" class="external text" title="http://www.red3d.com/cwr/steer/" rel="nofollow">Steering Behavior for Autonomous Characters</a>: по движению автономных устройств немного отходит от задачи поиска пути, но она может быть интегрирована с ним для более совершенного перемещения и определения столкновений.
</li><li><a href="http://ducati.doc.ntu.ac.uk/uksim/uksim'04/Papers/Simon%20Tomlinson-%2004-20/paper04-20%20CR.pdf" class="external text" title="http://ducati.doc.ntu.ac.uk/uksim/uksim'04/Papers/Simon%20Tomlinson-%2004-20/paper04-20%20CR.pdf" rel="nofollow">The Long and Short of Steering in Computer Games</a>]: Интересный обзор литературы по передвижению и поиску пути. Это pdf документ.
</li><li><a href="http://www.gamasutra.com/features/game_design/19990122/movement_01.htm" class="external text" title="http://www.gamasutra.com/features/game_design/19990122/movement_01.htm" rel="nofollow">Coordinated Unit Movement</a>]: Первая статья из двух серийного цикла про формацию и сгруппированное передвижение юнитов от дизайнера Эпохи Империй (Age of Empires) Дейва Поттингера (Dave Pottinger).
</li><li><a href="http://www.gamasutra.com/features/19990129/implementing_01.htm" class="external text" title="http://www.gamasutra.com/features/19990129/implementing_01.htm" rel="nofollow">Implementing Coordinated Movement</a>: Вторая статья из этого цикла.
</li></ul>
</li></ol>
<ol><li>Различная стоимость передвижения: В этой статье и в моей прилагающейся программе поверхность может быть только двух типов - проходимая и непроходимая. Но что, если у вас есть территория, которая проходима, но имеет большую стоимость передвижения? Болота, возвышенности, лестницы в пещерах, и т.д. - это примеры поверхности, которую можно пройти, но стоимость передвижения у нее выше, чем стоимость передвижения по ровной, открытой поверхности. Также стоимость передвижения по дорогам может быть немного ниже стоимости передвижения по другим видам поверхности.
</li></ol>
<p>Эта проблема легко решается путем добавления стоимости поверхности при вычислении стоимости G любой вершины. Просто добавьте дополнительную стоимость к таким вершинам. Алгоритм поиска пути A* написан для нахождения пути с наименьшей стоимостью и легко справится с такой задачей. В простом примере, который я описал, когда поверхность может быть или проходимой или нет, A* будет искать кратчайший, более прямолинейный путь. Но в случае с различной стоимостью поверхности, юнит может пойти более длинным путем - как, например, при движении по дороге через болото, а не движении напрямик по самому болоту.
</p><p>Существует еще одно интересное решение, которое профессионалы называют "influence mapping" (что-то вроде карты с областями влияния). Так же как и с различной стоимостью поверхности, вы можете создавать дополнительные системы и применять их для целей ИИ (искусственного интеллекта). Представьте, что у вас есть карта, на которой находятся толпы юнитов, охраняющих проезд через горный регион. Каждый раз, когда компьютер посылает свой юнит через этот проход, он уничтожается. Если вы захотите, то можете создать "карту влияний", которая будет "штрафовать" вершины, возле которых множество вражеских единиц. Это научит компьютер планировать более безопасные пути и поможет избежать глупых ситуаций, когда компьютер продолжит посылать юниты через более опасный район только потому, что он более короткий.
</p>
<ol><li>Обработка неизведанных территорий: Вы когда-нибудь играли в игры, в которых компьютер всегда знает точно, какой путь выбрать, даже если карта еще не полностью исследована? В зависимости от игры, поиск пути это то, что может быть очень нереалистичным. К сожалению, это та проблема, которую не так-то просто решить.
</li></ol>
<p>Ответ заключается в создании массива "известная проходимость" для каждого из игроков и компьютерных оппонентов ("каждый игрок" не значит "каждый юнит", это потребовало бы очень много памяти). Каждый такой массив должен содержать информацию про области, которые игрок уже исследовал, остальные же области должны оставаться непроходимыми до исследования. Используя такое решение, юниты будут попадать в тупики и искать неверный путь до тех пор, пока они не откроют всю карту. Как только карта будет исследована, поиск пути станет всегда находить верные пути.
</p>
<ol><li>Сглаженные пути: A* даст вам кратчайший, с наименьшей стоимостью путь, но он не даст вам визуально сглаженного пути. Давайте посмотрим на окончательный путь, просчитанный в примере (рис. 7). На этом пути первый шаг находится справа внизу от стартовой клетки. Не казался бы наш путь более плавным, если бы первый шаг находился прямо под стартовой клеткой?
</li></ol>
<p>Есть несколько способов решить эту проблему. В процессе поиска вы можете "штрафовать" вершины, где есть смена направления движения, увеличивая их стоимости G. Так же вы можете пройти по всему пути после его вычисления и выискивать вершины, в которых вы бы хотели изменить направление для более сглаженного пути. Для более обширного описания проблемы, проверьте , <a href="http://www.gamasutra.com/features/20010314/pinter_01.htm" class="external text" title="http://www.gamasutra.com/features/20010314/pinter_01.htm" rel="nofollow">Toward More Realistic Pathfinding</a>, бесплатную (но требующую регистрации) статью Марка Пинтера (Marco Pinter) на Gamasutra.com.
</p>
<ol><li>Неквадратные области поиска: В нашем примере мы используем простые плоские квадратные ячейки. Необязательно всегда выбирать такое решение. Вы можете использовать области с неправильной формой. Вспомните про игру Risk (Риск&nbsp;:-) и страны в ней. Вы можете захотеть использовать такой сценарий поиска пути. Для того чтобы это сделать, необходимо создать таблицу для хранения информации о том, какие страны с какими граничат и стоимости G для передвижения от одной страны к другой. Вы также должны выбрать метод определения стоимости H. Все остальное остается таки же, как и в нашем примере. При добавлении элементов в открытый список, вместо просмотра соседних клеток просто просматривайте соседние страны в таблице.
</li></ol>
<p>Также вы можете создать систему вэйпоинтов для путей нефиксированной карте. Вэйпоинты представляют собой несколько связанных точек пути, например, на дороге или в туннеле подземелья. Как гейм-дизайнер вы можете указывать эти вэйпоинты вручную. Два вэйпоинта считаются соседними, если на линии между ними нет никаких препятствий. В случае с игрой Риск (Risk), вы сохраняете эту информацию о соседстве в какой-нибудь таблице и используете эту информацию при генерации элементов открытого списка. Затем вы сохраняете присвоенные стоимости G (возможно, используя длины отрезков, соединяющих вершины) и стоимости H (возможно, используя длины отрезков, соединяющих вершины и цель). Все остальное выполняется как обычно.
</p><p>Амит Пател (Amit Patel) написал <a href="http://theory.stanford.edu/~amitp/GameProgramming/MapRepresentations.html" class="external text" title="http://theory.stanford.edu/~amitp/GameProgramming/MapRepresentations.html" rel="nofollow">статью</a>, предлагающую некоторые альтернативы. Пример по поиску на изометрической RPG карте, используя неквадратные области поиска, лежит здесь: <a href="http://www.policyalmanac.org/games/twoTiered.htm" class="external text" title="http://www.policyalmanac.org/games/twoTiered.htm" rel="nofollow">Two-Tiered A* Pathfinding</a>.
</p>
<ol><li>Некоторые советы по увеличению скорости поиска: Как только вы разработаете свою собственную программу A*, или адаптируете ту, которую написал я, то обнаружите, что поиск пути использует львиную долю вашего процессорного времени, особенно если у вас огромное количество юнитов и большая карта. Если вы прочитаете в сети различные материалы, то узнаете, что это распространяется даже на программистов таких игр, как Starcraft или Age of Empires. Если вы заметили, что поиск пути стал медленным, то вот несколько советов о том, как ускорить этот процесс:
</li></ol>
<ol><li><ul><li>Используйте карты поменьше и небольшое количество юнитов.
</li><li>Никогда не ищите путь одновременно для нескольких юнитов. Вместо этого поставьте их в очередь и рассчитывайте за несколько игровых циклов. Если ваша игра работает на скорости, скажем, в 40 циклов за кадр, никто никогда этого не заметит. Но все заметят, если игра начнет работать очень медленно каждый раз, когда путь вычисляется одновременно для множества юнитов.
</li><li>Используйте для вашей карты как можно большие квадраты (или любую другую фигуру). Это уменьшит общее количество вершин просмотренных при поиске пути. Если вы очень амбициозный человек, то можете использовать две или больше систем поиска пути, которые будут использоваться в разных ситуациях в зависимости от длины пути. Вот что делают профессионалы: используют большие области для длинных путей, а затем переходят на более точный поиск, используя меньшие квадраты/области при приближении к цели. Если вы заинтересованы в таком подходе, прочтите мою статью <a href="http://www.policyalmanac.org/games/twoTiered.htm" class="external text" title="http://www.policyalmanac.org/games/twoTiered.htm" rel="nofollow">Two-Tiered A* Pathfinding</a>.
</li><li>Для длинных путей можно использовать предварительно просчитанные пути.
</li><li>Обрабатывайте вашу карту на наличие недоступных из других частей карты участков. Я называю эти участки "острова." В действительности они могут быть островами или любой другой поверхностью, которая отгорожена стенами или недоступна. Один из недостатков алгоритма A* состоит в том, для нахождения путей к таким участкам, он будет искать путь на всей карте, останавливаясь только когда каждый квадрат/вершина прошли через открытый и закрытый списки. Это может потратить очень много процессорного времени. Этого можно избежать если просчитывать какие области недостижимы (с помощью flood-fill заливки или похожего метода), сохраняя эту информацию в любом массиве и проверяя ее каждый раз перед началом поиска.
</li><li>В запутанном, лабиринтоподобном окружении, стоит отметить вершины, которые не приводят никуда, кроме тупиков. Такие области можно указывать на вашей карте вручную или разработать алгоритм, который будет определять такие области автоматически. Любой группе таких вершин можно присвоить уникальный идентификационный номер. Затем вы можете спокойно игнорировать все тупики при поиске пути, задумываясь только о том, чтобы стартовая или целевая точки не попали в такую "тупиковую" область.
</li></ul>
</li></ol>
<ol><li>Реализация открытого списка: Это один из наиболее важных элементов в алгоритме A*. Каждый раз при обращении к открытому списку вам необходимо найти вершину с наименьшей стоимостью F. Существует несколько способов это сделать. Вы можете сохранять элементы пути, когда потребуется и просто просматривать весь открытый список каждый раз, когда надо извлечь элемент с наименьшей стоимостью F. Это простой метод, но очень медленный для длинных путей. Он может быть улучшен использованием сортированного списка и тогда нужно будет просто выбрать первый элемент списка - это и будет элемент с наименьшей стоимостью F. Когда я писал свою программу этот метод был первым, который я использовал.
</li></ol>
<p>Это будет быстро работать на маленьких картах, но это не оптимальное решение. Серьезные программисты A*, которые стремятся действительно к впечатляющей скорости, используют что-то, что называются "двоичными кучами" (binary heaps) и это то, что я использовал в своей программе. Это будет, по крайней мере, в 2-3 раза быстрее в большинстве случаев и намного быстрее (в 10 и больше раз) на длинных путях. Если вы заинтересовались, прочтите мою статью Using Binary Heaps in A* Pathfinding.
</p>
<ol><li>Алгоритм Дийкстры: В то время как считается, что A* самый лучший алгоритм поиска (смотрите выше), существует, по крайней мере, еще один алгоритм, который активно используется - алгоритм Дийкстры (Dijkstra's algorithm). Этот алгоритм точно такой же, как и A*, только без эвристики (H всегда равна 0). Так как в нем нет эвристики, он ищет путь одновременно во все стороны. Перед тем, как найти путь, алгоритм исследует намного больше территории. Это делает его медленнее A*.
</li></ol>
<p>Так зачем его использовать? Иногда мы не знаем, где находится наша цель. Например, у вас есть добывающий юнит, которому надо собрать каких-нибудь ресурсов. Он может знать, что на этой территории есть несколько областей с ресурсами, но он хочет добраться к ближайшим. Здесь использовать алгоритм Дийкстры будет более целесообразно, чем использовать A* потому, что мы не знаем, какие из ресурсов находятся ближе. Альтернатива есть только в повторном использовании A* для нахождения расстояния до каждого из ресурсов, а затем использовании этого пути. Существует множество таких ситуаций.
</p>
<a name=".D0.94.D0.B0.D0.BB.D1.8C.D0.BD.D0.B5.D0.B9.D1.88.D0.B5.D0.B5_.D0.B8.D0.B7.D1.83.D1.87.D0.B5.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_A%2A_%D0%B4%D0%BB%D1%8F_%D0%BD%D0%BE%D0%B2%D0%B8%D1%87%D0%BA%D0%BE%D0%B2&amp;action=edit&amp;section=8" title="Алгоритм A* для новичков">править</a>]</span> <span class="mw-headline">Дальнейшее изучение</span></h2>
<p>Хорошо, теперь вы знаете основы и смысл некоторых углубленных решений. На этом этапе я советую заглянуть в мой исходный код, он содержит множество комментариев и должен быть довольно простым в понимании:
</p><p>Вы также можете заинтересоваться некоторыми сайтами. После прочтения этой статьи они будут простыми для понимания.
</p>
<ul><li><a href="http://www-cs-students.stanford.edu/~amitp/gameprog.html#Paths" class="external text" title="http://www-cs-students.stanford.edu/~amitp/gameprog.html#Paths" rel="nofollow">Amit’s A* Pages</a>: Это очень обширная страничка Амита Патела (Amit Patel), но она может быть немного непонятной для тех, кто не читал эту статью. Но все же стоит глянуть. Советую прочитать личные рассуждения Амита про статью.
</li><li><a href="http://www.gamasutra.com/features/19970801/pathfinding.htm" class="external text" title="http://www.gamasutra.com/features/19970801/pathfinding.htm" rel="nofollow">Smart Moves</a>: Intelligent Path Finding: Эта статья написана Брайаном Стаутом (Bryan Stout) для портала Gamasutra.com и требует регистрации для чтения. Регистрация бесплатна и позволяет прочитать не только эту статью, но и множество других ресурсов, доступных на сайте. Программа, написанная Брайаном на Delphi помогла мне изучить A* и вдохновила на написание моей программы A*. Также она описывает некоторые альтернативные возможности A*.
</li><li><a href="http://www.gdconf.com/archives/2000/pottinger.doc|Terrain" class="external text" title="http://www.gdconf.com/archives/2000/pottinger.doc|Terrain" rel="nofollow">Analysis</a>: Это сложная, но интересная статья Дейва Поттингера (Dave Pottinger), профессионала из Ensemble Studios. Этот парень координировал разработку Эпохи Империй (Age of Empires) и ее второй части. Не ожидайте, что вы поймете все, написанное в ней, но это очень интересная статья, которая может натолкнуть вас на некоторые идеи. Она включает в себя обсуждение мип-маппинга, карты с влияниями и некоторыми другими углубленными решениями ИИ/поиска пути. Обсуждение "заливки" (“flood filling”) послужило идеей моих собственных "тупиков" и "островов"(“dead ends” and “islands”) , которые прилагаются к Blitz версии моей программы..
</li></ul>
<p>Вот некоторые интересные сайты, которые следует просмотреть:
</p>
<ul><li><a href="http://www.aiguru.com/pathfinding.htm" class="external text" title="http://www.aiguru.com/pathfinding.htm" rel="nofollow">aiGuru: Pathfinding</a>
</li><li><a href="http://www.gameai.com/pathfinding.html" class="external text" title="http://www.gameai.com/pathfinding.html" rel="nofollow">Game AI Resource: Pathfinding</a>
</li><li><a href="http://www.gamedev.net/reference/list.asp?categoryid=18#94" class="external text" title="http://www.gamedev.net/reference/list.asp?categoryid=18#94" rel="nofollow">GameDev.net: Pathfinding</a>
</li></ul>
<p>Хорошо, вот и все. Если вы напишите программу, которая использует любые из этих принципов, я с удовольствием на нее взгляну. Пишите письма.&nbsp;:)
</p><p>До встречи и удачи! 
</p>
<div align="right"><a href="http://blitzetcetera.org/images/8/87/AStar.zip" class="internal" title="AStar.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: Patrick Lester (e-mail: patrick@policyalmanac.org)<br />
Дата создания: 2 апреля 2004г<br />
Перевод: Morpher (e-mail: Morpher@alien-ws.com)<br />
Дата перевода: 26 июля 2004г
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Делаем чат"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Делаем чат&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Делаем чат&amp;action=edit">править</a>]</span><span class="mw-headline">Делаем чат</span></h1>
</p>
<a name=".D0.9F.D0.B5.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.BD.D1.8B.D0.B5.2C_.D1.82.D0.B8.D0.BF.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%94%D0%B5%D0%BB%D0%B0%D0%B5%D0%BC_%D1%87%D0%B0%D1%82&amp;action=edit&amp;section=1" title="Делаем чат">править</a>]</span> <span class="mw-headline">Переменные, типы</span></h2>
<p>Для начала объявим переменные:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> chat$=<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #ffee00">;Строка чата</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> name$=<span style="color: #00ff66;">&quot;noname&quot;</span> <span style="color: #ffee00">;Имя чувака</span></div>
<p>Люди будут храниться в типе:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> Player<br />
<p><span style="color: #aaffff; font-weight: bold;">Field</span> name$,net_id<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>Базар тоже в тип:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> Info<br />
<p><span style="color: #aaffff; font-weight: bold;">Field</span> txt$<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<a name=".D0.A1.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D0.B5_.D1.81.D0.B5.D1.82.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%94%D0%B5%D0%BB%D0%B0%D0%B5%D0%BC_%D1%87%D0%B0%D1%82&amp;action=edit&amp;section=2" title="Делаем чат">править</a>]</span> <span class="mw-headline">Создание сети</span></h2>
<p>Вот здесь создаётся сетевая игра:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">newGame = <span style="color: #aaffff; font-weight: bold;">StartNetGame</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">If</span> newGame = <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<span style="color: #aaffff; font-weight: bold;">end</span><span style="color: #ffee00">;не получилось</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>Узнаём имя
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">.label1:<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<p>name$=<span style="color: #aaffff; font-weight: bold;">Input</span>$<span style=" ">&#40;</span> <span style="color: #00ff66;">&quot;Ваше имя? &quot;</span> <span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">If</span> name$=<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Goto</span> label1</div>
<p>Локальный плеер
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> player.Player=<span style="color: #aaffff; font-weight: bold;">New</span> Player<br />
<p>player\name=name$<br />
player\net_id=<span style="color: #aaffff; font-weight: bold;">CreateNetPlayer</span><span style=" ">&#40;</span> name$ <span style=" ">&#41;</span><br />
</p>
myid=player\net_id</div>
<p>Командой CreateNetPlayer() создаётся новый игрок в сети. И всем уже подключенным игрокам отправляется сообщение с типом 100 (оно отправляется автоматически) 
</p>
<a name=".D0.9E.D0.B1.D0.BD.D0.BE.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B8.D0.B3.D1.80.D0.BE.D0.BA.D0.BE.D0.B2"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%94%D0%B5%D0%BB%D0%B0%D0%B5%D0%BC_%D1%87%D0%B0%D1%82&amp;action=edit&amp;section=3" title="Делаем чат">править</a>]</span> <span class="mw-headline">Обновление игроков</span></h2>
<p>Теперь нам нужна эта функция:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> UpdatePlayers<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">For</span> p.Player=<span style="color: #aaffff; font-weight: bold;">Each</span> Player<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">NetPlayerLocal</span><span style=" ">&#40;</span> p\net_id <span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Если гамер локальный, то набираем текст</span><br />
key=<span style="color: #aaffff; font-weight: bold;">GetKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> key<br />
<span style="color: #aaffff; font-weight: bold;">If</span> key=<span style="color: #33ffdd;">13</span><br />
<span style="color: #ffee00">;13=ENTER ОТСЫЛАЕМ ВСЕМ СВОЙ БАЗАР</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> chat$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">SendNetMsg</span> <span style="color: #33ffdd;">2</span>,chat$,p\net_id,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:info<span style=" ">&#40;</span>name$+<span style="color: #00ff66;">&quot;: &quot;</span>+chat$<span style=" ">&#41;</span><br />
chat$=<span style="color: #00ff66;">&quot;&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span> <span style="color: #aaffff; font-weight: bold;">If</span> key=<span style="color: #33ffdd;">8</span><br />
<span style="color: #ffee00">;удаляем последнюю букву</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>chat$<span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> chat$=<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>chat$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>chat$<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span> <span style="color: #aaffff; font-weight: bold;">If</span> key&gt;=<span style="color: #33ffdd;">32</span><br />
<span style="color: #ffee00">;пишем букву</span><br />
chat$=chat$+<span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span>key<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>В этой функции набирается текст, и если нажат ENTER, то отправляем сообщение всем!
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">SendNetMsg</span> <span style="color: #33ffdd;">2</span>,chat$,p\net_id,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span></div>
<p>Отправляется сообщение с типом 2, содержащее текст переменной chat$, от игрока p\net_id. Отправляется оно всем, об этом свидетельствует первый нуль (вместо нуля можно написать ID другого юзера и тогда сообщение будет отправлено только ему).
</p><p>И печатаем 
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">info<span style=" ">&#40;</span>name$+<span style="color: #00ff66;">&quot;: &quot;</span>+chat$<span style=" ">&#41;</span></div>
<a name=".D0.A0.D0.B8.D1.81.D1.83.D0.B5.D0.BC"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%94%D0%B5%D0%BB%D0%B0%D0%B5%D0%BC_%D1%87%D0%B0%D1%82&amp;action=edit&amp;section=4" title="Делаем чат">править</a>]</span> <span class="mw-headline">Рисуем</span></h2>
<p>Добавление строчки в тип
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> info<span style=" ">&#40;</span>t$<span style=" ">&#41;</span><br />
<p>i.Info=<span style="color: #aaffff; font-weight: bold;">New</span> Info<br />
i\txt$=t$<br />
<span style="color: #aaffff; font-weight: bold;">Insert</span> i <span style="color: #aaffff; font-weight: bold;">Before</span> <span style="color: #aaffff; font-weight: bold;">First</span> Info<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Эта функция просто рисует.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> RenderAll<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span>,chat$<br />
y=<span style="color: #aaffff; font-weight: bold;">FontHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">2</span><br />
r=<span style="color: #33ffdd;">0</span><span style="color: #ffee00">;255</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i.Info=<span style="color: #aaffff; font-weight: bold;">Each</span> Info<br />
<span style="color: #aaffff; font-weight: bold;">If</span> r&lt;<span style="color: #33ffdd;">15</span><span style="color: #ffee00">;максимальное количество ctpok</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">8</span>,y,i\txt$<br />
y=y+<span style="color: #aaffff; font-weight: bold;">FontHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
r=r<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
<span style="color: #aaffff; font-weight: bold;">Delete</span> i<br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.9E.D0.B1.D0.BD.D0.BE.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D1.81.D0.B5.D1.82.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%94%D0%B5%D0%BB%D0%B0%D0%B5%D0%BC_%D1%87%D0%B0%D1%82&amp;action=edit&amp;section=5" title="Делаем чат">править</a>]</span> <span class="mw-headline">Обновление сети</span></h2>
<p>Теперь самая главная функция.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> UpdateNetwork<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">RecvNetMsg</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Select</span> <span style="color: #aaffff; font-weight: bold;">NetMsgType</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span>:<br />
<span style="color: #ffee00">;Сообщение принято!!</span><br />
info<span style=" ">&#40;</span> <span style="color: #aaffff; font-weight: bold;">NetPlayerName</span>$<span style=" ">&#40;</span> <span style="color: #aaffff; font-weight: bold;">NetMsgFrom</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;: &quot;</span>+<span style="color: #aaffff; font-weight: bold;">NetMsgData</span>$<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">100</span>:<br />
<span style="color: #ffee00">;новый чувак влез к нам!!...</span><br />
p.Player=<span style="color: #aaffff; font-weight: bold;">New</span> Player<br />
p\net_id=<span style="color: #aaffff; font-weight: bold;">NetMsgFrom</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
p\name=<span style="color: #aaffff; font-weight: bold;">NetPlayerName</span>$<span style=" ">&#40;</span> <span style="color: #aaffff; font-weight: bold;">NetMsgFrom</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style=" ">&#41;</span><br />
info<span style=" ">&#40;</span> <span style="color: #00ff66;">&quot;Входит &quot;</span>+p\name <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">101</span>:<br />
<span style="color: #ffee00">;...и ушел</span><br />
p.Player=FindPlayer<span style=" ">&#40;</span> <span style="color: #aaffff; font-weight: bold;">NetMsgFrom</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p&lt;&gt;Null<br />
info<span style=" ">&#40;</span> <span style="color: #00ff66;">&quot;Вышел &quot;</span>+p\name <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Delete</span> p<br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">102</span>:<br />
<span style="color: #ffee00">;сервак закрылся</span><br />
info<span style=" ">&#40;</span> <span style="color: #00ff66;">&quot;Теперь я сервер&quot;</span> <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">200</span>:<br />
<span style="color: #ffee00">;Must Die сети</span><br />
<span style="color: #aaffff; font-weight: bold;">EndGraphics</span><br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Сессия прервана&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">WaitKey</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Эта функция проверяет, есть ли какие-нибудь сообщения. Если есть, то по типу сообщения выполняем соответствующие действия. 
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span>:<br />
<p><span style="color: #ffee00">;Сообщение принято!!</span><br />
</p>
info<span style=" ">&#40;</span> <span style="color: #aaffff; font-weight: bold;">NetPlayerName</span>$<span style=" ">&#40;</span> <span style="color: #aaffff; font-weight: bold;">NetMsgFrom</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;: &quot;</span>+<span style="color: #aaffff; font-weight: bold;">NetMsgData</span>$<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style=" ">&#41;</span></div>
<p>Почему именно 2???. Потому что в функции UpdatePlayers() отправляется сообщение 2-го типа
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">SendNetMsg</span> <span style="color: #33ffdd;">2</span>,chat$,p\net_id,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span></div>
<p>Можно было и 17 и 56 (до 99) придумать.
</p><p>Это стандартные типы сообщений: 
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">100</span>:<br />
<p><span style="color: #ffee00">;новый чувак влез к нам!!...</span><br />
когда получено это сообщение, чувак добавляется в тип.<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">101</span>:<br />
<span style="color: #ffee00">;...и ушел</span><br />
когда получено это сообщение, чувак удаляется из типа.<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">102</span>:<br />
<span style="color: #ffee00">;сервак закрылся</span><br />
когда получено это сообщение, Вы становитесь сервером<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">200</span>:<br />
<span style="color: #ffee00">;Сессия прервана</span><br />
</p>
когда получено это сообщение, сеть накрылась <span style="color: #33ffdd;">4</span></div>
<a name=".D0.93.D0.BB.D0.B0.D0.B2.D0.BD.D1.8B.D0.B9_.D1.86.D0.B8.D0.BA.D0.BB"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%94%D0%B5%D0%BB%D0%B0%D0%B5%D0%BC_%D1%87%D0%B0%D1%82&amp;action=edit&amp;section=6" title="Делаем чат">править</a>]</span> <span class="mw-headline">Главный цикл</span></h2>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<p><span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">Keyhit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
UpdateNetwork<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
UpdatePlayers<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
RenderAll<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Wend</span></div>
<a name=".D0.9F.D0.BE.D0.BB.D0.BD.D1.8B.D0.B9_.D0.BA.D0.BE.D0.B4"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%94%D0%B5%D0%BB%D0%B0%D0%B5%D0%BC_%D1%87%D0%B0%D1%82&amp;action=edit&amp;section=7" title="Делаем чат">править</a>]</span> <span class="mw-headline">Полный код</span></h2>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;**********************************************</span><br />
<p><span style="color: #ffee00">;ЧАТ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*</span><br />
<span style="color: #ffee00">;АВТОР: TankSoft &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *</span><br />
<span style="color: #ffee00">;МЫЛО&nbsp;: TankSoft@rambler.ru &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *</span><br />
<span style="color: #ffee00">;САЙТ&nbsp;: http://TankSoft.narod.ru &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*</span><br />
<span style="color: #ffee00">;**********************************************</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> chat$=<span style="color: #00ff66;">&quot;&quot;</span> &nbsp;<span style="color: #ffee00">;Строка чата</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> name$=<span style="color: #00ff66;">&quot;noname&quot;</span><span style="color: #ffee00">;Имя чувака</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> Player<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> name$,net_id<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> Info<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> txt$<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #ffee00">;===================================</span><br />
<span style="color: #ffee00">;Стартуем сетевую гаму</span><br />
newGame = <span style="color: #aaffff; font-weight: bold;">StartNetGame</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> newGame = <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span><span style="color: #ffee00">;не получилось</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #ffee00">;===================================</span><br />
<br />
<span style="color: #ffee00">;===================================</span><br />
<span style="color: #ffee00">;Узнаём имя</span><br />
.label1:<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
name$=<span style="color: #aaffff; font-weight: bold;">Input</span>$<span style=" ">&#40;</span> <span style="color: #00ff66;">&quot;Ваше имя? &quot;</span> <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> name$=<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Goto</span> label1<br />
<span style="color: #ffee00">;===================================</span><br />
<br />
<span style="color: #ffee00">;===================================</span><br />
<span style="color: #ffee00">;Локальный плеер</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> player.Player=<span style="color: #aaffff; font-weight: bold;">New</span> Player<br />
player\name=name$<br />
player\net_id=<span style="color: #aaffff; font-weight: bold;">CreateNetPlayer</span><span style=" ">&#40;</span> name$ <span style=" ">&#41;</span><br />
myid=player\net_id<br />
<span style="color: #ffee00">;===================================</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
&nbsp;UpdateNetwork<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;UpdatePlayers<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<br />
&nbsp;RenderAll<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> UpdateNetwork<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">RecvNetMsg</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Select</span> <span style="color: #aaffff; font-weight: bold;">NetMsgType</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span>:<br />
&nbsp; &nbsp;<span style="color: #ffee00">;Сообщение принято!!</span><br />
&nbsp; &nbsp;info<span style=" ">&#40;</span> <span style="color: #aaffff; font-weight: bold;">NetPlayerName</span>$<span style=" ">&#40;</span> <span style="color: #aaffff; font-weight: bold;">NetMsgFrom</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;: &quot;</span>+<span style="color: #aaffff; font-weight: bold;">NetMsgData</span>$<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">100</span>:<br />
&nbsp; &nbsp;<span style="color: #ffee00">;новый чувак влез к нам!!...</span><br />
&nbsp; &nbsp;p.Player=<span style="color: #aaffff; font-weight: bold;">New</span> Player<br />
&nbsp; &nbsp;p\net_id=<span style="color: #aaffff; font-weight: bold;">NetMsgFrom</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;p\name=<span style="color: #aaffff; font-weight: bold;">NetPlayerName</span>$<span style=" ">&#40;</span> <span style="color: #aaffff; font-weight: bold;">NetMsgFrom</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style=" ">&#41;</span><br />
&nbsp; &nbsp;info<span style=" ">&#40;</span> <span style="color: #00ff66;">&quot;Входит &quot;</span>+p\name <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">101</span>:<br />
&nbsp; &nbsp;<span style="color: #ffee00">;...и ушел</span><br />
&nbsp; &nbsp;p.Player=FindPlayer<span style=" ">&#40;</span> <span style="color: #aaffff; font-weight: bold;">NetMsgFrom</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> p&lt;&gt;Null<br />
&nbsp; &nbsp; info<span style=" ">&#40;</span> <span style="color: #00ff66;">&quot;Вышел &quot;</span>+p\name <span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> p<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">102</span>:<br />
&nbsp; &nbsp;<span style="color: #ffee00">;сервак закрылся</span><br />
&nbsp; &nbsp;info<span style=" ">&#40;</span> <span style="color: #00ff66;">&quot;Теперь я сервер&quot;</span> <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">200</span>:<br />
&nbsp; &nbsp;<span style="color: #ffee00">;Must Die сети</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndGraphics</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Сессия прервана&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">WaitKey</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> UpdatePlayers<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> p.Player=<span style="color: #aaffff; font-weight: bold;">Each</span> Player<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">NetPlayerLocal</span><span style=" ">&#40;</span> p\net_id <span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Если гамер локальный, то набираем текст</span><br />
&nbsp; &nbsp;key=<span style="color: #aaffff; font-weight: bold;">GetKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> key<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> key=<span style="color: #33ffdd;">13</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;13=ENTER ОТСЫЛАЕМ ВСЕМ СВОЙ БАЗАР</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> chat$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">SendNetMsg</span> <span style="color: #33ffdd;">2</span>,chat$,p\net_id,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:info<span style=" ">&#40;</span>name$+<span style="color: #00ff66;">&quot;: &quot;</span>+chat$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp;chat$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span> <span style="color: #aaffff; font-weight: bold;">If</span> key=<span style="color: #33ffdd;">8</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;удаляем последнюю букву</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>chat$<span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> chat$=<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>chat$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>chat$<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span> <span style="color: #aaffff; font-weight: bold;">If</span> key&gt;=<span style="color: #33ffdd;">32</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;пишем букву</span><br />
&nbsp; &nbsp; &nbsp;chat$=chat$+<span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span>key<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> info<span style=" ">&#40;</span>t$<span style=" ">&#41;</span><br />
&nbsp;i.Info=<span style="color: #aaffff; font-weight: bold;">New</span> Info<br />
&nbsp;i\txt$=t$<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Insert</span> i <span style="color: #aaffff; font-weight: bold;">Before</span> <span style="color: #aaffff; font-weight: bold;">First</span> Info<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> RenderAll<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span>,chat$<br />
&nbsp;y=<span style="color: #aaffff; font-weight: bold;">FontHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">2</span><br />
&nbsp;r=<span style="color: #33ffdd;">0</span><span style="color: #ffee00">;255</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i.Info=<span style="color: #aaffff; font-weight: bold;">Each</span> Info<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> r&lt;<span style="color: #33ffdd;">15</span><span style="color: #ffee00">;максимальное количество ctpok</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">8</span>,y,i\txt$<br />
&nbsp; &nbsp;y=y+<span style="color: #aaffff; font-weight: bold;">FontHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;r=r<span style="color: #33ffdd;">+1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Delete</span> i<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> FindPlayer.Player<span style=" ">&#40;</span> id <span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> p.Player=<span style="color: #aaffff; font-weight: bold;">Each</span> Player<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> p\net_id=id <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> p<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/8/8f/Chat.bb" class="internal" title="Chat.bb">скачать исходный код</a></div>
<hr />
<p>Автор: TankSoft (tanksoft@rambler.ru)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Эффекты размытия в реальном времени"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Эффекты размытия в реальном времени&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Эффекты размытия в реальном времени&amp;action=edit">править</a>]</span><span class="mw-headline">Эффекты размытия в реальном времени</span></h1>
<p>Эффекты типа "размытие движения" можно увидеть в играх GTA 3, Max Payne 2 и других. Можно заметить, что когда герой двигается, за ним остается угасающий шлейф. Достигается эффект путем смешивания предыдущего и текущего кадра. При этом, можно варьировать множество параметров: деформация предыдущего кадра (масштабирование, поворот, смещение), его затемнение, прозрачность, тип смешивания. Можно смешивать разными способами сразу несколько копий предыдущего кадра или нескольких предыдущих (хотя, это часто бывает излишним). В результате, после нескольких повторений рендеринга / смешивания получим рекурсивный эффект (из-за того, что каждый новый кадр будет смешиваться со смесью всех предыдущих). Это дает иллюзию изменения течения времени и разные психоделические эффекты.
</p>
</p><p>Самый быстрый на мой взгляд алгоритм - когда перед камерой устанавливается прямоугольник, текстурируемый запоминаемым предыдущим кадром. При этом прямоугольник трансформруется так, чтобы текстура с предыдущим кадром совпадала с экраном. Различных эффетов можно достичь, перемещая, масштабируя и вращая прямоугольник относительно камеры, изменяя его прозрачность, подсветку, способ смешивания.
</p><p>Вот программа, демонстрирующая разные эффекты такого типа:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;Размер текстуры, номер эффекта, порядок прорисовки (-1 или 1)</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Const</span> texsize=<span style="color: #33ffdd;">1024</span>,fx=<span style="color: #33ffdd;">7</span>,o=<span style="color: #33ffdd;">-1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<br />
cam=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> cam,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-6</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">45</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #ffee00">;Создание сцены</span><br />
cube=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> cube,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">128</span>,<span style="color: #33ffdd;">0</span><br />
cone1=<span style="color: #aaffff; font-weight: bold;">CreateCone</span><span style=" ">&#40;</span><span style="color: #33ffdd;">20</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> cone1,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> cone1,<span style="color: #33ffdd;">-4</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
cone2=<span style="color: #aaffff; font-weight: bold;">CreateCone</span><span style=" ">&#40;</span><span style="color: #33ffdd;">20</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> cone2,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> cone2,<span style="color: #33ffdd;">4</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
p=<span style="color: #aaffff; font-weight: bold;">CreatePivot</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
sph=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">20</span>,p<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> sph,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-4</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Select</span> fx<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span>:bl=createblurlayer<span style=" ">&#40;</span>cam,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>,.<span style="color: #33ffdd;">95</span>,<span style="color: #33ffdd;">1</span>,o<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span>:bl=createblurlayer<span style=" ">&#40;</span>cam,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,.<span style="color: #33ffdd;">97</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">3</span>,o<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">3</span>:bl=createblurlayer<span style=" ">&#40;</span>cam,<span style="color: #33ffdd;">1</span>,.<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1.02</span>,.<span style="color: #33ffdd;">97</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">3</span>,o<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">4</span>:bl=createblurlayer<span style=" ">&#40;</span>cam,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1.01</span>,<span style="color: #33ffdd;">1</span>,.<span style="color: #33ffdd;">95</span>,<span style="color: #33ffdd;">1</span>,o<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">5</span><br />
&nbsp; bl=createblurlayer<span style=" ">&#40;</span>cam,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1.01</span>,<span style="color: #33ffdd;">1</span>,.<span style="color: #33ffdd;">9</span>,<span style="color: #33ffdd;">1</span>,o<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityColor</span> bl,<span style="color: #33ffdd;">240</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">225</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">6</span><br />
&nbsp; bl=createblurlayer<span style=" ">&#40;</span>cam,<span style="color: #33ffdd;">1.1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>,.<span style="color: #33ffdd;">95</span>,<span style="color: #33ffdd;">1</span>,o<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> bl,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">7</span><br />
&nbsp; bl=createblurlayer<span style=" ">&#40;</span>cam,<span style="color: #33ffdd;">1.01</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>,.<span style="color: #33ffdd;">9</span>,<span style="color: #33ffdd;">1</span>,o<span style=" ">&#41;</span><br />
&nbsp; bl2=createblurlayer<span style=" ">&#40;</span>cam,<span style="color: #33ffdd;">1.02</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>,.<span style="color: #33ffdd;">8</span>,<span style="color: #33ffdd;">1</span>,o<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> cube,.<span style="color: #33ffdd;">1</span>,.<span style="color: #33ffdd;">2</span>,.<span style="color: #33ffdd;">3</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> p,.<span style="color: #33ffdd;">55</span>,.<span style="color: #33ffdd;">35</span>,.<span style="color: #33ffdd;">2</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
&nbsp;bltex=updateblurlayer<span style=" ">&#40;</span>bl,bltex<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> bl2 <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">EntityTexture</span> bl2,bltex<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> fx=<span style="color: #33ffdd;">4</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> bl,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span>-.<span style="color: #33ffdd;">01</span>,.<span style="color: #33ffdd;">01</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span>-.<span style="color: #33ffdd;">01</span>,.<span style="color: #33ffdd;">01</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
<span style="color: #ffee00">;Функция создания слоя размытия, привязанного к камере - возвращает адрес слоя</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> createblurlayer<span style=" ">&#40;</span>cam,z#,ang#,mgn#,bright#,alpha#,bmode,ord<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Local</span> xres=<span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Local</span> yres=<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
layer=<span style="color: #aaffff; font-weight: bold;">CreateMesh</span><span style=" ">&#40;</span>cam<span style=" ">&#41;</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span>layer<span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Вычисление координат текстуры</span><br />
vx#=<span style="color: #33ffdd;">1.0</span>*xres/texsize<br />
vy#=<span style="color: #33ffdd;">1.0</span>*yres/texsize<br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,vx#,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vy#<br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>,vx#,vy#<br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #ffee00">;Определение величин для установки прямоугольника прямо перед камерой путем</span><br />
<span style="color: #ffee00">; вычисления экранных координат точки трехмерного мира</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> layer,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>,z#<br />
<span style="color: #aaffff; font-weight: bold;">CameraProject</span> cam,<span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>layer,<span style="color: #aaffff; font-weight: bold;">True</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>layer,<span style="color: #aaffff; font-weight: bold;">True</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>layer,<span style="color: #aaffff; font-weight: bold;">True</span><span style=" ">&#41;</span><br />
rx#=<span style="color: #aaffff; font-weight: bold;">ProjectedX</span>#<span style=" ">&#40;</span><span style=" ">&#41;</span>-.<span style="color: #33ffdd;">5</span>*xres<br />
ry#=<span style="color: #aaffff; font-weight: bold;">ProjectedY</span>#<span style=" ">&#40;</span><span style=" ">&#41;</span>-.<span style="color: #33ffdd;">5</span>*yres<br />
<span style="color: #ffee00">;Масштабирование слоя</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> layer,.<span style="color: #33ffdd;">5</span>*xres/rx#,.<span style="color: #33ffdd;">5</span>*yres/ry#,<span style="color: #33ffdd;">1</span><br />
<span style="color: #ffee00">;Сдлвиг прямоугольника на полпиксела влево-вверх, чтобы он был в центре экрана</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> layer,-.<span style="color: #33ffdd;">5</span>/rx#,-.<span style="color: #33ffdd;">5</span>/ry#,z#<br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> layer,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,ang#<br />
<span style="color: #ffee00">;Задание эффектов слоя</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> layer,mgn#,mgn#,mgn#<br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> layer,alpha#<br />
<span style="color: #aaffff; font-weight: bold;">EntityBlend</span> layer,bmode<br />
col=<span style="color: #33ffdd;">255</span>*bright#<br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> layer,col,col,col<br />
<span style="color: #aaffff; font-weight: bold;">EntityFX</span> layer,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityOrder</span> layer,ord<br />
<span style="color: #aaffff; font-weight: bold;">Return</span> layer<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Функция обновления слоя (возвращает адрес текстуры)</span><br />
<span style="color: #ffee00">;Нужно вызывать каждый раз после RenderWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> updateblurlayer<span style=" ">&#40;</span>layer,tex<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> tex=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> tex=<span style="color: #aaffff; font-weight: bold;">CreateTexture</span><span style=" ">&#40;</span>texsize,texsize<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> layer,tex<br />
<span style="color: #aaffff; font-weight: bold;">CopyRect</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">TextureBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> tex<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/c/cb/3DRealtimeBlur.bb" class="internal" title="3DRealtimeBlur.bb">скачать исходный код</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Редактор двумерных кривых"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Редактор двумерных кривых&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Редактор двумерных кривых&amp;action=edit">править</a>]</span><span class="mw-headline">Редактор двумерных кривых</span></h1>
</p>
<a name=".D0.9F.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80.D1.8B_.D0.BA.D1.80.D0.B8.D0.B2.D0.BE.D0.B9_.D0.B8_.D0.B5.D0.B5_.D0.BF.D0.BE.D1.81.D1.82.D1.80.D0.BE.D0.B5.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A0%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%BE%D1%80_%D0%B4%D0%B2%D1%83%D0%BC%D0%B5%D1%80%D0%BD%D1%8B%D1%85_%D0%BA%D1%80%D0%B8%D0%B2%D1%8B%D1%85&amp;action=edit&amp;section=1" title="Редактор двумерных кривых">править</a>]</span> <span class="mw-headline">Параметры кривой и ее построение</span></h2>
<p>В прошлом выпуске была статья о кубической интерполяции. В последнем примере с двигающимся объектом есть одна особенность: перемещаясь, он описывает кривую. Так почему же не создать на основе той же интерполяции алгоритм построения кривых? В этой статье будет объяснено, как создать редактор таких кривых.
</p><p>Напомню, для того, чтобы построить траекторию, были созданы две интерполяционные функции - x = f<sup>1</sup>(t) и y = f<sup>2</sup>(t), 0&lt;=t&lt;=1. Если Вы редактировали кривые в векторных редакторах, например в CorelDraw или Macromedia Flash, то могли заметить, что от каждой вершины отходят два отрезка с точками на концах. Если присмотреться, то можно увидеть, что эти отрезки - касательные к частям кривой, подходящим к этой точке.  Когда отрезки параллельны - кривая плавно закругляется в вершине, в противном случае получается излом. Будем называть эти отрезки векторами (так как можно задать направление - от вершины).
</p><p>Для начала, определим тип, отвечающий за точки. Каждая точка имеет координаты, также нужно зафиксировать координаты векторов (они будут равны разности между конечными точками отрезков и координатами вершины). Для построения простейшей кривой необходимо минимум две точки - зададим их в начале программы.
</p><p>Теперь можно создать процедуру рисования кривой. Как вычислить коэффициенты, было рассказано в предыдущем выпуске, а построить кривую легко можно в цикле отрезками по точкам. Разбиение кривой на 100 отрезков (шаг 1/100) быстро строит вполне качественную кривую. Но какие производные подставлять в формулы? Можно просто подставить приращения отрезков, умноженные на константу (скажем, 20), но удобнее для редактирования будет, если эта константа будет зависеть от расстояния между вершинами кривой. Теперь можно поэкспериментировать с векторами:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> dot<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x,y,dx1,dy1,dx2,dy2<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> xres=<span style="color: #33ffdd;">800</span>, yres=<span style="color: #33ffdd;">600</span>, stp#=.<span style="color: #33ffdd;">01</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> seldot.dot, bi, sel<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> a#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,b#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,c#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,d#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> xres,yres,<span style="color: #33ffdd;">32</span><br />
<br />
<span style="color: #ffee00">;Задание начальных точек</span><br />
dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
dt\x=.<span style="color: #33ffdd;">5</span>*xres<br />
dt\y=.<span style="color: #33ffdd;">25</span>*yres<br />
dt\dx2=<span style="color: #33ffdd;">50</span><br />
dt\dy2=<span style="color: #33ffdd;">50</span><br />
dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
dt\x=.<span style="color: #33ffdd;">5</span>*xres<br />
dt\y=.<span style="color: #33ffdd;">75</span>*yres<br />
dt\dx1=<span style="color: #33ffdd;">40</span><br />
dt\dy1=<span style="color: #33ffdd;">-60</span><br />
<br />
<br />
drawcurve <span style="color: #aaffff; font-weight: bold;">First</span> dot<br />
<span style="color: #aaffff; font-weight: bold;">WaitKey</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> drawcurve<span style=" ">&#40;</span>dt1.dot<span style=" ">&#41;</span><br />
dt2.dot=<span style="color: #aaffff; font-weight: bold;">After</span> dt1<br />
<br />
<span style="color: #ffee00">;Вычисление расстояния между вершинами кривой для вычисления производных</span><br />
r#=.<span style="color: #33ffdd;">05</span>*<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span><span style=" ">&#40;</span>dt1\x-dt2\x<span style=" ">&#41;</span>*<span style=" ">&#40;</span>dt1\x-dt2\x<span style=" ">&#41;</span>+<span style=" ">&#40;</span>dt1\y-dt2\y<span style=" ">&#41;</span>*<span style=" ">&#40;</span>dt1\y-dt2\y<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;Вычисление коэффициентов кривой</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> nn=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> nn <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; v1=dt1\y<br />
&nbsp; v2=dt2\y<br />
&nbsp; c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=dt1\dy2*r#<br />
&nbsp; dy2#=dt2\dy1*r#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; v1=dt1\x<br />
&nbsp; v2=dt2\x<br />
&nbsp; c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=dt1\dx2*r#<br />
&nbsp; dy2#=dt2\dx1*r#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=v1<br />
&nbsp;b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=<span style="color: #33ffdd;">3.0</span>*v2-dy2#<span style="color: #33ffdd;">-2.0</span>*c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><span style="color: #33ffdd;">-3.0</span>*d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><br />
&nbsp;a#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=<span style=" ">&#40;</span>dy2#<span style="color: #33ffdd;">-2</span>*b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>-c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">3.0</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #ffee00">;Построение кривой</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> t#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> stp<br />
&nbsp;tt#=t#*t#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> nn=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; oc<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=a#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*tt#*t#+b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*tt#+c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*t#+d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> t#&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Line</span> oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,x,y<br />
&nbsp;x=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;y=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #ffee00">;Отображение направляющих отрезков, относящихся к кривой, и ее вершин</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> dt1\dx2&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> dt1\dy2&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> dt1\x,dt1\y,dt1\x+dt1\dx2,dt1\y+dt1\dy2<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Oval</span> dt1\x+dt1\dx2<span style="color: #33ffdd;">-1</span>,dt1\y+dt1\dy2<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> dt2\dx1&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> dt2\dy1&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> dt2\x,dt2\y,dt2\x-dt2\dx1,dt2\y-dt2\dy1<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Oval</span> dt2\x-dt2\dx1<span style="color: #33ffdd;">-1</span>,dt2\y-dt2\dy1<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.98.D0.BD.D1.82.D0.B5.D1.80.D1.84.D0.B5.D0.B9.D1.81"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A0%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%BE%D1%80_%D0%B4%D0%B2%D1%83%D0%BC%D0%B5%D1%80%D0%BD%D1%8B%D1%85_%D0%BA%D1%80%D0%B8%D0%B2%D1%8B%D1%85&amp;action=edit&amp;section=2" title="Редактор двумерных кривых">править</a>]</span> <span class="mw-headline">Интерфейс</span></h2>
<p>Возможные операции: перемещение / вставка / удаление точки, изменение координат векторов. Здесь возникает следующая задача: необходима функция, распознающая объект под курсором мыши. Придется перебирать каждый объект и проверять его.
</p><p>Для вершин существуют несколько методов проверки на касание курсором: проверка на совпадение координат (недостаток - сложно выделить объект, нужна большая точность), квадратная зона вокруг вершины (путем отсечения полуплоскостей) и круглая зона (вычисление расстояния между курсором и вершиной). Воспользуемся вторым методом.
</p><p>При выделении кривой можно использовать подобные методы, проверяя промежуточные точки, но очевидным недостатком будут разрывы в области поиска при "разрежении" массива точек. Поэтому, будет лучше использовать другой метод - разбиение кривой на отрезки и проверка на пересечение ее зоны коллизии и курсора. Это довольно интересная задача: сначала нужно определить, находится ли курсор в прямоугольнике, который ограничивает отрезок (берем минимальные и максимальные значения x и y вершин отрезка и добавляем бордюр в 3 пиксела). Затем определяется расстояние до линии, которой принадлежит отрезок и если оно меньше или равно 3, значит можно выделять линию. Найти коэффициенты уравнения линии, проходящей через 2 точки отрезка можно следующим образом:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Curves01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Curves01.gif" src="yl_v2up6.gif" width="277" height="63" /></a></span></div></div>
<p>Теперь можно найти расстояние от точки до этой линии:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Curves02.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Curves02.gif" src="s9cph788.gif" width="439" height="43" /></a></span></div></div>
<p>Переменная sel определяет текущий выбранный объект: 0 - ничего, 1 - вершина, 2 - кривая. Когда курсор проходит над объектом - объект выделяется, если курсор уходит от объекта - выделение снимается. Еще немного кода и можно перемещать вершины и делить кривую новой вершиной (ПКМ). Но для того, чтобы редактировать вектора нужно, чтобы определенная вершина была выделена независимо от положения курсора. Для этого введем новое значение - sel=3 (вершина выделяется ЛКМ). При этом, клавишами "1" и "2" можно изменять первый или второй, а клавишей "3" - оба вектора сразу. "0" обнуляет вектора, "Del" удаляет вершину. Добавим возможность загрузки и записи кривой в файл "data.bb".
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> dot<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x,y,dx1,dy1,dx2,dy2<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> xres=<span style="color: #33ffdd;">800</span>, yres=<span style="color: #33ffdd;">600</span>, stp#=.<span style="color: #33ffdd;">01</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> seldot.dot, sel, mx, my<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> a#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,b#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,c#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,d#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> xres,yres,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<br />
dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
dt\x=.<span style="color: #33ffdd;">5</span>*xres<br />
dt\y=.<span style="color: #33ffdd;">25</span>*yres<br />
dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
dt\x=.<span style="color: #33ffdd;">5</span>*xres<br />
dt\y=.<span style="color: #33ffdd;">75</span>*yres<br />
<br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
&nbsp;redraw<br />
<br />
&nbsp;mx=<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;my=<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #ffee00">;Эта переменная будет принимать значение 1, если нажата левая и 2, если правая</span><br />
&nbsp;<span style="color: #ffee00">; кнопка мыши</span><br />
&nbsp;mb=<span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+2</span>*<span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Выбор действия в зависимости от нажатой кнопки и выбранного объекта</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> mb+sel*<span style="color: #33ffdd;">10</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">11</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Если нажата левая кнопка мыши и под курсором находится вершина - фиксируем ее</span><br />
&nbsp; &nbsp;sel=<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">31</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Если нажата левая кнопка мыши при зафиксированной вершине - перепроверяем</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">; выделение</span><br />
&nbsp; &nbsp;sel=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;redraw<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> sel=<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">12</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Нажата правая кнопка мыши при выбранной вершине - перемещаем вершину</span><br />
&nbsp; &nbsp;seldot\x=mx<br />
&nbsp; &nbsp;seldot\y=my<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">22</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Нажата правая кнопка мыши при выбранной линии - вставляем вершину</span><br />
&nbsp; &nbsp;dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
&nbsp; &nbsp;dt\x=mx<br />
&nbsp; &nbsp;dt\y=my<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Insert</span> dt <span style="color: #aaffff; font-weight: bold;">After</span> seldot<br />
&nbsp; &nbsp;seldot=dt<br />
&nbsp; &nbsp;sel=<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Блок изменения векторов</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">3</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Нажата клавиша &quot;2&quot; - изменяем второй вектор</span><br />
&nbsp; &nbsp;seldot\dx1=seldot\x-mx<br />
&nbsp; &nbsp;seldot\dy1=seldot\y-my<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">4</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Изменяем первый вектор</span><br />
&nbsp; &nbsp;seldot\dx2=mx-seldot\x<br />
&nbsp; &nbsp;seldot\dy2=my-seldot\y<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">4</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #ffee00">;И второй, если нажата клавиша &quot;3&quot; а не &quot;2&quot;</span><br />
&nbsp; &nbsp; seldot\dx1=mx-seldot\x<br />
&nbsp; &nbsp; seldot\dy1=my-seldot\y<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Если выбрана вершина, то...</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> sel=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #ffee00">;Удаление точки(&quot;Del&quot;)</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">211</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">After</span> <span style="color: #aaffff; font-weight: bold;">First</span> dot&lt;&gt;Last dot <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Delete</span> seldot<br />
&nbsp; &nbsp;sel=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #ffee00">;Обнуление векторов, если нажат &quot;0&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">11</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;seldot\dx1=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;seldot\dy1=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;seldot\dx2=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;seldot\dy2=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Запись кривой</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">60</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; f=<span style="color: #aaffff; font-weight: bold;">WriteFile</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;data.bb&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> dt.dot=<span style="color: #aaffff; font-weight: bold;">Each</span> dot<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">WriteLine</span> f,<span style="color: #00ff66;">&quot;Data &quot;</span>+dt\x+<span style="color: #00ff66;">&quot;,&quot;</span>+dt\y+<span style="color: #00ff66;">&quot;,&quot;</span>+dt\dx1+<span style="color: #00ff66;">&quot;,&quot;</span>+dt\dy1+<span style="color: #00ff66;">&quot;,&quot;</span>+dt\dx2+<span style="color: #00ff66;">&quot;,&quot;</span>+dt\dy2 &nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">CloseFile</span> f<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span> <br />
<br />
&nbsp;<span style="color: #ffee00">;Загрузка кривой</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">61</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> <span style="color: #aaffff; font-weight: bold;">Each</span> dot<br />
&nbsp; f=<span style="color: #aaffff; font-weight: bold;">ReadFile</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;data.bb&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">Eof</span><span style=" ">&#40;</span>f<span style=" ">&#41;</span><br />
&nbsp; &nbsp;dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
&nbsp; &nbsp;m$=<span style="color: #00ff66;">&quot;,&quot;</span>+<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">ReadLine</span><span style=" ">&#40;</span>f<span style=" ">&#41;</span>,<span style="color: #33ffdd;">6</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">6</span><br />
&nbsp; &nbsp; m$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>m$,<span style="color: #00ff66;">&quot;,&quot;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Select</span> n<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span>:dt\x=m$<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span>:dt\y=m$<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">3</span>:dt\dx1=m$<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">4</span>:dt\dy1=m$<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">5</span>:dt\dx2=m$<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">6</span>:dt\dy2=m$<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">CloseFile</span> f<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> redraw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Если выделение не зафиксировано, оно обновляется</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> sel&lt;<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span> sel=<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #ffee00">;Проверка на коллизию с точкой</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> dt.dot=<span style="color: #aaffff; font-weight: bold;">Each</span> dot<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>mx-dt\x<span style=" ">&#41;</span>&lt;=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>my-dt\y<span style=" ">&#41;</span>&lt;=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span> seldot=dt: sel=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> dt.dot=<span style="color: #aaffff; font-weight: bold;">Each</span> dot<br />
&nbsp;<span style="color: #ffee00">;Выделение точки</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Oval</span> dt\x<span style="color: #33ffdd;">-1</span>,dt\y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp;drawcurve dt<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> sel <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Oval</span> seldot\x<span style="color: #33ffdd;">-3</span>,seldot\y<span style="color: #33ffdd;">-3</span>,<span style="color: #33ffdd;">7</span>,<span style="color: #33ffdd;">7</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> drawcurve<span style=" ">&#40;</span>dt1.dot<span style=" ">&#41;</span><br />
dt2.dot=<span style="color: #aaffff; font-weight: bold;">After</span> dt1<br />
<span style="color: #aaffff; font-weight: bold;">If</span> dt2=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span><br />
<br />
r#=.<span style="color: #33ffdd;">05</span>*<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span><span style=" ">&#40;</span>dt1\x-dt2\x<span style=" ">&#41;</span>*<span style=" ">&#40;</span>dt1\x-dt2\x<span style=" ">&#41;</span>+<span style=" ">&#40;</span>dt1\y-dt2\y<span style=" ">&#41;</span>*<span style=" ">&#40;</span>dt1\y-dt2\y<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> nn=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> nn <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; v1=dt1\y<br />
&nbsp; v2=dt2\y<br />
&nbsp; c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=dt1\dy2*r#<br />
&nbsp; dy2#=dt2\dy1*r#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; v1=dt1\x<br />
&nbsp; v2=dt2\x<br />
&nbsp; c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=dt1\dx2*r#<br />
&nbsp; dy2#=dt2\dx1*r#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=v1<br />
&nbsp;b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=<span style="color: #33ffdd;">3.0</span>*v2-dy2#<span style="color: #33ffdd;">-2.0</span>*c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><span style="color: #33ffdd;">-3.0</span>*d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><br />
&nbsp;a#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=<span style=" ">&#40;</span>dy2#<span style="color: #33ffdd;">-2</span>*b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>-c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">3.0</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> t#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> stp<br />
&nbsp;tt#=t#*t#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> nn=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; oc<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=a#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*tt#*t#+b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*tt#+c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*t#+d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> t#&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">4</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Выделение текущей кривой</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> xx=<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> yy=<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+xx,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+yy,x+xx,y+yy<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,x,y<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Проверка на коллизию с отрезком кривой</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #ffee00">;Проверка нахождения курсора внутри ограничивающего прямоугольника</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> mx&gt;=min<span style=" ">&#40;</span>x,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">-3</span> <span style="color: #aaffff; font-weight: bold;">And</span> mx&lt;=max<span style=" ">&#40;</span>x,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+3</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> my&gt;=min<span style=" ">&#40;</span>y,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">-3</span> <span style="color: #aaffff; font-weight: bold;">And</span> my&lt;=max<span style=" ">&#40;</span>y,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+3</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; aa#=y-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; bb#=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>-x<br />
&nbsp; &nbsp; <span style="color: #ffee00">;Проверка расстояния от прямой</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>aa#*<span style=" ">&#40;</span>mx-x<span style=" ">&#41;</span>+bb#*<span style=" ">&#40;</span>my-y<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;=<span style="color: #33ffdd;">3.0</span>*<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>aa#*aa#+bb#*bb#<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;seldot=dt1<br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Это хитрый способ повторить построение кривой, выделив ее и заодно</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; при этом избавиться от проверки</span><br />
&nbsp; &nbsp; &nbsp;sel=<span style="color: #33ffdd;">4</span><br />
&nbsp; &nbsp; &nbsp;t#=-stp<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;x=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;y=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #ffee00">;Восстанавливаем значение sel</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">4</span> <span style="color: #aaffff; font-weight: bold;">Then</span> sel=<span style="color: #33ffdd;">2</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> dt1\dx2&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> dt1\dy2&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> dt1\x,dt1\y,dt1\x+dt1\dx2,dt1\y+dt1\dy2<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Oval</span> dt1\x+dt1\dx2<span style="color: #33ffdd;">-1</span>,dt1\y+dt1\dy2<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> dt2\dx1&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> dt2\dy1&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> dt2\x,dt2\y,dt2\x-dt2\dx1,dt2\y-dt2\dy1<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Oval</span> dt2\x-dt2\dx1<span style="color: #33ffdd;">-1</span>,dt2\y-dt2\dy1<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> min<span style=" ">&#40;</span>v1,v2<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> v1&lt;v2 <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> v1 <span style="color: #aaffff; font-weight: bold;">Else</span> <span style="color: #aaffff; font-weight: bold;">Return</span> v2<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> max<span style=" ">&#40;</span>v1,v2<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> v1&gt;v2 <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> v1 <span style="color: #aaffff; font-weight: bold;">Else</span> <span style="color: #aaffff; font-weight: bold;">Return</span> v2<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/b/ba/2D_Curves.zip" class="internal" title="2D Curves.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Тела вращения"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Тела вращения&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Тела вращения&amp;action=edit">править</a>]</span><span class="mw-headline">Тела вращения</span></h1>
<p>Как известно, тела вращения - это трехмерные фигуры, полученные вращением двумерных фигур вокруг выбираемой произвольно оси. Вот простейшие тела вращения - цилиндр, конус, усеченный конус, шар, тор, а также более комплексное - бокал, получаемые вращением фигур слева вокруг оси в центре:
</p>
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3D01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3D01.gif" src="0j0k_rj3.gif" width="610" height="305" /></a></span></div></div>
<a name=".D0.A1.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D0.B5_.D1.82.D0.B5.D0.BB_.D0.B2.D1.80.D0.B0.D1.89.D0.B5.D0.BD.D0.B8.D1.8F"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D0%B5%D0%BB%D0%B0_%D0%B2%D1%80%D0%B0%D1%89%D0%B5%D0%BD%D0%B8%D1%8F&amp;action=edit&amp;section=1" title="Тела вращения">править</a>]</span> <span class="mw-headline">Создание тел вращения</span></h2>
<p>Для начала, разберемся с тем, как работают функции Blitz3D, создающие тела вращения. Взгляните на рисунок:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3D02.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3D02.gif" src="d6nr2_q9.gif" width="500" height="246" /></a></span></div></div>
<p>Если цилиндр сгенерирован довольно неплохо (минимум граней - максимум сходства), то на сферу треугольники расходуются неэффективно. Сфера построена по принципу разбивки глобуса меридианами и параллелями на квадратоподобные секции: получается, что у полюсов они гораздо уже, чем у экватора.
</p><p>Итак, чтобы построить трехмерное тело, вернее его оболочку из треугольников, прежде всего необходимо определить контур и ось вращения. Усложним задачу - контур будет задан кривой. Естественно, кривую нужно будет преобразовать в ломаную, то есть разбить на отрезки. Каждый отрезок, вращаясь вокруг оси даст усеченный конус без оснований. Поэтому на втором этапе необходимо построить конуса для всех отрезков.
</p><p>Первый этап: как построить кривую уже было рассказано, теперь как эту кривую разбить на отрезки? Сначала необходимо определить степень детализации (sen#) - на сколько единиц (в данном случае - пикселов) допустимо отклонение ломаной от кривой. Необходимо построить такую ломаную, чтобы, расширив ее на заданное кол-во пикселов, можно было покрыть ей кривую:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3D03.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3D03.gif" src="sb_y1x7v.gif" width="598" height="195" /></a></span></div></div>
<p>Как видно из рисунка, кривая вписывается в набор "корридоров", которые задают ломаную. Здесь возникают два вопроса, на которые не так-то легко найти ответы: как определить угол "корридора" от заданной точки и точку, в которой кривая пересекается с этим "корридором". Найти идеальный алгоритм (результат которого показан на рисунке) мне пока не удалось (возможно, тогда придется решать обе задачи сразу), поэтому приравняем направление "корридора" к направлению касательной к кривой в исходной точке. Точку пересечения определить с помощью формул, в принципе, можно, но как-то не хочется искать корни кубического уравнения (попробуйте найти точку сами, если есть желание). Пойдем более простым путем - определим шаг (точка кривой по формулам из предыдущей статьи определяется исходя из параметра t, изменяющегося от 0 - начало кривой до 1 - конец кривой, поэтому вполне достаточна одна сотая) и будем двигаться вдоль кривой, пока не выйдем за пределы "корридора". После этого определяем отрезок, устанавливаем новый "корридор" от полученной точки и продолжаем весь процесс по достижении конца кривой:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3D04.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3D04.gif" src="nf7juq98.gif" width="604" height="208" /></a></span></div></div>
<p>"Корридор" расширяется в 2 раза, т. к. начальная точка всегда находится в его середине и отклонение будет по крайней мере в 2 раза меньше. На самом деле оно обычно еще меньше, поэтому детализация увеличивается, но из-за особенностей данного метода количество отрезков увеличивается тоже. Еще один момент: линия может выйти за пределы окружности (sen# &gt; 2 * R), тогда количество точек = 1.
</p><p>Второй этап: построение конуса. Метод, в котором количество вершин на каждой окружности фиксировано (так Blitz строит сферу) не подходит. Тогда необходимо задать формулу, определяющую количество вершин для окружности (и, соответственно, тип многоугольника, ее представляющий), в зависимости от радиуса. Возьмем окружность с центром в точке (0,0) и радиусом R. Руководствуясь алгоритмом построения кривой, начав от точки (0,R), в которой касательная параллельна оси OY, нужно было бы, двигаясь по окружности, определить точку, расстояние от которой будет больше или равно sen# - это и будет первый отрезок. Так как кривизна окружности в каждой точке одинакова, то отрезки будут равны (последний в расчет не берем), значит дуги тоже будут равны, поэтому достаточно найти угол между двумя радиусами к соседним точкам, чтобы найти количество точек на окружности и задать их координаты. Точка, в которой расстояние равно sen# - это точка пересечения между линией, параллельной касательной и отстоящей от нее влево на sen# единиц:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3D05.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3D05.gif" src="ik5umj0_.gif" width="492" height="289" /></a></span></div></div>
<p>Установка вершин завершена, теперь дело за треугольниками. Представим развертку конуса прямоугольником, на верхней стороне которого 6 точек, на нижней 8. Они разбивают стороны на 5 и 7 отрезков соответственно. Вот очень эффективный способ разбивки на треугольники (по шагам):
</p>
<ul><li>Начинаем с крайних левых точек. Верхняя - А, нижняя - Б.
</li><li>Определяем следующую по x-координате точку (она может быть из верхнего или нижнего ряда, если две точки имеют одинаковые координаты x, берем верхнюю). Пусть это будет В.
</li><li>Добавляем треугольник АБВ.
</li><li>Если В на той же стороне, что и А, то А = В, иначе Б = В.
</li><li>Повторяем процесс (переходим на пункт 2) пока точки А и Б не окажутся крайними правыми.
</li></ul>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3D06.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3D06.gif" src="gof0gln8.gif" width="360" height="70" /></a></span></div></div>
<p>Не стоит делать каждый конус отдельно - пусть вторые вершины одного конуса будут первыми следующего, так, чтобы получилась своеобразная труба.
</p>
<a name=".D0.A0.D0.B5.D0.B4.D0.B0.D0.BA.D1.82.D0.BE.D1.80_.D1.82.D0.B5.D0.BB_.D0.B2.D1.80.D0.B0.D1.89.D0.B5.D0.BD.D0.B8.D1.8F"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D0%B5%D0%BB%D0%B0_%D0%B2%D1%80%D0%B0%D1%89%D0%B5%D0%BD%D0%B8%D1%8F&amp;action=edit&amp;section=2" title="Тела вращения">править</a>]</span> <span class="mw-headline">Редактор тел вращения</span></h2>
<p>Для создания такого редактора, воспользуемся программой из предыдущей статьи и немного изменим ее. Одна половина экрана будет отведена для редактирования кривой, вторая - для просмотра вращающейся трехмерной фигуры (формируется при нажатии "Enter"). Очень красиво смотрятся блики (команда EntityShininess).
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> dot<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x,y,dx1,dy1,dx2,dy2<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> xres=<span style="color: #33ffdd;">800</span>, yres=<span style="color: #33ffdd;">600</span>, stp#=.<span style="color: #33ffdd;">01</span>, sen#=<span style="color: #33ffdd;">2</span>, maxr#=<span style="color: #33ffdd;">20</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> xres2=xres <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">1</span>, yres2=yres <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> seldot.dot, sel, mx, my<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> a#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,b#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,c#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,d#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,oc#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> xres,yres,<span style="color: #33ffdd;">32</span><br />
<span style="color: #ffee00">;Слаживание линий</span><br />
<span style="color: #aaffff; font-weight: bold;">AntiAlias</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #ffee00">;WireFrame True</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">-2.1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-4</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">45</span>,<span style="color: #33ffdd;">45</span><br />
<span style="color: #ffee00">;Создание модели</span><br />
m=<span style="color: #aaffff; font-weight: bold;">CreateMesh</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span>m<span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Создание блика на модели</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityShininess</span> m,<span style="color: #33ffdd;">1</span><br />
<br />
dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
dt\x=.<span style="color: #33ffdd;">5</span>*xres<br />
dt\y=.<span style="color: #33ffdd;">15</span>*yres<br />
dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
dt\x=.<span style="color: #33ffdd;">5</span>*xres<br />
dt\y=.<span style="color: #33ffdd;">85</span>*yres<br />
<br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Вращаем модель</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> m,.<span style="color: #33ffdd;">3</span>,.<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">0</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #00ff66;">&quot;Triangles rendered:&quot;</span>+<span style="color: #aaffff; font-weight: bold;">TrisRendered</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<br />
&nbsp;<span style="color: #ffee00">;Рисуем ось</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">128</span>,<span style="color: #33ffdd;">128</span>,<span style="color: #33ffdd;">128</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> xres2,<span style="color: #33ffdd;">0</span>,xres2,yres<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<br />
&nbsp;redraw<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span> <br />
<br />
&nbsp;mx=<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;my=<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;mb=<span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+2</span>*<span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> mb+sel*<span style="color: #33ffdd;">10</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">11</span><br />
&nbsp; &nbsp;sel=<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">31</span><br />
&nbsp; &nbsp;sel=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;redraw<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> sel=<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">12</span><br />
&nbsp; &nbsp;seldot\x=min<span style=" ">&#40;</span>mx,xres2<span style=" ">&#41;</span><br />
&nbsp; &nbsp;seldot\y=my<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">22</span><br />
&nbsp; &nbsp;dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
&nbsp; &nbsp;dt\x=mx<br />
&nbsp; &nbsp;dt\y=my<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Insert</span> dt <span style="color: #aaffff; font-weight: bold;">After</span> seldot<br />
&nbsp; &nbsp;seldot=dt<br />
&nbsp; &nbsp;sel=<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">3</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;seldot\dx1=seldot\x-mx<br />
&nbsp; &nbsp;seldot\dy1=seldot\y-my<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">4</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;seldot\dx2=mx-seldot\x<br />
&nbsp; &nbsp;seldot\dy2=my-seldot\y<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">4</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; seldot\dx1=mx-seldot\x<br />
&nbsp; &nbsp; seldot\dy1=my-seldot\y<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> sel=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">211</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">After</span> <span style="color: #aaffff; font-weight: bold;">First</span> dot&lt;&gt;Last dot <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Delete</span> seldot<br />
&nbsp; &nbsp;sel=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">11</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;seldot\dx1=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;seldot\dy1=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;seldot\dx2=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;seldot\dy2=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Формирование модели (&quot;ENTER&quot;)</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">28</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #ffee00">;Очистка поверхности</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ClearSurface</span> s<br />
&nbsp; rbeg=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> dt1.dot=<span style="color: #aaffff; font-weight: bold;">Each</span> dot<br />
&nbsp; &nbsp;dt2.dot=<span style="color: #aaffff; font-weight: bold;">After</span> dt1<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> dt2=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp;kcalc dt1,dt2<br />
&nbsp; &nbsp;t#=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;tt#=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=d#<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=d#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Формирование начального кольца вершин</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> dt1=<span style="color: #aaffff; font-weight: bold;">First</span> dot <span style="color: #aaffff; font-weight: bold;">Then</span> r1=vertexes<span style=" ">&#40;</span>s<span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp; x#=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; y#=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffee00">;Вычисление коэффициентов касательной - производных многочлена</span><br />
&nbsp; &nbsp; la#=<span style="color: #33ffdd;">-3.0</span>*a#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>*tt#<span style="color: #33ffdd;">-2.0</span>*b#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>*t#-c#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; lb#=<span style="color: #33ffdd;">3.0</span>*a#<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>*tt#<span style="color: #33ffdd;">+2.0</span>*b#<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>*t#+c#<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffee00">;Если A и B равны нулю - определяем грубым способом</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> la#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> lb#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;la#=dt1\y-dt2\y<br />
&nbsp; &nbsp; &nbsp;lb#=dt2\x-dt1\x<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp; lc#=-la#*x#-lb#*y#<br />
&nbsp; &nbsp; <span style="color: #ffee00">;Предварительные вычисления для условия выхода</span><br />
&nbsp; &nbsp; sen2#=<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>la#*la#+lb#*lb#<span style=" ">&#41;</span>*sen#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span> <br />
&nbsp; &nbsp; &nbsp;t#=t#+stp<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> t#&gt;<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> t#=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp;tt#=t#*t#<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> nn=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; oc<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=a#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*tt#*t#+b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*tt#+c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*t#+d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Здесь определяется, превысила ли длина отрезка максимальную (тогда выходим)</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span><span style=" ">&#40;</span>x#-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span>*<span style=" ">&#40;</span>x#-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span>+<span style=" ">&#40;</span>y#-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span>*<span style=" ">&#40;</span>y#-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;maxr <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Проверка на превышение расстояния до касательной в исходной точке</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Until</span> t#=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>la#*oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+lb#*oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+lc#<span style=" ">&#41;</span>&gt;=sen2#<br />
&nbsp; &nbsp; <span style="color: #ffee00">;Добавление кольца вершин для конечной точки отрезка</span><br />
&nbsp; &nbsp; r2=vertexes<span style=" ">&#40;</span>s<span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffee00">;Процедура создания усовершенствованного усеченного конуса</span><br />
&nbsp; &nbsp; rbeg2=rbeg+r1<br />
&nbsp; &nbsp; r10=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; r20=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Выбор ближайшей вершины и задание соответствующего треугольника</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>r10<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>*r2&lt;<span style=" ">&#40;</span>r20<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>*r1 <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; r10=r10<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp; r11=r12<br />
&nbsp; &nbsp; &nbsp; r12=r10 <span style="color: #aaffff; font-weight: bold;">Mod</span> r1<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,rbeg2+r22,rbeg+r11,rbeg+r12<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; r20=r20<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp; r21=r22<br />
&nbsp; &nbsp; &nbsp; r22=r20 <span style="color: #aaffff; font-weight: bold;">Mod</span> r2<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,rbeg+r12,rbeg2+r22,rbeg2+r21<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Until</span> r12=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> r22=<span style="color: #33ffdd;">0</span><br />
<br />
&nbsp; &nbsp; rbeg=rbeg2<br />
&nbsp; &nbsp; r1=r2<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> t#=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">UpdateNormals</span> m<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">60</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; f=<span style="color: #aaffff; font-weight: bold;">WriteFile</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;data.bb&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> dt.dot=<span style="color: #aaffff; font-weight: bold;">Each</span> dot<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">WriteLine</span> f,<span style="color: #00ff66;">&quot;Data &quot;</span>+dt\x+<span style="color: #00ff66;">&quot;,&quot;</span>+dt\y+<span style="color: #00ff66;">&quot;,&quot;</span>+dt\dx1+<span style="color: #00ff66;">&quot;,&quot;</span>+dt\dy1+<span style="color: #00ff66;">&quot;,&quot;</span>+dt\dx2+<span style="color: #00ff66;">&quot;,&quot;</span>+dt\dy2 &nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">CloseFile</span> f<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span> <br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">61</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> <span style="color: #aaffff; font-weight: bold;">Each</span> dot<br />
&nbsp; f=<span style="color: #aaffff; font-weight: bold;">ReadFile</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;data.bb&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">Eof</span><span style=" ">&#40;</span>f<span style=" ">&#41;</span><br />
&nbsp; &nbsp;dt.dot=<span style="color: #aaffff; font-weight: bold;">New</span> dot<br />
&nbsp; &nbsp;dat$=<span style="color: #00ff66;">&quot;,&quot;</span>+<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">ReadLine</span>$<span style=" ">&#40;</span>f<span style=" ">&#41;</span>,<span style="color: #33ffdd;">6</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">6</span><br />
&nbsp; &nbsp; dat$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>dat$,<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>dat$,<span style="color: #00ff66;">&quot;,&quot;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Select</span> n<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span>:dt\x=dat$<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span>:dt\y=dat$<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">3</span>:dt\dx1=dat$<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">4</span>:dt\dy1=dat$<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">5</span>:dt\dx2=dat$<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">6</span>:dt\dy2=dat$<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">CloseFile</span> f<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span> <br />
&nbsp;<br />
<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> redraw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> sel&lt;<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span> sel=<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> dt.dot=<span style="color: #aaffff; font-weight: bold;">Each</span> dot<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>mx-dt\x<span style=" ">&#41;</span>&lt;=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>my-dt\y<span style=" ">&#41;</span>&lt;=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span> seldot=dt: sel=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> dt.dot=<span style="color: #aaffff; font-weight: bold;">Each</span> dot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Oval</span> dt\x<span style="color: #33ffdd;">-1</span>,dt\y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp;drawcurve dt<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> sel <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Oval</span> seldot\x<span style="color: #33ffdd;">-3</span>,seldot\y<span style="color: #33ffdd;">-3</span>,<span style="color: #33ffdd;">7</span>,<span style="color: #33ffdd;">7</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> drawcurve<span style=" ">&#40;</span>dt1.dot<span style=" ">&#41;</span><br />
dt2.dot=<span style="color: #aaffff; font-weight: bold;">After</span> dt1<br />
<span style="color: #aaffff; font-weight: bold;">If</span> dt2=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span><br />
<br />
kcalc dt1,dt2<br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> t#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> stp<br />
&nbsp;tt#=t#*t#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> nn=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; oc<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=a#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*tt#*t#+b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*tt#+c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>*t#+d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> t#&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">4</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> xx=<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> yy=<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+xx,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+yy,x+xx,y+yy<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,x,y<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> mx&gt;=min<span style=" ">&#40;</span>x,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">-3</span> <span style="color: #aaffff; font-weight: bold;">And</span> mx&lt;=max<span style=" ">&#40;</span>x,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+3</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> my&gt;=min<span style=" ">&#40;</span>y,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">-3</span> <span style="color: #aaffff; font-weight: bold;">And</span> my&lt;=max<span style=" ">&#40;</span>y,oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+3</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; aa#=y-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; bb#=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>-x<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>aa#*<span style=" ">&#40;</span>mx-x<span style=" ">&#41;</span>+bb#*<span style=" ">&#40;</span>my-y<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;=<span style="color: #33ffdd;">3.0</span>*<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>aa#*aa#+bb#*bb#<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;seldot=dt1<br />
&nbsp; &nbsp; &nbsp;sel=<span style="color: #33ffdd;">4</span><br />
&nbsp; &nbsp; &nbsp;t#=-stp<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;x=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;y=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> sel=<span style="color: #33ffdd;">4</span> <span style="color: #aaffff; font-weight: bold;">Then</span> sel=<span style="color: #33ffdd;">2</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> dt1\dx2&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> dt1\dy2&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> dt1\x,dt1\y,dt1\x+dt1\dx2,dt1\y+dt1\dy2<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Oval</span> dt1\x+dt1\dx2<span style="color: #33ffdd;">-1</span>,dt1\y+dt1\dy2<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> dt2\dx1&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> dt2\dy1&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> dt2\x,dt2\y,dt2\x-dt2\dx1,dt2\y-dt2\dy1<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Oval</span> dt2\x-dt2\dx1<span style="color: #33ffdd;">-1</span>,dt2\y-dt2\dy1<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> min<span style=" ">&#40;</span>v1,v2<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> v1&lt;v2 <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> v1 <span style="color: #aaffff; font-weight: bold;">Else</span> <span style="color: #aaffff; font-weight: bold;">Return</span> v2<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> max<span style=" ">&#40;</span>v1,v2<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> v1&gt;v2 <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> v1 <span style="color: #aaffff; font-weight: bold;">Else</span> <span style="color: #aaffff; font-weight: bold;">Return</span> v2<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> kcalc<span style=" ">&#40;</span>dt1.dot,dt2.dot<span style=" ">&#41;</span><br />
r#=.<span style="color: #33ffdd;">05</span>*<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span><span style=" ">&#40;</span>dt1\x-dt2\x<span style=" ">&#41;</span>*<span style=" ">&#40;</span>dt1\x-dt2\x<span style=" ">&#41;</span>+<span style=" ">&#40;</span>dt1\y-dt2\y<span style=" ">&#41;</span>*<span style=" ">&#40;</span>dt1\y-dt2\y<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> nn=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> nn <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; x1=dt1\y<br />
&nbsp; x2=dt2\y<br />
&nbsp; c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=r#*dt1\dy2<br />
&nbsp; dy2#=r#*dt2\dy1<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; x1=dt1\x<br />
&nbsp; x2=dt2\x<br />
&nbsp; c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=r#*dt1\dx2<br />
&nbsp; dy2#=r#*dt2\dx1<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=x1<br />
&nbsp;b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=<span style="color: #33ffdd;">3.0</span>*x2-dy2#<span style="color: #33ffdd;">-2.0</span>*c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><span style="color: #33ffdd;">-3.0</span>*d#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><br />
&nbsp;a#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>=<span style=" ">&#40;</span>dy2#<span style="color: #33ffdd;">-2</span>*b#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span>-c#<span style=" ">&#40;</span>nn<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">3.0</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> vertexes<span style=" ">&#40;</span>s<span style=" ">&#41;</span><br />
vx#=<span style="color: #33ffdd;">1.0</span>*<span style=" ">&#40;</span>xres2-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span>/yres2<br />
vy#=<span style="color: #33ffdd;">1.0</span>*<span style=" ">&#40;</span>yres2-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span>/yres2<br />
r=<span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>xres2-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> sen&gt;=r*<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;r=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">0</span>,vy#,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp;r=<span style="color: #aaffff; font-weight: bold;">Ceil</span><span style=" ">&#40;</span><span style="color: #33ffdd;">360.0</span>/<span style="color: #aaffff; font-weight: bold;">ACos</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1.0</span>-sen#/r<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp;ang#=<span style="color: #33ffdd;">0</span><br />
&nbsp;dang#=<span style="color: #33ffdd;">360.0</span>/r<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>*vx#,vy#,<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>*vx#<br />
&nbsp; ang#=ang#+dang#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> ang#&gt;<span style="color: #33ffdd;">359.9</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> r<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D1.80"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D0%B5%D0%BB%D0%B0_%D0%B2%D1%80%D0%B0%D1%89%D0%B5%D0%BD%D0%B8%D1%8F&amp;action=edit&amp;section=3" title="Тела вращения">править</a>]</span> <span class="mw-headline">Пример</span></h2>
<p>На основе редактора можно сделать игру, где используется множество тел вращения - шахматы, но для начала хватит просто трехмерной доски с фигурами. Сделаем шаблоны каждой фигуры и расставим копии по местам, покрасив в соответствующий цвет. Единственная проблема - конь, его голову придется загрузить из <a href="http://blitzetcetera.org/images/9/9f/ChessKnight.zip" class="internal" title="ChessKnight.zip">модели</a>. Введем динамически меняющий направление источник света, а текстуру доски сгенерируем. Все это будет неплохо смотреться на градиентном фоне.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> xres=<span style="color: #33ffdd;">800</span>, yres=<span style="color: #33ffdd;">600</span>, stp#=.<span style="color: #33ffdd;">001</span>, sen#=<span style="color: #33ffdd;">4</span>, maxr#=<span style="color: #33ffdd;">30</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Const</span> txp=<span style="color: #33ffdd;">8</span>, txres=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> txp, txcp=txp<span style="color: #33ffdd;">-6</span>, txcell=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> txcp<span style="color: #33ffdd;">-1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> fg<span style=" ">&#40;</span><span style="color: #33ffdd;">5</span><span style=" ">&#41;</span>,a#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,b#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,c#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,d#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,oc#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> xres,yres,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">AntiAlias</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #ffee00">;WireFrame True</span><br />
<br />
<span style="color: #ffee00">;Пивот для удобного управления камерой</span><br />
p=<span style="color: #aaffff; font-weight: bold;">CreatePivot</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
cam=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>p<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> cam,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">3.5</span>,<span style="color: #33ffdd;">-7</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> cam,<span style="color: #33ffdd;">30</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #ffee00">;Эта строка нужна, чтобы фон не стирался перед рендерингом 3D-сцены</span><br />
<span style="color: #aaffff; font-weight: bold;">CameraClsMode</span> cam,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<br />
l=<span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> l,<span style="color: #33ffdd;">45</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #ffee00">;Создание шаблонов моделей</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> n1=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">5</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Read</span> q,x2,y2,dx21,dy21,dx22,dy22<br />
&nbsp;rbeg=<span style="color: #33ffdd;">0</span><br />
&nbsp;fg<span style=" ">&#40;</span>n1<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">CreateMesh</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #ffee00">;Сам шаблон должен быть невидим</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">HideEntity</span> fg<span style=" ">&#40;</span>n1<span style=" ">&#41;</span><br />
&nbsp;s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span>fg<span style=" ">&#40;</span>n1<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> n2=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">To</span> q<br />
&nbsp; x1=x2:y1=y2:dx11=dx21:dy11=dy21:dx12=dx22:dy12=dy22<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Read</span> x2,y2,dx21,dy21,dx22,dy22<br />
<br />
&nbsp; r#=.<span style="color: #33ffdd;">05</span>*<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span><span style=" ">&#40;</span>x1-x2<span style=" ">&#41;</span>*<span style=" ">&#40;</span>x1-x2<span style=" ">&#41;</span>+<span style=" ">&#40;</span>y1-y2<span style=" ">&#41;</span>*<span style=" ">&#40;</span>y1-y2<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> n3=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> n3 <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; ux1=y1<br />
&nbsp; &nbsp; ux2=y2<br />
&nbsp; &nbsp; c#<span style=" ">&#40;</span>n3<span style=" ">&#41;</span>=r#*dy12<br />
&nbsp; &nbsp; dy2#=r#*dy21<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; ux1=x1<br />
&nbsp; &nbsp; ux2=x2<br />
&nbsp; &nbsp; c#<span style=" ">&#40;</span>n3<span style=" ">&#41;</span>=r#*dx12<br />
&nbsp; &nbsp; dy2#=r#*dx21<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;d#<span style=" ">&#40;</span>n3<span style=" ">&#41;</span>=ux1<br />
&nbsp; &nbsp;b#<span style=" ">&#40;</span>n3<span style=" ">&#41;</span>=<span style="color: #33ffdd;">3.0</span>*ux2-dy2#<span style="color: #33ffdd;">-2.0</span>*c#<span style=" ">&#40;</span>n3<span style=" ">&#41;</span><span style="color: #33ffdd;">-3.0</span>*d#<span style=" ">&#40;</span>n3<span style=" ">&#41;</span><br />
&nbsp; &nbsp;a#<span style=" ">&#40;</span>n3<span style=" ">&#41;</span>=<span style=" ">&#40;</span>dy2#<span style="color: #33ffdd;">-2</span>*b#<span style=" ">&#40;</span>n3<span style=" ">&#41;</span>-c#<span style=" ">&#40;</span>n3<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">3.0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
&nbsp; t#=<span style="color: #33ffdd;">0</span><br />
&nbsp; tt#=<span style="color: #33ffdd;">0</span><br />
&nbsp; oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=d#<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=d#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> n2=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span> r1=vertexes<span style=" ">&#40;</span>s<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp;x#=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;y#=oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;la#=<span style="color: #33ffdd;">-3.0</span>*a#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>*tt#<span style="color: #33ffdd;">-2.0</span>*b#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>*t#-c#<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;lb#=<span style="color: #33ffdd;">3.0</span>*a#<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>*tt#<span style="color: #33ffdd;">+2.0</span>*b#<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>*t#+c#<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> la#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> lb#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; la#=y1-y2<br />
&nbsp; &nbsp; lb#=x2-x1<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;lc#=-la#*x#-lb#*y#<br />
&nbsp; &nbsp;sen2#=<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>la#*la#+lb#*lb#<span style=" ">&#41;</span>*sen#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Repeat</span> <br />
&nbsp; &nbsp; t#=t#+stp<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> t#&gt;<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> t#=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; tt#=t#*t#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> n3=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp;oc<span style=" ">&#40;</span>n3<span style=" ">&#41;</span>=a#<span style=" ">&#40;</span>n3<span style=" ">&#41;</span>*tt#*t#+b#<span style=" ">&#40;</span>n3<span style=" ">&#41;</span>*tt#+c#<span style=" ">&#40;</span>n3<span style=" ">&#41;</span>*t#+d#<span style=" ">&#40;</span>n3<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span><span style=" ">&#40;</span>x#-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span>*<span style=" ">&#40;</span>x#-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span>+<span style=" ">&#40;</span>y#-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span>*<span style=" ">&#40;</span>y#-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;maxr <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> t#=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>la#*oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+lb#*oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+lc#<span style=" ">&#41;</span>&gt;=sen2#<br />
&nbsp; &nbsp;r2=vertexes<span style=" ">&#40;</span>s<span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp;rbeg2=rbeg+r1<br />
&nbsp; &nbsp;r10=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;r20=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>r10<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>*r2&lt;<span style=" ">&#40;</span>r20<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>*r1 <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;r10=r10<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp;r11=r12<br />
&nbsp; &nbsp; &nbsp;r12=r10 <span style="color: #aaffff; font-weight: bold;">Mod</span> r1<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,rbeg2+r22,rbeg+r11,rbeg+r12<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp;r20=r20<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp;r21=r22<br />
&nbsp; &nbsp; &nbsp;r22=r20 <span style="color: #aaffff; font-weight: bold;">Mod</span> r2<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,rbeg+r12,rbeg2+r22,rbeg2+r21<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> r12=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> r22=<span style="color: #33ffdd;">0</span><br />
<br />
&nbsp; &nbsp;rbeg=rbeg2<br />
&nbsp; &nbsp;r1=r2<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> t#=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">UpdateNormals</span> fg<span style=" ">&#40;</span>n1<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #ffee00">;Загрузка и установка головы коня</span><br />
m=<span style="color: #aaffff; font-weight: bold;">LoadMesh</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;knight.3ds&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> m,.<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">1</span>,.<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> m,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,-.<span style="color: #33ffdd;">05</span><br />
<span style="color: #aaffff; font-weight: bold;">UpdateNormals</span> m<br />
<span style="color: #aaffff; font-weight: bold;">AddMesh</span> m,fg<span style=" ">&#40;</span><span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeEntity</span> m<br />
<br />
<span style="color: #ffee00">;Создание и расстановка фигур</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> x=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">7</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">7</span><br />
&nbsp; e=<span style="color: #33ffdd;">-1</span><br />
&nbsp; <span style="color: #ffee00">;Определение типа фигуры</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> y=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> y=<span style="color: #33ffdd;">7</span> <span style="color: #aaffff; font-weight: bold;">Then</span> e=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;43210234&quot;</span>,x<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> y=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> y=<span style="color: #33ffdd;">6</span> <span style="color: #aaffff; font-weight: bold;">Then</span> e=<span style="color: #33ffdd;">5</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> e&gt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Создание копии шаблона</span><br />
&nbsp; &nbsp;e=<span style="color: #aaffff; font-weight: bold;">CopyEntity</span><span style=" ">&#40;</span>fg<span style=" ">&#40;</span>e<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> e,x<span style="color: #33ffdd;">-3.5</span>,<span style="color: #33ffdd;">0</span>,y<span style="color: #33ffdd;">-3.5</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Определение цвета фигуры</span><br />
&nbsp; &nbsp;col=<span style="color: #33ffdd;">128</span>*<span style=" ">&#40;</span>y&lt;<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+48</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Вращение черного коня на 180 градусов (так как он несимметричен)</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> y&lt;<span style="color: #33ffdd;">4</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> e,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">180</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EntityColor</span> e,col,col,col<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EntityShininess</span> e,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #ffee00">;Создание фона (градиент от голубого к синему)</span><br />
bg=<span style="color: #aaffff; font-weight: bold;">CreateImage</span><span style=" ">&#40;</span>xres,yres<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>bg<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> yres<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">255</span><span style="color: #33ffdd;">-255</span>*y/yres,<span style="color: #33ffdd;">255</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Line</span> <span style="color: #33ffdd;">0</span>,y,xres,y<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #ffee00">;Отрисовка текстуры доски</span><br />
tex=<span style="color: #aaffff; font-weight: bold;">CreateTexture</span><span style=" ">&#40;</span>txres,txres<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">TextureBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> x=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">63</span><br />
&nbsp;ux=x <span style="color: #aaffff; font-weight: bold;">Shl</span> txcp<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">63</span><br />
&nbsp; uy=y <span style="color: #aaffff; font-weight: bold;">Shl</span> txcp<br />
&nbsp; col=<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #ffee00">;Определение цвета секции</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> x&gt;=<span style="color: #33ffdd;">4</span> <span style="color: #aaffff; font-weight: bold;">And</span> x&lt;<span style="color: #33ffdd;">60</span> <span style="color: #aaffff; font-weight: bold;">And</span> y&gt;=<span style="color: #33ffdd;">4</span> <span style="color: #aaffff; font-weight: bold;">And</span> y&lt;<span style="color: #33ffdd;">60</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Floor</span><span style=" ">&#40;</span><span style=" ">&#40;</span>x<span style="color: #33ffdd;">-4</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">7</span><span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Floor</span><span style=" ">&#40;</span><span style=" ">&#40;</span>y<span style="color: #33ffdd;">-4</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">7</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> col=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ElseIf</span> x&gt;=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">And</span> x&lt;<span style="color: #33ffdd;">61</span> <span style="color: #aaffff; font-weight: bold;">And</span> y&gt;=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">And</span> y&lt;<span style="color: #33ffdd;">61</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;col=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffee00">;Закраска секции с добавлением цветового шума</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> xx=ux <span style="color: #aaffff; font-weight: bold;">To</span> ux+txcell<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> yy=uy <span style="color: #aaffff; font-weight: bold;">To</span> uy+txcell<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-8</span>,<span style="color: #33ffdd;">8</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+192</span>*col<span style="color: #33ffdd;">+16</span>,<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-8</span>,<span style="color: #33ffdd;">8</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+128</span>*col<span style="color: #33ffdd;">+16</span>,<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-8</span>,<span style="color: #33ffdd;">8</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+16</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Plot</span> xx,yy<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span> &nbsp;<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #ffee00">;Создание доски</span><br />
brd=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
s=<span style="color: #aaffff; font-weight: bold;">GetSurface</span><span style=" ">&#40;</span>brd,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Корректировка текстурных координат доски</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">23</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">VertexY</span><span style=" ">&#40;</span>s,n<span style=" ">&#41;</span>&lt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">VertexTexCoords</span> s,n,<span style="color: #aaffff; font-weight: bold;">VertexU</span><span style=" ">&#40;</span>s,n<span style=" ">&#41;</span>,<span style="color: #33ffdd;">3.0</span>/<span style="color: #33ffdd;">64</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> brd,<span style="color: #33ffdd;">32.0</span>/<span style="color: #33ffdd;">7</span>,.<span style="color: #33ffdd;">25</span>,<span style="color: #33ffdd;">32.0</span>/<span style="color: #33ffdd;">7</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> brd,<span style="color: #33ffdd;">0</span>,-.<span style="color: #33ffdd;">25</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> brd,tex<br />
<br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #ffee00">;Поворот доски</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> p,<span style="color: #33ffdd;">0</span>,.<span style="color: #33ffdd;">4</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #ffee00">;Изменение направления света (так, чтобы он не светил вверх)</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> l,.<span style="color: #33ffdd;">2</span>,.<span style="color: #33ffdd;">3</span>,.<span style="color: #33ffdd;">3</span><br />
&nbsp;<span style="color: #ffee00">;Печать фона</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">DrawBlock</span> bg,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #00ff66;">&quot;Triangles rendered:&quot;</span>+<span style="color: #aaffff; font-weight: bold;">TrisRendered</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;Данные для построения кривых:</span><br />
<br />
<span style="color: #ffee00">;0-Король</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">24</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">391</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">391</span>,<span style="color: #33ffdd;">26</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">377</span>,<span style="color: #33ffdd;">26</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">377</span>,<span style="color: #33ffdd;">36</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">391</span>,<span style="color: #33ffdd;">36</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">391</span>,<span style="color: #33ffdd;">62</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">352</span>,<span style="color: #33ffdd;">79</span>,<span style="color: #33ffdd;">-5</span>,<span style="color: #33ffdd;">31</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">331</span>,<span style="color: #33ffdd;">74</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">355</span>,<span style="color: #33ffdd;">162</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-53</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">355</span>,<span style="color: #33ffdd;">177</span>,<span style="color: #33ffdd;">53</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">355</span>,<span style="color: #33ffdd;">190</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-53</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">355</span>,<span style="color: #33ffdd;">205</span>,<span style="color: #33ffdd;">53</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">326</span>,<span style="color: #33ffdd;">205</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-69</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">326</span>,<span style="color: #33ffdd;">219</span>,<span style="color: #33ffdd;">69</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">373</span>,<span style="color: #33ffdd;">219</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">341</span>,<span style="color: #33ffdd;">462</span>,<span style="color: #33ffdd;">-10</span>,<span style="color: #33ffdd;">28</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">351</span>,<span style="color: #33ffdd;">473</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-33</span>,<span style="color: #33ffdd;">14</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">295</span>,<span style="color: #33ffdd;">573</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">28</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">305</span>,<span style="color: #33ffdd;">573</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">305</span>,<span style="color: #33ffdd;">584</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">295</span>,<span style="color: #33ffdd;">584</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">295</span>,<span style="color: #33ffdd;">599</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">599</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #ffee00">;1-Ферзь</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">20</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">45</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">380</span>,<span style="color: #33ffdd;">53</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">391</span>,<span style="color: #33ffdd;">62</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">352</span>,<span style="color: #33ffdd;">79</span>,<span style="color: #33ffdd;">-5</span>,<span style="color: #33ffdd;">31</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">331</span>,<span style="color: #33ffdd;">74</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">30</span>,<span style="color: #33ffdd;">39</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">355</span>,<span style="color: #33ffdd;">162</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-53</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">355</span>,<span style="color: #33ffdd;">177</span>,<span style="color: #33ffdd;">53</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">355</span>,<span style="color: #33ffdd;">190</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-53</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">355</span>,<span style="color: #33ffdd;">205</span>,<span style="color: #33ffdd;">53</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">326</span>,<span style="color: #33ffdd;">205</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-69</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">326</span>,<span style="color: #33ffdd;">219</span>,<span style="color: #33ffdd;">69</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">373</span>,<span style="color: #33ffdd;">219</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">341</span>,<span style="color: #33ffdd;">462</span>,<span style="color: #33ffdd;">-10</span>,<span style="color: #33ffdd;">28</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">351</span>,<span style="color: #33ffdd;">473</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-33</span>,<span style="color: #33ffdd;">14</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">295</span>,<span style="color: #33ffdd;">573</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">28</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">305</span>,<span style="color: #33ffdd;">573</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">305</span>,<span style="color: #33ffdd;">584</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">295</span>,<span style="color: #33ffdd;">584</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">295</span>,<span style="color: #33ffdd;">599</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">599</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #ffee00">;2-Слон</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">18</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">84</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-46</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">392</span>,<span style="color: #33ffdd;">107</span>,<span style="color: #33ffdd;">24</span>,<span style="color: #33ffdd;">8</span>,<span style="color: #33ffdd;">6</span>,<span style="color: #33ffdd;">13</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">369</span>,<span style="color: #33ffdd;">162</span>,<span style="color: #33ffdd;">-29</span>,<span style="color: #33ffdd;">33</span>,<span style="color: #33ffdd;">-29</span>,<span style="color: #33ffdd;">33</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">366</span>,<span style="color: #33ffdd;">253</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-53</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">366</span>,<span style="color: #33ffdd;">266</span>,<span style="color: #33ffdd;">53</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">366</span>,<span style="color: #33ffdd;">292</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-53</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">366</span>,<span style="color: #33ffdd;">304</span>,<span style="color: #33ffdd;">53</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">346</span>,<span style="color: #33ffdd;">304</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-69</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">346</span>,<span style="color: #33ffdd;">317</span>,<span style="color: #33ffdd;">69</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">380</span>,<span style="color: #33ffdd;">317</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">352</span>,<span style="color: #33ffdd;">497</span>,<span style="color: #33ffdd;">-10</span>,<span style="color: #33ffdd;">28</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">359</span>,<span style="color: #33ffdd;">505</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-19</span>,<span style="color: #33ffdd;">15</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">309</span>,<span style="color: #33ffdd;">577</span>,<span style="color: #33ffdd;">-5</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">321</span>,<span style="color: #33ffdd;">577</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">321</span>,<span style="color: #33ffdd;">586</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">309</span>,<span style="color: #33ffdd;">586</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">309</span>,<span style="color: #33ffdd;">599</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">599</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #ffee00">;3-Конь</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">9</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">475</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">333</span>,<span style="color: #33ffdd;">475</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">345</span>,<span style="color: #33ffdd;">493</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">297</span>,<span style="color: #33ffdd;">578</span>,<span style="color: #33ffdd;">-2</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">310</span>,<span style="color: #33ffdd;">578</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">310</span>,<span style="color: #33ffdd;">586</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">297</span>,<span style="color: #33ffdd;">586</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">297</span>,<span style="color: #33ffdd;">599</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">599</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #ffee00">;4-Ладья</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">20</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">181</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">332</span>,<span style="color: #33ffdd;">181</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">332</span>,<span style="color: #33ffdd;">161</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">316</span>,<span style="color: #33ffdd;">161</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">316</span>,<span style="color: #33ffdd;">193</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">332</span>,<span style="color: #33ffdd;">193</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">332</span>,<span style="color: #33ffdd;">215</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">344</span>,<span style="color: #33ffdd;">215</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">344</span>,<span style="color: #33ffdd;">238</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">359</span>,<span style="color: #33ffdd;">238</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">359</span>,<span style="color: #33ffdd;">268</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">346</span>,<span style="color: #33ffdd;">454</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">333</span>,<span style="color: #33ffdd;">460</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">342</span>,<span style="color: #33ffdd;">473</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">309</span>,<span style="color: #33ffdd;">577</span>,<span style="color: #33ffdd;">-2</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">321</span>,<span style="color: #33ffdd;">577</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">321</span>,<span style="color: #33ffdd;">586</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">309</span>,<span style="color: #33ffdd;">586</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">309</span>,<span style="color: #33ffdd;">599</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">599</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #ffee00">;5-Пешка</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">13</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">209</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-37</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">375</span>,<span style="color: #33ffdd;">283</span>,<span style="color: #33ffdd;">31</span>,<span style="color: #33ffdd;">11</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">339</span>,<span style="color: #33ffdd;">334</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">382</span>,<span style="color: #33ffdd;">334</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">46</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">355</span>,<span style="color: #33ffdd;">501</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">339</span>,<span style="color: #33ffdd;">498</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">346</span>,<span style="color: #33ffdd;">512</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">309</span>,<span style="color: #33ffdd;">577</span>,<span style="color: #33ffdd;">-2</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">321</span>,<span style="color: #33ffdd;">577</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">321</span>,<span style="color: #33ffdd;">586</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">309</span>,<span style="color: #33ffdd;">586</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">309</span>,<span style="color: #33ffdd;">599</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">599</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> vertexes<span style=" ">&#40;</span>s<span style=" ">&#41;</span><br />
vx#=<span style="color: #33ffdd;">1.0</span>*<span style=" ">&#40;</span><span style="color: #33ffdd;">400</span>-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">300</span><br />
vy#=<span style="color: #33ffdd;">1.0</span>*<span style=" ">&#40;</span><span style="color: #33ffdd;">600</span>-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">300</span><br />
r1=<span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #33ffdd;">400</span>-oc<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> sen&gt;=r1*<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;r1=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">0</span>,vy#,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp;r1=<span style="color: #aaffff; font-weight: bold;">Ceil</span><span style=" ">&#40;</span><span style="color: #33ffdd;">360.0</span>/<span style="color: #aaffff; font-weight: bold;">ACos</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1.0</span>-sen#/r1<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp;ang#=<span style="color: #33ffdd;">0</span><br />
&nbsp;dang#=<span style="color: #33ffdd;">360.0</span>/r1<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>*vx#,vy#,<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>*vx#<br />
&nbsp; ang#=ang#+dang#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> ang#&gt;<span style="color: #33ffdd;">359.9</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> r1<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> max<span style=" ">&#40;</span>v1,v2<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> v1&gt;v2 <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> v1 <span style="color: #aaffff; font-weight: bold;">Else</span> <span style="color: #aaffff; font-weight: bold;">Return</span> v2<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/c/c5/Rotational_Bodies.zip" class="internal" title="Rotational Bodies.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Бесконечная «Жизнь»"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Бесконечная «Жизнь»&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Бесконечная «Жизнь»&amp;action=edit">править</a>]</span><span class="mw-headline">Бесконечная «Жизнь»</span></h1>
</p>
<a name=".D0.92.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%91%D0%B5%D1%81%D0%BA%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%C2%AB%D0%96%D0%B8%D0%B7%D0%BD%D1%8C%C2%BB&amp;action=edit&amp;section=1" title="Бесконечная «Жизнь»">править</a>]</span> <span class="mw-headline">Введение</span></h2>
<p>В этой заключительной статье из цикла, будем избавляться от основного ограничения предыдущего алгоритма - размера поля. Это, конечно, приведет к заметному снижению скорости, но в некоторых задачах без гигантского поля просто не обойтись. Если взять поле со стороной, скажем, миллион ячеек (не заполняя его клетками случайным образом и не обрабатывая при этом около 10<sup>12</sup> / 2 ячеек) и поместить туда организм, даже распространяющийся на все поле, то он будет состоять из относительно небольшого количества клеток, поэтому скороть будет вполне приемлемой. Естественно, бесконечность в буквальном смысле реализовать не удастся, но поля со стороной в 4 миллиарда ячеек (2<sup>32</sup>) будет вполне достаточно.
</p><p>Основная проблема алгоритмов "Жизни" состоит в определении, заполнена ли ячейка, соседняя с данной. До сих пор она легко решалась созданием массива для ячеек всего доступного поля. Теперь доступны два варианта решения (может быть есть и другие):
</p>
<ul><li>Разбить поле на квадратные блоки с фиксированным количеством ячеек и обрабатывать каждый блок отдельно. В таком случае, придется создать буфер по размеру блока, очищать и заполнять его информацией несколько раз за цикл (что существенно замедляет работу), создать массив для хранения координат активных блоков и, самое главное, обеспечить стыковку блоков. Попробуйте реализовать этот алгоритм самостоятельно.
</li><li>Организовать древовидную структуру доступа к ячейкам. При этом, создаются цепочки, позволяющие добраться до соседних пикселов. Мало того, что такой алгоритм сам по себе сложен, создание и удаление цепочек замедляет процесс. Но со всем этим вполне можно примириться. Рассмотрим этот алгоритм подробнее.
</li></ul>
<a name=".D0.9E.D0.B4.D0.BD.D0.BE.D0.BC.D0.B5.D1.80.D0.BD.D0.B0.D1.8F_.D0.B4.D1.80.D0.B5.D0.B2.D0.BE.D0.B2.D0.B8.D0.B4.D0.BD.D0.B0.D1.8F_.D1.81.D1.82.D1.80.D1.83.D0.BA.D1.82.D1.83.D1.80.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%91%D0%B5%D1%81%D0%BA%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%C2%AB%D0%96%D0%B8%D0%B7%D0%BD%D1%8C%C2%BB&amp;action=edit&amp;section=2" title="Бесконечная «Жизнь»">править</a>]</span> <span class="mw-headline">Одномерная древовидная структура</span></h2>
<p>Чтобы понять суть и преимущества древовидной структуры, еще раз коснемся принципов действия десятичной системы счисления. В древности люди для обозначения количества объектов делали зарубки, рисовали черточки или завязывали узелки (это не что иное, как 1-ричная система счисления). Но чтобы обозначить, скажем, 123 объекта, им пришлось бы делать 123 зарубки, в то время как нам достаточно написать 3 символа. То есть, взять один раз по сто, два по десять и еще три объекта. В итоге, чтобы "добраться" до искомого числа нам нужно сделать 3 а не 123 шага. Причем, при увеличении шагов, количество возможных чисел возрастает в геометрической прогрессии. Теперь взгляните, как можно построить древовидную структуру для двоичной системы:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Life3-01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Life3-01.gif" src="wssoxlmu.gif" width="480" height="180" /></a></span></div></div>
<p>Здесь три уровня, на каждом из которых можно продолжить движение вниз (0, темно-серый блок) или сделать шаг вправо (1, светло-серый блок). Чем выше уровень, тем больше шаг (степень двойки).Если все числа (блоки первого уровня - снизу) не нужны, то структуру можно упростить. Например, необходимы числа 1, 4, 6, 7:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Life3-02.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Life3-02.gif" src="832lzkxc.gif" width="480" height="180" /></a></span></div></div>
<p>Выберем блок №6 в качестве исходной точки и определим последовательность шагов для достижения каждого из оставшихся блоков: №7 - вверх, шаг вправо, вниз; №4 - вверх, вверх, шаг влево, вниз, вниз; №1 - вверх, вверх, шаг влево, вверх, шаг влево, вниз, вниз, шаг вправо, вниз. Нетрудно заметить, что путь разбивается на два этапа: 1 - движение вверх, к корню дерева (иногда - шаги влево), 2 - вниз к искомому блоку (иногда - шаги вправо). Т. к. при подъеме мы переходим на указатель более высокого уровня, то шаг влево совершается автоматически.
</p><p>В нашем алгоритме основное значение имеет указатель на исходный блок и положение конечного блока относительно исходного. Итак, дан исходный блок и приращение до конечного (N, dx). Теперь при поиске алгоритма создания пути возникают две задачи:  на сколько уровней подниматься, когда шагать вправо при спуске.
</p><p>Если приращение не равно 0 (в таком случае результат - исходный блок), то подъем вверх на один уровень обязателен. Поднимаясь от блоков №6 или №7, мы переходим на блок, с которого доступен переход на один из этих блоков. То есть, для данных (№6, +1) и (№7, -1) достаточно подняться только на один уровень. Будем отслеживать положение текущего блока изменением приращения. Рассмотрим ситуацию с поиском пути для данных (№7, -1): поднимаясь на блок более высокого уровня - "11", сделан шаг влево, увеличиваем приращение на 1 (так как мы приблизились к искомому блоку №6). Данные изменились - ("11",0). Для данных (№6, +1) результат подъема будет ("11", +1), т. к. шаг не был сделан. Так как от блока "11" можно сделать шаг (+1) или спуститься (+0), определим диапазон этого блока (он будет равен диапазону всех блоков этого уровня) - (0 - 1). Значит, для данных ("11", 0) и ("11", 1) подъем можно прекратить - приращения входят в диапазон блока.
</p><p>Данные (№6, -2), где искомый блок - №4: подъем вверх - ("11",-2), диапазон (0 - 1). Приращение в диапазон не попадает, поднимаемся еще. Заметьте, шаг увеличивается в 2 раза. Поэтому, т. к. сделан шаг влево - увеличиваем приращение не на 1, а на 2 - данные ("1", 0), диапазон тоже увеличивается в два раза - (0 - 3). Теперь можно спускаться.
</p><p>Еще более усложненный пример - данные (№6, -5), где искомый блок - №1. Подъем: (№6, -5), (0); ("11",-5), (0 - 1); ("1", -3), (0 - 3); ("корень", 1), (0 - 7). Подъем завершен, но как теперь правильно спуститься? Выручит двоичное представление приращения (оно теперь - 001). Так как в третьем разряде - 0, при спуске на третий уровень шаг вправо не делаем. То же самое и для второго уровня. В первом разряде - единица, поэтому шагаем вправо и приходим к искомому блоку.
</p><p>А что делать, если искомые блоки выходят за пределы дерева? Взгляните на схему (сверху - путь для (№7, +4), снизу - (№1, -4)):
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Life3-03.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Life3-03.gif" src="bwzmd-d_-2.gif" width="482" height="282" /></a></span></div></div>
<p>Cтруктуре придана гибкость за счет отказа от фиксированной нумерации блоков. Добавляются указатели четвертого уровня: в первом случае, бывший "корень" становится "темно-серым", чтобы можно было сделать шаг вправо к искомому блоку, во втором - "светло-серым", чтобы можно было сделать шаг влево. Еще один аспект - если соответствующие указатели отсутствуют, они создаются по мере надобности. Вообще, операция "надстройки" структуры повторяется до тех пор, пока блок не станет доступен (для отдаленных блоков).
</p>
<a name=".D0.9E.D1.81.D0.BE.D0.B1.D0.B5.D0.BD.D0.BD.D0.BE.D1.81.D1.82.D0.B8_.D0.B0.D0.BB.D0.B3.D0.BE.D1.80.D0.B8.D1.82.D0.BC.D0.B0_.2B_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D0.BC.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%91%D0%B5%D1%81%D0%BA%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D0%B0%D1%8F_%C2%AB%D0%96%D0%B8%D0%B7%D0%BD%D1%8C%C2%BB&amp;action=edit&amp;section=3" title="Бесконечная «Жизнь»">править</a>]</span> <span class="mw-headline">Особенности алгоритма + программа</span></h2>
<p>Так как поле двумерно, придется создавать двумерную древовидную структуру. Ее можно синтезировать из двух одномерных - для оси X и для оси Y. При этом возникают два нюанса: каждый указатель теперь указывает не на два, а на четыре указателя уровнем ниже. Указатель, в зависимости от уровня охватывает квадратную площадь, а подъем вверх завершается только тогда, когда искомый блок окажется в пределах этой площади (оба приращения будут лежать в диапазоне блока для каждой оси). Вот организмы: <a href="c5aj42ec.png" class="internal" title="Life-Locomotive.png">"паровоз"</a> и <a href="ukyx2srm.png" class="internal" title="Life-Virus.png">"вирус"</a>.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;Указатель и одновременно ячейка</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Type</span> ptr<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> nxt.ptr<span style=" ">&#91;</span><span style="color: #33ffdd;">3</span><span style=" ">&#93;</span> <span style="color: #ffee00">;следующие указатели в иерархии</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> prev.ptr <span style="color: #ffee00">;предыдущий указатель в иерархии</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> prevpos <span style="color: #ffee00">;расположение предыдущего указателя</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> neig.ptr<span style=" ">&#91;</span><span style="color: #33ffdd;">7</span><span style=" ">&#93;</span> <span style="color: #ffee00">;адреса соседей (для клетки)</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x,y,nq<span style="color: #ffee00">; координаты и количество соседей</span><br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #ffee00">;Указатели на ячейки, для которых возможно изменение состояния</span><br />
<span style="color: #aaffff; font-weight: bold;">Type</span> chang<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> p.ptr<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> loadorg$=<span style="color: #00ff66;">&quot;Life-Locomotive.png&quot;</span><br />
<span style="color: #ffee00">;Const loadorg$=&quot;Life-Virus.png&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> xres=<span style="color: #33ffdd;">800</span>,yres=<span style="color: #33ffdd;">600</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> cellq, scrx, scry, ib<br />
<br />
<span style="color: #ffee00">;Разбивка массива указателей на 3 списка</span><br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> pmark.ptr<span style=" ">&#40;</span><span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">3</span><br />
&nbsp;pmark<span style=" ">&#40;</span>n<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">New</span> ptr<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> xres,yres<br />
<span style="color: #aaffff; font-weight: bold;">SetFont</span> <span style="color: #aaffff; font-weight: bold;">LoadFont</span> <span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Arial cyr&quot;</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> change<span style=" ">&#40;</span><span style="color: #33ffdd;">24</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Read</span> m$<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> nn=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">8</span><br />
&nbsp; change<span style=" ">&#40;</span>n*<span style="color: #33ffdd;">16</span>+nn<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>m$,nn<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;3&quot;</span>,<span style="color: #00ff66;">&quot;0145678&quot;</span><br />
<br />
i=<span style="color: #aaffff; font-weight: bold;">CreateImage</span><span style=" ">&#40;</span>xres,yres<span style=" ">&#41;</span><br />
ib=<span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>i<span style=" ">&#41;</span><br />
<br />
i2=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span>loadorg$<span style=" ">&#41;</span><br />
ib2=<span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>i2<span style=" ">&#41;</span><br />
xsiz=<span style="color: #aaffff; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>i2<span style=" ">&#41;</span><br />
ysiz=<span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>i2<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> x=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> xsiz<span style="color: #33ffdd;">-1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> ysiz<span style="color: #33ffdd;">-1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">ReadPixel</span><span style=" ">&#40;</span>x,y,ib2<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Первая встреченная ячейка - отправная точка для создания остальных</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> cellq=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; cell.ptr=<span style="color: #aaffff; font-weight: bold;">New</span> ptr<br />
&nbsp; &nbsp; ptrq=ptrq<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; cell\x=<span style="color: #33ffdd;">400</span><br />
&nbsp; &nbsp; cell\y=<span style="color: #33ffdd;">300</span><br />
&nbsp; &nbsp; xx=x<br />
&nbsp; &nbsp; yy=y<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;newborn findcell<span style=" ">&#40;</span>cell,x-xx,y-yy<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeImage</span> i2<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">DrawBlock</span> i,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
&nbsp;gen=gen<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #ffee00">;Курсор мыши перемещается в центр экрана (чтобы не цепляться за края)</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> xres <span style="color: #aaffff; font-weight: bold;">Sar</span> <span style="color: #33ffdd;">1</span>,yres <span style="color: #aaffff; font-weight: bold;">Sar</span> <span style="color: #33ffdd;">1</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> cellq=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Все ячейки, подверженные изменениям, переещаются в список №2</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> ch.chang=<span style="color: #aaffff; font-weight: bold;">Each</span> chang<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> change<span style=" ">&#40;</span>ch\p\nq<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Insert</span> ch\p <span style="color: #aaffff; font-weight: bold;">After</span> pmark<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Delete</span> <span style="color: #aaffff; font-weight: bold;">Each</span> chang<br />
<br />
&nbsp;<span style="color: #ffee00">;Изменяем состояние всех клеток из списка №2</span><br />
&nbsp;cell=pmark<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; cell=<span style="color: #aaffff; font-weight: bold;">After</span> cell<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> cell=pmark<span style=" ">&#40;</span><span style="color: #33ffdd;">3</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> cell\nq&lt;<span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;newborn cell<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Для всех соседей - уменьшение их счетчика соседей</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">7</span><br />
&nbsp; &nbsp; cell2.ptr=cell\neig<span style=" ">&#91;</span>n<span style=" ">&#93;</span><br />
&nbsp; &nbsp; cell2\nq=cell2\nq<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp; <span style="color: #ffee00">;Занесение соседа в список ячеек, которые, возможно, изменят свое состояние</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> change<span style=" ">&#40;</span>cell2\nq<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> ch.chang=<span style="color: #aaffff; font-weight: bold;">New</span> chang: ch\p=cell2<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Выключение бита заполненности</span><br />
&nbsp; &nbsp;cell\nq=cell\nq <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">15</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">WritePixel</span> scrx+cell\x,scry+cell\y,<span style="color: #33ffdd;">0</span>,ib<br />
&nbsp; &nbsp;cellq=cellq<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Занесение обработанной ячейки в список потенциально изменяющихся ячеек</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> change<span style=" ">&#40;</span>cell\nq<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> ch.chang=<span style="color: #aaffff; font-weight: bold;">New</span> chang: ch\p=cell<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Все ячейки из списка №2 переходят в список №1 (стабилизируются)</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Insert</span> pmark<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Before</span> pmark<span style=" ">&#40;</span><span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Определяется смещение курсора мыши</span><br />
&nbsp;dx=<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-xres <span style="color: #aaffff; font-weight: bold;">Sar</span> <span style="color: #33ffdd;">1</span><br />
&nbsp;dy=<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-yres <span style="color: #aaffff; font-weight: bold;">Sar</span> <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #ffee00">;Если курсор сместился, то происходит перерисовка клеток (весь 1-й список)</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> dx&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> dy&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; scrx=scrx+dx<br />
&nbsp; scry=scry+dy<br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">SetBuffer</span> ib<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Cls</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">FrontBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; cell=pmark<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp;cell=<span style="color: #aaffff; font-weight: bold;">After</span> cell<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> cell=pmark<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> cell\nq <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">WritePixel</span> scrx+cell\x,scry+cell\y,<span style="color: #33ffdd;">-1</span>,ib<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> ib<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Rect</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">36</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #00ff66;">&quot;FPS: &quot;</span><span style="color: #33ffdd;">+1000.0</span>/<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-fps<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">12</span>,<span style="color: #00ff66;">&quot;Клеток: &quot;</span>+cellq<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">24</span>,<span style="color: #00ff66;">&quot;Поколение: &quot;</span>+gen<br />
&nbsp;fps=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">FrontBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<br />
<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #ffee00">;Функция поиска ячейки в иерархии по отправной точке и смещению</span><br />
<span style="color: #ffee00">;Если ячейка не существует, она создается вместе с цепочкой указателей</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> findcell.ptr<span style=" ">&#40;</span>cell.ptr,x,y<span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Если смещение нулевое, то результат - отправная точка</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> x=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> y=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> cell<br />
<span style="color: #ffee00">;Запоминаем координаты искомой ячейки (на случай, если ее придется создать)</span><br />
xx=x+cell\x<br />
yy=y+cell\y<br />
pmax=<span style="color: #33ffdd;">1</span> <span style="color: #ffee00">;Счетчик уровня в иерархии</span><br />
<span style="color: #ffee00">;Первый этап - подъем вверх</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #ffee00">;Добавление нового указателя сверху, если достигнута вершина иерархии</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> cell\prev=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; p.ptr=<span style="color: #aaffff; font-weight: bold;">New</span> ptr<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Insert</span> p <span style="color: #aaffff; font-weight: bold;">After</span> pmark<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffee00">;Позиция определяется положением искомой ячейки</span><br />
&nbsp; pos=<span style=" ">&#40;</span>x&lt;<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+<span style=" ">&#40;</span>y&lt;<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; p\nxt<span style=" ">&#91;</span>pos<span style=" ">&#93;</span>=cell<br />
&nbsp; cell\prev=p<br />
&nbsp; cell\prevpos=pos<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; <span style="color: #ffee00">;Иначе - переход на более высокий уровень в иерархии</span><br />
&nbsp; pos=cell\prevpos<br />
&nbsp; p.ptr=cell\prev<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #ffee00">;Изменение координат в соответствии с перемещением</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> pos <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> x=x+pmax<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> pos <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span> y=y+pmax<br />
&nbsp;<span style="color: #ffee00">;Повышение уровня</span><br />
&nbsp;pmax=pmax <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">1</span><br />
&nbsp;cell=p<br />
&nbsp;<span style="color: #ffee00">;Выход, если достигнута точка, откуда можно спуститься до искомой</span><br />
<span style="color: #aaffff; font-weight: bold;">Until</span> x&gt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> y&gt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> x&lt;pmax <span style="color: #aaffff; font-weight: bold;">And</span> y&lt;pmax<br />
<br />
<span style="color: #ffee00">;Второй этап - спуск</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #ffee00">;Понижение уровня</span><br />
&nbsp;pmax=pmax <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #ffee00">;Определение направления</span><br />
&nbsp;pos=<span style=" ">&#40;</span><span style=" ">&#40;</span>x <span style="color: #aaffff; font-weight: bold;">And</span> pmax<span style=" ">&#41;</span>=pmax<span style=" ">&#41;</span>+<span style=" ">&#40;</span><span style=" ">&#40;</span>y <span style="color: #aaffff; font-weight: bold;">And</span> pmax<span style=" ">&#41;</span>=pmax<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">1</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Создание нового указателя, если ветвь отсутствует</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> cell\nxt<span style=" ">&#91;</span>pos<span style=" ">&#93;</span>=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; p.ptr=<span style="color: #aaffff; font-weight: bold;">New</span> ptr<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Insert</span> p <span style="color: #aaffff; font-weight: bold;">After</span> pmark<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; cell\nxt<span style=" ">&#91;</span>pos<span style=" ">&#93;</span>=p<br />
&nbsp; p\prev=cell<br />
&nbsp; p\prevpos=pos<br />
&nbsp; <span style="color: #ffee00">;Если создаем клетку (указатель 1-го уровня), то перемещаем ее в список №1 и</span><br />
&nbsp; <span style="color: #ffee00">; присваиваем запомненные координаты</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pmax=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Insert</span> p <span style="color: #aaffff; font-weight: bold;">After</span> pmark<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;p\x=xx<br />
&nbsp; &nbsp;p\y=yy<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;cell=cell\nxt<span style=" ">&#91;</span>pos<span style=" ">&#93;</span><br />
&nbsp;<span style="color: #ffee00">;Если достигнут низ иерархии (уровень клеток) - выход</span><br />
<span style="color: #aaffff; font-weight: bold;">Until</span> pmax=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> cell<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Функция рождения новой клетки</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> newborn<span style=" ">&#40;</span>cell.ptr<span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Поиск, запоминание соседей и увеличение их счетчика количества соседей</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> xx=<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> yy=<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> xx <span style="color: #aaffff; font-weight: bold;">Or</span> yy <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;cell2.ptr=findcell<span style=" ">&#40;</span>cell,xx,yy<span style=" ">&#41;</span><br />
&nbsp; &nbsp;cell2\nq=cell2\nq<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Занесение соседа в список ячеек, которые, возможно, изменят свое состояние</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> change<span style=" ">&#40;</span>cell2\nq<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> ch.chang=<span style="color: #aaffff; font-weight: bold;">New</span> chang: ch\p=cell2<br />
&nbsp; &nbsp;cell\neig<span style=" ">&#91;</span>n<span style=" ">&#93;</span>=cell2<br />
&nbsp; &nbsp;n=n<span style="color: #33ffdd;">+1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #ffee00">;Включение бита заполненности</span><br />
cell\nq=cell\nq <span style="color: #aaffff; font-weight: bold;">Or</span> <span style="color: #33ffdd;">16</span><br />
<span style="color: #ffee00">;Занесение обработанной ячейки в список потенциально изменяющихся ячеек</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> change<span style=" ">&#40;</span>cell\nq<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> ch.chang=<span style="color: #aaffff; font-weight: bold;">New</span> chang: ch\p=cell<br />
<span style="color: #aaffff; font-weight: bold;">WritePixel</span> cell\x+scrx,cell\y+scry,<span style="color: #33ffdd;">-1</span>,ib<br />
cellq=cellq<span style="color: #33ffdd;">+1</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/3/3a/Unlimited_Life.zip" class="internal" title="Unlimited Life.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Виртуальный художник: соседние пикселы"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Виртуальный художник: соседние пикселы&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Виртуальный художник: соседние пикселы&amp;action=edit">править</a>]</span><span class="mw-headline">Виртуальный художник: соседние пикселы</span></h1>
<p>В этом выпуске будут рассматриваться изменения картинки, когда цвет пиксела зависит от того, какие пикселы расположены вокруг.
</p>
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:182px;"><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Painter3.jpg" class="internal" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Painter3.jpg" class="thumbimage" src="_g4ippz3.jpg" width="180" height="135" /></a>  <div class="thumbcaption"><div class="magnify" style="float:right"><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Painter3.jpg" class="internal" title="Увеличить"><img src="gau13a4-.png" width="15" height="11" alt="" /></a></div></div></div></div></div>
<a name=".D0.9F.D1.80.D0.BE.D1.81.D1.82.D0.B5.D0.B9.D1.88.D0.B8.D0.B5_.D1.8D.D1.84.D1.84.D0.B5.D0.BA.D1.82.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D1%85%D1%83%D0%B4%D0%BE%D0%B6%D0%BD%D0%B8%D0%BA:_%D1%81%D0%BE%D1%81%D0%B5%D0%B4%D0%BD%D0%B8%D0%B5_%D0%BF%D0%B8%D0%BA%D1%81%D0%B5%D0%BB%D1%8B&amp;action=edit&amp;section=1" title="Виртуальный художник: соседние пикселы">править</a>]</span> <span class="mw-headline">Простейшие эффекты</span></h2>
<p>Сначала определим зону вокруг данного пиксела - пусть это будет квадрат ((x-wid)..(x+wid),(y-wid)..(y+wid)), где wid - ширина зоны. Рассматриваемый пиксел находится в центре. Эффект размытия достигается просто - находим среднее арифметическое (напомню, формула: (a<sub>1</sub> + a<sub>2</sub> + ... + a<sub>n-1</sub> + a<sub>n</sub>) / n) для каждого канала между всеми пикселами зоны. Эффект диффузии еще более прост - из зоны берется случайно выбранный пиксел. Рельефность достигается нахождением среднего арифметического яркости пикселов в левом верхнем квадранте зоны и сравниванием этого значения с яркостью данного.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;Const wid=2,fx=1</span><br />
<p><span style="color: #ffee00">;Const wid=2,fx=2</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> wid=<span style="color: #33ffdd;">2</span>,fx=<span style="color: #33ffdd;">3</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> k1=<span style=" ">&#40;</span>wid*<span style="color: #33ffdd;">2</span><span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>^<span style="color: #33ffdd;">2</span>,k2=<span style=" ">&#40;</span>wid<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>^<span style="color: #33ffdd;">2</span><span style="color: #33ffdd;">-1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span>,<span style="color: #33ffdd;">32</span><br />
<br />
i=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Painter3.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">DrawBlock</span> i,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
ib=<span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>i<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">LockBuffer</span> ib<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
k3=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> wid<span style="color: #33ffdd;">-1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Rect</span> n,n,<span style="color: #33ffdd;">640</span>-n*<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">480</span>-n*<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;k3=k3+<span style=" ">&#40;</span>n<span style="color: #33ffdd;">+2</span><span style=" ">&#41;</span>*<span style=" ">&#40;</span>n<span style="color: #33ffdd;">+2</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> y=wid <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">479</span>-wid<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> x=wid <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">639</span>-wid<br />
&nbsp; r=<span style="color: #33ffdd;">0</span>:g=<span style="color: #33ffdd;">0</span>:b=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Select</span> fx<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span><span style="color: #ffee00">;Размытие </span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> xx=-wid <span style="color: #aaffff; font-weight: bold;">To</span> wid<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> yy=-wid <span style="color: #aaffff; font-weight: bold;">To</span> wid<br />
&nbsp; &nbsp; &nbsp; p=<span style="color: #aaffff; font-weight: bold;">ReadPixelFast</span><span style=" ">&#40;</span>x+xx,y+yy,ib<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; r=r+<span style=" ">&#40;</span><span style=" ">&#40;</span>p <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; g=g+<span style=" ">&#40;</span><span style=" ">&#40;</span>p <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; b=b+<span style=" ">&#40;</span>p <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">WritePixel</span> x,y,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>b/k1<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>g/k1<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">8</span>+<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>r/k1<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">16</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span><span style="color: #ffee00">;Диффузия</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">WritePixel</span> x,y,<span style="color: #aaffff; font-weight: bold;">ReadPixelFast</span><span style=" ">&#40;</span>x+<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span>-wid,wid<span style=" ">&#41;</span>,y+<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span>-wid,wid<span style=" ">&#41;</span>,ib<span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">3</span><span style="color: #ffee00">;Рельефность</span><br />
&nbsp; &nbsp; k=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> xx=-wid <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> yy=-wid <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; p=<span style="color: #aaffff; font-weight: bold;">ReadPixelFast</span><span style=" ">&#40;</span>x+xx,y+yy,ib<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; r=<span style=" ">&#40;</span>p <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><br />
&nbsp; &nbsp; &nbsp; g=<span style=" ">&#40;</span>p <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><br />
&nbsp; &nbsp; &nbsp; b=p <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><br />
&nbsp; &nbsp; &nbsp; c=.<span style="color: #33ffdd;">35</span>*r+.<span style="color: #33ffdd;">45</span>*g+.<span style="color: #33ffdd;">2</span>*b<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> xx+yy=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> k=<span style=" ">&#40;</span>c-k/k2<span style="color: #33ffdd;">+255</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Sar</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Else</span> k=k+c<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> k&lt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> k=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> k&gt;<span style="color: #33ffdd;">255</span> <span style="color: #aaffff; font-weight: bold;">Then</span> k=<span style="color: #33ffdd;">255</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">WritePixel</span> x,y,k*<span style="color: #33ffdd;">65793</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">WaitKey</span></div>
<a name=".D0.90.D0.BB.D0.B3.D0.BE.D1.80.D0.B8.D1.82.D0.BC_.D0.B7.D0.B0.D0.BB.D0.B8.D0.B2.D0.BA.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D1%85%D1%83%D0%B4%D0%BE%D0%B6%D0%BD%D0%B8%D0%BA:_%D1%81%D0%BE%D1%81%D0%B5%D0%B4%D0%BD%D0%B8%D0%B5_%D0%BF%D0%B8%D0%BA%D1%81%D0%B5%D0%BB%D1%8B&amp;action=edit&amp;section=2" title="Виртуальный художник: соседние пикселы">править</a>]</span> <span class="mw-headline">Алгоритм заливки</span></h2>
<p>С заливкой области цветом, вы наверняка уже не раз сталкивались в редакторах или старых версиях Бейсика. Суть в том, чтобы залить область определенного цвета, которая ограничена пикселами другого цвета, данным цветом. Исходные данные - цвет заливки и начальный пиксел. Самый простой алгоритм реализации - взять цвет исходного пиксела и проверять, совпадает ли с ним цвет смежных пикселов. Если да, то закрашиваем их и проверяем пикселы, смежные с ними. Процесс происходит до тех пор, пока все пикселы не окажутся проверенными. При этом, можно воспользоваться типами для записи пикселов, подлежащих проверке. Оптимизировать алгоритм можно снизив количество проверок (простейший алгоритм проверяет каждый пиксел 4 раза).
</p><p>Еще один алгоритм - заполнение линиями. Принцип тот же, только проверяются и выявляются горизонтальные линии.
</p><p>Чтобы получить один интересный эффект, задачу можно усложнить: цвет заливки будет цветом исходного пиксела, а пикселы с цветом, мало отличающимся от исходного, будут также заливаться. Повторим этот процесс для каждого пиксела изображения. Придется использовать вспомогательный буфер для пометки уже залитых областей.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> paint<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x,y,dir,move<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> paint2<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x1,x2,y<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> rad=<span style="color: #33ffdd;">48</span>^<span style="color: #33ffdd;">2</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> ib,ib2,p,r,g,b<br />
<br />
i=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Painter3.jpg&quot;</span><span style=" ">&#41;</span><br />
ib=<span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>i<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">DrawBlock</span> i,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">LockBuffer</span> ib<br />
<br />
i2=<span style="color: #aaffff; font-weight: bold;">CreateImage</span><span style=" ">&#40;</span><span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span><span style=" ">&#41;</span><br />
ib2=<span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>i2<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> zero=<span style="color: #aaffff; font-weight: bold;">ReadPixel</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,ib2<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">LockBuffer</span> ib2<br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> x=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">639</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">479</span><br />
&nbsp; p=<span style="color: #aaffff; font-weight: bold;">ReadPixelFast</span><span style=" ">&#40;</span>x,y,ib<span style=" ">&#41;</span><br />
&nbsp; r=<span style=" ">&#40;</span>p <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><br />
&nbsp; g=<span style=" ">&#40;</span>p <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><br />
&nbsp; b=p <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><br />
&nbsp; paint x,y<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">WaitKey</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> checkpixel<span style=" ">&#40;</span>x,y<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> x&lt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> x&gt;=<span style="color: #33ffdd;">640</span> <span style="color: #aaffff; font-weight: bold;">Or</span> y&lt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> y&gt;=<span style="color: #33ffdd;">480</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">ReadPixelFast</span><span style=" ">&#40;</span>x,y,ib2<span style=" ">&#41;</span>&lt;&gt;zero <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span><br />
<span style="color: #ffee00">;Вычисление разницы цветов</span><br />
pp=<span style="color: #aaffff; font-weight: bold;">ReadPixelFast</span><span style=" ">&#40;</span>x,y,ib<span style=" ">&#41;</span><br />
r2=r-<span style=" ">&#40;</span><span style=" ">&#40;</span>pp <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
g2=g-<span style=" ">&#40;</span><span style=" ">&#40;</span>pp <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
b2=b-<span style=" ">&#40;</span>pp <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
rr=r2*r2+g2*g2+b2*b2<br />
<span style="color: #aaffff; font-weight: bold;">If</span> rr&gt;rad <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span><br />
p1.paint=<span style="color: #aaffff; font-weight: bold;">New</span> paint<br />
p1\x=x<br />
p1\y=y<br />
<span style="color: #aaffff; font-weight: bold;">WritePixel</span> x,y,p<br />
<span style="color: #ffee00">;Пометка пиксела во вспомогательном буфере, как проработанного</span><br />
<span style="color: #aaffff; font-weight: bold;">WritePixelFast</span> x,y,<span style="color: #33ffdd;">-1</span>,ib2<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> paint<span style=" ">&#40;</span>x,y<span style=" ">&#41;</span><br />
checkpixel x,y<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;p1.paint=<span style="color: #aaffff; font-weight: bold;">First</span> paint<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> p1=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;x=p1\x<br />
&nbsp;y=p1\y<br />
&nbsp;<span style="color: #ffee00">;Проверка смежных пикселов</span><br />
&nbsp;checkpixel x<span style="color: #33ffdd;">+1</span>,y<br />
&nbsp;checkpixel x<span style="color: #33ffdd;">-1</span>,y<br />
&nbsp;checkpixel x,y<span style="color: #33ffdd;">-1</span><br />
&nbsp;checkpixel x,y<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Delete</span> p1<br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/7/7c/Virtual_Painter_-_Adjacent_Pixels.zip" class="internal" title="Virtual Painter - Adjacent Pixels.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="МАКСимальная энциклопедия"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:МАКСимальная энциклопедия&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=МАКСимальная энциклопедия&amp;action=edit">править</a>]</span><span class="mw-headline">МАКСимальная энциклопедия</span></h1>
</p>
<a name="3D_Studio_Max:_.D0.A7.D0.B8.D1.81.D1.82.D0.B0.D1.8F_.D1.82.D0.B5.D0.BE.D1.80.D0.B8.D1.8F"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9C%D0%90%D0%9A%D0%A1%D0%B8%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%8D%D0%BD%D1%86%D0%B8%D0%BA%D0%BB%D0%BE%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F&amp;action=edit&amp;section=1" title="МАКСимальная энциклопедия">править</a>]</span> <span class="mw-headline">3D Studio Max: Чистая теория</span></h2>
<p>Почему именно 3D Studio Max? Во-первых, он стандартный. Во-вторых, его возможности практически безграничны. В-третьих, он экономит время: создать несложную сцену можно буквально за несколько минут. В-четвертых, он удобен: интерфейс полностью настраиваемый. В-пятых, он всегда идет в ногу со временем: новые технологии практически моментально занимают в нем свое законное место. Дальше продолжать?
</p>
<a name=".D0.9F.D0.BE.D0.B5.D1.85.D0.B0.D0.BB.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9C%D0%90%D0%9A%D0%A1%D0%B8%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%8D%D0%BD%D1%86%D0%B8%D0%BA%D0%BB%D0%BE%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F&amp;action=edit&amp;section=2" title="МАКСимальная энциклопедия">править</a>]</span> <span class="mw-headline">Поехали</span></h2>
<p>Для нормальной работы нам понадобится любой Мах не слабее версии 4.25. У более старых версий есть проблемы с установкой под ХР из-за того, что в них используется система лицензий C-Dilla, которая наотрез отказывается работать с новой Windows. Вся статья описывает использование 3D Studio Max, но, уверяю, и в четвертой версии (и даже в более старых) все работает точно так же.
</p><p>Лицензия на Мах обойдется примерно в $3000 (за седьмую версию - $3495), но настоящего российского дизайнера и такая сумма не остановит;). Добрые люди предложат докупить на дополнительных дисках учебники, сборники плагинов, примеров и материалов. На самом деле все это ни к чему: нормальные подборки встретить крайне сложно, да к тому же все это валяется абсолютно бесплатно в Интернете. И не стоит ставить русификаторы Мах'а. Во-первых, переводы часто бывают настолько кривыми, что лучше бы их вообще не было (понятнее с появлением перевода не становится). Во-вторых, большинство уроков и энциклопедий (в том числе и эта&nbsp;:)) описывают англоязычную версию.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-02.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-02.jpg" src="vpa_62be-2.jpg" width="336" height="409" /></a></span></div></div>
<p>Задача этой статьи - объяснить то, как можно создать сложную сцену "с нуля", так что для по-настоящему серьезной работы материала этой статьи будет мало. Я специально не упоминал многие разделы, например, анимацию. Для желающих разобраться есть толстые и скучные энциклопедии.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-01.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-01.jpg" src="gqtd_3c7.jpg" width="385" height="336" /></a></span></div></div>
<a name=".D0.98.D0.BD.D1.82.D0.B5.D1.80.D1.84.D0.B5.D0.B9.D1.81_2"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9C%D0%90%D0%9A%D0%A1%D0%B8%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%8D%D0%BD%D1%86%D0%B8%D0%BA%D0%BB%D0%BE%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F&amp;action=edit&amp;section=3" title="МАКСимальная энциклопедия">править</a>]</span> <span class="mw-headline">Интерфейс</span></h2>
<p>До работы необходимо разобраться с интерфейсом Мах'а. Основную площадь на экране занимают четыре окна проекций, на которых отображается сцена с разных сторон. Наверху, под главным меню, находится панель инструментов, на нее вынесены самые употребительные команды. Справа по вертикали расположена панель команд. Снизу находятся панель анимации, строка состояния и окна макросов, а правее них - кнопки, управляющие видом в окнах проекции.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-03.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-03.jpg" src="ogz2wl84.jpg" width="448" height="336" /></a></span></div></div>
<p>Окна проекций можно настроить на свой вкус, вплоть до размещения в них, например, браузера Мах'а. Однако опыт показывает, что предлагаемый в начале расклад удобнее всего. Если нет особой необходимости, то лучше оставить в окнах вид сверху, спереди, слева и отображение перспективы. Если потребуется что-то изменить, вызывай меню настройки, кликнув по надписи справа, которая находится в левом верхнем углу любого из окон. В появившемся меню для начала стоит обратить внимание на верхние два пункта Smooth + Highlights и Wireframe. Они определяют, в каком виде будет отображаться сцена: со сглаживанием и освещением или в виде каркаса. А в выпадающем подменю Views можно задать тип отображения.
</p><p>Чтобы рассмотреть моделируемую сцену, потребуется регулярно вращать, двигать и приближать проекции в окнах. В этом помогут инструменты Arc Rotate, Pan и Zoom соответственно. Их иконки расположены в правом нижнем углу Мах'а. Гораздо удобнее проделывать все это трехкнопочной мышкой со скроллером: зажав третью кнопку -двигать, а колесиком - приближать или удалять. Чтобы рассмотреть какое-то окно поближе, его можно временно сделать полноэкранным, щелкнув по кнопке Min / Max Toggle.
</p><p>Все объекты в Мах независимо от их природы можно двигать и вращать. Для этого созданы инструменты Select and Move и Select and Rotate. Если же кликнуть правой клавишей по любой из этих кнопок, то легко можно задать отступ или поворот объекта в числовых значениях. Также можно просто выделить объект, не совершая над ним никаких действий, при помощи Select Object или выделить объект по его названию - Select by Name. Все эти инструменты находятся на панели инструментов.
</p>
<a name=".D0.9F.D1.80.D0.B8.D0.BC.D0.B8.D1.82.D0.B8.D0.B2.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9C%D0%90%D0%9A%D0%A1%D0%B8%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%8D%D0%BD%D1%86%D0%B8%D0%BA%D0%BB%D0%BE%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F&amp;action=edit&amp;section=4" title="МАКСимальная энциклопедия">править</a>]</span> <span class="mw-headline">Примитивы</span></h2>
<p>Первое, что необходимо научиться создавать в Мах - это примитивы (стандартные стереометрические фигуры): на панели команд выбираешь закладку Create, далее Geometry, а в выпадающем меню Standard Primitives или Extended Primitives. Всего в Мах'е 10 стандартных и 13 расширенных примитивов. Человеку, который в школе не прогуливал стереометрию слишком злостно, разобраться в них будет довольно просто. Каждый примитив определяется своим набором свойств, но основные параметры у всех одинаковы (длина, ширина, высота, сглаживание...). Увы, в статье не поместится и десятая часть описаний возможностей Мах'а, поэтому оставлю такие простые вещи, как создание примитивов, на самостоятельное изучение. Разобраться в этом можно банальным "методом тыка": если при изменении параметра сразу же видны изменения объекта, то все ОК. Если же никаких событий не наблюдается, то лучше пока оставить этот параметр со значением, которое было присвоено по умолчанию. К тому же назначение большинства параметров можно понять по их названиям.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-04.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-04.jpg" src="lmh6rc5s.jpg" width="445" height="336" /></a></span></div></div>
<p>Каждый примитив содержит параметры типа Segments или Sides, которые определяют количество сторон или сегментов, составляющих этот объект. С одной стороны, с увеличением этих счетчиков объект становится менее угловатым, а с другой - количество полигонов растет и такой объект становится значительно сложнее редактировать, да и про тормоза не стоит забывать. Придется искать золотую середину.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-05.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-05.jpg" src="e8zywxtw.jpg" width="447" height="336" /></a></span></div></div>
<a name=".D0.AD.D1.82.D0.BE_.D0.BD.D1.83.D0.B6.D0.BD.D0.BE_.D0.B7.D0.BD.D0.B0.D1.82.D1.8C"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9C%D0%90%D0%9A%D0%A1%D0%B8%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%8D%D0%BD%D1%86%D0%B8%D0%BA%D0%BB%D0%BE%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F&amp;action=edit&amp;section=5" title="МАКСимальная энциклопедия">править</a>]</span> <span class="mw-headline">Это нужно знать</span></h2>
<p>Вернемся к интерфейсу. Ниже рассмотрены несколько основных приемов, которые необходимы при создании любой сцены.
</p><p>Для масштабирования объекта используется инструмент Select and Uniform Scale, который позволяет сжимать и растягивать модель в разных плоскостях. Для этого на панели инструментов нужно зажать ту же кнопку, и через секунду из нее вывалится менюшка с тремя иконками, каждая из которых обозначает различный инструмент масштабирования.
</p><p>Если твоя сцена состоит из огромного количества объектов, то ты рискуешь заблудиться в них. Для облегчения нелегкой жизни художника в Мах предусмотрены группы. Группируем объекты так: выделяем их и щелкаем в главном меню Group-&gt;Group. Теперь с этой группой можно управляться как с одним объектом. Для обратной операции - Group-&gt;Ungroup.
</p><p>Если при создании сцены уровень точности "на глазок" и "плюс-минус трамвайная остановка" недостаточен, то придется звать на помощь инструмент Align, который находится на панели инструментов. Объекты можно выравнивать друг относительно друга вдоль осей X, Y и Z, а также относительно центров, минимумов и максимумов самих объектов.
</p><p>Если нужна точная копия объекта, то просто щелкаешь в главном меню по пункту Edit-&gt;Clone, конечно же выбрав заранее клонируемый объект. Существует три варианта клонирования: Copy, Instance и Reference. Первый -это просто копирование, остальные определяют наследуемость свойств, то есть после изменения основного объекта та же судьба будет постигать и клонов.
</p><p>Более изощренный вариант клонирования - создание массива объектов. По непонятным мне причинам в шестом Мах'е разработчики убрали кнопку Array из стандартного набора. Исправим это недоразумение. Кликни правой кнопкой по панели инструментов и выбери Customize.... Далее ставь Group - Main Ul, Category - All Commands, в появившемся списке найди Array и перетащи эту кнопку на панель инструментов. Готово. Массив объектов может пригодиться для создания множества копий одного объекта, расположенных на определенном состоянии друг от друга. Например, таким путем из одной доски за несколько кликов можно сколотить замечательный забор. Итак, во-первых, нужно выделить интересующий тебя объект и нажать по новой кнопке. Появится окно с множеством полей, в котором пока актуальны только три верхние левые колонки и счетчик Count - 1D. В колонках указываешь то, насколько каждый следующий объект будет сдвинут (повернут / увеличен) относительно предыдущего, а счетчик определяет будущее количество копий.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-06.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-06.jpg" src="ct74b-of.jpg" width="336" height="340" /></a></span></div></div>
<a name="C.D0.B2.D0.BE.D0.B9.D1.81.D1.82.D0.B2.D0.B0_.D0.B8_.D0.BC.D0.BE.D0.B4.D0.B8.D1.84.D0.B8.D0.BA.D0.B0.D1.82.D0.BE.D1.80.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9C%D0%90%D0%9A%D0%A1%D0%B8%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%8D%D0%BD%D1%86%D0%B8%D0%BA%D0%BB%D0%BE%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F&amp;action=edit&amp;section=6" title="МАКСимальная энциклопедия">править</a>]</span> <span class="mw-headline">Cвойства и модификаторы</span></h2>
<p>Каждый объект в Мах характеризуется огромным количеством параметров. Чтобы просмотреть свойства конкретного объекта, достаточно просто выделить его и перейти на закладку Modify панели команд. Верхнее поле этой закладки - название объекта и его цвет на схеме, чуть ниже - выпадающее меню Modifier List с неимоверным количеством модификаторов (о них позже), в середине - стек модификаторов, внизу - текущие параметры. На этой закладке и осуществляется основная часть манипуляций объектами.
</p><p>Модификаторы - это инструменты, которые позволяют изменять структуру объекта. Их можно условно сравнить с фильтрами в Photoshop. После применения к объекту нового модификатора он автоматически падает в стек и занимает там верхнюю позицию. Стек модификаторов назван так с некоторой натяжкой, так как большую часть модификаторов можно редактировать даже если они не занимают в нем верхнюю позицию. Чтобы отредактировать какой-нибудь модификатор, достаточно просто щелкнуть по нему (под стеком выкатятся все его свойства), а чтобы удалить - нажать на кнопку под стеком с изображением корзины. Примеры модификаторов будут рассмотрены ниже, а пока для практики попробуй на примитивах следующие: Bend - изгиб, Taper - заострение, Twist - скручивание, Skew - сдвиг, Stretch - растяжение, Sgueeze - сжатие, Push - сдавливание, Relax -ослабление, Mirror - отражение, Noise - зашумление (очень важный параметр Fractal), Spherify - осферение&nbsp;:), Wave - волны, Ripple - рябь, Lattice - решетка. Все описанное задается на закладке Modify в списке Modifier List.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-07.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-07.jpg" src="ttmfoe0c.jpg" width="448" height="312" /></a></span></div></div>
<a name=".D0.A1.D0.B5.D1.82.D0.BA.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9C%D0%90%D0%9A%D0%A1%D0%B8%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%8D%D0%BD%D1%86%D0%B8%D0%BA%D0%BB%D0%BE%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F&amp;action=edit&amp;section=7" title="МАКСимальная энциклопедия">править</a>]</span> <span class="mw-headline">Сетки</span></h2>
<p>В природе практически все трехмерные объекты состоят из полигонов. Разберемся с редактированием на этом уровне. Для наглядности лучше выбрать в окне перспективы отображение Wireframe и, кликнув правой кнопкой по какому-нибудь трехмерному объекту, навести курсор на пункт Convert to: в появившемся списке выбираем Convert to Editable Mesh. Теперь объект предстал в образе редактируемой сетки. Запомни, эту операцию невозможно отменить (кроме как через Undo)! При конвертировании объекта в сетку уничтожатся все модификаторы, которые были к нему применены раньше. Другими словами, результат действия этих модификаторов сохранится, но править их будет уже невозможно. После превращения объекта в сетку автоматически откроется закладка панели команд Modify, a в стеке модификаторов останется только Editable Mesh. Под стеком к тому времени появятся пять новых кнопок с изображениями точек, треугольников и других многоугольников, которые определяют, на каком уровне будет редактироваться сетка. Нажатая кнопка Vertex означает, что редактирование будет происходить на уровне вершин, Edge - на уровне граней, Fасе - на уровне треугольников, Polygon - на уровне полигонов, а Element - на уровне объектов. Все эти элементы можно двигать, вращать и масштабировать практически так же, как и отдельные объекты.
Что нужно уметь при работе с редактируемой сеткой?
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-08.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-08.jpg" src="4kg0bl_j.jpg" width="444" height="336" /></a></span></div></div>
<p>При моделировании аморфного объекта острые углы ни к чему, но они упорно продолжают образовываться, если просто двигать вершины или полигоны. В такой ситуации на помощь приходит опция Use Soft Selection, которая находится в свитке Soft Selection. После ее активации и перемещения одной или нескольких вершин соседние с ней тоже подтянутся. Причем вершины, которые находятся вплотную к редактируемым, сдвинутся практически на такое же расстояние, а более отдаленные - намного меньше. Похоже на изменения фигуры при лепке из пластилина. Параметр Falloff задает то, какую площадь будут охватывать изменения.
</p><p>Бывает полезно "выдавить" некоторые полигоны из объекта. Для этого нужно перейти к редактированию на уровне треугольников или полигонов. Сначала выделим один или несколько полигонов, а затем на панели команд в разделе Edit Geometry найдем кнопку Extrude. Справа от кнопки увидишь счетчик, при изменении значения которого выбранные полигоны моментально выдавятся из объекта.
<p>Если требуется объединить несколько вершин в одну, то выбираешь редактирование вершин и нащупываешь группу Weld на панели команд в разделе Edit Geometry, а в ней кнопку Selected. Рядом с этой кнопкой есть счетчик, значение которого определяет, на каком максимальном расстоянии друг от друга вершины могут быть объединены. После установки подходящего значения останется только нажать Selected.
</p>
</p>
<a name=".D0.A1.D0.BF.D0.BB.D0.B0.D0.B9.D0.BD.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9C%D0%90%D0%9A%D0%A1%D0%B8%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%8D%D0%BD%D1%86%D0%B8%D0%BA%D0%BB%D0%BE%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F&amp;action=edit&amp;section=8" title="МАКСимальная энциклопедия">править</a>]</span> <span class="mw-headline">Сплайны</span></h2>
<p>Сплайны - двух- или трехмерные кривые и геометрические фигуры. По умолчанию их не видно при рендеринге, что можно исправить отменив галочку Renderable на закладке Modify. Всего существует 11 стандартных сплайнов, которые создаются с помощью Create - Shapes - Splines.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-09.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-09.jpg" src="54w2qc_x.jpg" width="438" height="336" /></a></span></div></div>
<p>Сплайны, как и сетки, можно редактировать. Превратить сплайн в редактируемый просто: правый клик, Convert To-&gt;Convert to Editable Spline. Если выбрать редактирование на уровне вершин и щелкнуть правой кнопкой мыши по любой из них, то каждая вершина обнаружит свою явную принадлежность к одной из следующих групп: Corner - угловая, Smooth - сглаженная, Bezier - регулируемо сглаженная, Bezier Corner - регулируемо угловая. Редактируя тип вершины, можно изменить сплайн до неузнаваемости. Если в нем недостаточное количество вершин, то можно добавить их кнопками Refine или Insert на закладке Modify. Если нужно присоединить к одному сплайну другой, выдели любой из них, и, нажав Attach, щелкни по второму.
</p><p>Есть несколько десятков приемов редактирования сплайнов, а я опишу лишь один из них (по-моему, самый полезный). Если в сплайне присутствуют самопересечения, например, после объединения двух сплайнов, то может возникнуть необходимость избавиться от лишних сегментов (классический пример - создание деки скрипки). Берем эллипс, повторяющий очертания деки, и выставляем две окружности по бокам в тех местах, где требуется сделать углубления. Объединяем эти сплайны в один, выбираем редактирование на уровне сплайнов и жмем кнопку Trim на закладке Modify. После щелчка по лишним сегментам они самоликвидируются. Последний штрих: переходим к редактированию на уровне вершин и с помощью Weld объединяем двойные вершины в местах бывших пересечений. Готово.
</p><p>А зачем нужны сплайны? Для начала их можно выдавить из плоскости, другими словами, добавить сплайну высоту. К примеру, звездочку или шестеренку проще всего слепить из сплайна, а потом просто добавить ей объема, для чего придется воспользоваться модификатором Extrude. Параметр Amount определяет высоту, a Cap Start и Cap End решает, закрывать пи начало и конец получившейся фигуры. Похожий эффект обеспечивает модификатор Bevel, делающий многослойное вьдавлива-ние, причем такие слои, возможно, будут отличаться друг от друга масштабом. Итого, мы получили такой же выдавленный сплайн, только с выпуклыми или вогнутыми краями. Параметры Level 1 - Level 3 задают нужное количество слоев, Height - высоту слоя, Outline - масштабирование, a Smooth Across Levels - сглаживание вдоль уровней.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-10.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-10.jpg" src="o0dd-di6.jpg" width="415" height="336" /></a></span></div></div>
<p>Другой способ "оттрехмерить" сплайн - создать объект вращения. Разные бокалы, бутылки, банки и стаканы производятся именно таким образом. Сплайны создают половину поперечного сечения объекта, а дальше дело за модификатором Lathe. Параметр Direction задает то, вокруг какой оси будет происходить вращение (X, Y или Z), а параметр Align - вокруг какой оси сплайна (вокруг центральной или крайних). Если в центре получившегося объекта проявятся какие-то артефакты, то придется отметить галочку Weld Core.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-11.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-11.jpg" src="63agprut.jpg" width="414" height="336" /></a></span></div></div>
<p>Также в Мах'е существуют NURBS-кривые, во многом похожие на сплайны, к которым можно применять те же самые модификаторы, поэтому останавливаться на них я не буду.
</p>
<a name=".D0.A1.D0.BE.D1.81.D1.82.D0.B0.D0.B2.D0.BD.D1.8B.D0.B5_.D0.BE.D0.B1.D1.8A.D0.B5.D0.BA.D1.82.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9C%D0%90%D0%9A%D0%A1%D0%B8%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%8D%D0%BD%D1%86%D0%B8%D0%BA%D0%BB%D0%BE%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F&amp;action=edit&amp;section=9" title="МАКСимальная энциклопедия">править</a>]</span> <span class="mw-headline">Составные объекты</span></h2>
<p>Пока все объекты, которые мы создавали, были довольно примитивными. Пора научиться моделировать что-нибудь посерьезнее, а именно - составные объекты.
</p><p>Важно разобраться с созданием в Boolean составных объектов, что обеспечит объединение и пересечение нескольких объектов, а также возможность вырезать из одного объекта другой. К примеру, требуется быстро сделать стену с окнами. Стена - это простая коробка, окна - тоже коробки. Вырезай окна из стены с помощью Boolean, а потом уже действуй по собственному усмотрению. Такой метод применяется в большинстве случаев, поэтому полезно будет привыкнуть быстро разбивать в уме модель на составные части, комбинируя их, вырезая, пересекая и объединяя друг с другом. Для создания Boolean-объекта потребуется не менее двух пересекающихся трехмерных объектов. Для начала выделяем первый из них и выбираем Create-&gt;Geometry-&gt;Compound Objects-&gt;Boolean. Затем надо определиться с операцией: Union - объединение, Intersection - пересечение, Subtraction (A-B) - вырезание второго из первого, Subtraction (B-A) -аналогично, Cut - различное разбиение граней. Останется только нажать кнопку Pick Operand В и выбрать второй объект. После этого из двух получится единый объект, a Boolean свалится в стек модификаторов.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-12.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-12.jpg" src="ruibppe5.jpg" width="431" height="336" /></a></span></div></div>
<p>К сожалению, при создании Boolean-объектов в Мах'е (особенно в старых версиях) нередко появляются необъяснимые глюки: то полигоны пропадут, то вообще всю модель разворотит&nbsp;:(. Поэтому после каждой операции в Boolean стоит исследовать модель на предмет видимых повреждений, чтобы не упустить тот момент, когда это злодеяние случилось и успеть нажать Undo.
</p><p>Еще один вид составных объектов - Loft. Это метод позволяет сделать из нескольких кривых (сплайнов или NURBS) один трехмерный объект. В этом случае одна кривая станет "путем", а другие "сечениями", расставленными вдоль него. Самый простой пример Loft-объекта - провод или шланг, где "путь" представлен идущей вдоль него кривой, а "сечение" - окружностью. Итак, нам понадобятся как минимум две кривые. Сначала нужно выделить первую (определиться с тем, "путь" это или "сечение", лучше сразу) и нажать Create-&gt;Geometry-&gt; Compound Objects-&gt;Loft. Далее, в зависимости от того, чего не хватает, "пути" или "сечения", выбрать Get Patch или Get Shape и указать на вторую кривую. Если одного "сечения" оказалось мало, то можно добавить еще несколько: в свойствах Loft в свитке Patch Parameters есть счетчик Patch, при изменении значения которого по "пути" будет бегать крестик, обозначающий место присоединения нового "сечения". Теперь можно снова нажать Get Shape и выбрать второе "сечение" - в месте стыка одно сечение плавно перетечет в другое.
</p>
<a name=".D0.A2.D0.B5.D0.BA.D1.81.D1.82.D1.83.D1.80.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9C%D0%90%D0%9A%D0%A1%D0%B8%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%8D%D0%BD%D1%86%D0%B8%D0%BA%D0%BB%D0%BE%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F&amp;action=edit&amp;section=10" title="МАКСимальная энциклопедия">править</a>]</span> <span class="mw-headline">Текстурирование</span></h2>
<p>Какой бы навороченной ни была SD-модель, без текстуры она смотрится довольно убого. Сейчас мы это исправим. За создание материалов в Мах'е отвечает "Редактор материалов", возможности которого практически не ограничены (в отличие от нашего журнала, поэтому полного описания ну никак не получится).
</p><p>Для открытия редактора на панели инструментов есть кнопка Material Editor. В верхней части редактора расположены 24 шарика (если ты ненавидишь шарики, то можешь выбрать кубики или цилиндры), каждый их которых представляет в виде символа одну текстуру. Чтобы сделать образец активным, достаточно кликнуть по нему один раз. Внизу будет семь свитков с параметрами, из которых самые важные - первые два. В первом (Shader Basic Parameters) определяется тип материала из восьми предложенных. Для начала вполне хватит типа Blinn. Там же есть еще два полезных свойства: Wire и 2-Sided. Если отметить Wire и наложить материал на объект, то при рендеринге модель будет представлять собой то же самое, что и в окне Perspective при отображении Wireframe. Двухсторонний материал стоит выбирать при наложении на незамкнутые объекты, например, плоскости. Теперь второй свиток -Blinn Basic Parameters. Счетчик Opacity определяет степень прозрачности объекта. Возле надписи Diffuse в цветном окошке задается однотонный цвет материала. Я думаю, одного цвета явно мало, поэтому сразу наложим полноценную текстуру из какого-нибудь файла типа jpeg. Правее от надписи Diffuse и окошка с цветом находится маленькая кнопка без надписи. Нам сюда. Откроется Material/Map Browser, в котором нужно выбрать Browse From-&gt;New и два раза кликнуть по словечку Bitmap. На этот раз появится стандартное win-окошко выбора файла, в котором остается только найти свою текстуру и кликнуть Open. Текстура уже готова. Для того чтобы вернуться к начальным настройкам материала, выбирай Go to Раrent из ряда кнопок под образцами. Если нет желания напрягать мозги созданием новых материалов, можно воспользоваться готовыми. Для этого нажимаешь на кнопку Standart под образцами - откроется уже знакомый Material/Map Browser. В нем выбираем Browse From-&gt;Mtl Library и ждем появления списка готовых материалов. Если он пуст, то придется вручную открывать файл, содержащий материалы, что делается в File-&gt;Open в этом же браузере.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-13.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-13.jpg" src="oyjpgxqd.jpg" width="448" height="333" /></a></span></div></div>
<p>Применить текстуру к объекту можно несколькими способами: обычным drag'n'drop образца на модель или после выделения одного или нескольких объектов кнопкой Assign Material to Selection в редакторе материалов. В любом случае имеет смысл накладывать текстуры только на те объекты, которые видны при рендеринге.
</p>
<a name=".D0.9D.D0.B0.D0.BB.D0.BE.D0.B6.D0.B5.D0.BD.D0.B8.D0.B5_.D1.82.D0.B5.D0.BA.D1.81.D1.82.D1.83.D1.80"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9C%D0%90%D0%9A%D0%A1%D0%B8%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%8D%D0%BD%D1%86%D0%B8%D0%BA%D0%BB%D0%BE%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F&amp;action=edit&amp;section=11" title="МАКСимальная энциклопедия">править</a>]</span> <span class="mw-headline">Наложение текстур</span></h2>
<p>Если текстура не однотонная, то ее слои можно наложить на объект сотней способов. Мах не обладает искусственным интеллектом, поэтому эту процедуру в автоматическом режиме он проделывает постоянно одним и тем же способом (в прошлых версиях он вообще отказывался это делать). Если не устраивает результат наложения шкурки, стоит попробовать другой способ проекции текстуры, для чего существует модификатор UVW Map. На выбор предлагается семь вариантов проекции. Если форма объекта хоть чем-то напоминает плоскость, цилиндр, сферу или куб, то оптимальным будет способ проекции с аналогичным названием (Planar, Cylindrical, Spherical &amp; Box). Вариант Shrink Wrap почти одинаков со Spherical, вариант Face проецирует текстуру в центр каждой грани, a XYZ to UVW растягивает текстуру при растягивании объекта. Опять не нравится результат? Тогда читай дальше.
</p><p>Ты когда-нибудь видел, как выглядят текстуры для моделей в играх? Примерно так: модель, как будто сделанную из бумаги, разрезали на кусочки, каждую часть развернули на плоскости, а потом все сгруппировали на одной картинке. Если такую текстуру просто наложить на модель, то какой способ проекции ни используй, все равно получится ерунда. Как это ни странно, во многих руководствах по Мах развертку вообще не рассматривают или описывают неприлично бегло. А она необходима практически всегда при наложении текстур, основанных на Bitmap. Для того чтобы развернуть карту текстуры на модель, существует модификатор Unwrap UVW. Применять его лучше с нормально настроенным UVW Map, чтобы потом не мучаться. Для того же удобства следует сначала превратить объект в редактируемую сетку и каждой смысловой группе полигонов задать отдельный номер. Сейчас объясню зачем. Например, нужно смоделировать машину, причем на дверь наложить одну часть текстуры, на капот - другую, на крыло - третью. Делается это так: выделяются полигоны, которые составляют дверь, и каждому из них задается номер, далее задается номер полигонам крыла и т.д. Задать номер полигонам можно на закладке Modify, выбрав редактирование на нужном уровне в свитке Surface Properties, группе Material и в счетчике Set ID. Теоретически последние два шага можно и опустить, но я бы не советовал этого делать:).
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-15.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-15.jpg" src="mll_p3pp.jpg" width="448" height="333" /></a></span></div></div>
<p>Итак, после применения модификатора Unwrap UVW пора приступать непосредственно к редактированию развертки, для чего открываешь редактор Edit UVWs и нажимаешь кнопку Edit в свойствах модификатора. Интерфейс редактора выполнен в стиле Мах и рассматривать его отдельно не имеет смысла. Основную площадь редактора занимает плоскость (в шестом Мах'е эта плоскость разлинована ярко-синим цветом, что ужасно раздражает, но, к счастью, отключается после ликвидации галочки возле Show Grid в свойствах редактора), в центре которой расположена накладываемая текстура, на которую в кучу свалены все полигоны, составляющие модель. Остается только понять, какой части модели принадлежит каждый полигон и оттащить его на нужное место текстуры. Но все не так просто, как кажется на первый взгляд. В нижней части редактора развертки есть выпадающее меню, значение которого определяет номера полигонов, отображаемых в определенный момент. Если перед этим не полениться и аккуратно назначить группам полигонов разные номера, то меню поможет довольно быстро расставить все по местам.
</p>
<a name=".D0.A0.D0.B5.D0.BD.D0.B4.D0.B5.D1.80.D0.B8.D0.BD.D0.B3"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9C%D0%90%D0%9A%D0%A1%D0%B8%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%8D%D0%BD%D1%86%D0%B8%D0%BA%D0%BB%D0%BE%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F&amp;action=edit&amp;section=12" title="МАКСимальная энциклопедия">править</a>]</span> <span class="mw-headline">Рендеринг</span></h2>
<p>Сцена готова и все текстуры наложены. Остался последний шаг - рендеринг, перед которым стоит заглянуть в главное меню - Rendering - Environment, где задаются различные эффекты окружения. В группе Background можно установить цвет фона или назначить текстуру для заднего плана. В этом же окне на закладке Effects можно настроить некоторые постфильтры. Теперь делаешь активным то окно, отображение в котором больше всего нравится, и нажимаешь на панели инструментов Render Scene. Появится окно настроек рендеринга с пятью закладками, из которых пока актуальна только Common. В ней самый важный параметр - разрешение выходного файла, которое находится в группе Output Size. Чем больше выбранный размер картинки, тем дольше нужно будет ждать результата. У профи процесс рендеринга может длиться несколько часов (вовсе не потому, что профи пользуются 386-ми процессорами). Если сцена изрядно нагружена, то лучше начать вообще с 320x240, и только после улыбки Фортуны выставлять нормальное разрешение. Жмем Render. Картинка загрузилась, остается последний штрих - сохранить ее, щелкнув по кнопке с изображением дискетки.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-14.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:3DSMax1-14.jpg" src="_0yryjij.jpg" width="433" height="336" /></a></span></div></div>
<hr />
<p>Автор: Федор (fm) Галков (e-mail: fm@real.xakep.ru, сайт: <a href="http://www.podzemka.net/" class="external free" title="http://www.podzemka.net" rel="nofollow">http://www.podzemka.net</a>)<br />
OCR: Святослав (e-mail: zlum@xaker.ru)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Курс молодого бойца, часть 3: практические занятия"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Курс молодого бойца, часть 3: практические занятия&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Курс молодого бойца, часть 3: практические занятия&amp;action=edit">править</a>]</span><span class="mw-headline">Курс молодого бойца, часть 3: практические занятия</span></h1>
</p>
<a name=".D0.92.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5_2"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D1%83%D1%80%D1%81_%D0%BC%D0%BE%D0%BB%D0%BE%D0%B4%D0%BE%D0%B3%D0%BE_%D0%B1%D0%BE%D0%B9%D1%86%D0%B0%2C_%D1%87%D0%B0%D1%81%D1%82%D1%8C_3:_%D0%BF%D1%80%D0%B0%D0%BA%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5_%D0%B7%D0%B0%D0%BD%D1%8F%D1%82%D0%B8%D1%8F&amp;action=edit&amp;section=1" title="Курс молодого бойца, часть 3: практические занятия">править</a>]</span> <span class="mw-headline">Введение</span></h2>
<p>Поразмыслив, я понял, банальный ФПС - это фигня для создателя Мега-игры. Раздобыв Диздок самой успешной MMORPG в мире, я решил, основываясь на нем, попытаться рассказать, как делаются мега игры. Конечно, сразу все не получится, многие вопросы придется прорабатывать отдельно, но задача будет интересной. Запасаемся терпением, и приступаем к с созданию нашего мира. Чтобы внести ясность: все примеры это только примеры, всегда есть более другой и красивый способ сделать что-либо. Я буду всегда выбирать тот, в котором можно задействовать минимум Медиа и приложить минимум труда, основной упор на прозрачность принципа создания: Поэтому очень извиняюсь за неподходящие модели, текстуры и т.д. С другой стороны это вполне отражает ситуацию, с которой сталкивается настоящий создатель Мега-игры. (Тащат к себе все, до чего могут дотянуться.) Картинка пока будет получаться не очень, но постепенно все проработаем до удовлетворительного результата: Особенно если найдется добрый самаритянин, готовый пожертвовать свое время и медиа, на благое дело...
</p>
<a name=".D0.91.D1.8B.D1.82.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D1%83%D1%80%D1%81_%D0%BC%D0%BE%D0%BB%D0%BE%D0%B4%D0%BE%D0%B3%D0%BE_%D0%B1%D0%BE%D0%B9%D1%86%D0%B0%2C_%D1%87%D0%B0%D1%81%D1%82%D1%8C_3:_%D0%BF%D1%80%D0%B0%D0%BA%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5_%D0%B7%D0%B0%D0%BD%D1%8F%D1%82%D0%B8%D1%8F&amp;action=edit&amp;section=2" title="Курс молодого бойца, часть 3: практические занятия">править</a>]</span> <span class="mw-headline">Бытие</span></h2>
<ol>
<li>В начале сотворил Бог небо и землю.
<li>Земля же была безвидна и пуста, и тьма над бездною, и Дух Божий носился над водою.
<li>И сказал Бог: да будет свет. И стал свет.
<li>И увидел Бог свет, что он хорош, и отделил Бог свет от тьмы.
<li>И назвал Бог свет днем, а тьму ночью. И был вечер, и было утро: день один.
</ol>
<p>Для работы программ нужно <a href="http://blitzetcetera.org/images/5/53/SoldierMedia.zip" class="internal" title="SoldierMedia.zip">скачать архив с изображениями</a>.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>, <span style="color: #33ffdd;">480</span>, <span style="color: #33ffdd;">32</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">HidePointer</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> God = <span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> god,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Red=<span style="color: #33ffdd;">0</span> &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Составляющие</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Green=<span style="color: #33ffdd;">150</span> &nbsp;<span style="color: #ffee00">; цвета</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Blue=<span style="color: #33ffdd;">200</span> &nbsp; <span style="color: #ffee00">; Неба</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Day=<span style="color: #33ffdd;">1.0</span> &nbsp; &nbsp;<span style="color: #ffee00">; Значит у нас кончилась ночь</span><br />
<span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> God,red,green,Blue<span style="color: #ffee00">; Небо</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> DayTime=<span style="color: #33ffdd;">10000</span> <span style="color: #ffee00">; скорость смены</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> DayBegin=<span style="color: #33ffdd;">0</span> &nbsp; <span style="color: #ffee00">; когда произошла смена дня и ночи</span><br />
<br />
<br />
Pl= <span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;Земля, которая вода</span><br />
tx=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\water.jpg&quot;</span><span style=" ">&#41;</span> &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> Pl,tx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">AmbientLight</span> <span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">50</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; как освещены предметы ночью</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> l = <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Свет, который хорошо</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> l,<span style="color: #33ffdd;">30</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
GodMovement<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; <span style="color: #ffee00">; носится над водой и под ней</span><br />
<br />
DayControl<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp;<span style="color: #ffee00">;смена дня и ночи</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> GodMovement<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> God,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">; поворот камеры мышкой аля FPS</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> god,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>god<span style=" ">&#41;</span> <span style="color: #ffee00">; чтобы не переворачивалась камера</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> God,<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">32</span><span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">30</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">17</span><span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">31</span><span style=" ">&#41;</span> <span style="color: #ffee00">; Движение камеры wasd</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span> <span style="color: #ffee00">; Это нужно чтобы машка не уходила за экран</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> DayControl<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> DayBegin=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> DayBegin=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp;<span style="color: #ffee00">; день первый начался</span><br />
delta#=<span style="color: #aaffff; font-weight: bold;">Float</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-DayBegin<span style=" ">&#41;</span>/DayTime <span style="color: #ffee00">; Какая часть дня прошла?</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> delta&gt;=<span style="color: #33ffdd;">1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; День/ночь кончился</span><br />
&nbsp;delta=<span style="color: #33ffdd;">1</span><br />
&nbsp;DayBegin=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;Начался новый день/ночь</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> day=<span style="color: #33ffdd;">-1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Ночью света становится меньше</span><br />
&nbsp;delta=<span style="color: #33ffdd;">1</span>-delta<br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">LightColor</span> l,<span style="color: #33ffdd;">255</span>*delta,<span style="color: #33ffdd;">255</span>*delta,<span style="color: #33ffdd;">255</span>*delta<br />
<span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> God,red*delta,green*delta,Blue*delta &nbsp;<span style="color: #ffee00">; цвет неба зависит от времени суток</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> delta=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> delta=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> day=-day &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; в полдень/полночь сменяем признак половины дня</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Рассмотрим чего я наворотил:
</p><p>Налицо локация (Типа море), персонаж (Мы - камера). Есть блок управления персонажем и камерой GodMovement(). Есть блок игровой логики DayControl(). День и ночь в данном примере равны и цвет неба изменяется в линейной зависимости синхронно с освещенностью. В жизни все происходит иначе. Цвет изменяется быстрее, чем падает освещенность. Вернее неравномерно. Сначала небо темнеет, освещенность падает медленнее, затем освещенность начинает быстро падать (солнце заходит) и "догоняет" цвет неба, затем небо начинает светлеть, но освещенность отстает и когда солнце восходит, освещенность "догоняет" цвет неба: Подобрать зависимость изменения цвета неба и цвета света я завещаю вам. Принципиально возможно сделать, чтобы вечером все предметы освещались красноватым цветом. Кстати непонятно почему бог сотворил землю, а его дух носился над водой: 
</p>
<ol start="6">
<li>И сказал Бог: да будет твердь посреди воды, и да отделяет она воду от воды. [И стало так.]
<li>И создал Бог твердь, и отделил воду, которая под твердью, от воды, которая над твердью. И стало так.
<li>И назвал Бог твердь небом. [И увидел Бог, что это хорошо.] И был вечер, и было утро: день второй.
<li>И сказал Бог: да соберется вода, которая под небом, в одно место, и да явится суша. И стало так. [И собралась вода под небом в свои места, и явилась суша.]
<li>И назвал Бог сушу землею, а собрание вод назвал морями. И увидел Бог, что это хорошо.
</ol>
<p>Если воду (текстуру) для первого дня, я нагло спер у кого-то (прошу у него прощения за это), то для того чтобы сказать: "да будет твердь посреди воды", потребуется спереть(Купить) что либо покрупнее например Terragen (www.planetside.co.uk) c eго помощью можно генерировать карты высот, или Total terrain - можно редактировать и создавать карты высот. Если вы думаете, что сейчас скачаете программу, ткнете кнопку и получите результат, то вы ошибаетесь. Результат, то вы получите, но не такой, какой хотите. Рандом - он и есть рандом. С ним или мирятся, или исправляют руками, или делают руками сразу: Я сгенерил в Терагене карту высот, которая при опускании в воду должна стать архипелагом, и опустил края в PaintBrush (Очень полезная программка - входящая в состав Виндовс). Я схалтурил, ясен пень, каждый остров архипелага нужно было генерить/создавать отдельно и расставлять ручками, но пока и так сойдет: Непонятные промежуточные этапы с созданием тверди отделяющей воду от воды я пропустил. Бог наверное сначала создал океан как и мы, только сферой, затем сделал дно (литосферу) , которое разделило воду, а затем скалил литосферу таким образом, чтобы неровности литосферы вышли на поверхность, и вода образовала моря и океаны. В общем, ему с движком повезло. И полигонов он держит, не меряно, и размер возможной вселенной впечатляет. Нам придется много изворачиваться:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>, <span style="color: #33ffdd;">480</span>, <span style="color: #33ffdd;">32</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">HidePointer</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> God = <span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> god,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Red=<span style="color: #33ffdd;">0</span> &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Составляющие</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Green=<span style="color: #33ffdd;">150</span> &nbsp;<span style="color: #ffee00">; цвета</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Blue=<span style="color: #33ffdd;">200</span> &nbsp; <span style="color: #ffee00">; Неба</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Day=<span style="color: #33ffdd;">1.0</span> &nbsp; &nbsp;<span style="color: #ffee00">; Значит у нас кончилась ночь</span><br />
<span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> God,red,green,Blue<span style="color: #ffee00">; Небо</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> DayTime=<span style="color: #33ffdd;">10000</span> <span style="color: #ffee00">; скорость смены</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> DayBegin=<span style="color: #33ffdd;">0</span> &nbsp; <span style="color: #ffee00">; когда произошла смена дня и ночи</span><br />
<br />
<br />
Pl= <span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;Земля, которая вода</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> Pl,<span style="color: #33ffdd;">0.4</span><br />
tx=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\water.jpg&quot;</span><span style=" ">&#41;</span> &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> Pl,tx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tx<br />
<br />
sh= <span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; дно - шельф</span><br />
<br />
Land=<span style="color: #aaffff; font-weight: bold;">LoadTerrain</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\land.png&quot;</span><span style=" ">&#41;</span> &nbsp; &nbsp;<span style="color: #ffee00">; Острова</span><br />
tx=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\dirt001.jpg&quot;</span><span style=" ">&#41;</span> &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tx,<span style="color: #33ffdd;">0.2</span>,<span style="color: #33ffdd;">0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> sh,tx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> land,tx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tx<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> sh,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> Land,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">80</span>,<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> Land,<span style="color: #33ffdd;">-256</span>*<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">-20</span>,<span style="color: #33ffdd;">-256</span>*<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> sh,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-20.001</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">AmbientLight</span> <span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; как освещены предметы ночью</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> l = <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Свет, который хорошо</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> l,<span style="color: #33ffdd;">30</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
GodMovement<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; <span style="color: #ffee00">; носится над водой и под ней</span><br />
<br />
DayControl<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp;<span style="color: #ffee00">;смена дня и ночи</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> GodMovement<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> God,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">; поворот камеры мышкой аля FPS</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> god,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>god<span style=" ">&#41;</span> <span style="color: #ffee00">; чтобы не переворачивалась камера</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> God,<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">32</span><span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">30</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">17</span><span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">31</span><span style=" ">&#41;</span> <span style="color: #ffee00">; Движение камеры wasd</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span> <span style="color: #ffee00">; Это нужно чтобы машка не уходила за экран</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> DayControl<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> DayBegin=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> DayBegin=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp;<span style="color: #ffee00">; день первый начался</span><br />
delta#=<span style="color: #aaffff; font-weight: bold;">Float</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-DayBegin<span style=" ">&#41;</span>/DayTime <span style="color: #ffee00">; Какая часть дня прошла?</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> delta&gt;=<span style="color: #33ffdd;">1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; День/ночь кончился</span><br />
&nbsp;delta=<span style="color: #33ffdd;">1</span><br />
&nbsp;DayBegin=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;Начался новый день/ночь</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> day=<span style="color: #33ffdd;">-1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Ночью света становится меньше</span><br />
&nbsp;delta=<span style="color: #33ffdd;">1</span>-delta<br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">LightColor</span> l,<span style="color: #33ffdd;">255</span>*delta,<span style="color: #33ffdd;">255</span>*delta,<span style="color: #33ffdd;">255</span>*delta<br />
<span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> God,red*delta,green*delta,Blue*delta &nbsp;<span style="color: #ffee00">; цвет неба зависит от времени суток</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> delta=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> delta=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> day=-day &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; в полдень/полночь сменяем признак половины дня</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Получилось что-то похожее. Суши маловато, но нужно же с чего-то начать? Мы еще пока не опытные боги: Кстати, как я писал выше внешний вид игры - это 90% медиа. Найти тайловую (на противоположных краях "переходит" сама в себя), равномерно освещенную текстуру очень сложно. Взять цифровик, нащелкать траву, землю и использовать в игре можно, но на открытых пространствах будут видны стыки текстур из-за их не тайловости, что можно убрать при некоторой сноровке, а главное, от неравномерного освещения, что невозможно убрать. Такие текстуры образуют на поверхности ощутимые квадраты как, это получается в нашем случае. Для того чтобы сгладить эффект необходимо или раздобыть тайловую текстуру, или применять мультитекстурирование. Чтобы заретушировать стыки, можно взять почти любую текстуру, изменить ее пропорции (ScaleTexture) и наложить на поверхность сверху, если сможете создать текстуру с неравномерной прозрачностью будет еще круче, нужно будет с TextureBlend экспериментировать: Нафоткать текстур получится для игровых объектов, на которых текстура не тайлится (текстура помещается на объекте один раз). И это имеет смысл. Только без фанатизма! А то, как сфоткаете 2700х1900 и начнете на модели прилаживать, так делать ненужно, нужно помучиться и подобрать минимальное разрешение текстуры, при котором получается приличный внешний вид. Например, натягивать на ландшафт текстуру 256х256 - расточительство, замена ее на текстуру 64х64 не очень влияет на внешний вид. Если, конечно, вы не собираетесь эту текстуру увеличивать:
</p><p>Хочу еще предупредить вас от гонки вооружений. Немного поэкспериментировав, вы увидите, что чем больше скалится терран, тем меньше на нем видно квадраты текстур, но одновременно мы становимся малюсенькими, для того чтобы почувствовать себя нормального размера мы поднимаемся повыше и приходим к тому с чего начали.
</p>
<ol start="11">
<li>И сказал Бог: да произрастит земля зелень, траву, сеющую семя [по роду и по подобию ее, и] дерево плодовитое, приносящее по роду своему плод, в котором семя его на земле. И стало так.
<li>И произвела земля зелень, траву, сеющую семя по роду [и по подобию] ее, и дерево [плодовитое], приносящее плод, в котором семя его по роду его [на земле]. И увидел Бог, что это хорошо.
<li>И был вечер, и было утро: день третий.
</ol>
<p>Вот и начинаются грабли. Замете, а мы даже еще не дошли до физических взаимодействий! Деревья мы раздобудем, сделать чтобы они росли, размножались и приносили плоды - проблема: Пока. Сейчас просто рассадим деревья по островам. Для создания деревьев использовали программу Tree[d] и экспортер созданный Barlok'ом на основе функций Progs'а. (Правда, нужно его немного подкрутить, флаги текстур неправильно экспортятся)
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>, <span style="color: #33ffdd;">480</span>, <span style="color: #33ffdd;">32</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">HidePointer</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> God = <span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> god,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Red=<span style="color: #33ffdd;">0</span> &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Составляющие</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Green=<span style="color: #33ffdd;">150</span> &nbsp;<span style="color: #ffee00">; цвета</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Blue=<span style="color: #33ffdd;">200</span> &nbsp; <span style="color: #ffee00">; Неба</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Day=<span style="color: #33ffdd;">1.0</span> &nbsp; &nbsp;<span style="color: #ffee00">; Значит у нас кончилась ночь</span><br />
<span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> God,red,green,Blue<span style="color: #ffee00">; Небо</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> DayTime=<span style="color: #33ffdd;">10000</span> <span style="color: #ffee00">; скорость смены</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> DayBegin=<span style="color: #33ffdd;">0</span> &nbsp; <span style="color: #ffee00">; когда произошла смена дня и ночи</span><br />
<br />
<br />
Pl= <span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;Земля, которая вода</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> Pl,<span style="color: #33ffdd;">0.4</span><br />
tx=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\water.jpg&quot;</span><span style=" ">&#41;</span> &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> Pl,tx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tx<br />
<span style="color: #aaffff; font-weight: bold;">EntityPickMode</span> pl,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">NameEntity</span> pl,<span style="color: #00ff66;">&quot;Water&quot;</span><br />
<br />
sh= <span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; дно - шельф</span><br />
<br />
Land=<span style="color: #aaffff; font-weight: bold;">LoadTerrain</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\land.png&quot;</span><span style=" ">&#41;</span> &nbsp; &nbsp;<span style="color: #ffee00">; Острова</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">EntityPickMode</span> Land,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">NameEntity</span> Land,<span style="color: #00ff66;">&quot;Land&quot;</span><br />
<br />
tx=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\dirt001.jpg&quot;</span><span style=" ">&#41;</span> &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tx,<span style="color: #33ffdd;">0.2</span>,<span style="color: #33ffdd;">0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> sh,tx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> land,tx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tx<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> sh,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> Land,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">80</span>,<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> Land,<span style="color: #33ffdd;">-256</span>*<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">-20</span>,<span style="color: #33ffdd;">-256</span>*<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> sh,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-20.001</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">AmbientLight</span> <span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; как освещены предметы ночью</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> l = <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Свет, который хорошо</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> l,<span style="color: #33ffdd;">30</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<br />
Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadMesh</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\tree\tree01.b3d&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">HideEntity</span> Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadMesh</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\tree\tree01.b3d&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">HideEntity</span> Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">3000</span> <span style="color: #ffee00">; количество растений</span><br />
en=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> en=<span style="color: #33ffdd;">0</span><br />
&nbsp;x#=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-2500</span>,<span style="color: #33ffdd;">2500</span><span style=" ">&#41;</span><br />
&nbsp;z#=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-2500</span>,<span style="color: #33ffdd;">2500</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">LinePick</span> x,<span style="color: #33ffdd;">200</span>,z,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-200</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;en=<span style="color: #aaffff; font-weight: bold;">PickedEntity</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> en<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">EntityName</span><span style=" ">&#40;</span>en<span style=" ">&#41;</span>=<span style="color: #00ff66;">&quot;Land&quot;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; В воду растения не сажаем.</span><br />
&nbsp; &nbsp;tr=<span style="color: #aaffff; font-weight: bold;">CopyEntity</span><span style=" ">&#40;</span>flora<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> tr,x,<span style="color: #aaffff; font-weight: bold;">PickedY</span>#<span style=" ">&#40;</span><span style=" ">&#41;</span>,z<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;en=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
GodMovement<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; <span style="color: #ffee00">; носится над водой и под ней</span><br />
<br />
DayControl<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp;<span style="color: #ffee00">;смена дня и ночи</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> GodMovement<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> God,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">; поворот камеры мышкой аля FPS</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> god,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>god<span style=" ">&#41;</span> <span style="color: #ffee00">; чтобы не переворачивалась камера</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> God,<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">32</span><span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">30</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">17</span><span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">31</span><span style=" ">&#41;</span> <span style="color: #ffee00">; Движение камеры wasd</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span> <span style="color: #ffee00">; Это нужно чтобы машка не уходила за экран</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> DayControl<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> DayBegin=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> DayBegin=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp;<span style="color: #ffee00">; день первый начался</span><br />
delta#=<span style="color: #aaffff; font-weight: bold;">Float</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-DayBegin<span style=" ">&#41;</span>/DayTime <span style="color: #ffee00">; Какая часть дня прошла?</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> delta&gt;=<span style="color: #33ffdd;">1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; День/ночь кончился</span><br />
&nbsp;delta=<span style="color: #33ffdd;">1</span><br />
&nbsp;DayBegin=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;Начался новый день/ночь</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> day=<span style="color: #33ffdd;">-1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Ночью света становится меньше</span><br />
&nbsp;delta=<span style="color: #33ffdd;">1</span>-delta<br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">LightColor</span> l,<span style="color: #33ffdd;">255</span>*delta,<span style="color: #33ffdd;">255</span>*delta,<span style="color: #33ffdd;">255</span>*delta<br />
<span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> God,red*delta,green*delta,Blue*delta &nbsp;<span style="color: #ffee00">; цвет неба зависит от времени суток</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> delta=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> delta=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> day=-day &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; в полдень/полночь сменяем признак половины дня</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Для осуществления задуманного, вводим первые {физические} параметры - PickMode и NameEntity чтобы знать, куда попало растение в воду или на благодатную почву. Для рассады райских садов, используем генератор псевдослучайных чисел (это занимает какое-то время и чем больше деревьев тем дольше). Наш "Райский" сад состоит из двух типов деревьев. Но все готово чтобы работать с произвольным набором флоры: В данном случае деревья и "кусты" - это спецэффекты, впрочем как и весь мир: Изменив количество растений, можете дойти до такого количества, что все начнет тормозить по полной, ну и придется подождать пока засадятся острова: Значительно увеличить количество деревьев при котором ФПС не падает на ногу можно объединив флору в несколько мешей. Подобными штуками занимается библиотека Single Surface, рекомендую. Ну или сделать самим.
</p>
<ol start="14"> 
<li>И сказал Бог: да будут светила на тверди небесной [для освещения земли и] для отделения дня от ночи, и для знамений, и времен, и дней, и годов;
<li>и да будут они светильниками на тверди небесной, чтобы светить на землю. И стало так.
<li>И создал Бог два светила великие: светило большее, для управления днем, и светило меньшее, для управления ночью, и звезды;
<li>и поставил их Бог на тверди небесной, чтобы светить на землю,
<li>и управлять днем и ночью, и отделять свет от тьмы. И увидел Бог, что это хорошо.
<li>И был вечер, и было утро: день четвёртый.
</ol>
<p>Просто поразительно, как сильно изменилась самая популярная ММОРПГ вселенная со времен диздока. Если Бету делали по нему, то до релиза кто-то впахивал как проклятый: В первый день у нас был свет-день и тьма-ночь, и только на четвертый Бог сделал Солнце, Луну и звезды: Я то, наивный полагал, что свет от солнца идет, а оказывается наоборот! Если есть свет - значит день и Солнце. Что вроде и неплохо для нас:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>, <span style="color: #33ffdd;">480</span>, <span style="color: #33ffdd;">32</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">HidePointer</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> God = <span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> god,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Red=<span style="color: #33ffdd;">0</span> &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Составляющие</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Green=<span style="color: #33ffdd;">150</span> &nbsp;<span style="color: #ffee00">; цвета</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Blue=<span style="color: #33ffdd;">200</span> &nbsp; <span style="color: #ffee00">; Неба</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Day=<span style="color: #33ffdd;">1.0</span> &nbsp; &nbsp;<span style="color: #ffee00">; Значит у нас кончилась ночь</span><br />
<span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> God,red,green,Blue<span style="color: #ffee00">; Небо</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> DayTime=<span style="color: #33ffdd;">100000</span> <span style="color: #ffee00">; скорость смены</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> DayBegin=<span style="color: #33ffdd;">0</span> &nbsp; <span style="color: #ffee00">; когда произошла смена дня и ночи</span><br />
<br />
<br />
Pl= <span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;Земля, которая вода</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> Pl,<span style="color: #33ffdd;">0.5</span><br />
tx=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\water.jpg&quot;</span><span style=" ">&#41;</span> &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> Pl,tx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tx<br />
<span style="color: #aaffff; font-weight: bold;">EntityPickMode</span> pl,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">NameEntity</span> pl,<span style="color: #00ff66;">&quot;Water&quot;</span><br />
<br />
sh= <span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; дно - шельф</span><br />
<br />
Land=<span style="color: #aaffff; font-weight: bold;">LoadTerrain</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\land.png&quot;</span><span style=" ">&#41;</span> &nbsp; &nbsp;<span style="color: #ffee00">; Острова</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">EntityPickMode</span> Land,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">NameEntity</span> Land,<span style="color: #00ff66;">&quot;Land&quot;</span><br />
<br />
tx=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\dirt001.jpg&quot;</span><span style=" ">&#41;</span> &nbsp; <span style="color: #ffee00">;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tx,<span style="color: #33ffdd;">0.2</span>,<span style="color: #33ffdd;">0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> sh,tx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> land,tx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tx<br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> sh,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> Land,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">80</span>,<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> Land,<span style="color: #33ffdd;">-256</span>*<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">-20</span>,<span style="color: #33ffdd;">-256</span>*<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> sh,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-20.001</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">AmbientLight</span> <span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; как освещены предметы ночью</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> l = <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Свет, который хорошо</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> l,<span style="color: #33ffdd;">30</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<br />
Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadMesh</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\tree\tree01.b3d&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">HideEntity</span> Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadMesh</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\tree\tree01.b3d&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">HideEntity</span> Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">3000</span> <span style="color: #ffee00">; количество растений</span><br />
en=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> en=<span style="color: #33ffdd;">0</span><br />
&nbsp;x#=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-2500</span>,<span style="color: #33ffdd;">2500</span><span style=" ">&#41;</span><br />
&nbsp;z#=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-2500</span>,<span style="color: #33ffdd;">2500</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">LinePick</span> x,<span style="color: #33ffdd;">200</span>,z,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-200</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;en=<span style="color: #aaffff; font-weight: bold;">PickedEntity</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> en<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">EntityName</span><span style=" ">&#40;</span>en<span style=" ">&#41;</span>=<span style="color: #00ff66;">&quot;Land&quot;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; В воду растения не сажаем.</span><br />
&nbsp; &nbsp;tr=<span style="color: #aaffff; font-weight: bold;">CopyEntity</span><span style=" ">&#40;</span>flora<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> tr,x,<span style="color: #aaffff; font-weight: bold;">PickedY</span>#<span style=" ">&#40;</span><span style=" ">&#41;</span>,z<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;en=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Center=<span style="color: #aaffff; font-weight: bold;">CreatePivot</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">; центр системы, его постоянно совмещаем с камерой (с нами т.е.)</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> star=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,center<span style=" ">&#41;</span> <span style="color: #ffee00">; ЗВЕЗДЫ</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityFX</span> star,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> star,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">50</span><br />
<span style="color: #aaffff; font-weight: bold;">FlipMesh</span> star<br />
tx=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Media\space\stars.png&quot;</span>,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> star,tx<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tx<br />
<span style="color: #aaffff; font-weight: bold;">EntityOrder</span> star,<span style="color: #33ffdd;">1.0</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> solCen=<span style="color: #aaffff; font-weight: bold;">CreatePivot</span><span style=" ">&#40;</span>Center<span style=" ">&#41;</span> &nbsp;<span style="color: #ffee00">; центр вокруг которого вращается Солнце</span><br />
sol=<span style="color: #aaffff; font-weight: bold;">LoadSprite</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Media\space\sol.png&quot;</span>,<span style="color: #33ffdd;">1</span>,SolCen<span style=" ">&#41;</span><span style="color: #ffee00">; Солнце</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> sol,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">15</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityOrder</span> sol,<span style="color: #33ffdd;">0.9</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> MoonCen=<span style="color: #aaffff; font-weight: bold;">CreatePivot</span><span style=" ">&#40;</span>Center<span style=" ">&#41;</span> <span style="color: #ffee00">; центр вокруг которого вращается Луна</span><br />
Moon=<span style="color: #aaffff; font-weight: bold;">LoadSprite</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Media\space\moon.png&quot;</span>,<span style="color: #33ffdd;">1</span>,MoonCen<span style=" ">&#41;</span><span style="color: #ffee00">; Луна</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> moon,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-15</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityOrder</span> moon,<span style="color: #33ffdd;">0.8</span><br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
GodMovement<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; <span style="color: #ffee00">; носится над водой и под ней</span><br />
<br />
DayControl<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp;<span style="color: #ffee00">;смена дня и ночи</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SpaceControl<span style=" ">&#40;</span>fase#,day<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> center,<span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>god<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>god<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>god<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> day=<span style="color: #33ffdd;">-1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> SolCen,<span style="color: #33ffdd;">90</span>-<span style=" ">&#40;</span><span style="color: #33ffdd;">180</span>*fase<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> MoonCen,<span style="color: #33ffdd;">90</span>-<span style=" ">&#40;</span><span style="color: #33ffdd;">180</span>*fase<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> SolCen,<span style=" ">&#40;</span><span style="color: #33ffdd;">180</span>*fase<span style=" ">&#41;</span><span style="color: #33ffdd;">+90</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> MoonCen,<span style=" ">&#40;</span><span style="color: #33ffdd;">180</span>*fase<span style=" ">&#41;</span><span style="color: #33ffdd;">+90</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> GodMovement<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> God,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">; поворот камеры мышкой аля FPS</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> god,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>god<span style=" ">&#41;</span> <span style="color: #ffee00">; чтобы не переворачивалась камера</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> God,<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">32</span><span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">30</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">17</span><span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">31</span><span style=" ">&#41;</span> <span style="color: #ffee00">; Движение камеры wasd</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span> <span style="color: #ffee00">; Это нужно чтобы машка не уходила за экран</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> DayControl<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> DayBegin=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> DayBegin=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp;<span style="color: #ffee00">; день первый начался</span><br />
delta#=<span style="color: #aaffff; font-weight: bold;">Float</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-DayBegin<span style=" ">&#41;</span>/DayTime <span style="color: #ffee00">; Какая часть дня прошла?</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> delta&gt;=<span style="color: #33ffdd;">1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; День/ночь кончился</span><br />
&nbsp;delta=<span style="color: #33ffdd;">1</span><br />
&nbsp;DayBegin=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;Начался новый день/ночь</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> day=<span style="color: #33ffdd;">-1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Ночью света становится меньше</span><br />
&nbsp;delta=<span style="color: #33ffdd;">1</span>-delta<br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">LightColor</span> l,<span style="color: #33ffdd;">255</span>*delta,<span style="color: #33ffdd;">255</span>*delta,<span style="color: #33ffdd;">255</span>*delta<br />
<span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> God,red*delta,green*delta,Blue*delta &nbsp;<span style="color: #ffee00">; цвет неба зависит от времени суток</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> star,<span style="color: #33ffdd;">1</span>-delta<br />
SpaceControl<span style=" ">&#40;</span>delta,day<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> delta=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> delta=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> day=-day &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; в полдень/полночь сменяем признак половины дня</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Досконально переводим в код то, что записано в диздоке. Само собой, что твердь небесная это сфера, на которой мы намалевали звезды. (я там созвездие большой медведицы намалевал) Солнышко и Луну запустили по круговой орбите: Теперь ясно почему Джордано Бруно сожгли! Движок пропачили, но что пропачили не сказали: Джордано фишку просек, о чем и сказал, но если он был прав, у клириков заклинание "Майнд контрол" обламывалось и они его на респ отправили, принеся в жертву.
</p><p>Как вы знаете Солнце, Луна и звезды находятся на большом расстоянии от нас, и находились на большом расстоянии даже при Геоцентрической системе мира. Но формально - далеко значит, рисуется первым. Для создания небесных сфер, использован контроль над Z-буфером. Первой выводятся звезды, которые днем становятся прозрачными, потом солнце, потом луна. Сделано это из-за того, что нужно одновременно противоположного. Сферы должны быть такими большими, чтобы все предмеры в радиусе видимости были внутри нее, а это возможно только если сфера больше радиуса видимости. Если сферы будут меньше, то будет видно как предметы проходят сквозь них: А слабо вам сделать солнечное затменье? Подсказка: для более наглядного и понятного обращения с планетами имеет смысл сделать свой календарь и время, которые будут привязаны к миллисекундам. Так как это сделал я сейчас - быстро, требует минимум квалификации, но несколько натянуто и не гибко. Помучавшись со своими часами и календарем, вы сможете легко управлять периодом обращения небесных тел. 
</p>
<ol start="20">
<li>И сказал Бог: да произведет вода пресмыкающихся, душу живую; и птицы да полетят над землею, по тверди небесной. [И стало так.]
<li>И сотворил Бог рыб больших и всякую душу животных пресмыкающихся, которых произвела вода, по роду их, и всякую птицу пернатую по роду ее. И увидел Бог, что это хорошо.
<li>И благословил их Бог, говоря: плодитесь и размножайтесь, и наполняйте воды в морях, и птицы да размножаются на земле.
<li>И был вечер, и было утро: день пятый.
</ol>
<p>Позволю себе заметить, сначала появилась земля, потом растения - стоят на месте и без анимации, потом звезды и планеты и потом пресмыкающиеся и птицы. Т.е. целый день Бог собирался с силами для того, что бы ввести в свой мир анимированные, перемещающиеся модели. И не зря. Для того чтобы сделать возможным их перемещение придется сделать гравитацию. (Может, поэтому он сделал планеты и звезды сначала?&nbsp;;)) Естественно делаем себе послабление - птиц не будет, животные ходить не будут. Почему? Потому что для того чтобы ходить, животным нужны мозги (АИ), а птицы - летают, зависшие птицы никуда не годятся, а вот стоящие на месте животные - это нормально. Животное я сделал с помощью Wings3D. Хто это? Сказать сложно, но то что это животное - однозначно.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>, <span style="color: #33ffdd;">480</span>, <span style="color: #33ffdd;">32</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">HidePointer</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> God = <span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> god,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Red=<span style="color: #33ffdd;">0</span> &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Составляющие</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Green=<span style="color: #33ffdd;">150</span> &nbsp;<span style="color: #ffee00">; цвета</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Blue=<span style="color: #33ffdd;">200</span> &nbsp; <span style="color: #ffee00">; Неба</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Day=<span style="color: #33ffdd;">1.0</span> &nbsp; &nbsp;<span style="color: #ffee00">; Значит у нас кончилась ночь</span><br />
<span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> God,red,green,Blue<span style="color: #ffee00">; Небо</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> DayTime=<span style="color: #33ffdd;">100000</span> <span style="color: #ffee00">; скорость смены</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> DayBegin=<span style="color: #33ffdd;">0</span> &nbsp; <span style="color: #ffee00">; когда произошла смена дня и ночи</span><br />
<br />
<br />
Pl= <span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;Земля, которая вода</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> Pl,<span style="color: #33ffdd;">0.5</span><br />
tx=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\water.jpg&quot;</span><span style=" ">&#41;</span> &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> Pl,tx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tx<br />
<span style="color: #aaffff; font-weight: bold;">EntityPickMode</span> pl,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">NameEntity</span> pl,<span style="color: #00ff66;">&quot;Water&quot;</span><br />
<br />
sh= <span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; дно - шельф</span><br />
<br />
Land=<span style="color: #aaffff; font-weight: bold;">LoadTerrain</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\Land.png&quot;</span><span style=" ">&#41;</span> &nbsp; &nbsp;<span style="color: #ffee00">; Острова</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">EntityPickMode</span> Land,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">NameEntity</span> Land,<span style="color: #00ff66;">&quot;Land&quot;</span><br />
<br />
tx=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\dirt001.jpg&quot;</span><span style=" ">&#41;</span> &nbsp; <span style="color: #ffee00">;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tx,<span style="color: #33ffdd;">0.2</span>,<span style="color: #33ffdd;">0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> sh,tx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> land,tx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tx<br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> sh,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> Land,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">80</span>,<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> Land,<span style="color: #33ffdd;">-256</span>*<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">-20</span>,<span style="color: #33ffdd;">-256</span>*<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> sh,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-20.001</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">AmbientLight</span> <span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; как освещены предметы ночью</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> l = <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Свет, который хорошо</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> l,<span style="color: #33ffdd;">30</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<br />
<span style="color: #ffee00">; Зеленые насаждения</span><br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<br />
Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadMesh</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\tree\tree01.b3d&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">HideEntity</span> Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadMesh</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;media\tree\tree01.b3d&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">HideEntity</span> Flora<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1000</span> <span style="color: #ffee00">; количество растений</span><br />
en=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> en=<span style="color: #33ffdd;">0</span><br />
&nbsp;x#=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-2500</span>,<span style="color: #33ffdd;">2500</span><span style=" ">&#41;</span><br />
&nbsp;z#=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-2500</span>,<span style="color: #33ffdd;">2500</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">LinePick</span> x,<span style="color: #33ffdd;">500</span>,z,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-500</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;en=<span style="color: #aaffff; font-weight: bold;">PickedEntity</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> en<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">EntityName</span><span style=" ">&#40;</span>en<span style=" ">&#41;</span>=<span style="color: #00ff66;">&quot;Land&quot;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; В воду растения не сажаем.</span><br />
&nbsp; &nbsp;tr=<span style="color: #aaffff; font-weight: bold;">CopyEntity</span><span style=" ">&#40;</span>flora<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> tr,x,<span style="color: #aaffff; font-weight: bold;">PickedY</span>#<span style=" ">&#40;</span><span style=" ">&#41;</span>,z<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;en=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #ffee00">;Космические тела</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Center=<span style="color: #aaffff; font-weight: bold;">CreatePivot</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">; центр системы, его постоянно совмещаем с камерой (с нами т.е.)</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> star=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,center<span style=" ">&#41;</span> <span style="color: #ffee00">; ЗВЕЗДЫ</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityFX</span> star,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> star,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">50</span><br />
<span style="color: #aaffff; font-weight: bold;">FlipMesh</span> star<br />
tx=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Media\space\stars.png&quot;</span>,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> star,tx<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tx<br />
<span style="color: #aaffff; font-weight: bold;">EntityOrder</span> star,<span style="color: #33ffdd;">1.0</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> solCen=<span style="color: #aaffff; font-weight: bold;">CreatePivot</span><span style=" ">&#40;</span>Center<span style=" ">&#41;</span> &nbsp;<span style="color: #ffee00">; центр вокруг которого вращается Солнце</span><br />
sol=<span style="color: #aaffff; font-weight: bold;">LoadSprite</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Media\space\sol.png&quot;</span>,<span style="color: #33ffdd;">1</span>,SolCen<span style=" ">&#41;</span><span style="color: #ffee00">; Солнце</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> sol,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">15</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityOrder</span> sol,<span style="color: #33ffdd;">0.9</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> MoonCen=<span style="color: #aaffff; font-weight: bold;">CreatePivot</span><span style=" ">&#40;</span>Center<span style=" ">&#41;</span> <span style="color: #ffee00">; центр вокруг которого вращается Луна</span><br />
Moon=<span style="color: #aaffff; font-weight: bold;">LoadSprite</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Media\space\moon.png&quot;</span>,<span style="color: #33ffdd;">1</span>,MoonCen<span style=" ">&#41;</span><span style="color: #ffee00">; Луна</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> moon,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-15</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityOrder</span> moon,<span style="color: #33ffdd;">0.8</span><br />
<br />
<span style="color: #ffee00">; гравитация</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> Terrain_type=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> Object_type=<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> Water_type=<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> Object_type,Terrain_type,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> Object_type,Water_type,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> gravity#=<span style="color: #33ffdd;">0.1</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> Land,Terrain_Type<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> Pl,Water_Type<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> Grav<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> Ent<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> Vy#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #ffee00">; фауна</span><br />
Monstr=<span style="color: #aaffff; font-weight: bold;">LoadMesh</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Media\Animal\dog.3ds&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> Monstr,Object_Type<br />
<span style="color: #aaffff; font-weight: bold;">EntityRadius</span> Monstr,<span style="color: #33ffdd;">0.1</span><br />
<span style="color: #aaffff; font-weight: bold;">HideEntity</span> Monstr<br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">200</span> <span style="color: #ffee00">; количество зверей</span><br />
en=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> en=<span style="color: #33ffdd;">0</span><br />
&nbsp;x#=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-2500</span>,<span style="color: #33ffdd;">2500</span><span style=" ">&#41;</span><br />
&nbsp;z#=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-2500</span>,<span style="color: #33ffdd;">2500</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">LinePick</span> x,<span style="color: #33ffdd;">500</span>,z,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-500</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;en=<span style="color: #aaffff; font-weight: bold;">PickedEntity</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> en<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">EntityName</span><span style=" ">&#40;</span>en<span style=" ">&#41;</span>=<span style="color: #00ff66;">&quot;Land&quot;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; В воду зверюшек не кидаем.</span><br />
&nbsp; &nbsp;G.Grav=<span style="color: #aaffff; font-weight: bold;">New</span> grav<br />
&nbsp; &nbsp;g\ent=<span style="color: #aaffff; font-weight: bold;">CopyEntity</span><span style=" ">&#40;</span>Monstr<span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> g\ent,x,<span style="color: #aaffff; font-weight: bold;">PickedY</span>#<span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+2</span>,z<br />
&nbsp; &nbsp;tr=g\ent<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;en=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> jamp=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
GodMovement<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; <span style="color: #ffee00">; носится над водой и под ней</span><br />
<br />
DayControl<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp;<span style="color: #ffee00">;смена дня и ночи</span><br />
<br />
GravityControl<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">; Обработка воздействия гравитации на объекты</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> GravityControl<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
TekMillisecs=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> t.grav= <span style="color: #aaffff; font-weight: bold;">Each</span> grav<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>t\ent,Terrain_type<span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AlignToVector</span> t\ent,<span style="color: #aaffff; font-weight: bold;">CollisionNX</span><span style=" ">&#40;</span>t\ent,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">CollisionNY</span><span style=" ">&#40;</span>t\ent,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">CollisionNZ</span><span style=" ">&#40;</span>t\ent,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">0.2</span><br />
&nbsp; t\Vy=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> TekMillisecs&gt;=Jamp<span style="color: #33ffdd;">+2000</span> <span style="color: #ffee00">; Раз в 2 секундs зверь прыгает, Для этого должен был-бы использоваться</span><br />
&nbsp; <span style="color: #ffee00">; модуль АИ, но пока и так хорошо.</span><br />
&nbsp; &nbsp;t\Vy=<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;t\Vy= t\Vy-gravity<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> t\ent,<span style="color: #33ffdd;">0</span>,t\vy,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> TekMillisecs&gt;=Jamp<span style="color: #33ffdd;">+2000</span> <span style="color: #ffee00">; Раз в 2 секундs зверь прыгает, Для этого должен был-бы использоваться</span><br />
&nbsp;<span style="color: #ffee00">; модуль АИ, но пока и так хорошо.</span><br />
&nbsp; jamp=TekMillisecs<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SpaceControl<span style=" ">&#40;</span>fase#,day<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> center,<span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>god<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>god<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>god<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> day=<span style="color: #33ffdd;">-1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> SolCen,<span style="color: #33ffdd;">90</span>-<span style=" ">&#40;</span><span style="color: #33ffdd;">180</span>*fase<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> MoonCen,<span style="color: #33ffdd;">90</span>-<span style=" ">&#40;</span><span style="color: #33ffdd;">180</span>*fase<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> SolCen,<span style=" ">&#40;</span><span style="color: #33ffdd;">180</span>*fase<span style=" ">&#41;</span><span style="color: #33ffdd;">+90</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> MoonCen,<span style=" ">&#40;</span><span style="color: #33ffdd;">180</span>*fase<span style=" ">&#41;</span><span style="color: #33ffdd;">+90</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> GodMovement<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> God,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">; поворот камеры мышкой аля FPS</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> god,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>god<span style=" ">&#41;</span> <span style="color: #ffee00">; чтобы не переворачивалась камера</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> God,<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">32</span><span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">30</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">17</span><span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">31</span><span style=" ">&#41;</span> <span style="color: #ffee00">; Движение камеры wasd</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span> <span style="color: #ffee00">; Это нужно чтобы машка не уходила за экран</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> DayControl<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> DayBegin=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> DayBegin=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp;<span style="color: #ffee00">; день первый начался</span><br />
delta#=<span style="color: #aaffff; font-weight: bold;">Float</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-DayBegin<span style=" ">&#41;</span>/DayTime <span style="color: #ffee00">; Какая часть дня прошла?</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> delta&gt;=<span style="color: #33ffdd;">1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; День/ночь кончился</span><br />
&nbsp;delta=<span style="color: #33ffdd;">1</span><br />
&nbsp;DayBegin=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;Начался новый день/ночь</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> day=<span style="color: #33ffdd;">-1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Ночью света становится меньше</span><br />
&nbsp;delta=<span style="color: #33ffdd;">1</span>-delta<br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">LightColor</span> l,<span style="color: #33ffdd;">255</span>*delta,<span style="color: #33ffdd;">255</span>*delta,<span style="color: #33ffdd;">255</span>*delta<br />
<span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> God,red*delta,green*delta,Blue*delta &nbsp;<span style="color: #ffee00">; цвет неба зависит от времени суток</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> star,<span style="color: #33ffdd;">1</span>-delta<br />
SpaceControl<span style=" ">&#40;</span>delta,day<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> delta=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> delta=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> day=-day &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; в полдень/полночь сменяем признак половины дня</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Хочу отметить одну деталь. Когда предмет лежит на поверхности, на него тоже действует сила тяжести! Она ежесекундно смещает предмет вниз. Именно поэтому наши животины скатываются в воду, что противоречит привычной для нас логике. Исправляется это изменением одной цифры в коде. Когда вы захотите оптимизировать код и начнете писать что-то типа: "если предмет касается земли, то гравитацию не считать", а в результате время от времени быстро движущиеся предметы будут как бы отскакивать назад, вспомните об этой детали. Животные прыгают и радуются жизни, чтобы показать действие гравитации. Данная гравитация очень проста в использовании, достаточно включить гравитацию для 3Д объекта, и правильно установить радиус коллизии (самое сложное): Лучше всего использовать модели в специализированном формате движка, на котором вы создаете свой шедевр, в моем случае это B3D - жалко, что кроме 3D Max с ним нормально никто больше не работает. Кстати, особенно много глюков заложено в последнем дне. Почему, добравшись до воды, животные перестают прыгать? Почему 1000 деревьев стоит на суше, куча зверюшек попала в воду при одинаковом алгоритме расстановки? Намекаю - все дело в настройках коллизии! 
</p>
<ol start="24">
<li>И сказал Бог: да произведет земля душу живую по роду ее, скотов, и гадов, и зверей земных по роду их. И стало так.
<li>И создал Бог зверей земных по роду их, и скот по роду его, и всех гадов земных по роду их. И увидел Бог, что это хорошо.
</ol>
<p>Здесь ничего нового не происходит, просто новые модели в игру ввели.
</p>
<ol start="26">
<li>И сказал Бог: сотворим человека по образу Нашему [и] по подобию Нашему, и да владычествуют они над рыбами морскими, и над птицами небесными, [и над зверями,] и над скотом, и над всею землею, и над всеми гадами, пресмыкающимися по земле.
<li>И сотворил Бог человека по образу Своему, по образу Божию сотворил его; мужчину и женщину сотворил их.
<li>И благословил их Бог, и сказал им Бог: плодитесь и размножайтесь, и наполняйте землю, и обладайте ею, и владычествуйте над рыбами морскими [и над зверями,] и над птицами небесными, [и над всяким скотом, и над всею землею,] и над всяким животным, пресмыкающимся по земле.
</ol>
<p>Это самого страшного монстра в игру ввел - персонаж. В общем - начиналось все как обычно: Персонаж - папка, а все монстры - сынки, предназначенные исключительно для экспы: Но как все в релизе изменилось!
</p>
<ol start="29">
<li>И сказал Бог: вот, Я дал вам всякую траву, сеющую семя, какая есть на всей земле, и всякое дерево, у которого плод древесный, сеющий семя; -- вам сие будет в пищу;
<li>а всем зверям земным, и всем птицам небесным, и всякому [гаду,] пресмыкающемуся по земле, в котором душа живая, дал Я всю зелень травную в пищу. И стало так.
</ol>
<p>А это ролевую систему приладил.
</p>
<ol start="31">
<li>И увидел Бог все, что Он создал, и вот, хорошо весьма. И был вечер, и было утро: день шестой.
</ol>
<p>В общем день шестой Бог занимался левелдизайном и ролевой системой. С этого момента начался закрытый бета-тест двумя бета-тестерами: Адамом и Евой на тестовой локации "Рай".
</p><p>На данный момент, мы имеем основу мира.(Как скажут некоторые основное уже сделано&nbsp;:)) Исходники нашей вселенной нам все равно не достать. Придется писать свои. На данном этапе мы не готовы вдохнуть жизнь в наш мир, для этого нужна предварительная подготовка. В следующий раз мы заставим зверюшек шляться по островку (как минимум). Если есть вопросы - пишите (roman_tnp@mail.ru), они будут учтены при более тщательной проработке игровых моментов.
</p>
<div align="right"><a href="http://blitzetcetera.org/images/8/80/Rookie_Tutorial_1.zip" class="internal" title="Rookie Tutorial 1.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Tolking" title="Участник:Tolking">Роман Прядко</a> (roman_tnp@mail.ru)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Конкурс! (выпуск 3)"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Конкурс! (выпуск 3)&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Конкурс! (выпуск 3)&amp;action=edit">править</a>]</span><span class="mw-headline">Конкурс! (выпуск 3)</span></h1>
</p>
<a name="Super_Chess_Demo"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BD%D0%BA%D1%83%D1%80%D1%81%21_%28%D0%B2%D1%8B%D0%BF%D1%83%D1%81%D0%BA_3%29&amp;action=edit&amp;section=1" title="Конкурс! (выпуск 3)">править</a>]</span> <span class="mw-headline">Super Chess Demo</span></h2>
<p>Сделать демо-версию на основе шахмат из статьи "Тела вращения". Можно модифицировать все, кроме алгоритма - изменить фигуры, доску, добавить модели. Вариант - взять какую - нибудь шахматную партию и показать ее в 3D, хотя суть демки может быть любой - главное, чтобы в ней фигурировали шахматные фигуры. Ограничение - не более 100KB медиа.
</p>
<a name="Excellent_Model"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BD%D0%BA%D1%83%D1%80%D1%81%21_%28%D0%B2%D1%8B%D0%BF%D1%83%D1%81%D0%BA_3%29&amp;action=edit&amp;section=2" title="Конкурс! (выпуск 3)">править</a>]</span> <span class="mw-headline">Excellent Model</span></h2>
<p>Создайте свою оригинальную модель (одну или несколько) с помощью редактора тел вращения.
</p>
<a name="LCD"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BD%D0%BA%D1%83%D1%80%D1%81%21_%28%D0%B2%D1%8B%D0%BF%D1%83%D1%81%D0%BA_3%29&amp;action=edit&amp;section=3" title="Конкурс! (выпуск 3)">править</a>]</span> <span class="mw-headline">LCD</span></h2>
<p>Наверняка, все Вы знакомы с LCD. Нет, я не про психотропный препарат, а про монохромные жидкокристаллические дисплеи. Например, в калькуляторах дисплей разбит на ячейки. Ячейка состоит из 7 отдельных элементов. Зажигая их в определенной комбинации, можно схематично показать число от 0 до 9. А теперь задача: найти комбинацию элементов, которая может отобразить один из следующих наборов символов (или несколько).
</p><p><br />
</p>
<ul><li>Цифры 0 - 9, элементов 6 или меньше
</li><li>Все заглавные буквы латинского алфавита
</li><li>Все заглавные буквы русского алфавита
</li><li>Любой другой набор (здесь побеждает наиболее оригинальный)
</li></ul>
<p><br />
Допускается некоторая схематичность, но так, чтобы можно было понять, что это за символ. Вот пример заявки - это растровый файл, который можно отредактировать в Paint или другом редакторе. Сначала делается шаблон. Затем он копируется столько раз, сколько символов в наборе. После этого, в каждой копии некоторые из элементов закрашиваются цветом фона ("выключаются"), так чтобы получились символы:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:LCD01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:LCD01.gif" src="getprfc4.gif" width="580" height="64" /></a></span></div></div>
<p>Чем меньше элементов, тем больше шансов на победу. Дополнительный фактор - хорошая распознаваемость символов.
</p>
<a name=".D0.9D.D0.B0.D0.B1.D0.BE.D1.80_.D0.B7.D0.B0.D0.B4.D0.B0.D1.87"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BD%D0%BA%D1%83%D1%80%D1%81%21_%28%D0%B2%D1%8B%D0%BF%D1%83%D1%81%D0%BA_3%29&amp;action=edit&amp;section=4" title="Конкурс! (выпуск 3)">править</a>]</span> <span class="mw-headline">Набор задач</span></h2>
<ul><li>Задача 1: Функция max легко может быть написана с помощью структуры IF...THEN, как это было сделано в некоторых статьях. Найдите формулу для этой функции, то есть функция должна выглядеть так:
</li></ul>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> max<span style=" ">&#40;</span>v1,v2<span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Return</span> ...<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<ul><li>Задача 2: Вот кусок кода, меняющий значения переменных v1 и v2 местами:
</li></ul>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">v=v2<br />
<p>v2=v1<br />
</p>
v1=v</div>
<p>Как поменять значения переменных без использования других переменных и структур данных?
</p>
<hr />
<p>Присылайте мне на потовый ящик (MattMerk@mail.ru, ICQ: 392-274-050) Ваши работы. Срок конкурса - до 15 июня. Победители будут определены голосованием на форуме <a href="http://www.blitzgames.vov.ru/" class="external text" title="http://www.blitzgames.vov.ru" rel="nofollow">www.blitzgames.vov.ru</a> в течение нескольких дней. Все работы будут представлены в следующем выпуске журнала.
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="В следующем выпуске (выпуск 3)"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:В следующем выпуске (выпуск 3)&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=В следующем выпуске (выпуск 3)&amp;action=edit">править</a>]</span><span class="mw-headline">В следующем выпуске (выпуск 3)</span></h1>
<p>Следующий выпуск выйдет не раньше середины июня. Он, скорее всего, будет включать: следующую статью Романа Прядко, перевод Михаила Солодовниченко, OCR статьи о 3DSMax от Святослава, статью о формате B3D, переведенную Alexander Alrusdi, статью о списках - перевод Амира, а также учебник по 3D-моделированию. В разработке статья о создании адвентюрных игр, изометрического движка и трехмерных фигур, обзор технологий, используемых в трехмерных играх. Жду Ваших писем и статей. Всего доброго!
</p>
</p>
<p align="right">
редактор журнала Матвей Меркулов (MattMerk@mail.ru, ICQ: 392-274-050)
</p>
<p><!-- 
Pre-expand include size: 281957 bytes
Post-expand include size: 218564 bytes
Template argument size: 293 bytes
Maximum: 2097152 bytes
-->
</p>
<!-- Saved in parser cache with key db1:pcache:idhash:575-0!1!0!!ru!2 and timestamp 20071112103313 -->
<div class="printfooter">
Получено с <a href="9qvofrch.html">http://blitzetcetera.org/index.php/%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%963_-_%D0%B0%D0%BF%D1%80%D0%B5%D0%BB%D1%8C_2005</a></div>
			<!-- end content -->			<div class="visualClear"></div>				</td>				<td class="rightside">				</td>			</tr>		</table>		</div>	</div>		</div>	
		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</div></body>
<!-- Mirrored from localhost/index.php/%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%963_-_%D0%B0%D0%BF%D1%80%D0%B5%D0%BB%D1%8C_2005 by HTTrack Website Copier/3.x [XR&CO'2007], Mon, 12 Nov 2007 11:20:33 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>