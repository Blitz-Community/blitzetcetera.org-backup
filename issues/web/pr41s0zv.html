<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru" dir="ltr">	
<!-- Mirrored from localhost/index.php/%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%966_-_%D0%BC%D0%B0%D1%80%D1%82_2007 by HTTrack Website Copier/3.x [XR&CO'2007], Mon, 12 Nov 2007 11:20:27 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />				<meta name="keywords" content="Выпуск №6 - март 2007,Avel,JohnK,Matt Merkulov,SBJoker,SubZer0,Jimon" />
		<link rel="shortcut icon" href="http://blitzetcetera.org/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="http://blitzetcetera.org/opensearch_desc.php" title="Blitz Et Cetera (Русский)" />
		<title>Выпуск №6 - март 2007 — Blitz Et Cetera</title>		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "bvih5rde.css?63"; /*]]>*/</style>		<link rel="stylesheet" type="text/css" media="print" href="gcxktlm6.css?63" />		<link rel="stylesheet" type="text/css" media="handheld" href="zumsslq_.css?63" />		<!--[if lt IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE50Fixes.css?63";</style><![endif]-->		<!--[if IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE55Fixes.css?63";</style><![endif]-->		<!--[if IE 6]><style type="text/css">@import "/skins/OfflineNew/IE60Fixes.css?63";</style><![endif]-->		<!--[if IE 7]><style type="text/css">@import "/skins/OfflineNew/IE70Fixes.css?63";</style><![endif]-->		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?63"></script>		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->		<script type= "text/javascript">/*<![CDATA[*/
var skin = "OfflineNew";
var stylepath = "/skins";
var wgArticlePath = "/index.php/$1";
var wgScriptPath = "";
var wgServer = "http://blitzetcetera.org/";
var wgCanonicalNamespace = "";
var wgCanonicalSpecialPageName = false;
var wgNamespaceNumber = 0;
var wgPageName = "Выпуск_№6_-_март_2007";
var wgTitle = "Выпуск №6 - март 2007";
var wgAction = "view";
var wgArticleId = "659";
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "ru";
var wgContentLanguage = "ru";
var wgBreakFrames = false;
var wgCurRevisionId = "3644";
/*]]>*/</script>
		<script type="text/javascript" src="2nq-6cel.js?63"><!-- wikibits js --></script>		<script type="text/javascript" src="http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=js"><!-- site js --></script>		<style type="text/css">/*<![CDATA[*/
@import "http://blitzetcetera.org/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=MediaWiki:OfflineNew.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=css&amp;maxage=18000";
/*]]>*/</style>		<!-- Head Scripts -->	</head><body  class="mediawiki ns-0 ltr page-Выпуск_№6_-_март_2007">	<div id="globalWrapper">	<div id="logocontainer">		<table align="center">		  <tr>				<td id="blitzetclogo">				</td>			</tr>		</table>	</div>	<div id="magbar">	Журнал о программированнии на языках Blitz3D, BlitzMax, BlitzPlus	</div>		<div id="column-content">	<div id="content">		<a name="top" id="top"></a>				<div id="bodyContent">		<table cellspacing=0 cellpadding=0 width=100%>			<tr>			  <td class="leftside">				</td>				<td class="sheetbody">					<h1 class="sheet">Выпуск №6 - март 2007</h1>			<h3 id="siteSub">Материал из Blitz Et Cetera.</h3>			<div id="contentSub"></div>			<!-- start content -->			<a name="Contents"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%966_-_%D0%BC%D0%B0%D1%80%D1%82_2007&amp;action=edit&amp;section=1" title="Править секцию: Contents">править</a>]</span> <span class="mw-headline">Contents</span></h2>
<ul><li>Вступление
<ul><li><a href="#Предисловие редактора (выпуск 6)">Предисловие редактора (выпуск 6)</a>
</li><li><a href="#Почта (выпуск 6)">Почта (выпуск 6)</a>
</li></ul>
</li><li>Новичкам
<ul><li><a href="#Некоторые соображения по созданию игр">Некоторые соображения по созданию игр</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Avel" title="Участник:Avel">Агнислав Липкан</a> 
</li><li><a href="#Создание редактора карт, нестандартный подход">Создание редактора карт, нестандартный подход</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Avel" title="Участник:Avel">Агнислав Липкан</a> 
</li><li><a href="#Делаем частицы с ООП">Делаем частицы с ООП</a> - Matt McFarland, перевел <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:JohnK" title="Участник:JohnK">JohnK</a> 
</li></ul>
</li><li>Тонкости кодинга
<ul><li><a href="#Создание меню в BlitzPlus">Создание меню в BlitzPlus</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> 
</li><li><a href="#Отладка программы">Отладка программы</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> 
</li><li><a href="#Создаем GUI «руками»">Создаем GUI «руками»</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Avel" title="Участник:Avel">Агнислав Липкан</a> 
</li><li><a href="#Стабилизация FPS в играх">Стабилизация FPS в играх</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:SBJoker" title="Участник:SBJoker">SBJoker</a> 
</li></ul>
</li><li>Структуры данных
<ul><li><a href="#Быстрый поиск в базе данных">Быстрый поиск в базе данных</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> 
</li></ul>
</li><li>Разработки
<ul><li><a href="#Логотип jgs в 100 строчках кода">Логотип jgs в 100 строчках кода</a> - <a href="http://blitzetcetera.org/index.php?title=%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Jimon&amp;action=edit" class="new" title="Участник:Jimon">Jimon</a> 
</li><li><a href="#Мех на Blitz3D">Мех на Blitz3D</a> - <a href="http://blitzetcetera.org/index.php?title=%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Jimon&amp;action=edit" class="new" title="Участник:Jimon">Jimon</a> 
</li><li><a href="#Туториал «Змейка»">Туториал «Змейка»</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:SubZer0" title="Участник:SubZer0">SubZer0</a> 
</li></ul>
</li><li>Юмор
<ul><li><a href="#Blitz доберется до вас!">Blitz доберется до вас!</a> - L.D.M.T. 
</li></ul>
</li><li>В заключение
<ul><li><a href="#Конкурс! (выпуск 6)">Конкурс! (выпуск 6)</a>
</li><li><a href="#В следующем выпуске (выпуск 6)">В следующем выпуске (выпуск 6)</a>
</li></ul>
</li></ul>
<p></td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Предисловие редактора (выпуск 6)"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Предисловие редактора (выпуск 6)&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Предисловие редактора (выпуск 6)&amp;action=edit">править</a>]</span><span class="mw-headline">Предисловие редактора (выпуск 6)</span></h1>
<p>Здравствуйте, читатели шестого выпуска BlitzEtc! Как вы уже знаете, журнал реинкарнирован и открыт для новых статей и исходников с конца августа 2006. Я написал движок для генерации HTML-страниц журнала, поэтому на добавление новых статей и программ теперь уходит гораздо меньше времени. Это значит, что присланная вами статья имеет высокие шансы на появление в тот же или на следующий день после ее высылки. Теперь я отсылаю автору отредактированную статью в формате журнала.
</p>
</p><p>Первым, кто прислал статью, был L.D.M.T., написавший небольшое художественное произведение  "Blitz доберется до вас!", а Jimon предоставил пару интересных статей про графические эффекты в 2D (Логотип jgs в 100 строчках кода) и 3D (Мех на blitz3d).
</p><p>Я написал статью про отладку программ (пока только в Blitz3D и BlitzPlus) и систему хранения данных, облегчающую поиск (Быстрый поиск в базе данных).
</p><p>Статьями "Создаем GUI «руками»" Агнислава Липкана освещена тема создания графического интерфейса в играх. Еще касается интерфейса моя статья про удобную систему создания меню в BlitzPlus. Агнислав также поделился своими соображениями по созданию игр и написал статью "Создание редактора карт, нестандартный подход".
</p><p>SBJoker в своей статье "Стабилизация FPS в играх" предложил использование компактного модуля для корректирования скорости хода игры в зависимости от скорости работы компьютера.
</p><p>JohnK перевел небольшую статью про создание частиц в BlitzMax.
</p><p>Вообще-то я планировал выход выпуска на конец 2006 года. Но статья, которую я хотел написать для него, неожиданно разраслась до невероятных размеров (ведь, сказав А, нужно было сказать и Б!), к тому же, приходилось то и дело переписывать программу (а это 34KB кода и 16KB комментариев) по ходу более глубокого погружения в ее суть. И вот, статья готова, но она все еще оставляет много открытых вопросов, а посему, планируется продолжение.
</p><p>Код для этой статьи написан исключительно на BlitzMax. Я считаю, что этот язык является наиболее перспективным из всего семейства и поэтому полностью перешел на него (тем более, что большая часть Blitz3D-команд уже внедрена в BlitzMax энтузиастами, создавшими <a href="http://www.blitzbasic.com/logs/userlog.php?user=6&amp;log=1369" class="external text" title="http://www.blitzbasic.com/logs/userlog.php?user=6&amp;log=1369" rel="nofollow">MiniB3D</a> - бесплатный движок с открытыми исходниками, аналогичный имеющемуся в Blitz3D). А ведь еще на подходе официальный - с шейдерами и физикой! С удовольствием использую так не хватавшую мне возможность возвращать значения переменных из функций (которая есть в QBasic и отсутствует в Blitz3D), а также списки, иерархию объектов и методы. И там еще много всяких вкусностей, включая возможность значительно сократить размер exeшников и мультиплатформенность (программу можно откомпилировать для запуска под Windows, Linux и MacOS).
</p><p>Вы можете узнать о последних изменениях, а также ознакомиться с историей создания языков Blitz в <a href="http://www.blitzbasic.com/logs/userlog.php?user=1&amp;log=1043" class="external text" title="http://www.blitzbasic.com/logs/userlog.php?user=1&amp;log=1043" rel="nofollow">журнале Марка Сибли</a>.
</p><p>Еще в этом журнале вы найдете задачи, над которыми, думаю, будет интересно поломать голову. Причем, я решил сразу давать шаблон, в котором уже есть строки создания сцены и тестирующий код, так что вы можете сразу начинать реализовывать решение, не отвлекаясь на вторичные мелочи. Ответы принимаются до выпуска 7-го номера и будут в нем же опубликованы.
</p><p>Напоследок, хочу вам напомнить, что состояние журнала в большой степени зависит от вас, поэтому присылайте свои статьи! И не стоит сомневаться в своих способностях, по своему опыту скажу, что стоит только начать, а там ваш уровень, как писателя (и программиста тоже), будет неуклонно расти. К тому же, статьи можно в любой момент отредактировать, прислать мне и они будут изменены в журнале.
</p>
<div align="right">Матвей Меркулов</div>
<p></td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Почта (выпуск 6)"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Почта (выпуск 6)&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Почта (выпуск 6)&amp;action=edit">править</a>]</span><span class="mw-headline">Почта (выпуск 6)</span></h1>
</p>
<a name=".D0.9F.D0.B8.D1.81.D1.8C.D0.BC.D0.BE_.D0.BE.D1.82_Stalnoy_Gvozd"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9F%D0%BE%D1%87%D1%82%D0%B0_%28%D0%B2%D1%8B%D0%BF%D1%83%D1%81%D0%BA_6%29&amp;action=edit&amp;section=1" title="Почта (выпуск 6)">править</a>]</span> <span class="mw-headline">Письмо от Stalnoy Gvozd</span></h2>
<p>Журнал Blitz Et Cetera - лучший! Царство ему небесное.
</p><p>Матвей вы герой! Удачи!
</p>
<hr />:)
<a name=".D0.9F.D0.B8.D1.81.D1.8C.D0.BC.D0.BE_.D0.BE.D1.82_Plug55"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9F%D0%BE%D1%87%D1%82%D0%B0_%28%D0%B2%D1%8B%D0%BF%D1%83%D1%81%D0%BA_6%29&amp;action=edit&amp;section=2" title="Почта (выпуск 6)">править</a>]</span> <span class="mw-headline">Письмо от Plug55</span></h2>
<p>Привет Матвей. Совсем недавно у меня появилась программа Blitz3D 1.83. Вообще это наверно уже старая версия, но мне очень понравились возможности этой программы. К тому же, гуляя в Интернете наткнулся на какой - то сайт где скачал твои журналы с 1 - 5 номера, а так же много других статетей посвящённых Blitz. Мне очень понравился твой журнал, я открыл для себя много интересного и ещё больше заинтересовался Blitz. Но вот вопрос? - Журнал ещё существует или 5 номер - это последний? Читая твой журнал я понял что у тебя и твоих помощников нет опыта в издании журнала, но тем не менее журнал получился отличный, особенно для новичков. Большая просьба: если журнал ещё существует, то пожалуйста пришлите хотя - бы ссылку, где его можно найти. Так же очень хотелось бы на него подписаться. А если журнала уже нет и 5-ый номер последний, то пришлите пожалуйста ссылку, где я смогу найти какую - нибудь ещё информацию о Blitz. 
</p><p>P. S. Очень понравилась статья "Курс молодого бойца часть 3: практические занятия" в № 3. Автор обещал продолжение в следующем номере, но ни в № 4, ни в № 5 продолжения не было. Ессли где - то есть продолжение или ещё какие - нибудь статьи на счёт создания RPG игр шаг за шагом, то тоже большущая просьба пришлите ссылку. Заранее благодарю.
</p>
<hr />
<p>Добрый день
</p><p>Журнал сейчас закрыт и те 5 выпусков - все, что есть. Насчет сайтов о Blitz: могу посоветовать - blitz.pp.ru. "Курс молодого бойца 4" автор мне так и не прислал и я не знаю, есть ли продолжение.
</p><p>С уважением,
</p>
<p><dl><dd>Matt Merkulov
</dd></dl>
</p>
<hr />
<p>Добрый день
</p><p>В предыдущем письме вы интересовались судьбой журнала. Так вот (если вы еще не в курсе) - журнал снова открыт, есть новые статьи и исходники, готовится к выпуску номер 6. Адрес прежний: <a href="http://blitzetc.boolean.name/" class="external free" title="http://blitzetc.boolean.name" rel="nofollow">http://blitzetc.boolean.name</a>
</p><p>С уважением,
</p>
<p><dl><dd>Matt Merkulov
</dd></dl>
</p>
<a name=".D0.9F.D0.B8.D1.81.D1.8C.D0.BC.D0.BE_.D0.BE.D1.82_.D0.90.D0.B3.D0.BD.D0.B8.D1.81.D0.BB.D0.B0.D0.B2.D0.B0_.D0.9B.D0.B8.D0.BF.D0.BA.D0.B0.D0.BD.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9F%D0%BE%D1%87%D1%82%D0%B0_%28%D0%B2%D1%8B%D0%BF%D1%83%D1%81%D0%BA_6%29&amp;action=edit&amp;section=3" title="Почта (выпуск 6)">править</a>]</span> <span class="mw-headline">Письмо от Агнислава Липкана</span></h2>
<p>Здравствуй Матвей!
</p><p>Во первых спасибо тебе за благодарности по поводу моей статьи и вообще за то, что ты делаешь. 
<p>Журнал вообще супер. В нем можно почерпнуть много нового и не только новичкам. Хочу внести 
несколько рациональных предложений. Например, неплохо было бы более четко отделять разные части 
журнала друг от друга, а то иногда непонятно, где закончилась одна статья и началась другая. 
Еще необходима большая структурированность журнала и новые разделы. 
Например: обзор программ и/или новинок,  новости мира блиц, раздел по моделированию, 
хитрые алгоритмы, для новичков, ну, и т. д. Так же журналу нужна реклама, потому что многие 
просто не знают, что есть такой замечательный журнал. Я и сам только недавно совершенно случайно 
его обнаружил. Можно создать какой-нибудь проект, чтобы постепенно создавать, например мега игру, 
а читатели будут присылать свои наработки по этому проекту. Только не воспринимай мои слова как 
критику, это просто дружеские советы и пожелания.
</p>
</p><p>Теперь о наболевшем. Очень прошу какую-нибудь статью по созданию сетевой игры.
<p>Я сам неплохо знаю блиц, но вот с сетью совершенно не умею работать и думаю не я один. Причем я в этом деле настолько чайник, что неплохо было бы в этой статье рассказать, как запустить эту игру на сервере и на клиенте. Так же хотелось бы узнать, не знаешь ли ты как можно реализовать переменную гравитацию с перевертыванием камеры вверх ногами. 
Что бы ты не считал меня исключительно потребителем высылаю тебе несколько статей.
</p>
</p><p>Напоследок хочу отдельно поблагодарить тебя и всех авторов за следующие статьи:
</p>
<ul><li>Использование формул логики
</li><li>Игра "Жизнь"
</li><li>Виртуальный художник
</li><li>Курс молодого бойца
</li><li>Фазы создания видеоигр 
</li><li>Искусственный интеллект
</li><li>Создай свой скринсейвер
</li><li>Четырехмерная геометрия
</li><li>Blitz-сайты
</li><li>Галерея: стратегии от MicroProse
</li><li>Переход на BlitzMax с Blitz3D: Синтаксис
</li><li>Алгоритм A* для новичков
</li><li>Тела вращения
</li><li>Обзор технологий, используемых в играх
</li><li>3D-акселераторы
</li><li>Неофициальная спецификация формата файлов "B3D" V0.2
</li><li>Страна советов - Max и не только
</li><li>Создаём свой First Person Shooter
</li><li>Стрельба на опережение
</li><li>Лабиринты
</li><li>Скрипты
</li></ul>
<p>Все эти статьи показались мне наиболее интересными, побольше бы таких!
Неплохо было бы сделать простенькие примеры по статье LОбзор технологий, используемых в играх¦, готов взять часть этой работы на себя, но только часть. На все у меня не хватит ни времени, ни мозгов. Ну, вроде все сказал, что хотел, спасибо за внимание.
</p><p>С наилучшими пожеланиями, avel!
</p>
<hr />
<p>Привет, Агнислав!
</p>
<p><dl><dt>Во первых спасибо тебе за благодарности по поводу моей статьи и вообще за то, что ты делаешь.
</dt></dl>
</p>
<p>Приятно слышать.
</p>
<p><dl><dt>Журнал вообще супер. В нем можно почерпнуть много нового и не только новичкам. Хочу внести несколько рациональных предложений. Например, неплохо было бы более четко отделять разные части журнала друг от друга, а то иногда непонятно, где закончилась одна статья и началась другая.
</dt></dl>
</p>
<p>Хмм, как-то не замечал, подумаю над этим.
</p>
<p><dl><dt>Еще необходима большая структурированность журнала и новые разделы. Например</dt><dd> обзор программ и/или новинок,  новости мира блиц, раздел по моделированию, хитрые алгоритмы, для новичков, ну, и т. д.
</dd></dl>
</p>
<p>Хорошо бы, но кто их будет создавать? Я планирую создать раздел ссылок и периодически его обновлять, но часами бороздить интернет в поисках новостей, новых программ, качать и описывать их, мне пока просто неохота. Моделированием я почти не занимался, хирые алгоритмы периодически освещаются, для новичков статьи пишут относительно часто. В "списке" статьи распределены по категориям, если есть предложения по реструктуризации, с интересом выслушаю.
</p>
<p><dl><dt>Также, журналу нужна реклама, потому что многие просто не знают, что есть такой замечательный журнал. Я и сам только недавно совершенно случайно его обнаружил.
</dt></dl>
</p>
<p>Да, согласен, но этим лучше заняться после выхода 6-го номера, что я и планирую сделать.
</p>
<p><dl><dt>Можно создать какой-нибудь проект, чтобы постепенно создавать, например мега игру, а читатели будут присылать свои наработки по этому проекту.
</dt></dl>
</p>
<p>Я планировал что-то подобное, но у меня есть большие сомнения, что кто-нибудь еще будет сотрудничать. И еще, это настолько обширная территория, что, хорошо все обдумав, я предпочту написать книгу.
</p>
<p><dl><dt>Только не воспринимай мои слова как критику, это просто дружеские советы и пожелания.
</dt></dl>
</p>
<p>Да без проблем. Конструктивная критика с конкретными предложениями - это тоже хорошо.
</p>
<p><dl><dt>Теперь о наболевшем. Очень прошу какую-нибудь статью по созданию сетевой игры. Я сам неплохо знаю блиц, но вот с сетью совершенно не умею работать и думаю не я один. Причем я в этом деле настолько чайник, что неплохо было бы в этой статье рассказать, как запустить эту игру на сервере и на клиенте.
</dt></dl>
</p>
<p>Тут я сам не могу ничем помочь: я этим вопросом не занимался вообще и не планирую (нет резона).
</p>
<p><dl><dt>Напоследок хочу отдельно поблагодарить тебя и всех авторов за следующие статьи</dt><dd> ... Все эти статьи показались мне наиболее интересными, побольше бы таких!
</dd></dl>
</p>
<p>То ли еще будет!
</p>
<p><dl><dt>Неплохо было бы сделать простенькие примеры по статье "Обзор технологий, используемых в играх", готов взять часть этой работы на себя, но только часть.
</dt></dl>
</p>
<p>А это идея. Но, пожалуй, иллюстраций будет достаточно, а то обзор
разрастется до размеров учебника.
</p><p>Желаю успехов!
</p><p>С уважением,
</p>
<p><dl><dd>Matt Merkulov
</dd></dl>
</p>
<p></td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Некоторые соображения по созданию игр"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Некоторые соображения по созданию игр&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Некоторые соображения по созданию игр&amp;action=edit">править</a>]</span><span class="mw-headline">Некоторые соображения по созданию игр</span></h1>
</p>
<p align="center">(рекомендую новичкам)</p>
<p>Lectori benevolo salutem (лат. Привет благосклонному читателю). Я решил поделиться с вами некоторыми соображениями и рекомендациями по созданию 3D игр. Вот, что у меня получилось.
</p>
<ul><li>Соображение 1: Зачем изобретать велосипед, когда можно его улучшить.
</li></ul>
<p>Означает это примерно следующее: многое из того, что вы собираетесь создать, уже создано. Поэтому проще посмотреть, как это сделали другие, и потратить сэкономленное время на доработку и модернизацию существующего. Не стесняйтесь смотреть общедоступные исходники программ и использовать бесплатные модели. Так можно многому научиться. Однако не стоит тупо копировать плоды работы чужих умов, вам следует разбираться в механизме их создания. 
</p>
<ul><li>Соображение 2: Не все то золото, что блестит!
</li></ul>
<p>Внешняя «красота» в играх не главное. Качественные текстуры, высоко полигональные модели, всякие спецэффекты не заменят интересного сюжета и играбельного геймплэя. Часто очень качественно сделанные игры проваливались в продаже из-за своей однообразности и скучности 
</p>
<ul><li>Соображение 3: Кто не знает, что такое мир, не знает, где он сам... (Марк Аврелий)
</li></ul>
<p>Нестандартный и непонятный интерфейс отпугнет будущих пользователей вашего творения. Способ управления и правила игры должны быть просты и понятны, а количество этих правил не должно быть слишком велико. Погружаясь, в игровой мир, пользователь должен чувствовать себя как дома. 
</p>
<ul><li>Соображение 4: Соперничество - пища для гения (Ф. Вольтер)
</li></ul>
<p>В игре должен быть стимул к ее продолжению. Если игра одиночная, то должен быть враг, который всегда слегка впереди вас, если же сетевая, то список рекордов, в котором указаны лучшие достижения других игроков, и т. д. Например, в Quake III arena внизу экрана цифрами показывалось максимальное количество фрагов, набранных другими игроками (ботами) и количество фрагов, набранных вами. Вспомните, как приятно рассказать знакомым о своих достижениях в какой-либо игре. 
</p>
<ul><li>Соображение 5: Доблесть милее вдвойне, если доблестный телом прекрасен (Вергилий)
</li></ul>
<p>Внешний вид главного персонажа многое определяет. Гораздо приятнее играть за соблазнительную красотку или могучего воина, чем за какого-нибудь отвратительного паука-мутанта. 
</p>
<ul><li>Соображение 6: Все хорошо в меру (мой жизненный девиз!).
</li></ul>
<p>Часто на новичков действует синдром «первой большой игры». Т. е. когда в игру пытаются напихать все, что только можно. Этого делать не стоит. К тому же не стоит забывать об ограниченном объеме памяти, если не хотите получить слайд-шоу вместо игры. Необходим компромисс между красотой и FPS. Так же нет смысла использовать переменную гравитацию в РПГ или что-либо подобное. Соответствуйте жанру игры и не перебарщивайте с игровыми возможностями. 
</p>
<ul><li>Соображение 7: Оптимизируйте, оптимизируйте, и еще раз оптимизируйте!
</li></ul>
<p>Не забывайте, чем быстрее (без тормозов) будет работать ваша программа, тем лучше Например, заменяйте операции деления на умножение, оно работает быстрее. Это связано с особенностями работы процессора. Так же уменьшайте кол-во параметров в функциях, но при этом все возможное описывайте именно в них. Обращайте внимание на типы переменных, каждый тип занимает разный объем памяти. В моделях не стоит перебарщивать с числом полигонов, лучше подобрать качественную текстуру (смотрится лучше, а ресурсов жрет меньше). Впрочем, с текстурами тоже надо быть осторожнее. Надо подбирать размер текстуры так, чтобы она не состояла из кубиков, но и была при этом наименьшего размера. Если высоко полигональные модели дают нагрузку на процессор, то большие и качественные текстуры грузят оперативную память. Что для вас важнее решайте сами. Еще совет по поводу текстур: выбирайте правильные форматы. Например, мне нравится формат png , он достаточно точен и не прожорлив. На текстурах с разверткой следует компактно размещать детали. Ну и т. д. 
</p>
<ul><li>Соображение 8: Все дело в деталях.
</li></ul>
<p>Уделяйте внимание мелким деталям. Именно это и отличает профессионала от новичка. Например, анимация растительности, прозрачность воды и стекла, правильная траектория полета снаряда, корректные пересечения с камерой различных объектов, гравитация трупов (чтобы они не зависали в воздухе) и др. Не надейтесь, что пользователь не заметит вашей недоработки. 
</p>
<ul><li>Соображение 9: У всего есть свое начало и свой конец.
</li></ul>
<p>Не забудьте ограничивать свой мир, однако делайте это так, чтобы создавалась иллюзия, что ваш мир безграничен 
</p>
<ul><li>Соображение 10: Время - деньги!
</li></ul>
<p>Помните, что никто не любит тратить время попусту. Если в вашей игре, что-то долго грузиться, то займите игрока на это время чем-нибудь, например, можно давать советы по игре в виде текста. Так же стоит избегать повторяющихся действий для игрока (т. е. когда игрок от уровня к уровню делает однообразные действия) это всегда утомляет и интерес к игре пропадает. 
</p><p>Помните эти «десять заповедей» геймдевелопера и ваши игры будут интересными и увлекательными. Теперь хочу дать пару дельных советов:
</p>
<ul><li>Избегайте большого числа камер – это создает лишние тормоза, проще менять координаты одной камеры.
</li></ul>
<ul><li>Если хотите, чтобы спрайты не были полупрозрачными, то используйте формат png с прозрачным фоном или схожий с ним формат. То же относится и к рисункам, если хотите, чтобы он отображался точно, особенно его темные части.
</li></ul>
<ul><li>Используйте максимум команд блица для оптимизации своего кода, все равно к программе прикомпилируются все функции. 
</li></ul>
<ul><li>Помните: если игра работает у вас, то это не значит, что она будет работать на другом компьютере. Тестируйте свои программы на разных системах с разной конфигурацией, программным обеспечением и оборудованием. 
</li></ul>
<ul><li>Если хотите использовать реальное расположение звезд, то удобно воспользоваться картой звездного неба, слегка поработав над ней в фотошопе. У меня получилось вот, что: 
</li></ul>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Avel01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Avel01.gif" src="fr1bksm9.gif" width="525" height="175" /></a></span></div></div>
<p>не удивляйтесь, что она задом наперед. Так надо! Накладываете ее на сферу в 3dsmax, применяете сферическую текстурную карту, если сразу не получилось наложить правильно, меняете направление нормалей и небо готово. Выглядит вот так (это, кстати, из моей игры, которую я сейчас разрабатываю):
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Avel02.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Avel02.jpg" src="9lhncb9q.jpg" width="512" height="384" /></a></span></div></div>
<p>Узнаете медведицу? 
</p>
<ul><li>При текстурировании террайна удобно использовать равномерно освещенную не цветную текстуру, скажем такую: 
</li></ul>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Avel03.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Avel03.jpg" src="o6nbdyjp.jpg" width="256" height="256" /></a></span></div></div>
<p>А сверху накладывать текстуру-маску, растянутую на весь террайн. Например, зеленый – трава, коричневый – земля и т. д. 
</p>
<ul><li>При моделировании используйте минимум составных частей. Впоследствии, когда вы будете объединять эти части, у вас могут быть проблемы. Например, при экспорте из 3dsmax могут быть неправильно экспортированы нормали.
</li></ul>
<p>Хорошим помощником при моделировании может стать модификатор «выдавливание». 
</p>
<ul><li>Используйте комментарии в тексте программ. 
</li></ul>
<p>Ну, пожалуй, хватит. Все главное я, вроде, сказал.
</p>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Avel" title="Участник:Avel">Агнислав Липкан</a> (e-mail: avelnet@yandex.ru)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Создание редактора карт, нестандартный подход"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Создание редактора карт, нестандартный подход&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Создание редактора карт, нестандартный подход&amp;action=edit">править</a>]</span><span class="mw-headline">Создание редактора карт, нестандартный подход</span></h1>
</p>
<a name=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BD.D0.B5.D1.81.D1.82.D0.B0.D0.BD.D0.B4.D0.B0.D1.80.D1.82.D0.BD.D1.8B.D1.85_.D0.BF.D0.BE.D0.B4.D1.85.D0.BE.D0.B4.D0.BE.D0.B2_.D0.B2_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D0.BC.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B8_.D0.BD.D0.B0_.D0.BF.D1.80.D0.B8.D0.BC.D0.B5.D1.80.D0.B5_.D1.81.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D1.8F_.D1.80.D0.B5.D0.B4.D0.B0.D0.BA.D1.82.D0.BE.D1.80.D0.B0_.D0.BA.D0.B0.D1.80.D1.82."></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D1%80%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%BE%D1%80%D0%B0_%D0%BA%D0%B0%D1%80%D1%82%2C_%D0%BD%D0%B5%D1%81%D1%82%D0%B0%D0%BD%D0%B4%D0%B0%D1%80%D1%82%D0%BD%D1%8B%D0%B9_%D0%BF%D0%BE%D0%B4%D1%85%D0%BE%D0%B4&amp;action=edit&amp;section=1" title="Создание редактора карт, нестандартный подход">править</a>]</span> <span class="mw-headline">Использование нестандартных подходов в программировании на примере создания редактора карт.</span></h2>
<p>Я всегда считал, что программирование занятие, в общем, творческое и требующее нестандартного подхода к решению поставленных задач. Иногда бывает нужно запрограммировать что-либо, но стандартными методами этого сделать никак не получается. И вот тогда в дело включается смекалка, а в сознании (скорее даже на подсознательном уровне) возникает вопрос: «А что, если…». Озарение снизошло на вас, и вот уже новая идея стала раскручиваться в голове, на ум приходят все новые идеи по усовершенствованию существующей, и через минуту-другую программа работает, а вы довольно смотрите в монитор на свое творение. Это было некое лирическое отступление, теперь же попытаюсь объяснить, что означает «нестандартный подход» на простеньком примере, написанном в Blitz3D. Если вы с Blitz3D не знакомы, то это не означает, что вы не должны читать эту статью дальше. Логику действий я постараюсь объяснить подробно и простыми словами. Итак, приступим!
</p><p>Не так давно я писал редактор карт для своей игры, суть его состояла в следующем: он делил всю (достаточно большую) карту на квадраты (64 на 64), каждый из которых текстурировал своей текстурой. При этом в коде основной программы был некий массив текстур, и номер элемента массива загружался из файла.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">…<br />
<p><span style="color: #aaffff; font-weight: bold;">Dim</span> tex<span style=" ">&#40;</span><span style="color: #33ffdd;">26</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; создаем массив текстур</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">25</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;начало цикла по загрузке текстур, всего их 25</span><br />
&nbsp; &nbsp; &nbsp;b$=a+<span style="color: #00ff66;">&quot;.bmp&quot;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;b$ - это имя текстуры «1.bmp», «2.bmp», и т.д.</span><br />
&nbsp; &nbsp; &nbsp;tex<span style=" ">&#40;</span>a<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span>b$<span style=" ">&#41;</span> &nbsp;<span style="color: #ffee00">;в нужный элемент массива загружаем нужную текстуру</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;конец цикла</span><br />
<br />
…<br />
<br />
<span style="color: #ffee00">;тут начинается цикл создания карты в основной программе</span><br />
…<br />
file=<span style="color: #aaffff; font-weight: bold;">ReadFile</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;cart.dat&quot;</span><span style=" ">&#41;</span> &nbsp; &nbsp;<span style="color: #ffee00">;загружаем файл карты</span><br />
…<br />
track=<span style="color: #aaffff; font-weight: bold;">ReadLine</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;считываем в пер. «track» № элемента массива с нужной текстурой</span><br />
…<br />
<span style="color: #ffee00">;цикл закончен</span><br />
<span style="color: #aaffff; font-weight: bold;">CloseFile</span> file &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;закрываем файл</span><br />
</p>
…</div>
<p>Так, как у меня в карте было 4096 независимых квадрата (64*64=4096), то, соответственно, в загрузочном файле должно быть 4096 чисел. Вот такая вот арифметика!&nbsp;:)
</p><p>Конечно, ввести такое количество чисел, да еще и в нужной последовательности показалось мне нереальным, и я стал сочинять редактор, который упростил бы мне жизнь.
</p><p>Идея была следующая: создать поле из 4096 мини-картинок ( createimage() ) и двумерный массив общим числом элементов 4096. Ну, естественно при нажатии на нужный квадратик, его картинка сменяется на текущую, а в нужный элемент массива записывается номер текущей картинки. Первая часть выполняется элементарно просто:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Dim</span> ArrayGrid<span style=" ">&#40;</span><span style="color: #33ffdd;">65</span>,<span style="color: #33ffdd;">65</span><span style=" ">&#41;</span> &nbsp; <span style="color: #ffee00">;создаем массив</span><br />
<p><span style="color: #ffee00">; присвоим каждому элементу массива некое начальное значение. e,r-переменные цикла</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> e&lt;<span style="color: #33ffdd;">64</span><br />
&nbsp; &nbsp; e=e<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; r=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> r&lt;<span style="color: #33ffdd;">64</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; r=r<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; ArrayGrid<span style=" ">&#40;</span>e,r<span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Wend</span></div>
<p>С картинками немного сложнее. Тут есть два варианта (вообще-то больше, но это не важно J ): первый – это создать циклом 4096 изображений и циклом же их разместить на экране, второй вариант более изощренный, но и более удобный. Я воспользовался именно им. Я создал одно изображение, а потом рисовал его много раз в разных местах и с разным индексом, берущимся из массива, делалось все это с помощью цикла. Изображение должно быть не простое, а (нет, не золотое&nbsp;:) ) состоящее из структуры изображений. Проще говоря, воспользуйтесь командой <b>LoadAnimImage()</b>.
</p><p>В главном цикле постоянно выполняется что-то вроде этого:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">While</span> i&lt;<span style="color: #33ffdd;">64</span><br />
<p>x=x<span style="color: #33ffdd;">+12</span> <br />
i=i<span style="color: #33ffdd;">+1</span><br />
y=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> j&lt;<span style="color: #33ffdd;">64</span><br />
&nbsp; &nbsp; &nbsp; y=y<span style="color: #33ffdd;">+11</span><br />
&nbsp; &nbsp; &nbsp; j=j<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DrawImage</span> tim,<span style="color: #33ffdd;">10</span>+x,<span style="color: #33ffdd;">12</span>+y,ArrayGrid<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Wend</span></div>
<p>В выражениях <b>x=x+12</b> и <b>y=y+11</b>,12 и 11 – это длина и ширина изображения плюс промежуток между изображениями на поле. При разрешении экрана 1024 на 768 самым оптимальным, оказалось, сделать изображение 10 на 10 пикселей и промежуток в 2 пикселя по x и 1 пиксель по y.
В выражении <b>DrawImage tim,10+x,12+y,ArrayGrid(i,j)</b> 10 и 12 – это координаты начала прорисовки поля, они могут быть любые, но потом их надо будет учитывать, поэтому я взял их такими для удобства счета. tim - это наше изображение с вариантами разных картинок. Из массива <b>ArrayGrid(i,j)</b> берется нужный индекс. Иногда в таком варианте бывают глюки, просто раскидайте циклы по функциям и все заработает.
</p><p><br />
<p>Дальше, хуже. Необходимо реализовать в программе возможность «тыкать» курсором по мини-изображениям, и чтобы еще при этом в массиве ArrayGrid() что-то менялось. Кошмар!&nbsp;:) Вот вопрос: как сопоставить  мини-изображения и массив? Первое, что пришло мне в голову это команда <b>RectsOverlap()</b> с координатами мыши в качестве второго параметра (или что-либо подобное), но это почему-то не сработало. К тому же, такой вариант сильно загружал бы процессор и память, поэтому я от него отказался. И вот тут-то и начинается тот самый «нестандартный подход»! 
</p>
</p><p><br /> 
<p>Я решил определять номер нужного мне элемента массива непосредственно по координатам, передаваемым мышью. Для этого я все рабочее поле мысленно разделил на равные участки, равные размеру мини-изображений в сумме с промежутком между ними и в результате координаты передаваемые мышью деленные на длину либо ширину изображений (что в данном случае не важно, так как они у меня равны) плюс промежуток по x в одном случае и по y в другом, давали мне необходимые индексы для массива. Еще одно замечание: в массиве следует учесть то, что поле начинается не в начале координат, помните, я обращал на это ваше внимание. Так, как у меня удаления от начала координат равны шагу поля, то я просто отнимаю единицу. Команда выглядит так:
</p>
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">ArrayGrid<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">12</span><span style="color: #33ffdd;">-1</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">11</span><span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>=numer</div>
<p>Здесь numer - это номер текущего присваиваемого значения. Выбор этого значения реализуется аналогично, только поле меньшего размера и математика немного меняется.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">numer=<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">17</span><span style="color: #33ffdd;">-47</span><span style=" ">&#41;</span>+<span style=" ">&#40;</span><span style="color: #33ffdd;">10</span>*<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">17</span><span style="color: #33ffdd;">-6</span><span style=" ">&#41;</span><span style=" ">&#41;</span></div>
<p>Это вариант для поля 10 на 2 клеток. 47 и 7 это отступления от края, а 17 это длина либо ширина изображения сложенная с промежутком между ними. Умножение на 10 нужно для того, чтобы переменной numer присваивался новый с каждым рядом разряд десятков. Т. е. в первом ряду 1, 2, … ,10, во втором 11, 12, … , 20 и т. д.
</p><p><br />
<p>Чтобы можно было видеть курсор, следует загрузить еще одно изображение для курсора, а в качестве координат x,y передавать ему координаты мыши во время отрисовки.
</p>
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">DrawImage</span> ukazka,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p><b>Ukazka</b> – изображение курсора в png-формате. Чтобы курсор не оставлял следов на экране нужно его постоянно обновлять или очищать, но проще задать режим 3D и создать камеру. Сохранить данные в файл можно путем обычного циклического перебора всех элементов массива и стандартной функции записи.
</p><p>Вот, кажется и все. Напоследок весь код. С наилучшими пожеланиями, AVEL!
</p><p>Код всей проги:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;(c) Agnislav Lipcan</span><br />
<p><span style="color: #ffee00">; &nbsp; &nbsp;redactor cart</span><br />
<span style="color: #ffee00">;avelnet@yandex.ru</span><br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">1024</span>,<span style="color: #33ffdd;">768</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> tim=<span style="color: #aaffff; font-weight: bold;">LoadAnimImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;MapEditor-Tiles.png&quot;</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">30</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> ukazka=<span style="color: #aaffff; font-weight: bold;">LoadAnimImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;MapEditor-Cursors.png&quot;</span>,<span style="color: #33ffdd;">40</span>,<span style="color: #33ffdd;">40</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">8</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">HandleImage</span> ukazka,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> ArrayGrid<span style=" ">&#40;</span><span style="color: #33ffdd;">65</span>,<span style="color: #33ffdd;">65</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> e&lt;<span style="color: #33ffdd;">64</span><br />
&nbsp; &nbsp; e=e<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; r=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> r&lt;<span style="color: #33ffdd;">64</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; r=r<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; ArrayGrid<span style=" ">&#40;</span>e,r<span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span> <br />
<br />
c=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
i=<span style="color: #33ffdd;">0</span><br />
j=<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #ffee00">;main cikles</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">True</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
ff<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
ff2<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">DrawImage</span> ukazka,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Plot</span> <span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &lt; <span style="color: #33ffdd;">785</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; ArrayGrid<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">12</span><span style="color: #33ffdd;">-1</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">11</span><span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>=numer<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span> <br />
&nbsp; &nbsp; &nbsp; numer=<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">17</span><span style="color: #33ffdd;">-47</span><span style=" ">&#41;</span>+<span style=" ">&#40;</span><span style="color: #33ffdd;">10</span>*<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">17</span><span style="color: #33ffdd;">-7</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> numer&lt;<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> numer=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> numer&gt;<span style="color: #33ffdd;">30</span> <span style="color: #aaffff; font-weight: bold;">Then</span> numer=<span style="color: #33ffdd;">30</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span> &nbsp;<br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,numer<br />
<span style="color: #aaffff; font-weight: bold;">Flip</span> <br />
<span style="color: #aaffff; font-weight: bold;">Wend</span> <br />
<br />
fileout = <span style="color: #aaffff; font-weight: bold;">WriteFile</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;cartdata.dat&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> &nbsp;n=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">64</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> &nbsp;m=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">64</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; stek=ArrayGrid<span style=" ">&#40;</span>m,n<span style=" ">&#41;</span><span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">WriteLine</span><span style=" ">&#40;</span>fileout, stek <span style=" ">&#41;</span> <br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">WriteLine</span><span style=" ">&#40;</span>fileout, <span style="color: #33ffdd;">1</span> <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">CloseFile</span><span style=" ">&#40;</span> fileout<span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End</span> <br />
<br />
<span style="color: #ffee00">;functions</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> ff<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
i=<span style="color: #33ffdd;">0</span><br />
j=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> i&lt;<span style="color: #33ffdd;">64</span><br />
x=x<span style="color: #33ffdd;">+12</span> <br />
i=i<span style="color: #33ffdd;">+1</span><br />
y=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> j&lt;<span style="color: #33ffdd;">64</span><br />
&nbsp; &nbsp; y=y<span style="color: #33ffdd;">+11</span><br />
&nbsp; &nbsp; &nbsp;j=j<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">DrawImage</span> tim,<span style="color: #33ffdd;">10</span>+x,<span style="color: #33ffdd;">12</span>+y,ArrayGrid<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
j=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> ff2<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
i=<span style="color: #33ffdd;">0</span><br />
j=<span style="color: #33ffdd;">0</span><br />
k=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> i&lt;<span style="color: #33ffdd;">3</span><span style="color: #ffee00">;&lt;= кол-во рядов</span><br />
y=y<span style="color: #33ffdd;">+17</span><br />
i=i<span style="color: #33ffdd;">+1</span><br />
x=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> j&lt;<span style="color: #33ffdd;">10</span><br />
&nbsp; &nbsp; x=x<span style="color: #33ffdd;">+17</span><br />
&nbsp; &nbsp; &nbsp;j=j<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">DrawImage</span> tim, <span style="color: #33ffdd;">799</span>+x,<span style="color: #33ffdd;">102</span>+y, k<br />
&nbsp; &nbsp; k=k<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
j=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>А вот картинки, необходимые для работы проги:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:MapEditor-Tiles.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:MapEditor-Tiles.png" src="umxn5czk.png" width="310" height="10" /></a></span></div></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:MapEditor-Cursors.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:MapEditor-Cursors.png" src="fdghu829.png" width="320" height="40" /></a></span></div></div>
<div align="right"><a href="http://blitzetcetera.org/images/8/81/Map_Editor.zip" class="internal" title="Map Editor.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Avel" title="Участник:Avel">Агнислав Липкан</a> (e-mail: avelnet@yandex.ru)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Делаем частицы с ООП"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Делаем частицы с ООП&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Делаем частицы с ООП&amp;action=edit">править</a>]</span><span class="mw-headline">Делаем частицы с ООП</span></h1>
<p>Делаем частицы с ООП
</p>
</p><p>Пройдя этот туториал, вы сможете сделать это:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Sparkle01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Sparkle01.gif" src="8rwn_oo9.gif" width="398" height="301" /></a></span></div></div>
<p>Для начала вам нужны две вещи
</p>
<ul><li>Лицензионная копия BlitzMax&nbsp;;)
</li><li>Графический редактор сохраняющий в .png&nbsp;:)
</li></ul>
<p>Отлично, но перед тем как будем программировать мы должны нарисовать красивую искру. Откройте графический редактор и нарисуйте искру размером 16x16.
</p><p>Когда закончите, сохраните как "Sparkle.png" и положите в папку с будущим .bmx файлом. Если лень рисовать, то вот готовая:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Sparkle.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Sparkle.png" src="dqriiirk-2.png" width="16" height="16" /></a></span></div></div>
<p>Теперь мы готовы писать код, Секция Инициализации:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Strict</span><br />
<p><span style="color: #ffff00; font-weight: bold;">Graphics</span> <span style="color: #FFFFFF;">800</span>,<span style="color: #FFFFFF;">600</span><br />
<span style="color: #ffff00; font-weight: bold;">Global</span> SparkList:<span style="color: #ffff00; font-weight: bold;">TList</span> = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">AutoMidHandle</span><span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">True</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Global</span> iSpark:TImage = <span style="color: #ffff00; font-weight: bold;">LoadImage</span> <span style=" ">&#40;</span><span style="color: #00FF66;">&quot;Sparkle.png&quot;</span>,MIPMAPPEDIMAGE|FILTEREDIMAGE<span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">SetBlend</span> LIGHTBLEND</div>
<p>Надеюсь, это было не сложно. Так как мы работаем в BlitzMax, мы можем добавить элементы ООП. 
</p><p>Для начала создадим Тип, Я назвал его TSpark потому, что буква Т в начале имени Типа - полезная практика.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TSpark<br />
<p>&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> x#,y#,r,g,b,xv#,yv#,scale#,life<br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span></div>
<p>X и Y будут характеризовать позицию частиц, а r,g,b – цвет, который вы сможете изменить по желанию. С помощью Scale, вы сможете масштабировать каждую частицу соответственно. Параметр Life будет отвечать за время жизни частиц.
</p><p>Сначала мы напишем главный цикл, что бы составить представление, о том, что будет делать Тип, а после, напишем сам Тип. Я считаю, что для вас будет проще понять предназначение Типа до его написания.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Repeat</span><br />
<p>&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Function Create(x,y,xv,yv,scale,life)</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Cls</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Когда вы будете удерживать левую кнопку мыши, появиться источник частиц</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Который будет создавать частицы в месте, где находиться курсор</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">1</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'yv - это скорость по оси &nbsp;OY,равная единице</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'так что y будет меняться &nbsp;на единицу каждый раз</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> yv# = <span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'lx - локальная переменная, являющаяся </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'вектором скорости по оси OX для частиц</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Благодаря ей, вы сможете увидеть движение частиц</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> lx# = <span style="color: #FFFFFF;">0.1</span> <span style="color: #ffff00; font-weight: bold;">To</span> <span style="color: #FFFFFF;">1</span> <span style="color: #ffff00; font-weight: bold;">Step</span> .<span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Для опрятности, сделаем скорость по оси OY – случайной.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; yv#:-<span style="color: #ffff00; font-weight: bold;">RndFloat</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Итак, lx# лежит в диапазоне от 0.1 до 1.Далее создаем две частицы.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">' –lx# в последнем случае для того, что бы вторая частица была</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">'зеркальным отражением первой</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TSpark.<span style="">Create</span> <span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #FFFFFF;">-5</span>,lx#,yv#,.<span style="color: #FFFFFF;">2</span>,<span style="color: #FFFFFF;">660</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TSpark.<span style="">Create</span> <span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #FFFFFF;">-5</span>,-lx#,yv#,.<span style="color: #FFFFFF;">2</span>,<span style="color: #FFFFFF;">660</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; TSpark.<span style="">UpdateAll</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Flip</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">Until</span> <span style="color: #ffff00; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span>KEY_ESCAPE<span style=" ">&#41;</span></div>
<p>Надеюсь комментариев в коде достаточно для вашего понимания, если нет, то просто спросите на форуме.&nbsp;;)
</p><p>Теперь разберемся с Типом. Из кода выше, вы могли увидеть, что у типа используются две функции: Create() и UpdateAll().
<p>Давайте вернемся к объявлению типа и напишем эти функции:
</p>
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TSpark<br />
<p>&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> x#,y#,r,g,b,xv#,yv#,scale#,life<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span>x,y,xv#,yv#,scale#,life<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Spark:TSpark &nbsp;= <span style="color: #ffff00; font-weight: bold;">New</span> TSpark<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spark.<span style="">x</span> = x<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spark.<span style="">y</span> = y<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spark.<span style="">xv</span># = xv#<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spark.<span style="">yv</span># = yv#<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.<span style="">r</span> = <span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.<span style="">g</span> = <span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.<span style="">b</span> = <span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.<span style="">scale</span># = scale#<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.<span style="">life</span> = life<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SparkList.<span style="">AddLast</span><span style=" ">&#40;</span>Spark<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Destroy<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SparkList.<span style="color: #B1E7EB;">Remove(Self)<br />
&nbsp; &nbsp; &nbsp; &nbsp; End Method<br />
&nbsp; &nbsp; &nbsp; &nbsp; Function UpdateAll()<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; For Local Spark:TSpark = EachIn SparkList<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.yv#:+RndFloat()<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spark.x#:+Spark.xv#<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spark.y#:+Spark.yv#<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.r:-1<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.b:-2<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.g:-1<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SetColor spark.r,spark.g,spark.b<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SetScale spark.scale,spark.scale<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DrawImage (iSpark,spark.x,spark.y)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SetColor 255,255,255<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SetScale 1,1<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.life:-1<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;If spark.life &lt; 1 Then spark.Destroy()<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Next<br />
&nbsp; &nbsp; &nbsp; &nbsp; End Function<br />
End Type<br />
</p>
</span></div>
<p>Из кода выше, вы можете видеть, что функция UpdateAll() увеличивает скорость по оси OY на случайное дробное число, в то время как скорость по оси ОX стабильно увеличивается на заданное число. Значение Красного и Зеленого компонентов цвета снижается на единицу, а значение Синего на два. Из-за этого, чем ближе частица к смерти, тем больше она насыщенна желтым цветом. Частица исчезнет, когда параметр life будет меньше единицы. А параметр Scale остается неизменным.
</p><p>Вот код полностью: 
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Strict</span><br />
<p><span style="color: #ffff00; font-weight: bold;">Graphics</span> <span style="color: #FFFFFF;">800</span>,<span style="color: #FFFFFF;">600</span><br />
<span style="color: #ffff00; font-weight: bold;">Global</span> SparkList:<span style="color: #ffff00; font-weight: bold;">TList</span> = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">AutoMidHandle</span><span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">True</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Global</span> iSpark:TImage = <span style="color: #ffff00; font-weight: bold;">LoadImage</span> <span style=" ">&#40;</span><span style="color: #00FF66;">&quot;Sparkle.png&quot;</span>,MIPMAPPEDIMAGE|FILTEREDIMAGE<span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">SetBlend</span> LIGHTBLEND<br />
<br />
<span style="color: #ffff00; font-weight: bold;">Type</span> TSpark<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> x#,y#,r,g,b,xv#,yv#,scale#,life<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span>x,y,xv#,yv#,scale#,life<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Spark:TSpark &nbsp;= <span style="color: #ffff00; font-weight: bold;">New</span> TSpark<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spark.<span style="">x</span> = x<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spark.<span style="">y</span> = y<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spark.<span style="">xv</span># = xv#<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spark.<span style="">yv</span># = yv#<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.<span style="">r</span> = <span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.<span style="">g</span> = <span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.<span style="">b</span> = <span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.<span style="">scale</span># = scale#<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.<span style="">life</span> = life<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SparkList.<span style="">AddLast</span><span style=" ">&#40;</span>Spark<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Destroy<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SparkList.<span style="">remove</span><span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">Self</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> UpdateAll<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> Spark:TSpark = <span style="color: #ffff00; font-weight: bold;">EachIn</span> SparkList<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.<span style="">yv</span>#:+<span style="color: #ffff00; font-weight: bold;">RndFloat</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spark.<span style="">x</span>#:+Spark.<span style="">xv</span>#<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spark.<span style="">y</span>#:+Spark.<span style="">yv</span>#<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.<span style="">r</span>:<span style="color: #FFFFFF;">-1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.<span style="">b</span>:<span style="color: #FFFFFF;">-2</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.<span style="">g</span>:<span style="color: #FFFFFF;">-1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span> spark.<span style="">r</span>,spark.<span style="">g</span>,spark.<span style="">b</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetScale</span> spark.<span style="">scale</span>,spark.<span style="">scale</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawImage</span> <span style=" ">&#40;</span>iSpark,spark.<span style="">x</span>,spark.<span style="">y</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetScale</span> <span style="color: #FFFFFF;">1</span>,<span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spark.<span style="">life</span>:<span style="color: #FFFFFF;">-1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">If</span> spark.<span style="">life</span> &lt; <span style="color: #FFFFFF;">1</span> <span style="color: #ffff00; font-weight: bold;">Then</span> spark.<span style="">Destroy</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span><br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Function Create(x,y,xv,yv,scale,life)</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Cls</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Kогда вы будете удерживать левую кнопку мыши, появится источник частиц</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Kоторый будет создавать частицы в месте, где находиться курсор</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">1</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'yv - это скорость по оси &nbsp;OY,равная единице</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'так что y будет меняться &nbsp;на единицу каждый раз</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> yv# = <span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'lx - локальная переменная, являющаяся </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'вектором скорости по оси OX для частиц</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Благодаря ей, вы сможете увидеть движение частиц</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> lx# = <span style="color: #FFFFFF;">0.1</span> <span style="color: #ffff00; font-weight: bold;">To</span> <span style="color: #FFFFFF;">1</span> <span style="color: #ffff00; font-weight: bold;">Step</span> .<span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Для опрятности, сделаем скорость по оси OY - случайной.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; yv#:-<span style="color: #ffff00; font-weight: bold;">RndFloat</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Итак, lx# лежит в диапазоне от 0.1 до 1.Далее создаем две частицы.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">' -lx# в последнем случае для того, что бы вторая частица была</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">'зеркальным отражением первой</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TSpark.<span style="">Create</span> <span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #FFFFFF;">-5</span>,lx#,yv#,.<span style="color: #FFFFFF;">2</span>,<span style="color: #FFFFFF;">660</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TSpark.<span style="">Create</span> <span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #FFFFFF;">-5</span>,-lx#,yv#,.<span style="color: #FFFFFF;">2</span>,<span style="color: #FFFFFF;">660</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; TSpark.<span style="">UpdateAll</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Flip</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">Until</span> <span style="color: #ffff00; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span>KEY_ESCAPE<span style=" ">&#41;</span></div>
<p>Всё! 
</p>
<div align="right"><a href="http://blitzetcetera.org/images/0/0f/Sparkle.zip" class="internal" title="Sparkle.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: Matt McFarland<br />
Перевод: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:JohnK" title="Участник:JohnK">JohnK</a> (e-mail: JohnK_08@mail.ru, ICQ: 438-180-831)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Создание меню в BlitzPlus"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Создание меню в BlitzPlus&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Создание меню в BlitzPlus&amp;action=edit">править</a>]</span><span class="mw-headline">Создание меню в BlitzPlus</span></h1>
<p>Те, кто только начинает программировать графический интерфейс в BlitzPlus, обычно делают меню так:
</p>
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">mw=WindowMenu<span style=" ">&#40;</span>win<span style=" ">&#41;</span><br />
<p>m=CreateMenu<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;File&quot;</span>,<span style="color: #33ffdd;">0</span>,mw<span style=" ">&#41;</span><br />
CreateMenu<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;New&quot;</span>,<span style="color: #33ffdd;">1</span>,m<span style=" ">&#41;</span><br />
CreateMenu<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Open&quot;</span>,<span style="color: #33ffdd;">2</span>,m<span style=" ">&#41;</span><br />
...<br />
m=CreateMenu<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Help&quot;</span>,<span style="color: #33ffdd;">0</span>,mw<span style=" ">&#41;</span><br />
CreateMenu<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Index&quot;</span>,<span style="color: #33ffdd;">11</span>,m<span style=" ">&#41;</span><br />
CreateMenu<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;About&quot;</span>,<span style="color: #33ffdd;">12</span>,m<span style=" ">&#41;</span><br />
...<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> WaitEvent<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> $<span style="color: #33ffdd;">1001</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> EventData<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">case</span> <span style="color: #33ffdd;">1</span><span style="color: #ffee00">;New</span><br />
&nbsp; &nbsp; &nbsp;...<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">case</span> <span style="color: #33ffdd;">2</span><span style="color: #ffee00">;Open</span><br />
&nbsp; &nbsp; &nbsp;...<br />
&nbsp; &nbsp; &nbsp;...<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> $<span style="color: #33ffdd;">803</span>:<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Forever</span></div>
<p>Неудобства этого метода очевидны: раздражающая глаза масса "CreateMenu" и необходимость запоминать под каким номером какой элемент. Впрочем, последний недочет можно исправить:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> MenuNew=<span style="color: #33ffdd;">1</span>,MenuOpen=<span style="color: #33ffdd;">2</span>,...<br />
<p><span style="color: #aaffff; font-weight: bold;">Const</span> MenuIndex=<span style="color: #33ffdd;">11</span>,MenuAbout=<span style="color: #33ffdd;">12</span><br />
<br />
mw=WindowMenu<span style=" ">&#40;</span>win<span style=" ">&#41;</span><br />
m=CreateMenu<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;File&quot;</span>,<span style="color: #33ffdd;">0</span>,mw<span style=" ">&#41;</span><br />
CreateMenu<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;New&quot;</span>,MenuNew,m<span style=" ">&#41;</span><br />
CreateMenu<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Open&quot;</span>,MenuOpen,m<span style=" ">&#41;</span><br />
...<br />
m=CreateMenu<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Help&quot;</span>,<span style="color: #33ffdd;">0</span>,mw<span style=" ">&#41;</span><br />
CreateMenu<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Index&quot;</span>,MenuIndex,m<span style=" ">&#41;</span><br />
CreateMenu<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;About&quot;</span>,MenuAbout,m<span style=" ">&#41;</span><br />
...<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> WaitEvent<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> $<span style="color: #33ffdd;">1001</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> EventData<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">case</span> MenuNew<br />
&nbsp; &nbsp; &nbsp;...<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">case</span> MenuOpen<br />
&nbsp; &nbsp; &nbsp;...<br />
&nbsp; &nbsp; &nbsp;...<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> $<span style="color: #33ffdd;">803</span>:<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Forever</span></div>
<p>Но все еще остаются "CreateMenu" плюс добавляются константы. Я предлагаю третий вариант - хранить названия элементов меню в типах, автоматически сопоставляя им индексы, а затем по выданному WaitEvent+EventData индексу искать название и выбирать соответствующее действие в структуре Select-End Select по названию. То есть, вообще не трогать индексы в главной программе. Вот модуль для работы с меню:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> menuitem<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> name$<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> Menu_Create<span style=" ">&#40;</span>w<span style=" ">&#41;</span><br />
wmenu=WindowMenu<span style=" ">&#40;</span>w<span style=" ">&#41;</span><br />
parent=wmenu<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Read</span> m$<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> m$<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;{&quot;</span>: parent=old<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;}&quot;</span>: parent=wmenu<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;===Конец===&quot;</span>: <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Default</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> parent&lt;&gt;wmenu <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; i=i<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; mi.menuitem=<span style="color: #aaffff; font-weight: bold;">New</span> menuitem<br />
&nbsp; &nbsp; mi\name$=m$<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;old=CreateMenu<span style=" ">&#40;</span>m$,i,parent<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
UpdateWindowMenu<span style=" ">&#40;</span>w<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> menuitem_name$<span style=" ">&#40;</span>n<span style=" ">&#41;</span><br />
mi.menuitem=<span style="color: #aaffff; font-weight: bold;">First</span> menuitem<br />
<span style="color: #aaffff; font-weight: bold;">For</span> nn=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">To</span> n<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> mi=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> Notify <span style="color: #00ff66;">&quot;Menuitem N&quot;</span>+n+<span style="color: #00ff66;">&quot; doesn't exist&quot;</span>:<span style="color: #aaffff; font-weight: bold;">Return</span><br />
&nbsp;mi=<span style="color: #aaffff; font-weight: bold;">After</span> mi<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> mi\name$<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Сначала в строках Data пишется название подменю, затем открывающая фигурная скобка ("{"), затем пункты этого подменю, затем закрывающая фигурная скобка ("}"), следующее подменю, ... , маркер конца меню("===Конец==="). Тестовая программа:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Include</span> <span style="color: #00ff66;">&quot;Menu.bb&quot;</span><br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> ent$=<span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">13</span><span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Chr</span>$<span style=" ">&#40;</span><span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,filename$<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> win=CreateWindow<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;&quot;</span>,ClientWidth<span style=" ">&#40;</span>Desktop<span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span><span style="color: #33ffdd;">-300</span>,ClientHeight<span style=" ">&#40;</span>Desktop<span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span><span style="color: #33ffdd;">-200</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">7</span><span style=" ">&#41;</span><br />
filename_change <span style="color: #00ff66;">&quot;untitled.txt&quot;</span><br />
Menu_Create win<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> ta=CreateTextArea<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span>,win<span style=" ">&#41;</span><br />
ta_resize<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> WaitEvent<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> $<span style="color: #33ffdd;">1001</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> menuitem_name<span style=" ">&#40;</span>EventData<span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;Новый&quot;</span><br />
&nbsp; &nbsp; &nbsp;filename_change <span style="color: #00ff66;">&quot;untitled.txt&quot;</span><br />
&nbsp; &nbsp; &nbsp;SetTextAreaText ta,<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;Открыть...&quot;</span><br />
&nbsp; &nbsp; &nbsp;file$=RequestFile<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Открыть файл...&quot;</span>,<span style="color: #00ff66;">&quot;txt,*&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> file$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> doc_load file$<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;Сохранить...&quot;</span><br />
&nbsp; &nbsp; &nbsp;doc_save<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;Сохранить как...&quot;</span><br />
&nbsp; &nbsp; &nbsp;file$=RequestFile<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Сохранить файл как...&quot;</span>,<span style="color: #00ff66;">&quot;txt,*&quot;</span>,<span style="color: #aaffff; font-weight: bold;">True</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> file$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; filename_change file$<br />
&nbsp; &nbsp; &nbsp; doc_save<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;Выход&quot;</span>:<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;Помощь&quot;</span>:Notify <span style="color: #00ff66;">&quot;звони в 03 ((C) В.Н.Машков)&quot;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;О программе...&quot;</span>:Notify <span style="color: #00ff66;">&quot;Простой текстовый редактор&quot;</span>+ent$+<span style="color: #00ff66;">&quot;Автор: Матвей Меркулов&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> $<span style="color: #33ffdd;">802</span>:ta_resize<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> $<span style="color: #33ffdd;">803</span>:<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;Файл&quot;</span>,<span style="color: #00ff66;">&quot;{&quot;</span>,<span style="color: #00ff66;">&quot;Новый&quot;</span>,<span style="color: #00ff66;">&quot;Открыть...&quot;</span>,<span style="color: #00ff66;">&quot;Сохранить...&quot;</span>,<span style="color: #00ff66;">&quot;Сохранить как...&quot;</span>,<span style="color: #00ff66;">&quot;&quot;</span>,<span style="color: #00ff66;">&quot;Выход&quot;</span>,<span style="color: #00ff66;">&quot;}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;Справка&quot;</span>,<span style="color: #00ff66;">&quot;{&quot;</span>,<span style="color: #00ff66;">&quot;Помощь&quot;</span>,<span style="color: #00ff66;">&quot;О программе...&quot;</span>,<span style="color: #00ff66;">&quot;}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;===Конец===&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> ta_resize<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
SetGadgetShape ta,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,ClientWidth<span style=" ">&#40;</span>win<span style=" ">&#41;</span>,ClientHeight<span style=" ">&#40;</span>win<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> filename_change<span style=" ">&#40;</span>file$<span style=" ">&#41;</span><br />
filename$=file$<br />
SetGadgetText win,<span style="color: #00ff66;">&quot;Простой текстовый редактор - &quot;</span>+filename$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> doc_load<span style=" ">&#40;</span>file$<span style=" ">&#41;</span><br />
filename_change file$<br />
f=<span style="color: #aaffff; font-weight: bold;">ReadFile</span><span style=" ">&#40;</span>file$<span style=" ">&#41;</span><br />
LockTextArea ta<br />
SetTextAreaText ta,<span style="color: #00ff66;">&quot;&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">Eof</span><span style=" ">&#40;</span>f<span style=" ">&#41;</span><br />
&nbsp;AddTextAreaText ta,<span style="color: #aaffff; font-weight: bold;">ReadLine</span>$<span style=" ">&#40;</span>f<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">Eof</span><span style=" ">&#40;</span>f<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> AddTextAreaText ta,ent$<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">CloseFile</span> f<br />
UnlockTextArea ta<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> doc_save<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
f=<span style="color: #aaffff; font-weight: bold;">WriteFile</span><span style=" ">&#40;</span>filename$<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">WriteLine</span> f,TextAreaText$<span style=" ">&#40;</span>ta<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">CloseFile</span> f<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/5/57/Menu.zip" class="internal" title="Menu.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Отладка программы"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Отладка программы&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Отладка программы&amp;action=edit">править</a>]</span><span class="mw-headline">Отладка программы</span></h1>
<p>Те, кто создавали (или просто набирал по бумажке) программы размером больше экранной страницы, наверняка после набора программы (или ее автономной работоспособной части) сталкивались с необходимостью устранения ошибок в программе. Этот процесс называется отладкой. Условно можно разделить сей этап на три части (номера указывают как порядок, так и степень сложности):
</p>
</p>
<ul><li>Исправление синтаксических ошибок (без этого программа вообще не запускается)
</li><li>Устранение сбоев, приводящих к завершению программы.
</li><li>Коррекция неправильной работы программы
</li></ul>
<a name="C.D0.B8.D0.BD.D1.82.D0.B0.D0.BA.D1.81.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B5_.D0.BE.D1.88.D0.B8.D0.B1.D0.BA.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9E%D1%82%D0%BB%D0%B0%D0%B4%D0%BA%D0%B0_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D1%8B&amp;action=edit&amp;section=1" title="Отладка программы">править</a>]</span> <span class="mw-headline">Cинтаксические ошибки</span></h2>
<p>Они возникают в основном из-за опечаток или незнания синтаксиса команды и довольно легко устраняются.
</p>
<ul><li>Неправильное имя команды
</li><li>Ошибка в имени переменной
</li><li>Указание неверного типа переменной
</li><li>Неверный тип данных в строке вызова процедуры
</li><li>Нехватка данных в строке вызова Function
</li><li>Пропущенные скобки (обычно, закрывающая)
</li><li>Не та косая черта ("/" вместо "\" в ссылке на элемент типа)
</li><li>Незавершенная структура (If Then без End If, Repeat без Forever, For без Next и т. д.)
</li><li>Exit вместо Return в Function
</li></ul>
<a name=".D0.A1.D0.B1.D0.BE.D0.B8_.D0.B8_.D0.BA.D0.BE.D1.80.D1.80.D0.B5.D0.BA.D1.86.D0.B8.D1.8F_.D0.BD.D0.B5.D0.BF.D1.80.D0.B0.D0.B2.D0.B8.D0.BB.D1.8C.D0.BD.D0.BE.D0.B9_.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D1.8B_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D0.BC.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9E%D1%82%D0%BB%D0%B0%D0%B4%D0%BA%D0%B0_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D1%8B&amp;action=edit&amp;section=2" title="Отладка программы">править</a>]</span> <span class="mw-headline">Сбои и коррекция неправильной работы программы</span></h2>
<p>Для поиска таких ошибок обычно используется отладчик. Причины могут быть самые разные:
</p>
<ul><li>Неправильный путь к файлу (или имя файла), отсутствие файла
</li><li>Попытка доступа к несуществующему объекту (например, CreateEntity вернул 0)
</li><li>Неверная инициализация (или ее отсутствие), неправильное изменение значения переменной
</li><li>Упущенный из виду вариант, подлежащий обработке (а это значит нужно писать новую функцию / кусок кода)
</li><li>Использование в Write\ReadPixelFast координат, выходящих за пределы изображения
</li><li>Использование команд Write\ReadPixelFast без команды LockBuffer
</li><li>Попытка доступа к элементу переменной со значением Null пользовательского типа
</li><li>Ошибка в загружаемом файле (неверный синтаксис или порядок следования данных)
</li></ul>
<a name=".D0.97.D0.BD.D0.B0.D0.BA.D0.BE.D0.BC.D1.81.D1.82.D0.B2.D0.BE_.D1.81_.D0.BE.D1.82.D0.BB.D0.B0.D0.B4.D1.87.D0.B8.D0.BA.D0.BE.D0.BC"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9E%D1%82%D0%BB%D0%B0%D0%B4%D0%BA%D0%B0_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D1%8B&amp;action=edit&amp;section=3" title="Отладка программы">править</a>]</span> <span class="mw-headline">Знакомство с отладчиком</span></h2>
<p>Когда вы запустите программу, включив Debug Mode, появится окно отладчика. Оно состоит из:
</p>
<ul><li>Панели с кнопками
</li><li>Широкого окна с вкладкой Debug Log
</li><li>Узкого окошка со вкладками Local, Global, Consts
</li></ul>
<p>Кнопки выполняют следующие функции (во время работы программы доступны 1-я и 6-я, во время отладки со 2-й по 6-ю):
</p>
<ul><li>Светофор с красным сигналом - остановка программы
</li><li>Светофор с зеленым сигналом - продолжение работы программы
</li><li>Стрелка вправо - выполнение текущей строки и переход на следующую без входа в Function
</li><li>Стрелка вправо-вниз - выполнение текущей строки и переход на следующую, при вызове Function - вход
</li><li>Стрелка вправо-вверх - выполнение программы до выхода из Function (если находимся в главной программе, тогда просто пуск)
</li><li>Ядерный взрыв - прекращение работы программы и выход в редактор
</li></ul>
<p>В большом окне появляется текст программы (на вкладке с именем файла) с выделенной строкой - текущей, Debug Log - это журнал отладки, вы можете писать в него строки во время выполнения программы с помощью команды DebugLog message$.
</p><p>Вкладки маленького окошка (обновляются при остановке программы):
</p>
<ul><li>Local - дерево функций, в которые выполнен вход (включая главную программу на первой строке) с используемыми переменными
</li><li>Global - список глобальных переменных со значениями
</li><li>Consts - список констант со значениями
</li></ul>
<p>Во вкладке Local вы можете раскрывать дерево функции, содержащее переменные с их значениями. Раскрыв переменную пользовательского типа, вы можете просмотреть ее элементы и их значения (а если они, в свою очередь являются типами - то раскрыть их).
</p>
<a name=".D0.A2.D0.BE.D1.87.D0.BA.D0.B8_.D0.BE.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9E%D1%82%D0%BB%D0%B0%D0%B4%D0%BA%D0%B0_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D1%8B&amp;action=edit&amp;section=4" title="Отладка программы">править</a>]</span> <span class="mw-headline">Точки останова</span></h2>
<p>В редакторе их установка не предусмотрена, поэтому, если вы хотите, чтобы в каком либо месте программа прервалась и вышла в отладчик, поставьте команду "Stop".
</p>
<a name=".D0.A0.D0.B0.D0.B1.D0.BE.D1.82.D0.B0_.D1.81_.D0.BE.D1.82.D0.BB.D0.B0.D0.B4.D1.87.D0.B8.D0.BA.D0.BE.D0.BC_-_.D1.81.D0.BE.D0.B2.D0.B5.D1.82.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9E%D1%82%D0%BB%D0%B0%D0%B4%D0%BA%D0%B0_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D1%8B&amp;action=edit&amp;section=5" title="Отладка программы">править</a>]</span> <span class="mw-headline">Работа с отладчиком - советы</span></h2>
<p>Для начала, нужно определить точку сбоя. Обычно, это несложно - программа выдает сообщение типа "Memory Access Violation" или "Object does not exist" и вылетает в отладчик. Теперь вы можете посмотреть, в какой строке произошел сбой и определить переменную с неправильным значением. Если в строке используются вычисляемые выражения или элементы массива, то чтобы просмотреть их значения, нужно создать переменную, присвоив ей значение этого выражения (или элемента массива):
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;Пример кода</span><br />
<p><span style="color: #aaffff; font-weight: bold;">WritePixel</span> x+dx<span style=" ">&#40;</span><span style="color: #33ffdd;">5</span><span style=" ">&#41;</span>,y+<span style="color: #aaffff; font-weight: bold;">sqr</span><span style=" ">&#40;</span>xx*xx+yy*yy<span style=" ">&#41;</span>,<span style="color: #33ffdd;">-1</span><br />
<span style="color: #ffee00">;Код, подходящий для отладки</span><br />
x0=x+dx<span style=" ">&#40;</span><span style="color: #33ffdd;">5</span><span style=" ">&#41;</span><br />
y0=y+<span style="color: #aaffff; font-weight: bold;">sqr</span><span style=" ">&#40;</span>xx*xx+yy*yy<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">WritePixel</span> x0,y0,<span style="color: #33ffdd;">-1</span><br />
</p>
<span style="color: #ffee00">;Теперь можно точно узнать координаты записываемого пиксела</span></div>
<p>После выяснения имени переменной с неверным значением, постепенно распутываем загадку, прослеживая процесс работы программы в обратном направлении: устанавливаем точки останова выше, смотрим значение этой переменной на ранних этапах работы программы. Если выясняется, что переменная функционирует правильно, а ошибка происходит из-за другой переменной связанной с текущей, то переключаемся на нее, et cetera... 
</p><p>Если сбой произошел в цикле, полезным будет выяснить, почему предыдущие этапы прошли без сбоев, а текущий вызвал сбой.
</p><p>Не забывайте о возможности записи значений переменных, а также информации о прохождении какого-л этапа программы в журнал отладки (Debug Log). Это позволит быстро выяснить, где и почему произошел сбой. Можно также выводить отладочную информацию в файл или на экран.
</p><p>Иногда бывает полезно написать отладочную утилиту (например, отображающую связи между переменными пользовательского типа или выводящую таблицу значений массива). В приложениях, использующих трехмерную графику, можно создавать сферы и помещать их на место виртуальных точек (скажем, вершин многогранника, если треугольники заданы неправильно или еще не заданы), включая pivots.
</p>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Создаем GUI «руками»"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Создаем GUI «руками»&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Создаем GUI «руками»&amp;action=edit">править</a>]</span><span class="mw-headline">Создаем GUI «руками»</span></h1>
</p>
<div align="right">- Чем отличается начинающий программист от законченного?<br />
<p>- Начинающий считает, что в килобайте 1000 байт,<br />
</p>
а законченный - что в килограмме 1024 грамма.&nbsp;:)</div>
<p><br />
</p>
<div align="right">Человек даже сам себя не всегда понимает, чего уж говорить о других. (Липкан А. В.)</div>
<p><br />
Lectori benevolo salutem. (лат. Привет благосклонному читателю.) Вообще для создания GUI (graphics user interface, если кто не знает.) обычно используют всякие программы, flash анимацию, HTML и др. Но мы не ищем легких путей! Мы с вами создадим все сами, программно. Я на простых примерах покажу, как можно создать привлекательную картинку с разными эффектами. В работе мы будем использовать разные программы для разных целей. Наличие всех из них не обязательно, но желательно. Конечно, я не буду детально описывать работу этих программ (если есть проблемы goto основы), но на необходимых основных моментах я остановлюсь. Если будет время, то я расскажу, как можно сделать простую программу «с кнопочками» в Delphi – там это удобно очень и просто! Итак, приступим.
</p>
<a name=".D0.93.D0.BB.D0.B0.D0.B2.D0.B0_.D0.BF.D0.B5.D1.80.D0.B2.D0.B0.D1.8F._.D0.A2.D0.B8.D0.BF.D0.B0_.D0.BE.D1.81.D0.BD.D0.BE.D0.B2.D0.BD.D1.8B.D0.B5_.D0.BC.D0.BE.D0.BC.D0.B5.D0.BD.D1.82.D1.8B."></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%B5%D0%BC_GUI_%C2%AB%D1%80%D1%83%D0%BA%D0%B0%D0%BC%D0%B8%C2%BB&amp;action=edit&amp;section=1" title="Создаем GUI «руками»">править</a>]</span> <span class="mw-headline">Глава первая. Типа основные моменты.</span></h2>
<p>Все должно быть логично и понятно, т. е. не так: Keyboard not found. Press F1 to continue... Представьте, что пользователь полный идиот, когда будете разрабатывать логику интерфейса. И только после этого начинайте набрасывать примерную схему на бумаге. Да, да именно на бумаге, ну, в крайнем случае, в paint’e или в блокноте. И лишь когда будете полностью представлять, как и что у вас будет, начинайте программировать рисовать и т. д. Для отделения разных частей программы обычно используют оператор
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Select</span> <br />
<p>&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span><br />
&nbsp; …<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> n<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End select</span></div>
<p>Программа будет состоять из 2 частей как минимум: сама прога и меню. Введем переменную game:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;изначально = 1</span><br />
<p>game=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #ffee00">; основа</span><br />
<span style="color: #aaffff; font-weight: bold;">Select</span> game<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span><br />
<span style="color: #ffee00">; здесь будет игра</span><br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span><br />
<span style="color: #ffee00">; здесь меню</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Select</span></div>
<p>Основа готова можно заполнять! Меню будем создавать потом. Сначала что-нибудь попроще. Скажем, создадим экранную рамку в фотошопе.
</p>
<ul><li>Шаг первый: создаем новый файл с размерами будущего разрешения экрана нашей игры. Это в меню «файл».
</li></ul>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI1-01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI1-01.gif" src="d0dt912o.gif" width="400" height="300" /></a></span></div></div>
<ul><li>Шаг второй: окрашиваем фон в черный цвет с помощью заливки.
</li></ul>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI1-02.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI1-02.gif" src="370wsdzq.gif" width="400" height="475" /></a></span></div></div>
<ul><li>Шаг третий: создаем новый слой. Меню: Слой -&gt; новый слой.
</li><li>Шаг четвертый: рисуем чего-нибудь на этом слое, например рамку.
</li></ul>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI1-03.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI1-03.gif" src="5_6avy-g.gif" width="500" height="375" /></a></span></div></div>
<ul><li>Шаг пятый: сохраняем картинку в формате png (<a href="dojwi5hi.png" class="internal" title="GUI-Screen.png">Медиа:GUI-Screen.png</a>) через меню файл.
</li></ul>
<p>Все, готово! Можно вставить команду DrawImage картинка, x, y перед flip. Черный фон будет не видно.Вот код проги с рамкой:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;(c) Agnislav Lipcan</span><br />
<p><span style="color: #ffee00">;e-mail: avelnet[@]yandex.ru</span><br />
<br />
<span style="color: #ffee00">;изначально = 1</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> game=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #ffee00">; основа</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span> <br />
<span style="color: #aaffff; font-weight: bold;">Select</span> game<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span><br />
<span style="color: #ffee00">; начало тела игры</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Cls</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #ffee00">;&lt;-очищаем экран</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">1024</span>,<span style="color: #33ffdd;">768</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;&lt;-инициализируем графику</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; ekran=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;GUI-Screen.png&quot;</span><span style=" ">&#41;</span><span style="color: #ffee00">;&lt;-загружаем картинку</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span><span style="color: #ffee00">;&lt;-начало главного цикла</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> game=<span style="color: #33ffdd;">2</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DrawImage</span> ekran,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> game=<span style="color: #33ffdd;">2</span><span style="color: #ffee00">;&lt;-конец главного цикла</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span><br />
<span style="color: #ffee00">; здесь меню</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Cls</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #ffee00">;&lt;-очищаем экран</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">1024</span>,<span style="color: #33ffdd;">768</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;&lt;-инициализируем графику</span><br />
&nbsp; &nbsp;font=<span style="color: #aaffff; font-weight: bold;">LoadFont</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Arial Cyr&quot;</span>,<span style="color: #33ffdd;">24</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">SetFont</span> font<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">FlushKeys</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #ffee00">;&lt;-очищаем клавиатуру (всмысле нажатые клавиши)</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">430</span>,<span style="color: #33ffdd;">300</span>,<span style="color: #00ff66;">&quot;здесь будет меню&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #ffee00">;&lt;-конец, выходим</span><br />
<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Forever</span></div>
<p>Приступим. Из чего же, из чего же, из чего же  сделан наш интерфейс, как поется в песни (хотя, нет, там не так поется, ну ладно.&nbsp;:) ), а он сделан из менюшек, кнопок, курсоров, лист боксов, выпадающих меню, окон, дверей&nbsp;: ) и много чего еще. Допустим, что у нас есть программа, для которой нужно разработать интерфейс, например та, которую мы сделали в прошлый раз. Что обычно происходит на экране? Вначале главное меню, из него вы попадаете в игру (или другую программу, чего там у вас есть), там есть много всяких способов управления прогой вообще и тем, что твориться на экране конкретно, помимо всего прочего, там есть кнопка вызова контекстного меню, из которого можно опять попасть в главное. Из вышесказанного следует, что наш интерфейс делится на три части как минимум: главное меню, контекстное меню и экран рабочего поля со всем, что к нему прилагается. Контекстное меню можно реализовать по-разному. Это может быть отдельная часть программы или часть той части программы, где реализуется рабочий экран. При вызове контекстного меню основная программа останавливается. В первом варианте это реализуется автоматически, но необходимо сохранять текущий результат, а во втором случае сохранять ничего не требуется, но необходимо останавливать работу основной программы. Кроме того, важен внешний вид этого меню. Оно может быть выведено поверх рабочего экрана (например, как полупрозрачное меню в Quake 3 arena) или же занимать весь экран полностью. Если оно является частью экрана, то в случае, когда меню – отдельная часть программы придется реализовывать сохранение вида экрана. Обо всем этом следует подумать заранее. Вы можете спросить, зачем вообще нужно контекстное меню. Тут есть несколько причин: оно дает возможность быстро сделать, что-либо, например, сохраниться, не выходя из основной программы, оно может использоваться, чтобы временно остановить программу, сделать паузу, оно косвенным образом заставляет пользователя подольше оставаться в вашей программе (не в том смысле, что он будет тратить лишнее время на загрузку этого меню, оно, конечно, должно грузиться быстро, а в смысле пользователь не будет иметь предлога выйти из программы, до того, как она ему действительно надоест, чтобы выйти в главное меню и оттуда уже выгрузиться окончательно), оно улучшает внешний вид, дружелюбие и структурность программы. При разработке интерфейса подумайте, каким бы вы сами хотели его видеть, будь вы пользователем этой программы. Главным фактором тут, пожалуй, является удобство пользования.
</p><p>Теперь займемся практической составляющей. Я расскажу вам, как сделать из той нелепости, что получилась у нас в прошлый раз (по крайней мере, у меня), что-то стоящее.
<p>Но для начала добавим в нашу программу немного действия, чтобы это был не просто черный фон. Вставьте вот этот код в тело оператора "Case 1" после строки загрузки картинки экрана "ekran=LoadImage("GUI-Screen.png")":
</p>
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #ffee00">; создаем камеру</span><br />
<p>&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span><span style="color: #ffee00">; размещаем камеру</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> camera,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">180</span><span style="color: #ffee00">; цвет фона</span><br />
<br />
&nbsp; &nbsp; plane= <span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; pltex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;trava.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> pltex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EntityTexture</span> plane,pltex<br />
</p>
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeTexture</span> pltex</div>
<p>А в главный цикл добавьте строку поворота камеры: 
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span></div>
<p>Тут вроде все ясно, поэтому особо останавливаться на этом не буду. В папку с программой добавьте вот эту или другую текстуру:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI-Grass.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI-Grass.png" src="_mkhda1-.png" width="256" height="256" /></a></span></div></div>
<p>Теперь открываем фотошоп и делаем следующее:
</p>
<ul><li>Повторяем шаги 1-3 с прошлого раза.
</li><li>Выбираем подходящий цвет и заливаем им новый слой.
</li></ul>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI2-04.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI2-04.jpg" src="a3r809by.jpg" width="512" height="384" /></a></span></div></div>
<p>С помощью инструмента «выделение» выделяем лишние области и удаляем их. Чтобы выделить несколько областей одновременно используйте клавиши Shift и Alt. Должно получиться что-то вроде этого:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI2-05.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI2-05.jpg" src="izhi92p6.jpg" width="512" height="384" /></a></span></div></div>
<p>Воспользуйтесь каким-нибудь фильтром из меню фильтр, а также инструментами «затемнение» и «осветление» для придания рамке неоднородности. После чего, воспользуемся фильтром «рассеивание» из вкладки «стилизация» в меню «фильтр» для того, чтобы наша рамка не была такой ровной. Потом выделим внутренние границы рамки и в меню (изображение -&gt; регулировки -&gt; яркость / контраст) настроим их чуть темнее, чем основная рамка. Это придаст объемность.  Добавляем драгоценные камни или другие спецэффекты, вырезанные из других картинок, и получается что-то вроде этого:
</p>
<center><table class="gallery" cellspacing="0" cellpadding="0">
	<tr>
		<td><div class="gallerybox" style="width: 150px;">
			<div class="thumb" style="padding: 28px 0; width: 150px;"><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI-Screen2.png" title="Изображение:GUI-Screen2.png"><img src="1yvuzxio.png" width="120" height="90" alt="" /></a></div>
			<div class="gallerytext">
<p><!-- 
Pre-expand include size: 100655 bytes
Post-expand include size: 59874 bytes
Template argument size: 116 bytes
Maximum: 2097152 bytes
-->
</p>
			</div>
		</div></td>
	</tr>
</table></center>
<p>Экранная рамка готова. Теперь сделаем кнопку вызова контекстного меню, в качестве которого у нас пока будет главное меню. Вначале программно:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> RefreshButton<span style=" ">&#40;</span>ImBtn,x,y,txt$,n<span style=" ">&#41;</span><br />
<p>mx=<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>&nbsp;: my=<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #ffee00">;координаты мыши </span><br />
MHit=<span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style="color: #ffee00">;проверяем нажатие левой мыши </span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">RectsOverlap</span><span style=" ">&#40;</span>x<span style="color: #33ffdd;">+2</span>,y<span style="color: #33ffdd;">+2</span>,<span style="color: #aaffff; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>ImBtn<span style=" ">&#41;</span><span style="color: #33ffdd;">-4</span>,<span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>ImBtn<span style=" ">&#41;</span><span style="color: #33ffdd;">-4</span>,mx,my,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><span style="color: #ffee00">; наведение</span><br />
&nbsp; &nbsp; &nbsp;f=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp;y2=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> MHit=<span style="color: #aaffff; font-weight: bold;">True</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #ffee00">; нажатие мыши</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;f=<span style="color: #33ffdd;">2</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;y2=<span style="color: #33ffdd;">2</span> <span style="color: #ffee00">; сдвигаем текст кнопки ниже на 2 пикселя</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Buttons<span style=" ">&#40;</span>n<span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #ffee00">; записываем в массив, что кнопка нажата</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
<span style="color: #aaffff; font-weight: bold;">Else</span> <span style="color: #ffee00">; иначе кнопка неактивна</span><br />
&nbsp; &nbsp; &nbsp;f=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp;y2=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
<span style="color: #aaffff; font-weight: bold;">DrawImage</span> ImBtn,x,y,f <span style="color: #ffee00">; рисуем кнопку в нужном положении</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">; цвет текста</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> x<span style="color: #33ffdd;">+0.5</span>*<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>ImBtn<span style=" ">&#41;</span><span style="color: #33ffdd;">+4</span>-<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>txt$<span style=" ">&#41;</span>*<span style="color: #aaffff; font-weight: bold;">FontHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><span style=" ">&#41;</span>, y<span style="color: #33ffdd;">+0.5</span>*<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>ImBtn<span style=" ">&#41;</span><span style="color: #33ffdd;">-4</span>-<span style="color: #aaffff; font-weight: bold;">FontHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span>+y2, txt$<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Эта функция, которую я разработал для удобства, рисует в определенном месте экрана кнопку и проверяет два условия: наведения и нажатия при наведении левой кнопки мыши. Она достаточно универсальна и может использоваться несколько раз. Для нее также необходим массив buttons()  число элементов, которого, равно количеству кнопок. Есть возможность того, чтобы несколько кнопок ссылались на один элемент массива, это бывает полезно. Текст на кнопке центрируется. Входные параметры следующие:
</p><p>ImBtn – картинка кнопки (загружается через LoadAnimImage, состоит из 3 фреймов, размер любой)
</p>
<ul><li>x, y – координаты верхнего угла кнопки.
</li><li>txt$ - текст на кнопке.
</li><li>n – номер элемента массива на который ссылается кнопка.
</li></ul>
<p>Описывать саму функцию я не буду, потому, что там есть комментарии и все достаточно просто и понятно.
</p><p>Теперь о том, как нарисовать кнопку. Можно воспользоваться одной из специальных программ, которых достаточно много, например, программой ImageReady CS, которая поставляется вместе с фотошопом, или другой. Но мы сделаем все сами в фотошопе.
</p><p>Откроем файл с экранной рамкой, возьмем инструмент «волшебная палочка» и выделим область внутри круглой фигни в правом верхнем углу. Скопируем эту область и вставим в новый файл, размеры которого автоматически подгоняться под нашу область. Если они (размеры) по каким-то причинам иные, то измените их в меню (изображение -&gt; размер холста) так, чтобы края области точно совпадали с краями холста. Теперь рисуем кнопку, например, так:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI2-06.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI2-06.gif" src="eztx8ell.gif" width="64" height="70" /></a></span></div></div>
<p>Далее делаем копию изображения и пока сворачиваем. Это будет нажатая кнопка. А в исходной кнопке затемняем нижнюю часть и помещаем блик, инструментами «затемнение» и «осветление».
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI2-07.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI2-07.gif" src="_qhq9ca_.gif" width="64" height="70" /></a></span></div></div>
<p>Делаем копию и настраиваем яркость выше, чем у исходной, через меню. Это будет кнопка во время наведения.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI2-08.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI2-08.gif" src="_kxrbqsn.gif" width="64" height="70" /></a></span></div></div>
<p>Разворачиваем первую копию и затемняем ее верхнюю часть, а также помещаем блик. Все как у исходной кнопки, но наоборот.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI2-09.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI2-09.gif" src="ffdlsqt7.gif" width="64" height="70" /></a></span></div></div>
<p>Теперь заливаем фон всех трех кнопок черным цветом. Создаем новый файл с высотой такой же, как у файла с кнопкой, а шириной в три раза больше, чем ширина файла с кнопкой. Копируем все изображения в него и располагаем по порядку.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI-Button1.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI-Button1.png" src="w3sce_mx.png" width="192" height="70" /></a></span></div></div>
<p>Все! Кнопка готова.
Сделайте еще одну кнопку для главного меню, например, такую:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI-Button2.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI-Button2.png" src="ms9wms59.png" width="300" height="40" /></a></span></div></div>
<p>Вызываем в программе функцию в нужных местах и добавляем код обработки нажатия функции. Вот весь код:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;(c) Agnislav Lipcan</span><br />
<p><span style="color: #ffee00">;e-mail: avelnet@yandex.ru</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">1024</span>,<span style="color: #33ffdd;">768</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;&lt;-инициализируем графику</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;изначально = 2</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> game=<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> font=<span style="color: #aaffff; font-weight: bold;">LoadFont</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;courier&quot;</span>,<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">SetFont</span> font<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> Buttons<span style=" ">&#40;</span><span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> kn1=<span style="color: #aaffff; font-weight: bold;">LoadAnimImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;GUI-Button1.png&quot;</span>,<span style="color: #33ffdd;">64</span>,<span style="color: #33ffdd;">70</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> kn2=<span style="color: #aaffff; font-weight: bold;">LoadAnimImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;GUI-Button2.png&quot;</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">40</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> kursor=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;GUI-Cursor.png&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">; основа</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span> <br />
<span style="color: #aaffff; font-weight: bold;">Select</span> game<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span><br />
<span style="color: #ffee00">; начало тела игры</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Cls</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #ffee00">;&lt;-очищаем экран</span><br />
<br />
&nbsp; &nbsp; &nbsp;ekran=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;GUI-Screen2.png&quot;</span><span style=" ">&#41;</span><span style="color: #ffee00">;&lt;-загружаем картинку</span><br />
<br />
&nbsp; &nbsp; camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #ffee00">; создаем камеру</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span><span style="color: #ffee00">; размещаем камеру</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> camera,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">180</span><span style="color: #ffee00">; цвет фона</span><br />
<br />
&nbsp; &nbsp; plane= <span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; pltex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;GUI-Grass.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> pltex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EntityTexture</span> plane,pltex<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeTexture</span> pltex<br />
<br />
&nbsp; &nbsp; lit=<span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span><span style="color: #ffee00">;&lt;-начало главного цикла</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> Buttons<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> game=<span style="color: #33ffdd;">2</span> Buttons<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span><span style="color: #ffee00">; поворачиваем камеру</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DrawImage</span> ekran,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; RefreshButton<span style=" ">&#40;</span>kn1,<span style="color: #33ffdd;">952</span>,<span style="color: #33ffdd;">12</span>,<span style="color: #00ff66;">&quot;&quot;</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DrawImage</span> kursor,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Flip</span><br />
&nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> game=<span style="color: #33ffdd;">2</span><span style="color: #ffee00">;&lt;-конец главного цикла</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> camera<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> plane <br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> lit <br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeImage</span> ekran<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span><br />
<span style="color: #ffee00">; здесь меню</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Cls</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #ffee00">;&lt;-очищаем экран</span><br />
<br />
&nbsp; &nbsp; camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #ffee00">; создаем камеру</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span><span style="color: #ffee00">; размещаем камеру</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CameraFogMode</span> camera,<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CameraFogRange</span> camera,.<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">50</span><br />
<br />
&nbsp; &nbsp; plane= <span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; pltex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;GUI-Grass.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> pltex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EntityTexture</span> plane,pltex<br />
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> pltex<br />
<br />
&nbsp; &nbsp; lit=<span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp;<br />
<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Repeat</span> <br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> exitprog=<span style="color: #aaffff; font-weight: bold;">True</span> <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #ffee00">;&lt;-конец, выходим</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Or</span> Buttons<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> exitprog=<span style="color: #aaffff; font-weight: bold;">True</span> Buttons<span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> &nbsp;Buttons<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> game=<span style="color: #33ffdd;">1</span> Buttons<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span><span style="color: #ffee00">; поворачиваем камеру</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RefreshButton<span style=" ">&#40;</span>kn2,<span style="color: #33ffdd;">462</span>,<span style="color: #33ffdd;">300</span>,<span style="color: #00ff66;">&quot;старт&quot;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; RefreshButton<span style=" ">&#40;</span>kn2,<span style="color: #33ffdd;">462</span>,<span style="color: #33ffdd;">450</span>,<span style="color: #00ff66;">&quot;выход&quot;</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">230</span>,<span style="color: #33ffdd;">230</span>,<span style="color: #33ffdd;">230</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">430</span>,<span style="color: #33ffdd;">150</span>,<span style="color: #00ff66;">&quot;здесь будет меню&quot;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DrawImage</span> kursor,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Flip</span> <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> game=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> camera<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> plane <br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> lit <br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<span style="color: #aaffff; font-weight: bold;">Until</span> &nbsp;exitprog=<span style="color: #aaffff; font-weight: bold;">True</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> RefreshButton<span style=" ">&#40;</span>ImBtn,x,y,txt$,n<span style=" ">&#41;</span><br />
mx=<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>&nbsp;: my=<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #ffee00">;координаты мыши </span><br />
MHit=<span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style="color: #ffee00">;проверяем нажатие левой мыши </span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">RectsOverlap</span><span style=" ">&#40;</span>x<span style="color: #33ffdd;">+2</span>,y<span style="color: #33ffdd;">+2</span>,<span style="color: #aaffff; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>ImBtn<span style=" ">&#41;</span><span style="color: #33ffdd;">-4</span>,<span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>ImBtn<span style=" ">&#41;</span><span style="color: #33ffdd;">-4</span>,mx,my,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><span style="color: #ffee00">; наведение</span><br />
&nbsp; &nbsp; &nbsp;f=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp;y2=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> MHit=<span style="color: #aaffff; font-weight: bold;">True</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #ffee00">; нажатие мыши</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;f=<span style="color: #33ffdd;">2</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;y2=<span style="color: #33ffdd;">2</span> <span style="color: #ffee00">; сдвигаем текст кнопки ниже на 2 пикселя</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Buttons<span style=" ">&#40;</span>n<span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #ffee00">; записываем в массив, что кнопка нажата</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
<span style="color: #aaffff; font-weight: bold;">Else</span> <span style="color: #ffee00">; иначе кнопка неактивна</span><br />
&nbsp; &nbsp; &nbsp;f=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp;y2=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
<span style="color: #aaffff; font-weight: bold;">DrawImage</span> ImBtn,x,y,f <span style="color: #ffee00">; рисуем кнопку в нужном положении</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">; цвет текста</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> x<span style="color: #33ffdd;">+0.5</span>*<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>ImBtn<span style=" ">&#41;</span><span style="color: #33ffdd;">+4</span>-<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>txt$<span style=" ">&#41;</span>*<span style="color: #aaffff; font-weight: bold;">FontHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><span style=" ">&#41;</span>, y<span style="color: #33ffdd;">+0.5</span>*<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>ImBtn<span style=" ">&#41;</span><span style="color: #33ffdd;">-4</span>-<span style="color: #aaffff; font-weight: bold;">FontHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span>+y2, txt$<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Как выяснилось, интерфейс игровой программы состоит как минимум из трех частей, но в законченном приложении их обычно гораздо больше. Для настройки приложения существует экран опций и консоль. Для разъяснения пользователю тонкостей интерфейса существует система справки и подсказок. Причем если консоль обычно существует как часть основной программы, то окна справки и опций (настроек) могут находиться вообще в других файлах. Так же обычно все разработчики включают в программу информацию о себе, которая может быть частью хелпа, а может быть отдельно. Часто в играх существуют различные экраны карьеры и тому подобное. В начале работы приложения обычно показывается картинка или видео с логотипом разработчиков, а в играх это используется повсеместно. Отдельной частью программы можно назвать систему управления курсором (видом, положением и т. д.), особенно это актуально для РПГ и стратегий. Основную программу тоже можно разделить на части: движок, создание виртуального мира, создание игрока, управление частицами, физический движок, система боя, система искусственного интеллекта, триггерная система, и т. д. Впрочем, это деление уже чисто условное. 
</p>
<a name=".D0.93.D0.BB.D0.B0.D0.B2.D0.B0_.D0.B2.D1.82.D0.BE.D1.80.D0.B0.D1.8F_-_.D1.8D.D0.BB.D0.B5.D0.BC.D0.B5.D0.BD.D1.82.D1.8B_.D1.83.D0.BF.D1.80.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D1.8F"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%B5%D0%BC_GUI_%C2%AB%D1%80%D1%83%D0%BA%D0%B0%D0%BC%D0%B8%C2%BB&amp;action=edit&amp;section=2" title="Создаем GUI «руками»">править</a>]</span> <span class="mw-headline">Глава вторая - элементы управления</span></h2>
<p>Надеюсь, что из прошлой главы вы поняли, из каких основных частей состоит программа. Теперь остановимся более подробно на основном рабочем поле программы и элементах его составляющих. 
</p><p>Рабочее поле - это та часть экрана, где пользователь производит все свои манипуляции и видит результат их выполнения. В случае игр там отображается игровое пространство. По краям рабочего поля находятся кнопки, меню, поля ввода и т. д. Теперь подробнее об элементах. В описании я буду пользоваться терминологией языка программирования Delphi, поэтому названия могут не совпадать с теми, что вы привыкли слышать. Но суть элементов от их названия не меняется, поэтому это не должно вас смущать. Элементы бывают следующие:
</p>
<ul><li>Button (кнопка) - ну это понятно, кнопка она и в Африке кнопка.
</li><li>Label (метка) - элемент использующийся для вывода текста на экран.
</li><li>Edit (текстовое поле) - поле ввода, служащее для введения текстовой информации с клавиатуры.
</li><li>CheckBox (флажок) - элемент принимающий два значения: выбран, не выбран.
</li><li>RadioGroup (группа радио кнопок) - похоже на флажок, но выбирается один элемент из*существующих.
</li><li>ComboBox (раскрывающийся список) - в этом элементе можно выбрать одно значение из*нескольких или ввести свое. 
</li><li>Panel (панель) - элемент на котором могут находиться другие элементы. Нужен для красоты*и удобства.
</li><li>MaskEdit (парольное поле) - тоже, что и Edit, но вводимые символы скрываются звездочками или еще чем.
</li><li>Image (изображение) - для отображения на экране какой-либо картинки.
</li><li>ProgressBar (индикатор загрузки) - показывает сколько процентов чего-либо выполнено. 
</li><li>PageControl (группа панелей) - несколько панелей между которыми можно переключаться.
</li><li>TrackBar (бегунок) - можно взять за бегунок и переместить его горизонтально в заданных границах.
</li><li>UpDown (счетчик) - прибавляет или отнимает шаг (обычно 1) по нажатию.
</li><li>Form (форма) - обычное окно.
</li></ul>
<p>На рисунке показаны все эти элементы:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI3-01.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:GUI3-01.png" src="qpchjkwr.png" width="369" height="463" /></a></span></div></div>
<p>Это список основных визуальных элементов, но кроме них существует множество других элементов. 
</p><p>Теперь посмотрим, как можно создать некоторые из этих элементов в блице.
</p><p>Элементы label и image в блице уже реализованы, а Panel приобретает чисто визуальное значение и реализуется легко, поэтому мы их рассматривать не будем. Как сделать кнопку мы уже разобрались. Создадим индикатор загрузки и группу радио кнопок:
</p><p>Функция для группы радио кнопок:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> RefreshRadioGroup<span style=" ">&#40;</span>x,y,n,k<span style=" ">&#41;</span> <br />
<p>r=<span style="color: #33ffdd;">10</span><span style="color: #ffee00">;радиус, он должен быть &gt; 6</span><br />
<span style="color: #ffee00">;проверяем мышь</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> k <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">RectsOverlap</span><span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y<span style="color: #33ffdd;">+1.5</span>*i*r,r<span style="color: #33ffdd;">-1</span>,r<span style="color: #33ffdd;">-1</span>,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> Radio<span style=" ">&#40;</span>n<span style=" ">&#41;</span>=i<br />
<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
<span style="color: #ffee00">;рисуем </span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> k &nbsp;<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span> <span style="color: #ffee00">;цвет фона </span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Oval</span> x<span style="color: #33ffdd;">-2</span>,y<span style="color: #33ffdd;">-2</span><span style="color: #33ffdd;">+1.5</span>*i*r,r<span style="color: #33ffdd;">+2</span>,r<span style="color: #33ffdd;">+2</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">250</span> <span style="color: #ffee00">;цвет фона </span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Oval</span> x,y<span style="color: #33ffdd;">+1.5</span>*i*r,r,r<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">; цвет внутреннего кружка</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=Radio<span style=" ">&#40;</span>n<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Oval</span> x<span style="color: #33ffdd;">+0.10</span>*r,y<span style="color: #33ffdd;">+1.5</span>*i*r<span style="color: #33ffdd;">+0.10</span>*r,<span style="color: #33ffdd;">0.75</span>*r,<span style="color: #33ffdd;">0.75</span>*r <span style="color: #ffee00">;если совпадает, закрашиваем</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Необходим массив:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Dim</span> Radio<span style=" ">&#40;</span>n<span style=" ">&#41;</span></div>
<p>Входные параметры:
</p>
<ul><li>x, y - координаты
</li><li>n - номер элемента массива, куда будет записываться значение
</li><li>k - количество радио-кнопок в группе
</li></ul>
<p>Функция для индикатора загрузки:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> RefreshLoadingBar<span style=" ">&#40;</span>ilx,ily,im,bim,proc<span style=" ">&#41;</span><br />
<p><span style="color: #ffee00">;Cls; если надо очищать фон, то оставить. </span><br />
<span style="color: #aaffff; font-weight: bold;">DrawImage</span> bim,ilx,ily <span style="color: #ffee00">;рисуем фон и полосу:</span><br />
<span style="color: #aaffff; font-weight: bold;">DrawImageRect</span> im,ilx,ily,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>im<span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.01</span>*proc,<span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>im<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span> <br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Входные параметры:
</p>
<ul><li>ilx, ily - координаты
</li><li>im, bim - картинка полосы загрузки и фоновая картинка
</li><li>proc - процент загрузки от 0 до 100 
</li></ul>
<p>функция вставляется в нужных местах кода с соответствующим количеством процентов.
</p>
<div align="right"><a href="http://blitzetcetera.org/images/1/10/GUI.zip" class="internal" title="GUI.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Avel" title="Участник:Avel">Агнислав Липкан</a> (e-mail: avelnet@yandex.ru)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Стабилизация FPS в играх"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Стабилизация FPS в играх&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Стабилизация FPS в играх&amp;action=edit">править</a>]</span><span class="mw-headline">Стабилизация FPS в играх</span></h1>
<p>В этой статье
мы с вами разберёмся, для чего нужна стабилизация в играх и нужна ли она
вообще. А так же какая стабилизация предпочтительнее, какие у неё есть минусы и
плюсы.
</p>
</p><p>Итак, для чего
<p>же нужна стабилизация в играх? У всех компьютеров разные вычислительные
возможности, во всех компьютерах разная графическая подсистема, обладающая
разной производительностью, поэтому наивно полагать, что игра на них будет идти
с одинаковой скоростью и равномерно.
</p>
</p><p>Те из вас кто
<p>пытался поиграть в старые игры для пентиум-1 и аналогичных наверняка
сталкивались с проблемой чрезмерной резвости этих игр на вашем ПК, это связанно
именно с тем, что в играх не было сделано элементарной стабилизации скорости
выполнения игры на разных ПК.
</p>
</p><p>А вот теперь
<p>другой пример, вы наверняка запускали «тяжелую» игрушку на своём ПК и она у вас
заметно «тормозила» или весь игровой процесс напоминал сон из-за медлительных
действий на экране. (Автор сам прошел GTA-3 на достаточно слабом ПК для неё, а потом спустя пару лет
удивился тому, какой игра стала динамичной на новом ПК, оказывается, тогда я
играл в сильно замедленном режиме по причине опять таки отсутствующей
стабилизации).
</p>
</p><p>Если вы не хотите,
<p>чтобы и ваша игра выкидывала такие вот фокусы, вам необходима стабилизация
скорости выполнения игры.
</p>
</p><p>Большой
<p>популярностью в среде Blitz-разработчиков
игр пользуется следующий стабилизатор (код для BlitzMAX):
</p>
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Const</span> FPS:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">75</span> <br />
<p><span style="color: #ffff00; font-weight: bold;">Global</span> period:<span style="color: #ffff00; font-weight: bold;">Float</span>=<span style="color: #FFFFFF;">1000.0</span>/FPS,elapsed:<span style="color: #ffff00; font-weight: bold;">Int</span>,Ticks:<span style="color: #ffff00; font-weight: bold;">Int</span>,tween:<span style="color: #ffff00; font-weight: bold;">Float</span>, time:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
<br />
<br />
time=<span style="color: #ffff00; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-period<br />
<span style="color: #ffff00; font-weight: bold;">Repeat</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Repeat</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elapsed=<span style="color: #ffff00; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-time <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Until</span> elapsed <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; Ticks=elapsed/period<br />
&nbsp; &nbsp; &nbsp; &nbsp; tween=<span style="color: #ffff00; font-weight: bold;">Float</span><span style=" ">&#40;</span>elapsed <span style="color: #ffff00; font-weight: bold;">mod</span> period<span style=" ">&#41;</span>/<span style="color: #ffff00; font-weight: bold;">Float</span><span style=" ">&#40;</span>period<span style=" ">&#41;</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> k=<span style="color: #FFFFFF;">1</span> <span style="color: #ffff00; font-weight: bold;">To</span> Ticks <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time=time+period <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'############# C A L C U L A T I N G ###############</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'logic code</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'###################### D R A W I N G ######################</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'graphics code</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">Forever</span></div>
<p>Многие
используют его не задумываясь, как он работает, а ведь часто это приводит к
непредсказуемым последствиям. Давайте разберемся, что здесь к чему.
</p><p><b>FPS</b> – это максимально число кадров в секунду в вашей игре,
<p>стабилизатор не допустит превышение этого числа, что не даст вашей игре
работать слишком резво.
</p>
</p>
<ul><li><b>Period</b> – это
</li></ul>
<p><u>расчётное</u> время подготовки одного кадра в миллисекундах.
</p>
<ul><li><b>Elapsed</b> – это <u>фактически затраченное</u> время на
</li></ul>
<p>подготовку одного (прошлого) кадра в миллисекундах.
</p>
<ul><li><b>Ticks</b> – <u>необходимое</u> число расчётов логики чтобы темп
</li></ul>
<p>игры не отставал при низком fps
от запланированного.
</p>
<ul><li><b>Time</b> – <u>расчётное</u> время начала расчёта текущего кадра.
</li></ul>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">time=<span style="color: #ffff00; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-period</div>
<p>Эта строка
инициализирует переменную time временем, когда должен был быть окончен расчёт предыдущего
кадра.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Repeat</span><br />
<p>&nbsp; &nbsp; &nbsp; &nbsp; elapsed=<span style="color: #ffff00; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-time<br />
</p>
<span style="color: #ffff00; font-weight: bold;">Until</span> elapsed</div>
<p>Смысл этого
цикла в следующем, дождаться, когда затраченное время на расчёт кадра станет
больше ноля. Теоретически время, затраченное на кадр всегда больше ноля
миллисекунд, но на практике не все микропроцессоры обладают достаточной
дискретностью таймера и/или не позволяют получать точное время с точностью до
миллисекунды, поэтому иногда эта разница может быть и отрицательной. Вот для
предотвращения возможных с этим ошибок и создан этот цикл. Он выполняется
минимум 1 раз и вычисляет затраченное время на расчёт кадра, причём это время
минимум 1мс.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">Ticks=elapsed/period<br />
tween=<span style="color: #ffff00; font-weight: bold;">Float</span><span style=" ">&#40;</span>elapsed <span style="color: #ffff00; font-weight: bold;">mod</span> period<span style=" ">&#41;</span>/<span style="color: #ffff00; font-weight: bold;">Float</span><span style=" ">&#40;</span>period<span style=" ">&#41;</span></div>
<p>Здесь в первой
строчке вычисляется отношение расчётного времени к
реально затраченному на расчет прошлого кадра, число округляется до меньшего
целого и это является коэффициентом ускорения всех движений в игре, чтобы
запаздывающая графика успевала за темпом игры. Во второй строчке считается
точный коэффициент для ускорения анимации.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">For</span> k=<span style="color: #FFFFFF;">1</span> <span style="color: #ffff00; font-weight: bold;">To</span> Ticks<br />
<p>&nbsp; &nbsp; &nbsp; &nbsp; time=time+period<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'############# C A L C U L A T I N G ###############</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'logic code</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">Next</span></div>
<p>В этом цикле,
который выполняется от 0 до Ticks раз, рассчитывается вся логика игры, именно внутри этого цикла нужно помещать AI, обновление положения игрока и юнитов и т.д.
</p><p>Внутри цикла строчка "time+period" выполняет очевидную функцию – вычисляет расчётное время
<p>окончания этого кадра, естественно оно не совпадёт с фактическим, но именно это
позволит сгладить эффект округления числа повторов логики до целого, за счёт
постепенно нарастающей разницы между "time" и реальным временем.
</p>
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #B1E7EB;">'###################### D R A W I N G ######################</span><br />
<p><span style="color: #B1E7EB;">'graphics code</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">Forever</span></div>
<p>В этом,
последнем куске кода размещается сам графический вывод изображения, т.е.
очистка экрана, рендер мира и отображение заднего
буфера. Так же здесь же располагаются команды вывода 2д графики и текста, однако
нужно не забывать использовать их только после RenderWorld() (если
используется 3Dграфика).
</p><p>Плюсы данного стабилизатора:
</p>
<ul><li>Честно выполняет свою роль, т.е. не даст вашей
</li></ul>
<p>игре разогнаться больше допустимого, а так же скомпенсирует fps ступенчатостью
движений.
</p>
<ul><li>Простота использования
</li></ul>
<p>Минусы
</p>
<ul><li>При текущем fps выше
</li></ul>
<p>расчётного, число проходов логики равно нулю, что делает бесполезным следующий
проход графики (т.к. на экране ничего не изменится).
</p>
<ul><li>Стабилизация является неравномерной (т.е. не
</li></ul>
<p>строго пропорционально замедлению графики), т.к. Ticks – целое число, из чего следует,
что fps должен упасть в 2 раза, чтобы Ticks изменилось,
и проходов логики стало 2 вместо 1. Поэтому происходит чередование кадров с удвоенным проходом логики и с обычным
проходом логики. В результате на низких fps возможно
неравномерное подёргивание движущихся объектов.
</p><p>Советы
</p>
<ul><li>Пороговый fps лучше
</li></ul>
<p>устанавливать как можно выше, это приведёт к более плавным движениям, т.о.
минимальное значение порогового fps должно быть не менее 75, а лучше его брать равным 1,5
желаемого fps в игре.
</p><p>Целесообразность применения такой
<p>стабилизации становится под сомнение в свете следующих фактов:
</p>
</p>
<ul><li>При экстремально низких пиковых реальных fps, отношение его к пороговому максимальному fps может достигать десятков. В результате на слабом ПК (по видео
</li></ul>
<p>части) возникает противоречие, ЦП должен отработать десятки повторов логики
чтобы сгладить запаздывание графики, что в свою очередь не оставит времени на
расчёт графики и ещё усугубит ситуацию, ввергнув игр в пучину тормозов и лагов,
это замкнутый круг.
</p>
<ul><li>С другой стороны при реальном fps выше
</li></ul>
<p>порогового, стабилизатор не даст логике игры выполняться, пропуская для части
кадров расчёт логики вообще. Но при этом выполнит графическую часть, что абсолютно
бесполезно т.к. на экране ничего не изменится. Т.е. при превышении порогового fps начинается
пустая трата процессорного времени и времени видеокарты на расчёт идентичных
предыдущим кадров, в то время когда можно было бы дать им отдохнуть, тем более
что работу под 100% нагрузкой долго не выдерживают особенно бюджетные
видеокарты и ЦП.
</p><p>Подводя итог этих фактов, следует
<p>признать большую полезность простого ограничителя кадров на базе ждущего
таймера, т.к. он ограничивает fps и при превышении порогового fps даёт отдых
как ЦП, так и видеокарте. Так же из-за отсутствия повторителя логики он
позволяет игре выполняться чуть быстрее на слабых ПК по отношению к выше
приведённому стабилизатору. Однако минусом его является снижение игрового темпа
пропорционально падению fps.
</p>
</p><p>Как компромисс возможно
<p>использование комбинированного стабилизатора, в котором при превышении
порогового fps направляет ход выполнения программы на ждущий таймер, и
разгружаем процессор, а при недостатке fps стабилизируем путём увеличения числа
проходов логики. И ввести ограничение на число повторов логики, например до 5,
и при превышении числа повторов логики сверх лимита не просчитывать пусть игра
начнёт снижать темп. Это лучше чем лаги на высокой скорости.
</p>
</p><p>Для аркадных же игр
<p>нетребовательным к вычислительной мощи ПК лучше обойтись ограничением fps на
базе ждущего таймера настроенного на частоту около 50-60Гц.
</p>
</p>
<div align="right"><a href="http://blitzetcetera.org/images/6/6a/Stabilizator.bmx" class="internal" title="Stabilizator.bmx">скачать исходный код</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:SBJoker" title="Участник:SBJoker">Жеронкин (SBJoker) Станислав</a> (admin@polynetix.com)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Быстрый поиск в базе данных"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Быстрый поиск в базе данных&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Быстрый поиск в базе данных&amp;action=edit">править</a>]</span><span class="mw-headline">Быстрый поиск в базе данных</span></h1>
<p>Иногда перед программистом встает следующая задача: найти элемент базы данных по его названию или другому идентификатору. Простейший вариант ее решения - просматривать по порядку все элементы и сравнивать их названия с данным, если совпадет - возвратить указатель на элемент. Но если при небольшом объеме данных этот метод еще можно применять, то когда записей больше десяти тысяч, на поиск может уйти непозволительно много времени (особенно, если запросов тоже много).
</p>
</p><p>Выход в этой ситуации таков: структурировать данные особым, удобным для поиска по названию образом. Первое, что приходит в голову - сделать древовидную структуру по такому принципу: корневой элемент содержит ссылки на все возможные первые символы названий, каждый из них, в свою очередь - на все возможные вторые символы, идущие после него, эти символы содержат ссылки на следующие и т. д. Вот как это выглядит на рисунке (пусть в базе данных будут 6 слов: Книга, Автобус, Абажур, Часы, Автоген, Авто):
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Search01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Search01.gif" src="2myh4h5p.gif" width="402" height="250" /></a></span></div></div>
<p>Серым выделены вспомогательные элементы. Чтобы найти элемент по названию, выбираем корневой элемент, переходим по ссылке на другой элемент, соответствующий первому символу названия - с него по ссылке на третий (соответствующий второму символу) и т. д. Переходим по ссылкам до последней буквы - придем к искомому элементу. Поиск элемента Автобус: А-&gt;в-&gt;т-&gt;о-&gt;б-&gt;у-&gt;с. Если на каком-то шаге наткнулись на пустую ссылку, значит в базе данных нет элемента с таким названием. В итоге, для того, чтобы найти элемент с длиной названия в n символов нужно сделать n операций вместо m=кол-во элементов. Уже значительный выигрыш во времени. Но эту структуру можно оптимизировать.
</p><p>В самом деле, почему бы вместо этого не использовать ссылки на куски строк, если в большинстве случаев от каждой буквы идет только одна ссылка? Вот как выглядит второй вариант структуры:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Search02.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Search02.gif" src="54w2qc_x.gif" width="268" height="250" /></a></span></div></div>
<p>Здесь поиск проходит так: от корневого элемента переходим по ссылке соответствующей первому символу названия на следующий элемент, который содержит строку из одного или нескольких символов. Если эта строка совпадает с куском названия, вырезанным от начала, такой же длины, то идем дальше - отбрасываем этот кусок строки, переходим по ссылке на следующий символ и опять сравниваем со строкой. Теперь поиск таков: (А)-&gt;(в)то-&gt;(б)ус. Теперь количество шагов зависит от названий, но оно, обычно, гораздо меньше длины названия, да и кол-во элементов заметно сократилось.
</p><p>Теперь рассмотрим, как форматируется данная структура. Каждый элемент имеет два поля - название и массив ссылок по количеству символов (управляющие символы (0-31) отбрасываем, остается 224 (96 для стандартной раскладки - только английский язык) ). Вначале необходимо создать корнеой элемент. Так как ни одной ссылки еще нет, то для добавления первого слова просто добавляем новый элемент с названием=слову и устанавливаем ссылку от корневого с номером, соответствующим первому символу (для слова "Autobus" номер=65(код английской "А")-32=33). В процессе добавления других слов возможны три варианта (после того, как программа дойдет до конца цепочки, проходя через совпадающие куски названия нового элемента):
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Search03.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Search03.gif" src="oyjpgxqd.gif" width="389" height="221" /></a></span></div></div>
<ul><li>Начало названия у существующего элемента совпадает с началом названия добавляемого. Тогда создается вспомогательный элемент с названием=началу, в нем устанавливаются ссылки на старый и новый элементы, названия этих элементов урезаются. Также устанавливается ссылка из предыдущего элемента к вспомогательному.
</li><li>Название добавляемого элемента полностью совпадает с началом названия уже имеющегося - устанавливаются ссылки: из предыдущего элемента к новому, из нового - к старому, название старого урезается.
</li><li>Начало названия добавляемого элемента полностью совпадает с названием уже имеющегося - название нового элемента урезается, устанавливается ссылка из старого элемента к новому.
</li></ul>
<p>Сформированную таким образом структуру, легко записать на диск в виде списка элементов, отсортированных по алфавиту. Вот программа-модуль для создания и работы с рассмотренной структурой:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> rootkey.key<br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> dbkey_add.key<span style=" ">&#40;</span>name$,kfrom.key<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">DebugLog</span> name$<br />
<span style="color: #aaffff; font-weight: bold;">If</span> name$=<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span><br />
rk.key=kfrom<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span> <br />
&nbsp;k.key=dbkeylink<span style=" ">&#40;</span>rk,name$<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> k=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;nk.key=<span style="color: #aaffff; font-weight: bold;">New</span> key<br />
&nbsp; &nbsp;nk\name$=name$<br />
&nbsp; &nbsp;dbkeylink_set rk,nk<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> nk<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; l=<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>k\name$<span style=" ">&#41;</span><br />
&nbsp; nl=<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>name$<span style=" ">&#41;</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> n=l+<span style=" ">&#40;</span>nl-l<span style=" ">&#41;</span>*<span style=" ">&#40;</span>nl&lt;l<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>name$,n<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>k\name$,n<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> n&lt;l <span style="color: #aaffff; font-weight: bold;">And</span> n&lt;nl <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;nk.key=<span style="color: #aaffff; font-weight: bold;">New</span> key<br />
&nbsp; &nbsp;nk\name$=<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>name$,n<span style=" ">&#41;</span><br />
&nbsp; &nbsp;dbkeylink_set rk,nk<br />
&nbsp; &nbsp;rk=nk<br />
&nbsp;<br />
&nbsp; &nbsp;k\name$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>k\name$,n<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;dbkeylink_set rk,k<br />
<br />
&nbsp; &nbsp;nk.key=<span style="color: #aaffff; font-weight: bold;">New</span> key<br />
&nbsp; &nbsp;nk\name$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>name$,n<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;dbkeylink_set rk,nk<br />
<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> nk<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ElseIf</span> nl&lt;l <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;nk.key=<span style="color: #aaffff; font-weight: bold;">New</span> key<br />
&nbsp; &nbsp;nk\name$=name$<br />
&nbsp; &nbsp;dbkeylink_set rk,nk<br />
<br />
&nbsp; &nbsp;k\name$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>k\name$,n<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;dbkeylink_set nk,k<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> nk<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span> &nbsp; <br />
&nbsp; &nbsp;name$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>name$,l<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> name$=<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> k<br />
&nbsp; &nbsp;rk=k<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> dbkeylink.key<span style=" ">&#40;</span>parent.key,name$<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> parent\link<span style=" ">&#91;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>name$,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">-32</span><span style=" ">&#93;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> dbkeylink_set<span style=" ">&#40;</span>parent.key,k.key<span style=" ">&#41;</span><br />
parent\link<span style=" ">&#91;</span><span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>k\name$,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">-32</span><span style=" ">&#93;</span>=k<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> db_init<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Delete</span> <span style="color: #aaffff; font-weight: bold;">Each</span> key<br />
rootkey=<span style="color: #aaffff; font-weight: bold;">New</span> key<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> db_load<span style=" ">&#40;</span>file$<span style=" ">&#41;</span><br />
db_init<br />
f=<span style="color: #aaffff; font-weight: bold;">ReadFile</span><span style=" ">&#40;</span>file$<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> f=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;No access to file &quot;</span>+file$: <span style="color: #aaffff; font-weight: bold;">Return</span><br />
dbkey_fromfile f,rootkey<br />
<span style="color: #aaffff; font-weight: bold;">CloseFile</span> f<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> dbkey_fromfile<span style=" ">&#40;</span>f,k.key<span style=" ">&#41;</span><br />
k\name$=<span style="color: #aaffff; font-weight: bold;">ReadString</span><span style=" ">&#40;</span>f<span style=" ">&#41;</span><br />
dbkey_read f,k<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;n=<span style="color: #aaffff; font-weight: bold;">ReadByte</span><span style=" ">&#40;</span>f<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> n=<span style="color: #33ffdd;">255</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;nk.key=<span style="color: #aaffff; font-weight: bold;">New</span> key<br />
&nbsp;k\link<span style=" ">&#91;</span>n<span style=" ">&#93;</span>=nk<br />
&nbsp;dbkey_fromfile f,nk<br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> db_save<span style=" ">&#40;</span>file$<span style=" ">&#41;</span><br />
f=<span style="color: #aaffff; font-weight: bold;">WriteFile</span><span style=" ">&#40;</span>file$<span style=" ">&#41;</span><br />
dbkey_tofile f,rootkey<br />
<span style="color: #aaffff; font-weight: bold;">CloseFile</span> f<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> dbkey_tofile<span style=" ">&#40;</span>f,k.key<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">WriteString</span> f,k\name$<br />
dbkey_write f,k<br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">223</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> k\link<span style=" ">&#91;</span>n<span style=" ">&#93;</span>&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">WriteByte</span> f,n<br />
&nbsp; dbkey_tofile f,k\link<span style=" ">&#91;</span>n<span style=" ">&#93;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">WriteByte</span> f,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> textfile_load<span style=" ">&#40;</span>file$<span style=" ">&#41;</span><br />
db_init<br />
f=<span style="color: #aaffff; font-weight: bold;">ReadFile</span><span style=" ">&#40;</span>file$<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> f=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;No access to file &quot;</span>+file$: <span style="color: #aaffff; font-weight: bold;">Return</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">Eof</span><span style=" ">&#40;</span>f<span style=" ">&#41;</span><br />
&nbsp;dbkey_add <span style="color: #aaffff; font-weight: bold;">ReadLine</span>$<span style=" ">&#40;</span>f<span style=" ">&#41;</span>,rootkey<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">CloseFile</span> f<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> textfile_save<span style=" ">&#40;</span>file$<span style=" ">&#41;</span><br />
f=<span style="color: #aaffff; font-weight: bold;">WriteFile</span><span style=" ">&#40;</span>file$<span style=" ">&#41;</span><br />
dbkey_totextfile f,rootkey<br />
<span style="color: #aaffff; font-weight: bold;">CloseFile</span> f<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> dbkey_totextfile<span style=" ">&#40;</span>f,k.key,m$=<span style="color: #00ff66;">&quot;&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">WriteLine</span> f,m$+k\name$<br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">223</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> k\link<span style=" ">&#91;</span>n<span style=" ">&#93;</span>&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> dbkey_totextfile f,k\link<span style=" ">&#91;</span>n<span style=" ">&#93;</span>,m$+k\name$<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>А вот тестовая программа (она загружает текст из файла (можно взять любой текстовый), создает структуру (добавив к каждому элементу контрольную сумму, вычисленную на основе названия), записывает ее на диск, стирает, загружает и выводит в текстовый файл элементы, отсортированные по алфавиту (вместе со вспомогательными)):
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> key<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> name$, link.key<span style=" ">&#91;</span><span style="color: #33ffdd;">223</span><span style=" ">&#93;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Include</span> <span style="color: #00ff66;">&quot;IndexedBase.bb&quot;</span><br />
<br />
textfile_load <span style="color: #00ff66;">&quot;test.txt&quot;</span><br />
db_save <span style="color: #00ff66;">&quot;test.bdb&quot;</span><br />
db_load <span style="color: #00ff66;">&quot;test.bdb&quot;</span><br />
textfile_save <span style="color: #00ff66;">&quot;out.txt&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> dbkey_read<span style=" ">&#40;</span>f,k.key<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> dbkey_write<span style=" ">&#40;</span>f,k.key<span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Попробуйте изменить программу так, чтобы вспомогательные элементы не выводились. И еще несколько слов о работе с модулем: вы можете добавлять поля в тип key, при этом изменяя процедуры "dbkey_write" и "dbkey_load" так, чтобы нужные элементы записывались / загружались из файла (либо формировались по ходу загрузки).
</p>
<div align="right"><a href="http://blitzetcetera.org/images/7/7b/Indexed_Base.zip" class="internal" title="Indexed Base.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Логотип jgs в 100 строчках кода"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Логотип jgs в 100 строчках кода&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Логотип jgs в 100 строчках кода&amp;action=edit">править</a>]</span><span class="mw-headline">Логотип jgs в 100 строчках кода</span></h1>
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:JGSLogo.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:JGSLogo.gif" src="4oia6f12.gif" width="465" height="103" /></a></span></div></div>
<p>Почитав про glow эффект, мне самому захотелось его сделать. Итак, начнем&nbsp;!
</p><p>Для начала, инициализируем экран и создадим картинку:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<p><br />
</p>
tex = <span style="color: #aaffff; font-weight: bold;">CreateImage</span><span style=" ">&#40;</span><span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">640</span><span style=" ">&#41;</span></div>
<p>Дальше нарисуем базовую картинку в картинку 
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">87</span>,<span style="color: #33ffdd;">96</span>,<span style="color: #33ffdd;">251</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> b# = <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">360</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a# = <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">360</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">Plot</span> <span style="color: #33ffdd;">320</span>+<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>b<span style=" ">&#41;</span>*<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>a<span style=" ">&#41;</span>*<span style="color: #33ffdd;">60</span>-<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>b<span style=" ">&#41;</span>*<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>a<span style=" ">&#41;</span>*<span style="color: #33ffdd;">300</span>,<span style="color: #33ffdd;">320</span> + <span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>b<span style=" ">&#41;</span>*<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>a<span style=" ">&#41;</span>*<span style="color: #33ffdd;">60</span>+<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>b<span style=" ">&#41;</span>*<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>a<span style=" ">&#41;</span>*<span style="color: #33ffdd;">300</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;generate base image ok&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Объясню что за Plot 320+Cos(b)*Cos(a)*60-Sin(b)*Sin(a)*300,320 + Sin(b)*Cos(a)*60+Cos(b)*Sin(a)*300: тут фокус простой, в общем, берем формулу круга через sin,cos&nbsp;: x = cos(alpha)*r, y = sin(alpha)*r и множим потом x и y на матрицу поворота в 2d... получаем такие формулы.
</p><p>Дальше установим буфер на картинку, и создадим временный массив.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><br />
<p><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Dim</span> buf<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span>,<span style="color: #33ffdd;">3</span><span style=" ">&#41;</span></div>
<p>Ничего сложного, просто считываем значения цветов в буферный массив
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">LockBuffer</span> <span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">For</span> x=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><br />
ki = <span style="color: #aaffff; font-weight: bold;">ReadPixelFast</span> <span style=" ">&#40;</span>x,y,<span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=ki <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">24</span> <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">24</span><br />
buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=ki <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">24</span> <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">24</span><br />
buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>=ki <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">24</span> <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">24</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">UnlockBuffer</span> <span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;get color value ok&quot;</span></div>
<p>Теперь расписываю самое интересное - стадию блюра. Итак, мы будем делать обычный блюр, но с фичей, фича эта - то, что значение цветов умножаются после блюра, это и есть весь glow(bloom) эффект.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">For</span> z = <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">3</span><br />
<p><span style="color: #aaffff; font-weight: bold;">For</span> x=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><br />
<br />
<span style="color: #ffee00">;обычный блюр</span><br />
r#=<span style=" ">&#40;</span>buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
r#=r#+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">9</span><br />
g#=<span style=" ">&#40;</span>buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
g#=g#+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">9</span><br />
b#=<span style=" ">&#40;</span>buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
b#=b#+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">9</span><br />
<span style="color: #ffee00">;а весь секрет вот в этом числе bloom effect при blur</span><br />
l# = <span style="color: #33ffdd;">1.35</span><br />
r = r*l<br />
g = g*l<br />
b = b*l<br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> r&gt;<span style="color: #33ffdd;">255</span> <span style="color: #aaffff; font-weight: bold;">Then</span> r = <span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> g&gt;<span style="color: #33ffdd;">255</span> <span style="color: #aaffff; font-weight: bold;">Then</span> g = <span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> b&gt;<span style="color: #33ffdd;">255</span> <span style="color: #aaffff; font-weight: bold;">Then</span> b = <span style="color: #33ffdd;">255</span><br />
<br />
buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span> = r<br />
buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> = g<br />
buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> = b<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;blur &quot;</span>+z<br />
</p>
<span style="color: #aaffff; font-weight: bold;">Next</span></div>
<p>В общем, никаких сложностей - 4 прохода блюра каждый раз множим на 1.35 и следим чтобы числа невылазили за 255
вот вам и эффект свечения.
</p><p>Дальше мелочи - записать значение цветов обратно в картинку, здесь я использовал writepixelfast и быстрый перевод цветов в ARGB.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">LockBuffer</span> <span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">For</span> x=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">Imagewidth</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">WritePixelFast</span> x,y,buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">16</span>+buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">8</span>+buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">UnlockBuffer</span> <span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;write image pixels ok&quot;</span></div>
<p>Теперь ставим буфер обратно, и рисуем картинку:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">DrawImage</span> tex,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">WaitKey</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Вот и все, дети. Эффект считает, правда, долго, у меня - секунд 10.
</p><p>Полный сорс:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<p><br />
tex = <span style="color: #aaffff; font-weight: bold;">CreateImage</span><span style=" ">&#40;</span><span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">640</span><span style=" ">&#41;</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">87</span>,<span style="color: #33ffdd;">96</span>,<span style="color: #33ffdd;">251</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> b# = <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">360</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a# = <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">360</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">Plot</span> <span style="color: #33ffdd;">320</span>+<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>b<span style=" ">&#41;</span>*<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>a<span style=" ">&#41;</span>*<span style="color: #33ffdd;">60</span>-<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>b<span style=" ">&#41;</span>*<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>a<span style=" ">&#41;</span>*<span style="color: #33ffdd;">300</span>,<span style="color: #33ffdd;">320</span> + <span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>b<span style=" ">&#41;</span>*<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>a<span style=" ">&#41;</span>*<span style="color: #33ffdd;">60</span>+<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>b<span style=" ">&#41;</span>*<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>a<span style=" ">&#41;</span>*<span style="color: #33ffdd;">300</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;generate base image ok&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> buf<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span>,<span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">LockBuffer</span> <span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> x=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><br />
ki = <span style="color: #aaffff; font-weight: bold;">ReadPixelFast</span> <span style=" ">&#40;</span>x,y,<span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=ki <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">24</span> <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">24</span><br />
buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=ki <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">8</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">24</span> <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">24</span><br />
buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>=ki <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">24</span> <span style="color: #aaffff; font-weight: bold;">Shr</span> <span style="color: #33ffdd;">24</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">UnlockBuffer</span> <span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;get color value ok&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> z = <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> x=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><br />
<br />
<span style="color: #ffee00">;обычный блюр</span><br />
r#=<span style=" ">&#40;</span>buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
r#=r#+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">9</span><br />
g#=<span style=" ">&#40;</span>buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
g#=g#+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">9</span><br />
b#=<span style=" ">&#40;</span>buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
b#=b#+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">-1</span>,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>+buf<span style=" ">&#40;</span>x<span style="color: #33ffdd;">+1</span>,y<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">9</span><br />
<span style="color: #ffee00">;а весь секрет вот в этом числе &nbsp;bloom effect при blur</span><br />
l# = <span style="color: #33ffdd;">1.35</span><br />
r = r*l<br />
g = g*l<br />
b = b*l<br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> r&gt;<span style="color: #33ffdd;">255</span> <span style="color: #aaffff; font-weight: bold;">Then</span> r = <span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> g&gt;<span style="color: #33ffdd;">255</span> <span style="color: #aaffff; font-weight: bold;">Then</span> g = <span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> b&gt;<span style="color: #33ffdd;">255</span> <span style="color: #aaffff; font-weight: bold;">Then</span> b = <span style="color: #33ffdd;">255</span><br />
<br />
buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span> = r<br />
buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> = g<br />
buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> = b<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;blur &quot;</span>+z<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">LockBuffer</span> <span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> x=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">WritePixelFast</span> x,y,buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">16</span>+buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Shl</span> <span style="color: #33ffdd;">8</span>+buf<span style=" ">&#40;</span>x,y,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">UnlockBuffer</span> <span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;write image pixels ok&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">DrawImage</span> tex,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">WaitKey</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/3/33/JGSLogo.bb" class="internal" title="JGSLogo.bb">скачать исходный код</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php?title=%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Jimon&amp;action=edit" class="new" title="Участник:Jimon">Jimon</a> (e-mail: jimon.j1m0n@gmail.com)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Мех на Blitz3D"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Мех на Blitz3D&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Мех на Blitz3D&amp;action=edit">править</a>]</span><span class="mw-headline">Мех на Blitz3D</span></h1>
<p>В общем, все это очень просто... надо только знать как и что. Начнем с единственной заготовки: 
</p>
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Hair.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Hair.png" src="6nyfe_4x.png" width="128" height="128" /></a></span></div></div>
<p>Такую картинку довольно несложно генерировать, но это уже не в этой статье.
</p><p>Эта картинка обозначает некую небольшую часть волос в разрезе.
</p><p>Идея такая: эту текстуру мы наносим, как полупрозрачную, на объект, потом копируем этот объект и чуть-чуть его увеличиваем. Когда мы сделаем много копий, то у нас получится псевдо-мех.
</p><p>Начнем устанавливаем параметры, создаем камеру, делаем тип в котором будем хранить множество объектов, тут именно тип, потому что массив для этого не подходит.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
cam=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> cam,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-7</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> cub<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> ent%<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>Дальше установим базовые переменные. Можете поиграться со значениями.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">cachestvo#=<span style="color: #33ffdd;">300</span><br />
<p><br />
<span style="color: #ffee00">;scale</span><br />
x#=<span style="color: #33ffdd;">4</span><br />
y#=x<br />
z#=x<br />
mm#=<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #ffee00">;smeshenie</span><br />
t#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #ffee00">;bufers</span><br />
xz#=<span style="color: #33ffdd;">0</span><br />
yz#=<span style="color: #33ffdd;">0</span><br />
<br />
</p>
t=t/cachestvo#</div>
<p>Дальше самое главное! Нам надо сделать много практически одинаковых кубиков.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">For</span> f#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> cachestvo<br />
<p>c.cub=<span style="color: #aaffff; font-weight: bold;">New</span> cub<br />
c\ent=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityFX</span> c\ent,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> c\ent,<span style="color: #33ffdd;">218</span>,<span style="color: #33ffdd;">194</span>,<span style="color: #33ffdd;">103</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> c\ent,mm+f/<span style=" ">&#40;</span>cachestvo/x<span style=" ">&#41;</span>,mm+f/<span style=" ">&#40;</span>cachestvo/y<span style=" ">&#41;</span>,mm+f/<span style=" ">&#40;</span>cachestvo/z<span style=" ">&#41;</span><br />
t1=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;a.jpg&quot;</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> t1,<span style="color: #33ffdd;">0.35</span>,<span style="color: #33ffdd;">0.35</span><br />
<br />
<span style="color: #ffee00">;Это надо для придания небольшой ломаности волосам</span><br />
xz=xz+t+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-0.006</span>,<span style="color: #33ffdd;">0.006</span><span style=" ">&#41;</span><br />
yz=yz+t+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-0.006</span>,<span style="color: #33ffdd;">0.006</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> c\ent,<span style="color: #33ffdd;">1</span>-f/cachestvo<br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionTexture</span> t1,xz,yz<br />
<br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> c\ent,t1<br />
</p>
<span style="color: #aaffff; font-weight: bold;">Next</span></div>
<p>Дальше - мелочи: так как у нас много объектов, надо их крутить все... 
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">For</span> c.cub=<span style="color: #aaffff; font-weight: bold;">Each</span> cub<br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> c\ent,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>У вас должно выйти что-то типа:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Hair01.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Hair01.jpg" src="z_q9khr1.jpg" width="680" height="538" /></a></span></div></div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
cam=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> cam,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-7</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> cub<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> ent%<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
cachestvo#=<span style="color: #33ffdd;">300</span><br />
<br />
<span style="color: #ffee00">;scale</span><br />
x#=<span style="color: #33ffdd;">4</span><br />
y#=x<br />
z#=x<br />
mm#=<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #ffee00">;smeshenie</span><br />
t#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #ffee00">;bufers</span><br />
xz#=<span style="color: #33ffdd;">0</span><br />
yz#=<span style="color: #33ffdd;">0</span><br />
<br />
t=t/cachestvo# <br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> f#=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> cachestvo<br />
c.cub=<span style="color: #aaffff; font-weight: bold;">New</span> cub<br />
c\ent=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityFX</span> c\ent,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> c\ent,<span style="color: #33ffdd;">218</span>,<span style="color: #33ffdd;">194</span>,<span style="color: #33ffdd;">103</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> c\ent,mm+f/<span style=" ">&#40;</span>cachestvo/x<span style=" ">&#41;</span>,mm+f/<span style=" ">&#40;</span>cachestvo/y<span style=" ">&#41;</span>,mm+f/<span style=" ">&#40;</span>cachestvo/z<span style=" ">&#41;</span><br />
t1=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Hair.png&quot;</span>,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> t1,<span style="color: #33ffdd;">0.35</span>,<span style="color: #33ffdd;">0.35</span><br />
<br />
<span style="color: #ffee00">;ето надо для придания небольшой ломаности волосам</span><br />
xz=xz+t+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-0.006</span>,<span style="color: #33ffdd;">0.006</span><span style=" ">&#41;</span><br />
yz=yz+t+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-0.006</span>,<span style="color: #33ffdd;">0.006</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> c\ent,<span style="color: #33ffdd;">1</span>-f/cachestvo<br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionTexture</span> t1,xz,yz<br />
<br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> c\ent,t1<br />
<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> c.cub=<span style="color: #aaffff; font-weight: bold;">Each</span> cub<br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> c\ent,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Да да, знаю, это медленно на geforce 4 mx 440, но на geforce 6600gt все летает!
</p>
<div align="right"><a href="http://blitzetcetera.org/images/8/80/Hair.zip" class="internal" title="Hair.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php?title=%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Jimon&amp;action=edit" class="new" title="Участник:Jimon">Jimon</a> (e-mail: jimon.j1m0n@gmail.com)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Туториал «Змейка»"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Туториал «Змейка»&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Туториал «Змейка»&amp;action=edit">править</a>]</span><span class="mw-headline">Туториал «Змейка»</span></h1>
<p>Доброго времени суток!
</p>
</p><p>Заметил я, что юные программисты часто сталкиваются с проблемой написания простой змейки! Попробуем это исправить, подсказав как это можно реализовать!
</p><p>Значит, задача: сделать "змейку", как на старом добром карманном "тетрисе"... чтоб она что-нибудь ела и при этом росла, ну и чтобы нельзя было себя за хвост "укусить", оградим игровое поле гранитом, чтоб нашей змее не удалось ее прогрызть и выбраться наружу (для удобства описания обзовем нашу змею кольчатым червем, и соответственно отдельные "куски" змеи - кольцами).
</p><p>Но, прежде чем займемся кодом, немножко теории:
</p><p>В наипростейшем случае змейка представляет собой массив ячеек в которых хранятся координаты положения колец змейки т.е. все тело змейки представляет собой примерно такую конструкцию:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake01.gif" src="bwzmd-d_.gif" width="363" height="73" /></a></span></div></div>
<p>В ячейке с номером "1" хранится голова змеи, в ячейке под номером "2" - первое кольцо, в "3" - второе и т.п.&lt;.p&gt;
</p><p>Наверное вы уже догадываетесь, как будет организовано ползание змеи... всё просто... при перемещении головы змеи, за ней должен двигаться весь ее хвост. Но программировать это придется детально. Нужно первое кольцо передвинуть на место, где раньше была голова, второе кольцо передвинуть туда, где раньше было первое. Третье туда, где было второе и так до саамого конца хвоста.
</p><p>Если все это перевести в логику программирования, то получится так, что координатам ячейки головы присваиваются новые координаты (она передвинулась) затем координаты головы присваиваются координатам первого кольца, координаты первого кольца присваиваются координатам второго кольца и в таком духе обрабатывается весь хвост. Схематично это можно отобразить так:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake02.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake02.gif" src="hqffj7w5.gif" width="347" height="127" /></a></span></div></div>
<p>Вот и весь секрет змейки... но во всем вышенаписанном есть один небольшой недостаток, змейка двигается не плавно... Чтобы это исправить, у меня появилась такая идея (может кто делает по-другому, а я делаю так): нужно не сразу координатам первого кольца присваивать координаты головы, а немножко погодя... хммм... но их нужно ведь где-то сохранять... для этого увеличивается количество ячеек змейки, и кольца делаются зависимыми от ячеек через определенное "расстояние", допустим каждая пятая ячейка будет кольцом, а остальные будут промежуточными хранилищами координат... Схематично можно отобразить это так:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake03.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake03.gif" src="qh9vyv3f.gif" width="612" height="145" /></a></span></div></div>
<p>Ну теперь уж точно всё! Теперь все секреты змеи раскрыты, приступим к программированию. Будем писать, используя динамичный массив типов. Создадим тип массива для змеи:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>Значения переменных:
</p>
<ul><li>h - будет хранить хендл объекта головы или кольца змеи
</li><li>s - будет использоваться только в первом элементе массива, и будет задавать количество "хранилищ" координат между кольцами змеи
</li><li>x, y и z - будут хранить сами координаты кольца, или просто промежуточные координаты.
</li></ul>
<p><br />
Создадим саму змею т.е. создадим динамичный массив и заполним его первыми характеристиками:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
<p><br />
Snake\h%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
Snake\s%=<span style="color: #33ffdd;">5</span><br />
Snake\x#=<span style="color: #33ffdd;">0</span><br />
Snake\y#=<span style="color: #33ffdd;">0</span><br />
</p>
Snake\z#=<span style="color: #33ffdd;">0</span></div>
<p>Вот мы создали голову змеи, в h занесем сам объект для отображения головы, в s запишем сколько будет хранилищ координат до первого кольца. Присвоим голове змеи изначальные координаты, в этом случае это будут 0,0,0 (середина мира). Создадим одно кольцо для змеи:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">Snake.sn=<span style="color: #aaffff; font-weight: bold;">First</span> sn<br />
<p>j=Snake\s%<br />
x=Snake\x#<br />
y=Snake\y#<br />
z=Snake\z#<br />
<br />
Snake.sn = <span style="color: #aaffff; font-weight: bold;">Last</span> sn<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i%=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> j<br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> i%=j% <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; <br />
&nbsp;k%=k%<span style="color: #33ffdd;">+1</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Next</span></div>
<p>Для создания кольца, нам нужно "спросить" у головы сколько создавать резервных хранилищ... перемещаем индикатор указателя в массиве в самое начало (Snake.sn=First sn) затем присваиваем какой-нить резервной переменной количество хранилищ (j=Snake\s%). Я еще сохранял резервные координаты, чтоб змея появилась в одной точке, это не особо-важно, можно не делать.
</p><p>Далее, переместим индикатор указателя в конец массива и приступим к созданию: запускаем цикл создающий резервные хранилища, и в этом цикле зададим условие (If i%=j%) если цикл идет последний раз, то надо вместо простого хранилища создать само кольцо... на самом деле хранилище отличается от кольца только наличием объекта отображающегося на экране... запишем в s идентификатор какого-нибудь объекта... теперь уже становится интересней... чтобы отобразить змейку на экране, используется такой код:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
<p>&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h,Snake\x,Snake\y,Snake\z<br />
</p>
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span></div>
<p>Здесь мы просто запускаем цикл, и если в переменной h что-нибудь записано (какой-нибудь объект) то позиционируем его согласно новых позиций.
</p><p>Ну а теперь самое интересное.. процедура перемещения координат от головы к хвосту... в нормальном случае, используя массив, цикл должен запускаться от конца к началу, чтобы не затирать старые координаты новыми, но за неимением такового цикла в блице, и из-за сложности адресации в типах сделаем все проще и понятней:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">x1#=x#<br />
<p>y1#=y#<br />
z1#=z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> z=z<span style="color: #33ffdd;">+0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> z=z<span style="color: #33ffdd;">-0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> x=x<span style="color: #33ffdd;">-0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> x=x<span style="color: #33ffdd;">+0.2</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> x1#&lt;&gt;x# <span style="color: #aaffff; font-weight: bold;">Or</span> y1#&lt;&gt;y# <span style="color: #aaffff; font-weight: bold;">Or</span> z1#&lt;&gt;z# <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<span style="color: #ffee00">; rotate snake</span><br />
<br />
x2#=x#<br />
y2#=y#<br />
z2#=z#<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
<br />
&nbsp; &nbsp;x1#=Snake\x<br />
&nbsp; &nbsp;y1#=Snake\y<br />
&nbsp; &nbsp;z1#=Snake\z<br />
<br />
&nbsp; &nbsp;Snake\x=x#<br />
&nbsp; &nbsp;Snake\y=y#<br />
&nbsp; &nbsp;Snake\z=z#<br />
<br />
&nbsp; &nbsp;x#=x1#<br />
&nbsp; &nbsp;y#=y1#<br />
&nbsp; &nbsp;z#=z1#<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
x#=x2#<br />
y#=y2#<br />
</p>
z#=z2#</div>
<p>В переменных x, y и z хранятся координаты головы. Сначала сохраняем координаты в каких-нибудь резервных переменных, затем спрашиваем игрока не соизволит ли он нажать какую-нибудь клавишу (если соизволит, то изменим соответствующие координаты). После этого проверяем, изменилось ли значение переменных координат, путем сравнения их с резервными переменными, в них ведь старые координаты лежат.
</p><p>Если координаты изменились, то запускаем процедуру перемещения всей змеи. Для выполнения процедуры нам потребуется сохранить переменные координат, поскольку после прохождения цикла в них будет не то, что было раньше. сама процедура состоит из одного цикла, который пройдет по всем ячейкам змеи.
</p><p>В цикле: временно сохраним координаты (для следующего шага) (x1#=Snake\x), присвоим новые координаты этой ячейке (Snake\x=x#), и затем присвоим временно сохраненные координаты основным переменным для того, чтобы на следующем шаге цикла присвоить их следующей ячейке массива (x#=x1#)... после прохождения цикла в переменных x, y и z хранятся координаты последнего кольца змеи... восстановим их, чтобы там снова хранились координаты головы змеи (x#=x2#)
</p><p>Вот, в принципе, и всё! Теперь собрав весь код вместе уже можно получить змею, которая будет ползать, изменяя направление, в зависимости от нажатия клавиш...
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
x#=<span style="color: #33ffdd;">0</span><br />
y#=<span style="color: #33ffdd;">0</span><br />
z#=<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">-20</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<br />
<span style="color: #ffee00">; create snake</span><br />
<br />
Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
<br />
Snake\h%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
Snake\s%=<span style="color: #33ffdd;">5</span><br />
Snake\x#=<span style="color: #33ffdd;">0</span><br />
Snake\y#=<span style="color: #33ffdd;">0</span><br />
Snake\z#=<span style="color: #33ffdd;">0</span><br />
<br />
<br />
<span style="color: #ffee00">; add segment</span><br />
<br />
Snake.sn=<span style="color: #aaffff; font-weight: bold;">First</span> sn<br />
j=Snake\s%<br />
x=Snake\x#<br />
y=Snake\y#<br />
z=Snake\z#<br />
<br />
Snake.sn = <span style="color: #aaffff; font-weight: bold;">Last</span> sn<br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i%=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> j<br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> i%=j% <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; <br />
&nbsp;k%=k%<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
x1#=x#<br />
y1#=y#<br />
z1#=z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> z=z<span style="color: #33ffdd;">+0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> z=z<span style="color: #33ffdd;">-0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> x=x<span style="color: #33ffdd;">-0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> x=x<span style="color: #33ffdd;">+0.2</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> x1#&lt;&gt;x# <span style="color: #aaffff; font-weight: bold;">Or</span> y1#&lt;&gt;y# <span style="color: #aaffff; font-weight: bold;">Or</span> z1#&lt;&gt;z# <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<span style="color: #ffee00">; rotate snake</span><br />
<br />
x2#=x#<br />
y2#=y#<br />
z2#=z#<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
<br />
&nbsp; &nbsp;x1#=Snake\x<br />
&nbsp; &nbsp;y1#=Snake\y<br />
&nbsp; &nbsp;z1#=Snake\z<br />
<br />
&nbsp; &nbsp;Snake\x=x#<br />
&nbsp; &nbsp;Snake\y=y#<br />
&nbsp; &nbsp;Snake\z=z#<br />
<br />
&nbsp; &nbsp;x#=x1#<br />
&nbsp; &nbsp;y#=y1#<br />
&nbsp; &nbsp;z#=z1#<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
x#=x2#<br />
y#=y2#<br />
z#=z2#<br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h,Snake\x,Snake\y,Snake\z<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<a name=".D0.9F.D0.B5.D1.80.D0.B5.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D0.BA.D0.B0_.D0.BA.D0.BE.D0.B4.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D1%83%D1%82%D0%BE%D1%80%D0%B8%D0%B0%D0%BB_%C2%AB%D0%97%D0%BC%D0%B5%D0%B9%D0%BA%D0%B0%C2%BB&amp;action=edit&amp;section=1" title="Туториал «Змейка»">править</a>]</span> <span class="mw-headline">Переработка кода</span></h2>
<p>Продолжим разработку нашего кольцевого червя! Но, прежде чем мы будем совершенствовать код, немножко теории: код в теперешнем состоянии имеет кучу недостатков. Первый из них - это используемая оперативная память... массив змейки выглядит примерно так:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake04.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Snake04.gif" src="p11fkg25.gif" width="549" height="329" /></a></span></div></div>
<p>В каждой ячейке есть место под координаты, под хендлы объектов колец змеи и под количество сегментов... Для резервных хранилищ не нужны переменные объектов и практически все элементы массива содержат лишние переменные s, используется-то переменная всего лишь единожды, и на протяжении всего массива эта переменная забивается нулями... Это очень плохо, занимать много оперативной памяти, не используя ее... надо исправить.
</p><p>Второй недостаток - то, что если мы по интуиции, чтобы увеличить скорость передвижения змеи, будем увеличивать ее шаг, то она будет "растягиваться"... решается этот недостаток несколькими путями: можно сделать динамическое количество промежуточных резервных хранилищ, а можно перемещать змейку на равный шаг, но с определенной частотой... возьмем второй метод на вооружение...
</p><p>Еще недостаток - весь код в таком состоянии, как будто он создан в GWBasic, надо маленько все распихать по функциям, таким образом, добавить всему коду "юзабельность"...
</p><p>Приступим к коду. Новые типы для змейки выглядят так:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>В нашем предыдущем коде можно было создать только одну змейку, чтобы их можно было создавать не одну, а больше, их нужно как-то отделять в общем массиве друг от друга, для этого вводим переменную id% которая будет содержать идентификатор змейки... Кроме этого, создаем еще один параллельный тип, в котором будем хранить координаты головы змеи, чтобы не прочесывать каждый раз основной массив в поисках головы для перемещения ее на новые координаты. Теперь функции:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
<p>&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Создание змеи. Сперва подсчитываем, сколько змей уже создано, чтобы новой змее выдать следующий уникальный номер. Здесь создаем голову змеи в основном массиве Snake и во вспомогательном SnakeManager создаем запись с координатами головы змеи. Ну и, естественно, возвращаем номер змеи для последующего использования:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
<p><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> s%=SnakeManager\s%<br />
&nbsp; x#=SnakeManager\x#<br />
&nbsp; y#=SnakeManager\y#<br />
&nbsp; z#=SnakeManager\z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; Snake\id%=id%<br />
&nbsp; Snake\x#=x#<br />
&nbsp; Snake\y#=y#<br />
&nbsp; Snake\z#=z#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Добавление кольца змеи. Здесь все немножко видоизменено, теперь нам не надо обращаться к первому элементу массива для получения количества промежуточных хранилищ... Теперь эта информация хранится в другом массиве... Ищем ее там и если есть змея с таким id%, то сохраним во временную переменную s% количество хранилищ, затем создадим нужное количество хранилищ и, самым последним, новое кольцо.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp;SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp;SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp;x#=SnakeManager\x#<br />
&nbsp; &nbsp;y#=SnakeManager\y#<br />
&nbsp; &nbsp;z#=SnakeManager\z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;x1#=Snake\x<br />
&nbsp; &nbsp;y1#=Snake\y<br />
&nbsp; &nbsp;z1#=Snake\z<br />
&nbsp; &nbsp;Snake\x=x#<br />
&nbsp; &nbsp;Snake\y=y#<br />
&nbsp; &nbsp;Snake\z=z#<br />
&nbsp; &nbsp;x#=x1#<br />
&nbsp; &nbsp;y#=y1#<br />
&nbsp; &nbsp;z#=z1#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Перемещение змеи. Этот код тоже немного изменен... Теперь у нас нет переменных x, y и z, которые хранили координаты головы, теперь это все хранится во вспомогательном массиве. Ищем их там по id% и если есть змея с таким id%, то добавляем к координатам головы координаты, поступившие в функцию, и сохраняем новые значения координат в переменные x, y и z для следующего цикла... Затем выбираем из массива все части змеи с идентификатором текущей и "продвигаем" координаты от головы к хвосту...
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h,Snake\x,Snake\y,Snake\z<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Обновление позиций объектов колец змеи. Здесь все без изменений... Теперь можно создавать не одну змейку, теперь нет лишней переменной s% которая просто так занимала бы место в массиве... Кроме этого все стало более приятно глазу и легко в использовании.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">-20</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<br />
a%=SnakeCreate<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">6</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">10</span><br />
&nbsp;SnakeAddSegment<span style=" ">&#40;</span>a,<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
b%=SnakeCreate<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">6</span>,<span style="color: #33ffdd;">-3</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">10</span><br />
&nbsp;SnakeAddSegment<span style=" ">&#40;</span>b,<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
time%=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
&nbsp;speed#=<span style="color: #33ffdd;">0.3</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed#<span style=" ">&#41;</span>:SnakeMove<span style=" ">&#40;</span>b,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed#<span style=" ">&#41;</span>:SnakeMove<span style=" ">&#40;</span>b,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>:SnakeMove<span style=" ">&#40;</span>b,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>:SnakeMove<span style=" ">&#40;</span>b,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<br />
&nbsp;SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-time&lt;=<span style="color: #33ffdd;">20</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> s%=SnakeManager\s%<br />
&nbsp; x#=SnakeManager\x#<br />
&nbsp; y#=SnakeManager\y#<br />
&nbsp; z#=SnakeManager\z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; Snake\id%=id%<br />
&nbsp; Snake\x#=x#<br />
&nbsp; Snake\y#=y#<br />
&nbsp; Snake\z#=z#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> <br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp;SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp;SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp;x#=SnakeManager\x#<br />
&nbsp; &nbsp;y#=SnakeManager\y#<br />
&nbsp; &nbsp;z#=SnakeManager\z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;x1#=Snake\x<br />
&nbsp; &nbsp;y1#=Snake\y<br />
&nbsp; &nbsp;z1#=Snake\z<br />
&nbsp; &nbsp;Snake\x=x#<br />
&nbsp; &nbsp;Snake\y=y#<br />
&nbsp; &nbsp;Snake\z=z#<br />
&nbsp; &nbsp;x#=x1#<br />
&nbsp; &nbsp;y#=y1#<br />
&nbsp; &nbsp;z#=z1#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h,Snake\x,Snake\y,Snake\z<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.A3.D0.B3.D0.BB.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D1%83%D1%82%D0%BE%D1%80%D0%B8%D0%B0%D0%BB_%C2%AB%D0%97%D0%BC%D0%B5%D0%B9%D0%BA%D0%B0%C2%BB&amp;action=edit&amp;section=2" title="Туториал «Змейка»">править</a>]</span> <span class="mw-headline">Углы</span></h2>
<p>Посмотрим, что у нас получилось... Змея уже умеет ползать, супер! Только если бы мы ее сделали из кубиков, то заметили бы, что она не поворачивает голову и все остальные кольца тоже постоянно находятся в одном положении... Это надо исправить... Итак, приступим к делу!
</p><p>С углами работа точно такаяже как и с координатами, их надо прописывать голове и потом в процедуру сдвига координат от головы к хвосту добавить сдвиг углов... Возьмем клаву в ежовые рукавицы!!!
</p><p>Добавим в типы поля для сохранения углов объектов:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>В процедуру создания добавим сохранение текущего угла головы змеи в поля для углов, чтобы в последствии двигать его по всему телу.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
<p>&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;SnakeManager\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;Snake\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>В процедуру создания змеи поступает идентификатор объекта, из него берем углы функциями EntityPitch(h%), EntityYaw(h%), EntityRoll(h%) и прописываем их как в основной, так и во вспомогательный массив, во вспомогательный заносится для последующей ротации, а в основной, чтоб змея появилась нормально до первого ее движения. Чтоб функция SnakeUpdate могла сразу обработать созданную змею.
</p><p>Не забудем и процедуру добавления сегмента, туда тоже добавим обработку углов:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> s%=SnakeManager\s%<br />
&nbsp; x#=SnakeManager\x#<br />
&nbsp; y#=SnakeManager\y#<br />
&nbsp; z#=SnakeManager\z#<br />
&nbsp; ax#=SnakeManager\ax#<br />
&nbsp; ay#=SnakeManager\ay#<br />
&nbsp; az#=SnakeManager\az#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; Snake\id%=id%<br />
&nbsp; Snake\x#=x#<br />
&nbsp; Snake\y#=y#<br />
&nbsp; Snake\z#=z#<br />
&nbsp; Snake\ax#=ax#<br />
&nbsp; Snake\ay#=ay#<br />
&nbsp; Snake\az#=az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Здесь мы берем углы из вспомогательного массива SnakeManager (угол положения головы) и присваиваем его очередному кольцу. Процедуру обновления обновляем одной командой установления угла очередному кольцу. Код:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h%,Snake\x#,Snake\y#,Snake\z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> Snake\h%,Snake\ax#,Snake\ay#,Snake\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Ну и, наконец, процедура сдвига координат... В ней нужно добавить обработку углов... Добавляем:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp;SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp;SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp;x#=SnakeManager\x#<br />
&nbsp; &nbsp;y#=SnakeManager\y#<br />
&nbsp; &nbsp;z#=SnakeManager\z#<br />
&nbsp; &nbsp;ax#=SnakeManager\ax#<br />
&nbsp; &nbsp;ay#=SnakeManager\ay#<br />
&nbsp; &nbsp;az#=SnakeManager\az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;x1#=Snake\x<br />
&nbsp; &nbsp;y1#=Snake\y<br />
&nbsp; &nbsp;z1#=Snake\z<br />
&nbsp; &nbsp;ax1#=Snake\ax<br />
&nbsp; &nbsp;ay1#=Snake\ay<br />
&nbsp; &nbsp;az1#=Snake\az<br />
&nbsp; &nbsp;Snake\x=x#<br />
&nbsp; &nbsp;Snake\y=y#<br />
&nbsp; &nbsp;Snake\z=z#<br />
&nbsp; &nbsp;Snake\ax=ax#<br />
&nbsp; &nbsp;Snake\ay=ay#<br />
&nbsp; &nbsp;Snake\az=az#<br />
&nbsp; &nbsp;x#=x1#<br />
&nbsp; &nbsp;y#=y1#<br />
&nbsp; &nbsp;z#=z1#<br />
&nbsp; &nbsp;ax#=ax1#<br />
&nbsp; &nbsp;ay#=ay1#<br />
&nbsp; &nbsp;az#=az1#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Берем координаты головы из вспомогательного массива SnakeManager и присваиваем их следующему кольцу (или временному хранилищу)... короче все точно также как и с координатами...
</p><p>Кроме всего этого, добавляем в код функцию поворота головы змеи. Код:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetAngle<span style=" ">&#40;</span>id%,ax#,ay#,az#<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\ax#=ax#<br />
&nbsp; &nbsp;SnakeManager\ay#=ay#<br />
&nbsp; &nbsp;SnakeManager\az#=az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Здесь все просто... ищем во вспомогательном массиве нужную змею (id%) и прописываем углы... в последующем процедура SnakeMove возьмет отсюда эти углы и присвоит их голове а в последствии и всем кольцам тела змеи.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">-20</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<br />
t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.8</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
<br />
t1%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t1%,<span style="color: #33ffdd;">-0.5</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t1%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t1%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
t2%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t2%,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t2%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t2%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
<br />
<br />
a%=SnakeCreate<span style=" ">&#40;</span>t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
j1#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">10</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1.5</span>*j1#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>*j1#<span style=" ">&#41;</span><span style="color: #33ffdd;">-1.2</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;SnakeAddSegment<span style=" ">&#40;</span>a%,t%<span style=" ">&#41;</span><br />
&nbsp;j1#=j1#<span style="color: #33ffdd;">-0.07</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
time%=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
&nbsp;speed#=<span style="color: #33ffdd;">0.1</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed#<span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed#<span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">180</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">270</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<br />
&nbsp;SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-time&lt;=<span style="color: #33ffdd;">20</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">Str</span><span style=" ">&#40;</span>SnakeTime%<span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetAngle<span style=" ">&#40;</span>id%,ax#,ay#,az#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\ax#=ax#<br />
&nbsp; &nbsp;SnakeManager\ay#=ay#<br />
&nbsp; &nbsp;SnakeManager\az#=az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp;SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp;SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp;x#=SnakeManager\x#<br />
&nbsp; &nbsp;y#=SnakeManager\y#<br />
&nbsp; &nbsp;z#=SnakeManager\z#<br />
&nbsp; &nbsp;ax#=SnakeManager\ax#<br />
&nbsp; &nbsp;ay#=SnakeManager\ay#<br />
&nbsp; &nbsp;az#=SnakeManager\az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;x1#=Snake\x<br />
&nbsp; &nbsp;y1#=Snake\y<br />
&nbsp; &nbsp;z1#=Snake\z<br />
&nbsp; &nbsp;ax1#=Snake\ax<br />
&nbsp; &nbsp;ay1#=Snake\ay<br />
&nbsp; &nbsp;az1#=Snake\az<br />
&nbsp; &nbsp;Snake\x=x#<br />
&nbsp; &nbsp;Snake\y=y#<br />
&nbsp; &nbsp;Snake\z=z#<br />
&nbsp; &nbsp;Snake\ax=ax#<br />
&nbsp; &nbsp;Snake\ay=ay#<br />
&nbsp; &nbsp;Snake\az=az#<br />
&nbsp; &nbsp;x#=x1#<br />
&nbsp; &nbsp;y#=y1#<br />
&nbsp; &nbsp;z#=z1#<br />
&nbsp; &nbsp;ax#=ax1#<br />
&nbsp; &nbsp;ay#=ay1#<br />
&nbsp; &nbsp;az#=az1#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;SnakeManager\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;Snake\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> s%=SnakeManager\s%<br />
&nbsp; x#=SnakeManager\x#<br />
&nbsp; y#=SnakeManager\y#<br />
&nbsp; z#=SnakeManager\z#<br />
&nbsp; ax#=SnakeManager\ax#<br />
&nbsp; ay#=SnakeManager\ay#<br />
&nbsp; az#=SnakeManager\az#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; Snake\id%=id%<br />
&nbsp; Snake\x#=x#<br />
&nbsp; Snake\y#=y#<br />
&nbsp; Snake\z#=z#<br />
&nbsp; Snake\ax#=ax#<br />
&nbsp; Snake\ay#=ay#<br />
&nbsp; Snake\az#=az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h%,Snake\x#,Snake\y#,Snake\z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> Snake\h%,Snake\ax#,Snake\ay#,Snake\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.A1.D0.BA.D0.BE.D1.80.D0.BE.D1.81.D1.82.D1.8C"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D1%83%D1%82%D0%BE%D1%80%D0%B8%D0%B0%D0%BB_%C2%AB%D0%97%D0%BC%D0%B5%D0%B9%D0%BA%D0%B0%C2%BB&amp;action=edit&amp;section=3" title="Туториал «Змейка»">править</a>]</span> <span class="mw-headline">Скорость</span></h2>
<p>Сделаем змее изменение скорости. Как уже упоминалось, если сделать интуитивно, т.е. увеличить шаг змеи, то получится нежелательный эффект "растягивания" змеи. Можно конечно это компенсировать динамичным количеством промежуточных хранилищ координат, если скорость (шаг) увеличивается, то уменьшать количество промежуточных хранилищ и наоборот. Но мы поступим по-другому: мы введем время, через которое будет делаться шаг. Получится меньше геморроя в коде и, соответственно, потратится меньше трудов на его составление.
</p><p>Поехали.
</p><p>Время будет меряться следующим образом: будут две дополнительные переменные, в одной будет храниться текущее время, а в другой, сколько его было с самого начала, чтоб можно было не один раз время отмерять... И в самой процедуре передвижения мы будем вычитать из переменной текущего времени единицу и если переменная стала нулем или меньше, то сделаем шаг и восстановим значение времени на первоначальное, взяв его из переменной, которая его надежно хранила выжидав этого момента.
</p><p>Ну хватит теории, приступим к коду! Добавим в тип вспомагательного массива эти самые две переменные:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> t%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> mt%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>Переменная t% будет хранить текущее время, а mt% будет хранить изначальное время для последующего его восстановления... Добавим в процедуру создания змеи значение времени, чтобы можно было сразу при создании задать скорость змее.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,t%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
<p>&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\mt%=t%<br />
&nbsp;SnakeManager\t%=t%<br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;SnakeManager\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;Snake\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Занесем значение времени как в текущее. Так и в резерв для восстановления, чтобы змея при создании сразу не сорвалась с места, а ждала нужное время. Внесем изменения в процедуру движения змеи.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\t%=SnakeManager\t%<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> SnakeManager\t%&lt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; SnakeManager\t%=SnakeManager\mt%<br />
&nbsp; &nbsp; SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp; SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp; SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp; x#=SnakeManager\x#<br />
&nbsp; &nbsp; y#=SnakeManager\y#<br />
&nbsp; &nbsp; z#=SnakeManager\z#<br />
&nbsp; &nbsp; ax#=SnakeManager\ax#<br />
&nbsp; &nbsp; ay#=SnakeManager\ay#<br />
&nbsp; &nbsp; az#=SnakeManager\az#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; x1#=Snake\x<br />
&nbsp; &nbsp; &nbsp; y1#=Snake\y<br />
&nbsp; &nbsp; &nbsp; z1#=Snake\z<br />
&nbsp; &nbsp; &nbsp; ax1#=Snake\ax<br />
&nbsp; &nbsp; &nbsp; ay1#=Snake\ay<br />
&nbsp; &nbsp; &nbsp; az1#=Snake\az<br />
&nbsp; &nbsp; &nbsp; Snake\x=x#<br />
&nbsp; &nbsp; &nbsp; Snake\y=y#<br />
&nbsp; &nbsp; &nbsp; Snake\z=z#<br />
&nbsp; &nbsp; &nbsp; Snake\ax=ax#<br />
&nbsp; &nbsp; &nbsp; Snake\ay=ay#<br />
&nbsp; &nbsp; &nbsp; Snake\az=az#<br />
&nbsp; &nbsp; &nbsp; x#=x1#<br />
&nbsp; &nbsp; &nbsp; y#=y1#<br />
&nbsp; &nbsp; &nbsp; z#=z1#<br />
&nbsp; &nbsp; &nbsp; ax#=ax1#<br />
&nbsp; &nbsp; &nbsp; ay#=ay1#<br />
&nbsp; &nbsp; &nbsp; az#=az1#<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Здесь уменьшаем значение текущего времени на единицу, если оно получилось ноль или меньше, то восстанавливаем значение времени и передвигаем змею на шаг...
</p><p>Я переместил процедуру ротации координат основного массива внутрь цикла поиска змеи (зеленое), чтобы не писать условие времени дважды, да и при таком расположении не будет лишнего "прогона" цикла обработки основного массива при несуществующем идентификаторе...
</p><p>Добавим процедуру изменения скорости, чтобы можно было в программе изменить скорость змеи
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetSpeed<span style=" ">&#40;</span>id%,t%<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\mt%=t%<br />
&nbsp; &nbsp;SnakeManager\t%=t%<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Здесь, как и в остальных процедурах, ищем нужную змею по id% и заменяем значения времени новыми, при этом надо заменить оба значения: mt% для восстановления времени, t% - новое значение текущего времени при уменьшении скорости, если текущее время будет больше чем теперь. Вообще, возможно, мы можем потерять несколько шагов или иными словами сказать "змея будет не сразу реагировать на изменение скорости".
</p><p>Вот и всё! теперь можно изменять скорость передвижения змеи без ее растягивания...
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> t%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> mt%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">-20</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<br />
t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.8</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
<br />
t1%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t1%,<span style="color: #33ffdd;">-0.5</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t1%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t1%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
t2%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t2%,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t2%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t2%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
<br />
<br />
a%=SnakeCreate<span style=" ">&#40;</span>t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
SnakesetSpeed<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<br />
j1#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">10</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1.5</span>*j1#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>*j1#<span style=" ">&#41;</span><span style="color: #33ffdd;">-1.2</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;SnakeAddSegment<span style=" ">&#40;</span>a%,t%<span style=" ">&#41;</span><br />
&nbsp;j1#=j1#<span style="color: #33ffdd;">-0.07</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
time%=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
&nbsp;speed#=<span style="color: #33ffdd;">0.1</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed#<span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed#<span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">180</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>:SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">270</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<br />
&nbsp;SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-time&lt;=<span style="color: #33ffdd;">20</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">Str</span><span style=" ">&#40;</span>SnakeTime%<span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetSpeed<span style=" ">&#40;</span>id%,t%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\mt%=t%<br />
&nbsp; &nbsp;SnakeManager\t%=t%<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetAngle<span style=" ">&#40;</span>id%,ax#,ay#,az#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\ax#=ax#<br />
&nbsp; &nbsp;SnakeManager\ay#=ay#<br />
&nbsp; &nbsp;SnakeManager\az#=az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\t%=SnakeManager\t%<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> SnakeManager\t%&lt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; SnakeManager\t%=SnakeManager\mt%<br />
&nbsp; &nbsp; SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp; SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp; SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp; x#=SnakeManager\x#<br />
&nbsp; &nbsp; y#=SnakeManager\y#<br />
&nbsp; &nbsp; z#=SnakeManager\z#<br />
&nbsp; &nbsp; ax#=SnakeManager\ax#<br />
&nbsp; &nbsp; ay#=SnakeManager\ay#<br />
&nbsp; &nbsp; az#=SnakeManager\az#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; x1#=Snake\x<br />
&nbsp; &nbsp; &nbsp; y1#=Snake\y<br />
&nbsp; &nbsp; &nbsp; z1#=Snake\z<br />
&nbsp; &nbsp; &nbsp; ax1#=Snake\ax<br />
&nbsp; &nbsp; &nbsp; ay1#=Snake\ay<br />
&nbsp; &nbsp; &nbsp; az1#=Snake\az<br />
&nbsp; &nbsp; &nbsp; Snake\x=x#<br />
&nbsp; &nbsp; &nbsp; Snake\y=y#<br />
&nbsp; &nbsp; &nbsp; Snake\z=z#<br />
&nbsp; &nbsp; &nbsp; Snake\ax=ax#<br />
&nbsp; &nbsp; &nbsp; Snake\ay=ay#<br />
&nbsp; &nbsp; &nbsp; Snake\az=az#<br />
&nbsp; &nbsp; &nbsp; x#=x1#<br />
&nbsp; &nbsp; &nbsp; y#=y1#<br />
&nbsp; &nbsp; &nbsp; z#=z1#<br />
&nbsp; &nbsp; &nbsp; ax#=ax1#<br />
&nbsp; &nbsp; &nbsp; ay#=ay1#<br />
&nbsp; &nbsp; &nbsp; az#=az1#<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,t%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\mt%=t%<br />
&nbsp;SnakeManager\t%=t%<br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;SnakeManager\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;Snake\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> s%=SnakeManager\s%<br />
&nbsp; x#=SnakeManager\x#<br />
&nbsp; y#=SnakeManager\y#<br />
&nbsp; z#=SnakeManager\z#<br />
&nbsp; ax#=SnakeManager\ax#<br />
&nbsp; ay#=SnakeManager\ay#<br />
&nbsp; az#=SnakeManager\az#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; Snake\id%=id%<br />
&nbsp; Snake\x#=x#<br />
&nbsp; Snake\y#=y#<br />
&nbsp; Snake\z#=z#<br />
&nbsp; Snake\ax#=ax#<br />
&nbsp; Snake\ay#=ay#<br />
&nbsp; Snake\az#=az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h%,Snake\x#,Snake\y#,Snake\z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> Snake\h%,Snake\ax#,Snake\ay#,Snake\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.98.D0.B3.D1.80.D0.BE.D0.B2.D0.BE.D0.B5_.D0.BF.D0.BE.D0.BB.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D1%83%D1%82%D0%BE%D1%80%D0%B8%D0%B0%D0%BB_%C2%AB%D0%97%D0%BC%D0%B5%D0%B9%D0%BA%D0%B0%C2%BB&amp;action=edit&amp;section=4" title="Туториал «Змейка»">править</a>]</span> <span class="mw-headline">Игровое поле</span></h2>
<p>Создадим "квадратное" игровое поле, и заставим змею двигаться по квадратам...
</p><p>Сейчас будет в основном рутинное программирование, поэтому приступим сразу к разборке кода... Для начала добавим несколько полезных функций:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakePosition<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\x#=x#<br />
&nbsp; &nbsp;SnakeManager\y#=y#<br />
&nbsp; &nbsp;SnakeManager\z#=z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetX<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\x#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetZ<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\z#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetY<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\y#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleX#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\ax#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleY#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\ay#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleZ#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Функции просты, но полезны, думаю, объяснять их функционирование не стоит, а назначение: запрос угла, запрос позиции и установка позиции головы змеи... Так, змею пока трогать не будем, займемся самим игровым полем! Создадим его для начала:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">15</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">15</span><br />
&nbsp; t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span> <span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t%,i*<span style="color: #33ffdd;">10</span><span style="color: #33ffdd;">-5</span>,<span style="color: #33ffdd;">0</span>,j*<span style="color: #33ffdd;">10</span><span style="color: #33ffdd;">-5</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">0.5</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Next</span></div>
<p>Эти два цикла разметят кусок мирового пространства на клетки... 15 на 15, размер каждой клетки будет 10 на 10 единиц...
</p><p>-5 это корректировка (сдвиг) игрового поля, чтобы позиция 0,0 как раз была в центре первой клетки... оно нам пригодится для дальнейших расчетов. Теперь самое интересное на этот момент: движение змеи! До этого мы управляли ей клавишами, но теперь нам надо чтоб она сама ползала... Код управления будет следующим:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">speed#=<span style="color: #33ffdd;">0.7</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span>,SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">2</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">180</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">180</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span>,SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">90</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">3</span> &nbsp; <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">270</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">270</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
</p>
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>Этот код каждый может составить по своему усмотрению. Мне понравился такой способ реализации.
</p><p>Значит так: вводим дополнительную переменную Direction%, эта переменная будет отвечать за направление движения... У нас ведь всего 4-х стороннее движение (налево, направо, вверх, вниз), по диагонали нам ездить не надо... Для быстрого понимания всего, советую представить себе часы: "12" - направление вверх обозначим числом "0", "3" - направление вправо числом "1", "6" - направление вниз, числом "2", 9 - направление влево числом "3"... Теперь пишем в главном цикле условия движения змеи, чтоб змея в любом случае куда-то передвинулась независимо от того, нажали мы какую-то кнопку или нет... если код направления движения равен нулю то двигаем змею вверх, если единице, то влево и т.д.
</p><p>Далее обработку клавиш... теперь нам надо при нажатии клавиш только менять направления... о передвижении змеи заботится предыдущий блок условий... НО! просто так нам изменять направления нельзя, нам нужно еще изменить угол головы змеи и проверять находится ли змея на середине квадрата игрового поля...
</p><p>"If (SnakeGetX(a) Mod 10)=0" проверяет находится ли змея на середине квадрата! Путем сравнения не пойдет, потому, что если шаг будет равен, например, 0.3, то попадание на ровное число 10 будет очень редким... Поэтому здесь вычисляется остаток от деления на 10 (размер квадрата): если он равен нулю, то змея находится на позиции кратной 10, а такие позиции находятся ровно в центре квадратов (для этого мы и сдвигали игровое поле на -5). Таким образом, если змея находится на позиции кратной 10, то изменяем ее направление, и при этом проверяем угол головы, если голова "повернута" не в том направлении, то поворачиваем ее в нужное и выравниваем позицию змеи... Чтобы змея находилась именно посередине квадрата... поскольку на момент поворота она может быть и не в середине.
</p><p>Теперь есть поле, по которому змея может ползать... и поворачивать можно только "по квадратам".. Вот рабочий код на этом шаге:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> t%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> mt%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">75</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,<span style="color: #33ffdd;">60</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> Map<span style=" ">&#40;</span><span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">15</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">15</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">15</span><br />
&nbsp; t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span> <span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t%,i*<span style="color: #33ffdd;">10</span><span style="color: #33ffdd;">-5</span>,<span style="color: #33ffdd;">0</span>,j*<span style="color: #33ffdd;">10</span><span style="color: #33ffdd;">-5</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">0.5</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">10</span><br />
&nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t%,i*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">1</span>,i*<span style="color: #33ffdd;">10</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> t%,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">5</span><br />
&nbsp;Map<span style=" ">&#40;</span>i,i<span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
<br />
t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.8</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<br />
t1%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t1%,<span style="color: #33ffdd;">-0.5</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t1%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t1%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
t2%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t2%,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t2%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t2%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> t%,<span style="color: #33ffdd;">2.5</span>,<span style="color: #33ffdd;">2.5</span>,<span style="color: #33ffdd;">2.5</span><br />
<br />
<br />
<br />
a%=SnakeCreate<span style=" ">&#40;</span>t%,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
j1#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">10</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">2</span>*j1#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>*j1#<span style=" ">&#41;</span><span style="color: #33ffdd;">-0.2</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> t%,<span style="color: #33ffdd;">2.5</span>,<span style="color: #33ffdd;">2.5</span>,<span style="color: #33ffdd;">2.5</span><br />
&nbsp;SnakeAddSegment<span style=" ">&#40;</span>a%,t%<span style=" ">&#41;</span><br />
&nbsp;j1#=j1#<span style="color: #33ffdd;">-0.07</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
<br />
time%=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;Direction%=<span style="color: #33ffdd;">0</span><br />
<br />
SnakeSetSpeed<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
&nbsp;speed#=<span style="color: #33ffdd;">0.7</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span>,SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">2</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">180</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">180</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span>,SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">90</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">3</span> &nbsp; <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">270</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">270</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<br />
<br />
&nbsp;SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-time&lt;=<span style="color: #33ffdd;">16</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakePosition<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\x#=x#<br />
&nbsp; &nbsp;SnakeManager\y#=y#<br />
&nbsp; &nbsp;SnakeManager\z#=z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetX<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\x#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetZ<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\z#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetY<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\y#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleX#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\ax#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleY#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\ay#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleZ#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetSpeed<span style=" ">&#40;</span>id%,t%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\mt%=t%<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetAngle<span style=" ">&#40;</span>id%,ax#,ay#,az#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\ax#=ax#<br />
&nbsp; &nbsp;SnakeManager\ay#=ay#<br />
&nbsp; &nbsp;SnakeManager\az#=az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\t%=SnakeManager\t%<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> SnakeManager\t%&lt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; SnakeManager\t%=SnakeManager\mt%<br />
&nbsp; &nbsp; SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp; SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp; SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp; x#=SnakeManager\x#<br />
&nbsp; &nbsp; y#=SnakeManager\y#<br />
&nbsp; &nbsp; z#=SnakeManager\z#<br />
&nbsp; &nbsp; ax#=SnakeManager\ax#<br />
&nbsp; &nbsp; ay#=SnakeManager\ay#<br />
&nbsp; &nbsp; az#=SnakeManager\az#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; x1#=Snake\x<br />
&nbsp; &nbsp; &nbsp; y1#=Snake\y<br />
&nbsp; &nbsp; &nbsp; z1#=Snake\z<br />
&nbsp; &nbsp; &nbsp; ax1#=Snake\ax<br />
&nbsp; &nbsp; &nbsp; ay1#=Snake\ay<br />
&nbsp; &nbsp; &nbsp; az1#=Snake\az<br />
&nbsp; &nbsp; &nbsp; Snake\x=x#<br />
&nbsp; &nbsp; &nbsp; Snake\y=y#<br />
&nbsp; &nbsp; &nbsp; Snake\z=z#<br />
&nbsp; &nbsp; &nbsp; Snake\ax=ax#<br />
&nbsp; &nbsp; &nbsp; Snake\ay=ay#<br />
&nbsp; &nbsp; &nbsp; Snake\az=az#<br />
&nbsp; &nbsp; &nbsp; x#=x1#<br />
&nbsp; &nbsp; &nbsp; y#=y1#<br />
&nbsp; &nbsp; &nbsp; z#=z1#<br />
&nbsp; &nbsp; &nbsp; ax#=ax1#<br />
&nbsp; &nbsp; &nbsp; ay#=ay1#<br />
&nbsp; &nbsp; &nbsp; az#=az1#<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,t%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\mt%=t%<br />
&nbsp;SnakeManager\t%=<span style="color: #33ffdd;">0</span><br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;SnakeManager\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;Snake\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> s%=SnakeManager\s%<br />
&nbsp; x#=SnakeManager\x#<br />
&nbsp; y#=SnakeManager\y#<br />
&nbsp; z#=SnakeManager\z#<br />
&nbsp; ax#=SnakeManager\ax#<br />
&nbsp; ay#=SnakeManager\ay#<br />
&nbsp; az#=SnakeManager\az#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; Snake\id%=id%<br />
&nbsp; Snake\x#=x#<br />
&nbsp; Snake\y#=y#<br />
&nbsp; Snake\z#=z#<br />
&nbsp; Snake\ax#=ax#<br />
&nbsp; Snake\ay#=ay#<br />
&nbsp; Snake\az#=az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h%,Snake\x#,Snake\y#,Snake\z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> Snake\h%,Snake\ax#,Snake\ay#,Snake\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.95.D0.94.D0.90"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D1%83%D1%82%D0%BE%D1%80%D0%B8%D0%B0%D0%BB_%C2%AB%D0%97%D0%BC%D0%B5%D0%B9%D0%BA%D0%B0%C2%BB&amp;action=edit&amp;section=5" title="Туториал «Змейка»">править</a>]</span> <span class="mw-headline">ЕДА</span></h2>
<p>Научим нашу змею есть и покажем что в этом мире бывают еще препятствия, которые кусать нежелательно...
</p><p>Нам нужно как-то представить весь игровой мир... В простых случаях (как наш) его представляют массивом (в сложном случае - базой данных)... Представим его трехмерным массивом map, в котором первое измерение - координаты по X, второе измерение - координаты по Y и третье измерение - типы объектов (0 - код объекта, 1 хендл объекта)... Третье измерение нужно нам для хранения кода препятствия, у нас ведь будут различные типы препятствий (стена и еда), ну и чтобы в любом случае можно было что-нибудь с объектом (препятствием) сделать, а не искать его и не заводить кучу дополнительный переменных, тоже нужно поле массива.
</p><p>НЕ советую юзать проверку на столкновения объектов, поскольку на проверку этого уйдет наааамного больше компьютерного времени, по сравнению с проверкой на наличие элемента в массиве по нужным координатам...
</p><p>Значит так: создание мира:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Dim</span> Map%<span style=" ">&#40;</span><span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span></div>
<p>Мир создан (богом быть все-таки легко), идем далее... Добавим несколько препятствий:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">10</span><br />
<p>&nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t%,i*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">1</span>,i*<span style="color: #33ffdd;">10</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> t%,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">5</span><br />
&nbsp;Map<span style=" ">&#40;</span>i,i,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
&nbsp;Map<span style=" ">&#40;</span>i,i,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=t%<br />
</p>
<span style="color: #aaffff; font-weight: bold;">Next</span></div>
<p>Для препятствий будет код "1", его и надо записать в нулевой индекс третьего измерения массива, в первый индекс запишем сам хендл, в случае если нам придется убрать препятствие или анимацию запускать надо будет, да мало ли чего... Покажем нашей змее, что в этом мире не только она одна бывает .
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<p>&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span><br />
</p>
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>Думаю тут объяснять много не надо... Просто берем координату головы змеи и проверяем есть ли по "кратным" координатам в массиве стена (код 1). В коде условие двойное...  Объясняется это отсутствием функции округления... На самом деле, функция int() не округляет, а отбрасывает все, что после запятой, и получается, что если у нас змея находится по Х координате примерно на 4.5, то физически будет отображено так, что половина головы будет уже в следующей клетке, а результат вычисления будет показывать, что она еще полностью в предыдущей... Для избегания таких случаев делается коррекция. Заключается она в дополнительной проверке других координат (как бы координат объекта, расположенного немножко в другом месте)...
</p><p>Покажем змее, что мир не безграничный, а что это всего лишь карта 14 на 14 клеток
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&lt;<span style="color: #33ffdd;">-3</span> <span style="color: #aaffff; font-weight: bold;">Or</span> SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">143</span> <span style="color: #aaffff; font-weight: bold;">Or</span> SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&lt;<span style="color: #33ffdd;">-3</span> <span style="color: #aaffff; font-weight: bold;">Or</span> SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">143</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
<p><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
</p>
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>Здесь вообще все просто... проверяем "выход" координат змеи за границы карты если да, то выходим...
</p><p>Теперь змея уже что-то видит... Займемся едой: заведем переменную FoodT% которая будет определять есть ли еда на поле, создавать второй кусок еды, если нет, и будет служить задержкой... т.е. чтоб еда не появлялась сразу, как ее только съели (так не интересно играть), а чтоб появлялась немного позже...
</p><p>Теперь идем в главный цикл и пишем код создания куска еды:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">; ----- Create a Food --------------------------------------------</span><br />
<p><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> FoodT%&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> FoodT%=FoodT%<span style="color: #33ffdd;">-1</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> FoodT%=<span style="color: #33ffdd;">0</span> <br />
<br />
&nbsp; FoodX%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; FoodZ%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;FoodX%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;FoodZ%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
&nbsp; map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityColor</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">50</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,FoodX%*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">2</span>,FoodZ%*<span style="color: #33ffdd;">10</span><br />
<br />
&nbsp; map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">2</span><br />
<br />
&nbsp; FoodT%=<span style="color: #33ffdd;">-1</span> <br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
</p>
<span style="color: #ffee00">; ----------------------------------------------------------------</span></div>
<p>Смотрим: если FoodT% больше нуля, значит еда съедена и запущен таймер, по истечении времени которого надо создать еду... Уменьшаем таймер на единицу... Если FoodT равно нулю, то или истекло время или только зашли в игру... Приступаем к созданию куска еды: делаем случайные координаты и запускаем цикл генерации новых координат, пока по этим координатам не будет пустота в массиве map, чтобы кусок еды нечаянно не создался в стене (как его потом оттудова выгрызать?)... Цикл будет крутиться, пока не будут найдены координаты пустой ячейки массива, значит, на выходе у нас будут координаты в которых можно создавать еду...
</p><p>Создаем объект еды CreateSphere(), красим его в красный цвет, скалим, позиционируем где надо, и записываем в массив map код еды "2" и сам хендл объекта тоже сохраняем, это для того, чтобы при съедании еды объект можно было удалить...
</p><p>И не забываем FoodT% поставить в такое состояние, чтобы эта процедура не вызвалась второй раз и чтоб не отмерялось время... Если мы здесь присвоим что-нибудь положительное, то автоматически запустим таймер и еда будет создаваться независимо от того, съели ли предыдущую...
</p><p>Приступаем к поеданию еды:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Or</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<p><br />
&nbsp; &nbsp;FoodT%=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">300</span><span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">FreeEntity</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
<br />
&nbsp; &nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1.5</span>*j1#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>*j1#<span style=" ">&#41;</span><span style="color: #33ffdd;">-0.2</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;SnakeAddSegment<span style=" ">&#40;</span>a%,t%<span style=" ">&#41;</span><br />
&nbsp; &nbsp;j1#=j1#<span style="color: #33ffdd;">-0.05</span><br />
<br />
</p>
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>По принципу проверки на коллизию со стенкой, проверяем на коллизию с едой... Если true, то приступаем к поеданию... Для начала, запустим таймер еды, поскольку эта будет съедена и надо будет создавать другую... Затем удаляем с поля объект еды (FreeEntity), хендл еды хранится в соответствующей ячейке массива map... Так, еду удалили, теоретически она должна быть в животе у змеи и змея должна от этого вырасти - реализуем это на практике путем создания дополнительного сегмента... Тут все просто: создаем сферу, скалим ее, позиционируем, и вызываем функцию добавления.
</p><p>Кстати про функцию добавления... Ее пришлось маленько переписать... В прошлом мы брали позицию головы и создавали в ней очередной сегмент... Теперь нам надо создавать новый сегмент в хвосте, иначе видно мигание куска хвоста в голове... Новая процедура выглядит следующим образом:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;s%=SnakeManager\s%<br />
&nbsp; &nbsp;SnakeManager\c%=SnakeManager\c%<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; &nbsp; x#=Snake\x#<br />
&nbsp; &nbsp; y#=Snake\y#<br />
&nbsp; &nbsp; z#=Snake\z#<br />
&nbsp; &nbsp; ax#=Snake\ax#<br />
&nbsp; &nbsp; ay#=Snake\ay#<br />
&nbsp; &nbsp; az#=Snake\az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; &nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; &nbsp; Snake\id%=id%<br />
&nbsp; &nbsp; Snake\x#=x#<br />
&nbsp; &nbsp; Snake\y#=y#<br />
&nbsp; &nbsp; Snake\z#=z#<br />
&nbsp; &nbsp; Snake\ax#=ax#<br />
&nbsp; &nbsp; Snake\ay#=ay#<br />
&nbsp; &nbsp; Snake\az#=az#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Здесь мы, в случае нахождения куска от нужной змеи, сохраняем координаты... В конце цикла переменные, куда мы сохраняли координаты, будут содержать координаты последнего элемента (не забываем и про углы)... Теперь мы при создании очередных резервных хранилищ и сегмента оперируем координатами предыдущего...
</p><p>Ну вот вроде бы и все... Теперь змея умеет есть, видеть препятствия и ей запрещено выходить за границы карты...
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sn<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> h%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> snm<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> id%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> t%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> mt%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> c%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> s%<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> y#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> z#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ax#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> ay#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> az#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">16</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #ffee00">;Graphics3D 1024,768,16,1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">SeedRnd</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">75</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,<span style="color: #33ffdd;">60</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> Map%<span style=" ">&#40;</span><span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">15</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">15</span><br />
&nbsp; t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span> <span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t%,i*<span style="color: #33ffdd;">10</span><span style="color: #33ffdd;">-5</span>,<span style="color: #33ffdd;">0</span>,j*<span style="color: #33ffdd;">10</span><span style="color: #33ffdd;">-5</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">0.5</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">14</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">14</span><br />
&nbsp; map<span style=" ">&#40;</span>i,j,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp; map<span style=" ">&#40;</span>i,j,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">10</span><br />
&nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t%,i*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">1</span>,i*<span style="color: #33ffdd;">10</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> t%,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">5</span><br />
&nbsp;Map<span style=" ">&#40;</span>i,i,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
&nbsp;Map<span style=" ">&#40;</span>i,i,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=t%<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
<br />
t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.3</span>,<span style="color: #33ffdd;">1.8</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<br />
t1%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t1%,<span style="color: #33ffdd;">-0.5</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t1%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t1%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
t2%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,t%<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t2%,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1.2</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t2%,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span>,<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t2%,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">30</span><br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> t%,<span style="color: #33ffdd;">2.5</span>,<span style="color: #33ffdd;">2.5</span>,<span style="color: #33ffdd;">2.5</span><br />
<br />
<br />
<br />
a%=SnakeCreate<span style=" ">&#40;</span>t%,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
j1#=<span style="color: #33ffdd;">2.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1.5</span>*j1#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>*j1#<span style=" ">&#41;</span><span style="color: #33ffdd;">-0.2</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp;SnakeAddSegment<span style=" ">&#40;</span>a%,t%<span style=" ">&#41;</span><br />
&nbsp;j1#=j1#<span style="color: #33ffdd;">-0.01</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
<br />
time%=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;Direction%=<span style="color: #33ffdd;">0</span><br />
<br />
SnakeSetSpeed<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<br />
<br />
FoodT%=<span style="color: #33ffdd;">0</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
<span style="color: #ffee00">; ----- Create a Food --------------------------------------------</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> FoodT%&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> FoodT%=FoodT%<span style="color: #33ffdd;">-1</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> FoodT%=<span style="color: #33ffdd;">0</span> <br />
<br />
&nbsp; FoodX%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; FoodZ%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;FoodX%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;FoodZ%=<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
&nbsp; map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityColor</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">50</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,FoodX%*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">2</span>,FoodZ%*<span style="color: #33ffdd;">10</span><br />
<br />
&nbsp; map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">2</span><br />
<br />
&nbsp; FoodT%=<span style="color: #33ffdd;">-1</span> <br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #ffee00">; ----------------------------------------------------------------</span><br />
<br />
<br />
<br />
<span style="color: #ffee00">; ----- Eat a Food -----------------------------------------------</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Or</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<br />
&nbsp; &nbsp;FoodT%=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">300</span><span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">FreeEntity</span> map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;map<span style=" ">&#40;</span>FoodX%,FoodZ%,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1.5</span>*j1#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>*j1#<span style=" ">&#41;</span><span style="color: #33ffdd;">-0.2</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;SnakeAddSegment<span style=" ">&#40;</span>a%,t%<span style=" ">&#41;</span><br />
&nbsp; &nbsp;j1#=j1#<span style="color: #33ffdd;">-0.05</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #ffee00">; ----------------------------------------------------------------</span><br />
<br />
<br />
<span style="color: #ffee00">; ----- Check Collisions -----------------------------------------</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">14</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">14</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> map<span style=" ">&#40;</span>i,j,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span> map<span style=" ">&#40;</span>i,j,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> SnakeSegmentCount<span style=" ">&#40;</span>a<span style=" ">&#41;</span><br />
&nbsp; &nbsp;t%=SnakeGetSegment<span style=" ">&#40;</span>a,i<span style=" ">&#41;</span><br />
&nbsp; &nbsp;map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>t%<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>t%<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> map<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style="color: #33ffdd;">+9</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #ffee00">; ----------------------------------------------------------------</span><br />
<br />
<span style="color: #ffee00">; ----- Check outside --------------------------------------------</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&lt;<span style="color: #33ffdd;">-3</span> <span style="color: #aaffff; font-weight: bold;">Or</span> SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">143</span> <span style="color: #aaffff; font-weight: bold;">Or</span> SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&lt;<span style="color: #33ffdd;">-3</span> <span style="color: #aaffff; font-weight: bold;">Or</span> SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">143</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<br />
<span style="color: #ffee00">; ----------------------------------------------------------------</span><br />
<br />
<br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> Direction%=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span> SnakeMove<span style=" ">&#40;</span>a,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
&nbsp;speed#=<span style="color: #33ffdd;">0.7</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span> <span style=" ">&#40;</span><span style="color: #33ffdd;">16</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; t%=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityColor</span> t%,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">30</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t%,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1</span>*j1#,<span style="color: #33ffdd;">1.5</span>*j1#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionMesh</span> t%,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>*j1#<span style=" ">&#41;</span><span style="color: #33ffdd;">-0.2</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; SnakeAddSegment<span style=" ">&#40;</span>a%,t%<span style=" ">&#41;</span><br />
&nbsp; j1#=j1#<span style="color: #33ffdd;">-0.03</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span>,SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">2</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">180</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">180</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span>,SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">90</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp;Direction%=<span style="color: #33ffdd;">3</span> &nbsp; <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetAngleY<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">270</span><br />
&nbsp; &nbsp; SnakeSetAngle<span style=" ">&#40;</span>a,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">270</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; SnakePosition <span style=" ">&#40;</span>a,SnakeGetX<span style=" ">&#40;</span>a<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>SnakeGetZ<span style=" ">&#40;</span>a<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<br />
<br />
&nbsp;SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-time&lt;=<span style="color: #33ffdd;">16</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSegmentCount%<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\c%<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetSegment%<span style=" ">&#40;</span>id%,count%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">And</span> Snake\h%&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;count%=count%<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> count%=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> Snake\h%<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakePosition<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\x#=x#<br />
&nbsp; &nbsp;SnakeManager\y#=y#<br />
&nbsp; &nbsp;SnakeManager\z#=z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetX<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\x#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetZ<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\z#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetY<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\y#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleX#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\ax#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleY#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\ay#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeGetAngleZ#<span style=" ">&#40;</span>id%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> SnakeManager\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetSpeed<span style=" ">&#40;</span>id%,t%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\mt%=t%<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeSetAngle<span style=" ">&#40;</span>id%,ax#,ay#,az#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\ax#=ax#<br />
&nbsp; &nbsp;SnakeManager\ay#=ay#<br />
&nbsp; &nbsp;SnakeManager\az#=az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeMove<span style=" ">&#40;</span>id%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;SnakeManager\t%=SnakeManager\t%<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> SnakeManager\t%&lt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; SnakeManager\t%=SnakeManager\mt%<br />
&nbsp; &nbsp; SnakeManager\x#=SnakeManager\x#+x#<br />
&nbsp; &nbsp; SnakeManager\y#=SnakeManager\y#+y#<br />
&nbsp; &nbsp; SnakeManager\z#=SnakeManager\z#+z#<br />
&nbsp; &nbsp; x#=SnakeManager\x#<br />
&nbsp; &nbsp; y#=SnakeManager\y#<br />
&nbsp; &nbsp; z#=SnakeManager\z#<br />
&nbsp; &nbsp; ax#=SnakeManager\ax#<br />
&nbsp; &nbsp; ay#=SnakeManager\ay#<br />
&nbsp; &nbsp; az#=SnakeManager\az#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> id%=Snake\id% <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; x1#=Snake\x<br />
&nbsp; &nbsp; &nbsp; y1#=Snake\y<br />
&nbsp; &nbsp; &nbsp; z1#=Snake\z<br />
&nbsp; &nbsp; &nbsp; ax1#=Snake\ax<br />
&nbsp; &nbsp; &nbsp; ay1#=Snake\ay<br />
&nbsp; &nbsp; &nbsp; az1#=Snake\az<br />
&nbsp; &nbsp; &nbsp; Snake\x=x#<br />
&nbsp; &nbsp; &nbsp; Snake\y=y#<br />
&nbsp; &nbsp; &nbsp; Snake\z=z#<br />
&nbsp; &nbsp; &nbsp; Snake\ax=ax#<br />
&nbsp; &nbsp; &nbsp; Snake\ay=ay#<br />
&nbsp; &nbsp; &nbsp; Snake\az=az#<br />
&nbsp; &nbsp; &nbsp; x#=x1#<br />
&nbsp; &nbsp; &nbsp; y#=y1#<br />
&nbsp; &nbsp; &nbsp; z#=z1#<br />
&nbsp; &nbsp; &nbsp; ax#=ax1#<br />
&nbsp; &nbsp; &nbsp; ay#=ay1#<br />
&nbsp; &nbsp; &nbsp; az#=az1#<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeCreate%<span style=" ">&#40;</span>h%,t%,s%,x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp;id%=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; id%=id%<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;SnakeManager.snm=<span style="color: #aaffff; font-weight: bold;">New</span> snm<br />
&nbsp;SnakeManager\id%=id%<br />
&nbsp;SnakeManager\mt%=t%<br />
&nbsp;SnakeManager\t%=<span style="color: #33ffdd;">0</span><br />
&nbsp;SnakeManager\s%=s%<br />
&nbsp;SnakeManager\c%=<span style="color: #33ffdd;">1</span><br />
&nbsp;SnakeManager\x#=x#<br />
&nbsp;SnakeManager\y#=y#<br />
&nbsp;SnakeManager\z#=z#<br />
&nbsp;SnakeManager\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;SnakeManager\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake.sn=<span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp;Snake\id%=id%<br />
&nbsp;Snake\h%=h%<br />
&nbsp;Snake\x#=x#<br />
&nbsp;Snake\y#=y#<br />
&nbsp;Snake\z#=z#<br />
&nbsp;Snake\ax#=<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\ay#=<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;Snake\az#=<span style="color: #aaffff; font-weight: bold;">EntityRoll</span><span style=" ">&#40;</span>h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span> id%<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeAddSegment<span style=" ">&#40;</span>id%,h%<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> SnakeManager.snm = <span style="color: #aaffff; font-weight: bold;">Each</span> snm<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> id%=SnakeManager\id% <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;s%=SnakeManager\s%<br />
&nbsp; &nbsp;SnakeManager\c%=SnakeManager\c%<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn=<span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; &nbsp; x#=Snake\x#<br />
&nbsp; &nbsp; y#=Snake\y#<br />
&nbsp; &nbsp; z#=Snake\z#<br />
&nbsp; &nbsp; ax#=Snake\ax#<br />
&nbsp; &nbsp; ay#=Snake\ay#<br />
&nbsp; &nbsp; az#=Snake\az#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> s<br />
&nbsp; &nbsp; Snake.sn = <span style="color: #aaffff; font-weight: bold;">New</span> sn<br />
&nbsp; &nbsp; Snake\id%=id%<br />
&nbsp; &nbsp; Snake\x#=x#<br />
&nbsp; &nbsp; Snake\y#=y#<br />
&nbsp; &nbsp; Snake\z#=z#<br />
&nbsp; &nbsp; Snake\ax#=ax#<br />
&nbsp; &nbsp; Snake\ay#=ay#<br />
&nbsp; &nbsp; Snake\az#=az#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> i=s <span style="color: #aaffff; font-weight: bold;">Then</span> Snake\h%=h% <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Return</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SnakeUpdate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> Snake.sn = <span style="color: #aaffff; font-weight: bold;">Each</span> sn<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> Snake\h&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Snake\h%,Snake\x#,Snake\y#,Snake\z#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> Snake\h%,Snake\ax#,Snake\ay#,Snake\az#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/b/b5/Snake.zip" class="internal" title="Snake.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:SubZer0" title="Участник:SubZer0">SubZer0</a> (e-mail: SubZer0@boolean.name)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Blitz доберется до вас!"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Blitz доберется до вас!&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Blitz доберется до вас!&amp;action=edit">править</a>]</span><span class="mw-headline">Blitz доберется до вас!</span></h1>
</p>
<p align="right">(если вы не остережетесь…)</p>
<p>Гарольд был заядлым программистом, пока учился в школе. Но, поступив в колледж, он большую часть своего досуга стал проводить в компании девушек или играл в гольф. После женитьбы на Хелен и покупки дома в нем вновь проснулся интерес к программированию. Поначалу все было хорошо. Но постепенно с ним начало происходить нечто непонятное. У него появился странный блуждающий взгляд. Редко читал что-либо, кроме компьютерных журналов. Его любимые палки для гольфа покрылись густым слоем пыли. Когда-то блестящий собеседник, Гарольд превратился в совершенного идиота в компании друзей. Хелен и он все реже стали принимать гостей, а когда они приходили, хозяин дома старался незаметно исчезнуть, ничего не объяснив. Дела на работе складывались также не блестяще. Несколько раз его обошли при очередных продвижениях. А когда он заснул на очень важной деловой встрече, президент вызвал его и объявил строгий выговор. Хелен была в отчаянии. В конце концов, ей удалось убедить Гарольда обратиться к психиатру. Он согласился и на следующее утро пригласил врача, знакомого программиста, которого знал со времен QBasic'а.
</p>
<ul><li> Прилягте на диван, друг мой, - сказал доктор, - попробуйте объяснить причину Вашего недомогания.
</li><li> Я пишу игру, - сказал Гарольд. - Это дело сильно закрутило мне мозги. Хотел закончить на реальной физике, потом решил сделать библиотеку теней, да так и пошло. Теперь я полагаю, буду первым кто написал свою игру на Blitz3D.
</li><li> Почему бы Вам не попробовать C++, Delphi или Assembler, - предложил доктор. - Blitz3D - это игра, наслаждаясь которой, Вы не должны пренебрегать семьей и работой. Как насчет  машинных кодов?
</li></ul>
<p>Гарольд всхлипнул:
</p>
<ul><li> Я уже пробовал это все. И вот, когда дело пошло на лад, сегодня утром вдруг произошло нечто, из-за чего я снова не пошел на работу.
</li><li> Что же случилось?
</li><li> В Интернете я скачал новую версию Blitz3D.
</li><li> Новую версию?!!! На каком сайте?
</li><li> www.blitz3d.com …… Куда вы доктор?!
</li></ul>
<p>Но доктор был уже на выходе из комнаты.
</p>
<ul><li> Как-нибудь забегу, -  крикнул он, открывая наружную дверь. - Срочное дело дома...
</li></ul>
<hr />
<p>Автор: L.D.M.T. (e-mail: myblitz3d@yandex.ru)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Конкурс! (выпуск 6)"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Конкурс! (выпуск 6)&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Конкурс! (выпуск 6)&amp;action=edit">править</a>]</span><span class="mw-headline">Конкурс! (выпуск 6)</span></h1>
<p>Предлагаю вам попробовать свои силы в решении нескольких интересных, на мой взгляд, задач. К каждой прилагается шаблон, вбив его в редактор, вы можете сразу приступить к решению, не отвлекаясь на оформление. Планирую провести конкурс совместно с участниками форума www.blitzbasic.com. Присланные решения будут опубликованы в следующем выпуске, а лучшие (определится голосованием) войдут в архив кода официального сайта www.blitzbasic.com. Срок окончания конкурса - 31 марта.
</p>
</p>
<a name=".D0.92.D1.8B.D0.BF.D1.83.D1.81.D0.BA.D0.B0.D0.B5.D0.BC_.D0.BA.D0.BE.D0.BB.D1.8E.D1.87.D0.BA.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BD%D0%BA%D1%83%D1%80%D1%81%21_%28%D0%B2%D1%8B%D0%BF%D1%83%D1%81%D0%BA_6%29&amp;action=edit&amp;section=1" title="Конкурс! (выпуск 6)">править</a>]</span> <span class="mw-headline">Выпускаем колючки</span></h2>
<p>Дана произвольная модель (mesh). Цель - утыкать ее колючками, добавив вершины, грани, возможно, изменив координаты существующих вершин.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span><br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> sphere_segments = <span style="color: #33ffdd;">8</span>, segments = <span style="color: #33ffdd;">48</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span>, <span style="color: #33ffdd;">0</span>, <span style="color: #33ffdd;">0</span>, <span style="color: #33ffdd;">-10</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>, <span style="color: #33ffdd;">45</span>, <span style="color: #33ffdd;">45</span>, <span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span>sphere_segments<span style=" ">&#41;</span>, <span style="color: #33ffdd;">-6</span>, <span style="color: #33ffdd;">4</span>, <span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Make_Spiky<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span>sphere_segments<span style=" ">&#41;</span><span style=" ">&#41;</span>, <span style="color: #33ffdd;">-2</span>, <span style="color: #33ffdd;">4</span>, <span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span>, <span style="color: #33ffdd;">2</span>, <span style="color: #33ffdd;">4</span>, <span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Make_Spiky<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span>, <span style="color: #33ffdd;">6</span>, <span style="color: #33ffdd;">4</span>, <span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateCone</span><span style=" ">&#40;</span>segments<span style=" ">&#41;</span>, <span style="color: #33ffdd;">-6</span>, <span style="color: #33ffdd;">0</span>, <span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Make_Spiky<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">CreateCone</span><span style=" ">&#40;</span>segments<span style=" ">&#41;</span><span style=" ">&#41;</span>, <span style="color: #33ffdd;">-2</span>, <span style="color: #33ffdd;">0</span>, <span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateCylinder</span><span style=" ">&#40;</span>segments<span style=" ">&#41;</span>, <span style="color: #33ffdd;">2</span>, <span style="color: #33ffdd;">0</span>, <span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Make_Spiky<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">CreateCylinder</span><span style=" ">&#40;</span>segments<span style=" ">&#41;</span><span style=" ">&#41;</span>, <span style="color: #33ffdd;">6</span>, <span style="color: #33ffdd;">0</span>, <span style="color: #33ffdd;">0</span><br />
<br />
mesh=<span style="color: #aaffff; font-weight: bold;">LoadMesh</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;C:\Program Files\Blitz3D\samples\teapot\teapot.x&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> mesh <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> mesh, <span style="color: #33ffdd;">-6</span>, <span style="color: #33ffdd;">-4</span>, <span style="color: #33ffdd;">0</span> <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Make_Spiky<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">CopyMesh</span><span style=" ">&#40;</span>mesh<span style=" ">&#41;</span><span style=" ">&#41;</span>, <span style="color: #33ffdd;">-2</span>, <span style="color: #33ffdd;">-4</span>, <span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
mesh=<span style="color: #aaffff; font-weight: bold;">LoadMesh</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;C:\Program Files\Blitz3D\samples\anim\makbot\mak_robotic.3DS&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> mesh <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> mesh, <span style="color: #33ffdd;">0.1</span>, <span style="color: #33ffdd;">0.1</span>, <span style="color: #33ffdd;">0.1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionMesh</span> mesh, <span style="color: #33ffdd;">0</span>, <span style="color: #33ffdd;">-2</span>, <span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> mesh, <span style="color: #33ffdd;">2</span>, <span style="color: #33ffdd;">-4</span>, <span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Make_Spiky<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">CopyMesh</span><span style=" ">&#40;</span>mesh<span style=" ">&#41;</span><span style=" ">&#41;</span>, <span style="color: #33ffdd;">6</span>, <span style="color: #33ffdd;">-4</span>, <span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">WaitKey</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> make_spiky<span style=" ">&#40;</span>mesh<span style=" ">&#41;</span><br />
<span style="color: #ffee00">; Разместите здесь код функции</span><br />
<span style="color: #aaffff; font-weight: bold;">UpdateNormals</span> mesh<br />
<span style="color: #aaffff; font-weight: bold;">Return</span> mesh<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.A1.D1.83.D0.B4.D0.BE.D0.BA.D1.83"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BD%D0%BA%D1%83%D1%80%D1%81%21_%28%D0%B2%D1%8B%D0%BF%D1%83%D1%81%D0%BA_6%29&amp;action=edit&amp;section=2" title="Конкурс! (выпуск 6)">править</a>]</span> <span class="mw-headline">Судоку</span></h2>
<p>Создайте алгоритм для решения головоломки <a href="http://www.sudoku.name/rules/ru" class="external text" title="http://www.sudoku.name/rules/ru" rel="nofollow">Судоку</a>. Шаблон содержит три примера, различающихся по уровню сложности алгоритма, необходимого для решения.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> q$<span style=" ">&#91;</span><span style="color: #33ffdd;">9</span>,<span style="color: #33ffdd;">9</span><span style=" ">&#93;</span><br />
<p><br />
' Загрузка головоломки<br />
RestoreData level_3<br />
<span style="color: #aaffff; font-weight: bold;">For</span> n1=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">8</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; ReadData v$<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> n2=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">8</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; q$<span style=" ">&#91;</span>n1,n2<span style=" ">&#93;</span>=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>v$,n2<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
' Место для главного цикла<br />
<br />
'Вывод результатов решения<br />
<span style="color: #aaffff; font-weight: bold;">For</span> n1=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">8</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>n1 <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">3</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> n1&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;-----------&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; m$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> n2=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">8</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m$=m$+q$<span style=" ">&#91;</span>n1,n2<span style=" ">&#93;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>n2 <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">3</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">And</span> n2&lt;<span style="color: #33ffdd;">8</span> <span style="color: #aaffff; font-weight: bold;">Then</span> m$=m$+<span style="color: #00ff66;">&quot;|&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Print</span> m$<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
&nbsp;#level_1<br />
DefData <span style="color: #00ff66;">&quot;.6.3.7.1.&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;1.4.8..6.&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;9...5.7.2&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;2.1.3...8&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;..61..5..&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;8..96.1.4&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;3.8.1...6&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;.2..7.4.1&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;.1.4.6.8.&quot;</span><br />
<br />
&nbsp;#level_2<br />
DefData <span style="color: #00ff66;">&quot;..7.4..8.&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;..82....4&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;.1.7..26.&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;3...86.7.&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;4...9...3&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;.6.5....1&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;.45..2.3.&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;8....45..&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;.2..7.4..&quot;</span><br />
<br />
&nbsp;#level_3<br />
DefData <span style="color: #00ff66;">&quot;.47..1.9.&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;......6..&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;2..9.3.7.&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;9.84..31.&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;..5.2.4..&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;.23..89.5&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;.5.1.7..6&quot;</span><br />
DefData <span style="color: #00ff66;">&quot;..2......&quot;</span><br />
</p>
DefData <span style="color: #00ff66;">&quot;.9.5..74.&quot;</span></div>
<a name=".D0.A1.D0.BB.D1.83.D1.87.D0.B0.D0.B9.D0.BD.D0.BE.D0.B5_.D1.87.D0.B8.D1.81.D0.BB.D0.BE.2C_.D0.BA.D1.80.D0.BE.D0.BC.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BD%D0%BA%D1%83%D1%80%D1%81%21_%28%D0%B2%D1%8B%D0%BF%D1%83%D1%81%D0%BA_6%29&amp;action=edit&amp;section=3" title="Конкурс! (выпуск 6)">править</a>]</span> <span class="mw-headline">Случайное число, кроме</span></h2>
<p>Напишите функцию, возвращающее случайное число из заданного диапазона, кроме указанного. Разрешается писать код только после команды Return, т. е. изменять возвращаемое значение.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">For</span> n = <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">19</span><br />
<p>&nbsp;res1$ = res1$ + RandExcept<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>, <span style="color: #33ffdd;">5</span>, <span style="color: #33ffdd;">5</span><span style=" ">&#41;</span> + <span style="color: #00ff66;">&quot;, &quot;</span><br />
&nbsp;res2$ = res2$ + RandExcept<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>, <span style="color: #33ffdd;">5</span>, <span style="color: #33ffdd;">3</span><span style=" ">&#41;</span> + <span style="color: #00ff66;">&quot;, &quot;</span><br />
&nbsp;res3$ = res3$ + RandExcept<span style=" ">&#40;</span><span style="color: #33ffdd;">-3</span>, <span style="color: #33ffdd;">2</span>, <span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span> + <span style="color: #00ff66;">&quot;, &quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Test 1, from 0 to 5 except 5: &quot;</span> + res1$<br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Test 2, from 0 to 5 except 3: &quot;</span> + res2$<br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Test 3, from -3 to 2 except -1: &quot;</span> + res3$<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> RandExcept<span style=" ">&#40;</span>v1, v2, ev<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> ' Напишите здесь свой код<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p></td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="В следующем выпуске (выпуск 6)"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:В следующем выпуске (выпуск 6)&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=В следующем выпуске (выпуск 6)&amp;action=edit">править</a>]</span><span class="mw-headline">В следующем выпуске (выпуск 6)</span></h1>
<p>Я планирую написать продолжение к статье о двумерном движке, где мы будем улучшать "Зверских колобков" и приступим к созданию аркады с видом сбоку, парочку "Галерей", статьи о "мощной" генерации тайлов, форматировании программы и графических форматах, дополнить статьи "Отладка программы" и "Скорость команд в Blitz", сделать на сайте раздел "вопрос-ответ" и расширить "сборник программ". Пока все. До новых встреч! И если что - стучитесь в ICQ.
</p>
</p>
<p align="right">
редактор журнала Матвей Меркулов (MattMerk@mail.ru, ICQ: 392-274-050)
</p>
<p><!-- 
Pre-expand include size: 227106 bytes
Post-expand include size: 159060 bytes
Template argument size: 231 bytes
Maximum: 2097152 bytes
-->
</p>
<!-- Saved in parser cache with key db1:pcache:idhash:659-0!1!0!!ru!2 and timestamp 20071112103711 -->
<div class="printfooter">
Получено с <a href="pr41s0zv.html">http://blitzetcetera.org/index.php/%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%966_-_%D0%BC%D0%B0%D1%80%D1%82_2007</a></div>
			<!-- end content -->			<div class="visualClear"></div>				</td>				<td class="rightside">				</td>			</tr>		</table>		</div>	</div>		</div>	
		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</div></body>
<!-- Mirrored from localhost/index.php/%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%966_-_%D0%BC%D0%B0%D1%80%D1%82_2007 by HTTrack Website Copier/3.x [XR&CO'2007], Mon, 12 Nov 2007 11:20:28 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>