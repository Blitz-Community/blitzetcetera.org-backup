<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru" dir="ltr">	
<!-- Mirrored from localhost/index.php/%D0%A2%D1%80%D1%83%D0%B4%D0%BD%D0%BE%D1%81%D1%82%D0%B8_%D0%BF%D0%B5%D1%80%D0%B5%D0%B4%D0%B2%D0%B8%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B4%D0%B2%D0%B8%D0%B6%D0%BA%D0%BE%D0%B2) by HTTrack Website Copier/3.x [XR&CO'2007], Mon, 12 Nov 2007 11:20:44 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />				<meta name="keywords" content="Трудности передвижения (программирование движков),Avel" />
		<link rel="shortcut icon" href="http://blitzetcetera.org/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="http://blitzetcetera.org/opensearch_desc.php" title="Blitz Et Cetera (Русский)" />
		<title>Трудности передвижения (программирование движков) — Blitz Et Cetera</title>		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "bvih5rde.css?63"; /*]]>*/</style>		<link rel="stylesheet" type="text/css" media="print" href="gcxktlm6.css?63" />		<link rel="stylesheet" type="text/css" media="handheld" href="zumsslq_.css?63" />		<!--[if lt IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE50Fixes.css?63";</style><![endif]-->		<!--[if IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE55Fixes.css?63";</style><![endif]-->		<!--[if IE 6]><style type="text/css">@import "/skins/OfflineNew/IE60Fixes.css?63";</style><![endif]-->		<!--[if IE 7]><style type="text/css">@import "/skins/OfflineNew/IE70Fixes.css?63";</style><![endif]-->		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?63"></script>		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->		<script type= "text/javascript">/*<![CDATA[*/
var skin = "OfflineNew";
var stylepath = "/skins";
var wgArticlePath = "/index.php/$1";
var wgScriptPath = "";
var wgServer = "http://blitzetcetera.org/";
var wgCanonicalNamespace = "";
var wgCanonicalSpecialPageName = false;
var wgNamespaceNumber = 0;
var wgPageName = "Трудности_передвижения_(программирование_движков)";
var wgTitle = "Трудности передвижения (программирование движков)";
var wgAction = "view";
var wgArticleId = "1707";
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "ru";
var wgContentLanguage = "ru";
var wgBreakFrames = false;
var wgCurRevisionId = "3201";
/*]]>*/</script>
		<script type="text/javascript" src="2nq-6cel.js?63"><!-- wikibits js --></script>		<script type="text/javascript" src="http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=js"><!-- site js --></script>		<style type="text/css">/*<![CDATA[*/
@import "http://blitzetcetera.org/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=MediaWiki:OfflineNew.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=css&amp;maxage=18000";
/*]]>*/</style>		<!-- Head Scripts -->	</head><body  class="mediawiki ns-0 ltr page-Трудности_передвижения_программирование_движков">	<div id="globalWrapper">	<div id="logocontainer">		<table align="center">		  <tr>				<td id="blitzetclogo">				</td>			</tr>		</table>	</div>	<div id="magbar">	Журнал о программированнии на языках Blitz3D, BlitzMax, BlitzPlus	</div>		<div id="column-content">	<div id="content">		<a name="top" id="top"></a>				<div id="bodyContent">		<table cellspacing=0 cellpadding=0 width=100%>			<tr>			  <td class="leftside">				</td>				<td class="sheetbody">					<h1 class="sheet">Трудности передвижения (программирование движков)</h1>			<h3 id="siteSub">Материал из Blitz Et Cetera.</h3>			<div id="contentSub"></div>			<!-- start content -->			<p>Veni, vidi, vici. (лат. Пришел, увидел, победил.) собственно именно это и требуется от современного движка: возможность передвижения, возможность осмотра окружающего и боевая система. В разных игровых жанрах вышеописанные действия осуществляются по-разному. Рассмотрим несколько реализаций более подробно.
</p>
<table id="toc" class="toc" summary="Содержание"><tr><td><div id="toctitle"><h2>Содержание</h2></div>
<ul>
<li class="toclevel-1"><a href="#.D0.94.D0.B2.D0.B8.D0.B6.D0.BA.D0.B8_.D0.B4.D0.BB.D1.8F_3D_.D1.88.D1.83.D1.82.D0.B5.D1.80.D0.BE.D0.B2"><span class="tocnumber">1</span> <span class="toctext">Движки для 3D шутеров</span></a></li>
<li class="toclevel-1"><a href="#.D0.94.D0.B2.D0.B8.D0.B6.D0.BA.D0.B8_.D0.B4.D0.BB.D1.8F_RPG"><span class="tocnumber">2</span> <span class="toctext">Движки для RPG</span></a></li>
<li class="toclevel-1"><a href="#.D0.94.D0.B2.D0.B8.D0.B6.D0.BA.D0.B8_.D0.B4.D0.BB.D1.8F_.C2.AB.D0.BD.D0.B0.D1.81.D1.82.D0.BE.D0.BB.D1.8C.D0.BD.D1.8B.D1.85.C2.BB_.D0.B8.D0.B3.D1.80"><span class="tocnumber">3</span> <span class="toctext">Движки для «настольных» игр</span></a></li>
<li class="toclevel-1"><a href="#.D0.94.D0.B2.D0.B8.D0.B6.D0.BA.D0.B8_.D0.B4.D0.BB.D1.8F_.D1.81.D0.BF.D0.BE.D1.80.D1.82.D0.B8.D0.B2.D0.BD.D1.8B.D1.85_.D1.81.D0.B8.D0.BC.D1.83.D0.BB.D1.8F.D1.82.D0.BE.D1.80.D0.BE.D0.B2"><span class="tocnumber">4</span> <span class="toctext">Движки для спортивных симуляторов</span></a></li>
<li class="toclevel-1"><a href="#.D0.94.D0.B2.D0.B8.D0.B6.D0.BA.D0.B8_.D0.B4.D0.BB.D1.8F_RTS_.D0.B8_.D0.BF.D0.BE.D1.88.D0.B0.D0.B3.D0.BE.D0.B2.D1.8B.D1.85_.D1.81.D1.82.D1.80.D0.B0.D1.82.D0.B5.D0.B3.D0.B8.D0.B9"><span class="tocnumber">5</span> <span class="toctext">Движки для RTS и пошаговых стратегий</span></a></li>
</ul>
</td></tr></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "показать"; var tocHideText = "убрать"; showTocToggle(); } </script>
<a name=".D0.94.D0.B2.D0.B8.D0.B6.D0.BA.D0.B8_.D0.B4.D0.BB.D1.8F_3D_.D1.88.D1.83.D1.82.D0.B5.D1.80.D0.BE.D0.B2"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D1%80%D1%83%D0%B4%D0%BD%D0%BE%D1%81%D1%82%D0%B8_%D0%BF%D0%B5%D1%80%D0%B5%D0%B4%D0%B2%D0%B8%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_%28%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B4%D0%B2%D0%B8%D0%B6%D0%BA%D0%BE%D0%B2%29&amp;action=edit&amp;section=1" title="Править секцию: Движки для 3D шутеров">править</a>]</span> <span class="mw-headline">Движки для 3D шутеров</span></h2>
<p>Как обычно реализовано передвижение персонажа в игре? Обычно персонаж имеет возможность двигаться вперед, вправо, влево, назад, присесть, прыгнуть, двигаться ускоренно (замедленно), поворачиваться вокруг своей оси с помощью мыши. Камеры располагаются тоже по-разному: от первого лица, вид из-за плеча, и др. В современных играх так же популярны всякие необычные вещи типа переменной гравитации, замедленного времени и т. д. Такие вещи тоже необходимо учитывать в движке. Также необходима стабилизация через FPS, чтобы игры работали одинаково на разных машинах (иногда это называется дельта-таймингом). Попробуем реализовать все вышесказанное в простом движке, написанном на Blitz3D.
</p><p>Нам понадобятся три функции:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> CreatePlayer<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">0</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span> <span style="color: #ffee00">;создаем кибер-чувака в координатах: x, y, z. по умолчанию в 0,0,0</span><br />
<p>&nbsp; &nbsp; &nbsp; &nbsp; movepiv=<span style="color: #aaffff; font-weight: bold;">CreatePivot</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;создаем основной объект. это будет пивот</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> movepiv,x#,y#<span style="color: #33ffdd;">+5</span>,z# <span style="color: #ffee00">;позиционируем его</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EntityType</span> movepiv,playertype <span style="color: #ffee00">;присваиваем ему тип персонажа. это нужно для коллизии.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; vertpiv=<span style="color: #aaffff; font-weight: bold;">CreatePivot</span><span style=" ">&#40;</span>movepiv<span style=" ">&#41;</span> <span style="color: #ffee00">;создаем второй пивот, зависящий от первого.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;первый пивот будет отвечать за столкновения и поворот относительно оси У. </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;второй для поворота относительно Х.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> vertpiv,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2.3</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">;поднимаем его чуть выше первого</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>vertpiv<span style=" ">&#41;</span> <span style="color: #ffee00">;создаем камеру относительно второго пивота.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">;располагаем ее.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; camMode=<span style="color: #33ffdd;">1</span> <span style="color: #ffee00">;переменная отвечающая за режим расположения камеры.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> camera,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">150</span> <span style="color: #ffee00">;задаем цвет окружения через RGB.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;mic=CreateListener(camera,0.05,0.05,0.08)&nbsp;;необязательная строка. создает микрофон для 3D звука.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> playertype,poltype,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span> <span style="color: #ffee00">;задаем коллизию с типом поверхности по которой будем двигаться.</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> dvigok<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">59</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #ffee00">;меняем режим камеры по клавише F1. </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; camMode=camMode<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> camMode&gt;<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span> camMode=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Select</span> camMode<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span> <span style="color: #ffee00">;от первого лица.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0.5</span>,<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span> <span style="color: #ffee00">;ззади</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-8</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End Select</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">60</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> wLog=<span style="color: #aaffff; font-weight: bold;">Not</span> wLog <span style="color: #aaffff; font-weight: bold;">WireFrame</span> wLog <span style="color: #ffee00">;возможность просмотра в каркасном режиме по F2.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; mxs#=<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;снимаем скорость движения мыши по горизонтали</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; mys#=<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;и по вертикали.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span> <span style="color: #ffee00">;перемещаем курсор в центр экрана. </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;это нужно чтобы мышь не была ограничена экранной областью. </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> userTime=<span style="color: #33ffdd;">0</span> userTime=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;стабилизация FPS. начальное значение.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; newTime=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;стабилизация FPS. снимаем время.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; deltaT=newTime-userTime <span style="color: #ffee00">;стабилизация FPS. вычисляем задержку выполнения.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; userTime=newTime <span style="color: #ffee00">;стабилизация FPS. уравниваем значения для следующего витка цикла.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>s_key<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> speed#=<span style="color: #33ffdd;">0.1</span>*deltaT <span style="color: #aaffff; font-weight: bold;">Else</span> speed#=<span style="color: #33ffdd;">0.04</span>*deltaT <span style="color: #ffee00">;вычисляем скорость. ускоряемся.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>f_key<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> movepiv,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed# <span style="color: #ffee00">;движение вперед. &nbsp;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>b_key<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> movepiv,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed# <span style="color: #ffee00">;движение назад.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>l_key<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> movepiv,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">;движение влево.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>r_key<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> movepiv,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">;движение вправо</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>c_key<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #ffee00">;реализация приседания </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EntityRadius</span> movepiv,<span style="color: #33ffdd;">2.8</span>,<span style="color: #33ffdd;">3</span> <span style="color: #ffee00">;меняем радиус пивота.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; posSme#=<span style="color: #33ffdd;">0.1</span> <span style="color: #ffee00">;начальное смещение по вертикали.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EntityRadius</span> movepiv,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">4.5</span> <span style="color: #ffee00">;основной радиус объекта</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;в зависимости от гравитации смещаем основной пивот вверх или вниз. это необходимо для того, чтобы после</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;отпускания клавиши приседания мы не проваливались вниз.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> grav=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> movepiv,<span style="color: #aaffff; font-weight: bold;">EntityX</span>#<span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span>#<span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>-posSme#*deltaT,<span style="color: #aaffff; font-weight: bold;">EntityZ</span>#<span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> grav=<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> movepiv,<span style="color: #aaffff; font-weight: bold;">EntityX</span>#<span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span>#<span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>+posSme#*deltaT,<span style="color: #aaffff; font-weight: bold;">EntityZ</span>#<span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; posSme#=posSme#*<span style="color: #33ffdd;">0.75</span> <span style="color: #ffee00">;постепенно уменьшаем смещение, чтобы наш персонаж не улетал вверх.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">TurnEntity</span> movepiv,<span style="color: #33ffdd;">0</span>,-mxs#*deltaT*<span style="color: #33ffdd;">0.01</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">;поворачиваемся вправо и влево с помощью мыши.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">TurnEntity</span> vertpiv,mys#*MInvers*deltaT*<span style="color: #33ffdd;">0.01</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">;обзор по вертикали. переменная MInvers-для инверсии мыши. она = 1 или -1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; k#=.<span style="color: #33ffdd;">002</span>*<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-timtorotate<span style=" ">&#41;</span> <span style="color: #ffee00">;постепенный переворот для переменной гравитации. задаем коэффициент угла поворота.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> k#&gt;<span style="color: #33ffdd;">1.0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> k#=<span style="color: #33ffdd;">1.0</span> <span style="color: #ffee00">;его граничные значения</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> grav=<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> k#=<span style="color: #33ffdd;">1</span>-k# <span style="color: #ffee00">;закон его изменения</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> movepiv,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,k#*<span style="color: #33ffdd;">180</span> <span style="color: #ffee00">;переворачиваем пивот при смене гравитации.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>vertpiv,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">40</span> <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> vertpiv,<span style="color: #33ffdd;">40</span>*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>vertpiv,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">;ограничим обзор по вертикали.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>p_key<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> pr2=<span style="color: #33ffdd;">1</span> <span style="color: #ffee00">;реализация прыжка.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pr2=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">If</span> pr=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #ffee00">;если условия для прыжка выполняются то двигаем пивот вверх или вниз в зависимости от гравитации.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; движение происходит пока пивот не достигает определенной высоты, которая выше (ниже) текущей на высоту прыжка (5).</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> grav=<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">EntityY</span>#<span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> &lt; mvpYPos<span style="color: #33ffdd;">+5</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> movepiv,<span style="color: #33ffdd;">0</span>,speed#,<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Else</span> pr=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> grav=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">EntityY</span>#<span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> &gt; mvpYPos<span style="color: #33ffdd;">-5</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> movepiv,<span style="color: #33ffdd;">0</span>,speed#,<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Else</span> pr=<span style="color: #33ffdd;">0</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>movepiv,poltype<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> pr=<span style="color: #33ffdd;">1</span> mvpYPos=<span style="color: #aaffff; font-weight: bold;">EntityY</span>#<span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> pr2=<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">;при столкновении меняем текущую высоту.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;теперь если клавиша прыжка нажата то персонаж прыгает пока ее не отпустят. при однократном нажатии прыгаем один раз. </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> movepiv,<span style="color: #33ffdd;">0</span>,-speed#*<span style="color: #33ffdd;">0.5</span>*-grav,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">;двигаем главный пивот вниз относительно гравитации.</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> <br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SmenaGrav<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;меняем гравитацию</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; grav=-grav <span style="color: #ffee00">;тип гравитации</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; timtorotate=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;значение времени. для плавного переворота.</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Надеюсь тут все понятно. Не забудьте определить все переменные используемые в функциях как глобальные, а также задать значения клавиш:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> movepiv<br />
<p><span style="color: #aaffff; font-weight: bold;">Global</span> vertpiv<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> mic<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> speed#<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> deltaT<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> userTime<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> newTime<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> mvpYPos<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> pr<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> pr2<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> MInvers<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> grav=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> timtorotate<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> posSme#<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> wLog<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camMode=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> f_key=<span style="color: #33ffdd;">17</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> b_key=<span style="color: #33ffdd;">31</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> l_key=<span style="color: #33ffdd;">30</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> r_key=<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> p_key=<span style="color: #33ffdd;">57</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> s_key=<span style="color: #33ffdd;">42</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> c_key=<span style="color: #33ffdd;">46</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">Const</span> &nbsp;playertype=<span style="color: #33ffdd;">1</span>,poltype=<span style="color: #33ffdd;">2</span></div>
<p>В качестве поверхностей лучше не использовать плоскости (созданные командой CreatePlane()), так как из-за их безконечности возникают проблеммы с гравитацией и данный код работает некорректно. Используйте террайны или заранее смоделированные объекты. За помощь с переменной гравитацией благодарю Матвея Меркулова.
</p>
<a name=".D0.94.D0.B2.D0.B8.D0.B6.D0.BA.D0.B8_.D0.B4.D0.BB.D1.8F_RPG"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D1%80%D1%83%D0%B4%D0%BD%D0%BE%D1%81%D1%82%D0%B8_%D0%BF%D0%B5%D1%80%D0%B5%D0%B4%D0%B2%D0%B8%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_%28%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B4%D0%B2%D0%B8%D0%B6%D0%BA%D0%BE%D0%B2%29&amp;action=edit&amp;section=2" title="Править секцию: Движки для RPG">править</a>]</span> <span class="mw-headline">Движки для RPG</span></h2>
<p>В этом жанре передвижение героя реализовано подругому. Обычно есть курсор которым кликают по поверхности 3D-мира и чувак за которого мы играем движется к указанной нами цели. Еще бывает возможно управлять этим напрямую с клавиатуры. Неплохо было-бы иметь возможность поворачивать камеру.
</p><p>Попробуем видоизменить наши функции для реализации вышеописанного. Они будут выглядеть так:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> CreatePlayer<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">0</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<p>&nbsp; &nbsp; &nbsp; &nbsp; movepiv=<span style="color: #aaffff; font-weight: bold;">CreatePivot</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;создаем основной пивот - основу главного чувака</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> movepiv,x#,y#<span style="color: #33ffdd;">+4</span>,z# <span style="color: #ffee00">;позиционируем его</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EntityRadius</span> movepiv,<span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">4.5</span> <span style="color: #ffee00">;задаем его радиус</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EntityType</span> movepiv,playertype <span style="color: #ffee00">;присваиваем пивоту тип игрока</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; centpiv=<span style="color: #aaffff; font-weight: bold;">CreatePivot</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;создаем пивот-цель </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> centpiv,x#<span style="color: #33ffdd;">+4</span>,y#<span style="color: #33ffdd;">+2</span>,z#<span style="color: #33ffdd;">+4</span> <span style="color: #ffee00">;позиционируем его немного дальше основного</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; campiv=<span style="color: #aaffff; font-weight: bold;">CreatePivot</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;создаем пивот камеры. это надо для ее поворота</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>campiv<span style=" ">&#41;</span> <span style="color: #ffee00">;создаем камеру</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">30</span>,<span style="color: #33ffdd;">-25</span> <span style="color: #ffee00">;располагаем ее</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #33ffdd;">35</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span> <span style="color: #ffee00">;поворачиваем ее</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> camera,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">150</span> <span style="color: #ffee00">;задаем цвет окружения</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; mic=<span style="color: #aaffff; font-weight: bold;">CreateListener</span><span style=" ">&#40;</span>camera,<span style="color: #33ffdd;">0.05</span>,<span style="color: #33ffdd;">0.05</span>,<span style="color: #33ffdd;">0.08</span><span style=" ">&#41;</span> <span style="color: #ffee00">;задает микрофон для 3D звука это необязательно</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> playertype,poltype,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span> <span style="color: #ffee00">;задаем коллизию</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> dvigok<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> campiv,<span style="color: #aaffff; font-weight: bold;">EntityX</span>#<span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span>#<span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span>#<span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #ffee00">;положения пивота камеры и игрока равны</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">60</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> wLog=<span style="color: #aaffff; font-weight: bold;">Not</span> wLog <span style="color: #aaffff; font-weight: bold;">WireFrame</span> wLog <span style="color: #ffee00">;по нажатию F2 просматриваем каркас.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> userTime=<span style="color: #33ffdd;">0</span> userTime=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;стабилизация FPS. начальное значение.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; newTime=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;стабилизация FPS. снимаем время.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; deltaT=newTime-userTime <span style="color: #ffee00">;стабилизация FPS. вычисляем задержку выполнения.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; userTime=newTime <span style="color: #ffee00">;стабилизация FPS. уравниваем значения для следующего витка цикла.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; speed#=<span style="color: #33ffdd;">0.04</span>*deltaT <span style="color: #ffee00">;вычисляем скорость.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>f_key<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> centpiv,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed# <span style="color: #ffee00">;движение вперед. </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>b_key<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> centpiv,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-speed# <span style="color: #ffee00">;движение назад.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>l_key<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> centpiv,-speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">;движение влево.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>r_key<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> centpiv,speed#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">;движение вправо</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">3</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #ffee00">;если нажата средняя кнопка мыши или колесико, то:</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mxs#=<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;снимаем скорость передвижения мыши по горизонтали</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span> <span style="color: #ffee00">;перенмещаем курсор в центр, чтобы не ограничивать поворот</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">TurnEntity</span> campiv,<span style="color: #33ffdd;">0</span>,-mxs#*<span style="color: #33ffdd;">0.25</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">;камеры вокруг главного пивота. теперь можем поворачивать камеру.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> centpiv,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>campiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">;одновременно с камерой поворачиваем и целевой пивот на тотже угол.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;это необходимо для управления передвижением с клавиатуры. правильно ориентирует пивот относительно камеры.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CameraPick</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;выбираем объект позиционируемый в указанных координатах (координаты курсора)</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;области просмотра камеры.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;If PickedEntity()=plane1 or PickedEntity()=plane2 Then&nbsp;;если у вас предыдущая команда используется не только </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;для передвижения, то здесь необходимо перечислить все по чему чувак передвигается, иначе эта строка ненужна.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #ffee00">;если нажата правая кнопка мыши, то:</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> centpiv,<span style="color: #aaffff; font-weight: bold;">PickedX</span>#<span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">PickedY</span>#<span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">+2</span>,<span style="color: #aaffff; font-weight: bold;">PickedZ</span>#<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;располагаем цел. пивот в выбранных координатах.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <span style="color: #ffee00">;теперь будем двигаться к указанной цели.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;EndIf&nbsp;;необязательно. смотри выше.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">EntityDistance</span><span style=" ">&#40;</span>movepiv,centpiv<span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #ffee00">;если дистанция между главным и целевым пивотом меньше трех, то:</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PointEntity</span> movepiv,centpiv <span style="color: #ffee00">;следим главным пивотом за целевым. для правильной ориентации гл. пивота.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> movepiv,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,speed# <span style="color: #ffee00">;двигаем гл. пивот вперед.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <span style="color: #ffee00">;теперь гл. пивот будет двигаться, пока не достигнет целевого.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> movepiv,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">;гравитация</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>не забываем определять глобальные переменные:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> movepiv<br />
<p><span style="color: #aaffff; font-weight: bold;">Global</span> centpiv<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> campiv<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> mic<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> speed#<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> deltaT<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> userTime<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> newTime<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> wLog<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> f_key=<span style="color: #33ffdd;">17</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> b_key=<span style="color: #33ffdd;">31</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> l_key=<span style="color: #33ffdd;">30</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> r_key=<span style="color: #33ffdd;">32</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">Const</span> &nbsp;playertype=<span style="color: #33ffdd;">1</span>,poltype=<span style="color: #33ffdd;">2</span></div>
<p>Чтобы понять как все это работает напишим простенькую программку:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<p><br />
CreateWorld<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> movepiv<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> centpiv<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> campiv<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> mic<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> speed#<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> deltaT<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> userTime<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> newTime<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> wLog<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> f_key=<span style="color: #33ffdd;">17</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> b_key=<span style="color: #33ffdd;">31</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> l_key=<span style="color: #33ffdd;">30</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> r_key=<span style="color: #33ffdd;">32</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> &nbsp;playertype=<span style="color: #33ffdd;">1</span>,poltype=<span style="color: #33ffdd;">2</span><br />
<br />
CreatePlayer<span style=" ">&#40;</span><span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">-600</span><span style=" ">&#41;</span><br />
<br />
cub=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> cub,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">4</span>,<span style="color: #33ffdd;">2</span><br />
<br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; dvigok<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> cub,<span style="color: #aaffff; font-weight: bold;">EntityX</span>#<span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span>#<span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span>#<span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> cub,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>movepiv,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Flip</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> CreateWorld<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; wtex=<span style="color: #aaffff; font-weight: bold;">CreateTexture</span><span style=" ">&#40;</span><span style="color: #33ffdd;">256</span>,<span style="color: #33ffdd;">256</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">TextureBuffer</span><span style=" ">&#40;</span>wtex<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">10</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Rect</span> &nbsp;<span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">226</span>,<span style="color: #33ffdd;">226</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> wtex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; plane=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EntityTexture</span> plane,wtex<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EntityType</span> plane,poltype<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EntityPickMode</span> plane,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeTexture</span> wtex<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>В конце кода добавьте наши функции и можете запускать программу. Надеюсь теперь принцип работы данных функций окончательно понятен.
</p>
<a name=".D0.94.D0.B2.D0.B8.D0.B6.D0.BA.D0.B8_.D0.B4.D0.BB.D1.8F_.C2.AB.D0.BD.D0.B0.D1.81.D1.82.D0.BE.D0.BB.D1.8C.D0.BD.D1.8B.D1.85.C2.BB_.D0.B8.D0.B3.D1.80"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D1%80%D1%83%D0%B4%D0%BD%D0%BE%D1%81%D1%82%D0%B8_%D0%BF%D0%B5%D1%80%D0%B5%D0%B4%D0%B2%D0%B8%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_%28%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B4%D0%B2%D0%B8%D0%B6%D0%BA%D0%BE%D0%B2%29&amp;action=edit&amp;section=3" title="Править секцию: Движки для «настольных» игр">править</a>]</span> <span class="mw-headline">Движки для «настольных» игр</span></h2>
<p>Тут все несколько сложнее. Для таких игр характерно то, что каждый раз программа пишется именно для данной игры. Например, шахматы делаются совсем иначе, нежели косынка. Единственное, что можно посоветовать – это использовать массивы и типы. Для примера рассмотрим знакомую каждому «счастливому» обладателю Windows игру Сапер.
Привожу просто ее код с комментариями, думаю, разобраться будет не сложно.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;(c) Agnislav Lipcan</span><br />
<p><span style="color: #ffee00">; &nbsp; &nbsp; &nbsp;сапер</span><br />
<span style="color: #ffee00">;avelnet@yandex.ru</span><br />
<br />
<span style="color: #ffee00">;задаем название окна.</span><br />
<span style="color: #aaffff; font-weight: bold;">AppTitle</span> <span style="color: #00ff66;">&quot;сапер&quot;</span><br />
<span style="color: #ffee00">;загружаем и присваиваем шрифт.</span><br />
font1=<span style="color: #aaffff; font-weight: bold;">LoadFont</span><span style=" ">&#40;</span>courier ,<span style="color: #33ffdd;">22</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">SetFont</span> font1<br />
<span style="color: #ffee00">;узнаем интеллектуальный уровень пользователя.&nbsp;:) (кол-во клеток и бомб)</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> kl=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;сколько клеток в ряду? (&gt;=6) &gt;&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> kb=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;сколько бомб? &gt;&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;если пользователь ошибся, то исправляем это. &quot;проверка на дурака&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> kl&lt;<span style="color: #33ffdd;">6</span> <span style="color: #aaffff; font-weight: bold;">Then</span> kl=<span style="color: #33ffdd;">6</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> kb&gt;<span style=" ">&#40;</span>kl<span style="color: #33ffdd;">-2</span><span style=" ">&#41;</span>*<span style=" ">&#40;</span>kl<span style="color: #33ffdd;">-2</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> kb=<span style=" ">&#40;</span>kl<span style="color: #33ffdd;">-2</span><span style=" ">&#41;</span>*<span style=" ">&#40;</span>kl<span style="color: #33ffdd;">-2</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;задаем графический режим. размеры окна в зависимости от кол-ва клеток.</span><br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> kl*<span style="color: #33ffdd;">20</span>,kl*<span style="color: #33ffdd;">20</span><span style="color: #33ffdd;">+70</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;глобальные переменные</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> bomb<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> ttime<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> time<br />
<span style="color: #ffee00">;создаем тип &quot;поле&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Type</span> pole<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> c,b<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> s$<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<span style="color: #ffee00">;создаем массив этого типа. тут будет храниться информация о клетках поля.</span><br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> p.pole<span style=" ">&#40;</span>kl,kl<span style=" ">&#41;</span><br />
<br />
newgame<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;снова присваиваем шрифт, уже в данном графическом режиме</span><br />
font1=<span style="color: #aaffff; font-weight: bold;">LoadFont</span><span style=" ">&#40;</span>courier ,<span style="color: #33ffdd;">22</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">SetFont</span> font1<br />
<span style="color: #ffee00">;**************************** главный цикл *******************************</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<span style="color: #ffee00">;снимаем текущее время игры</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>&gt;time<span style="color: #33ffdd;">+1000</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; ttime=ttime<span style="color: #33ffdd;">+1</span> <br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span> &nbsp;<br />
<span style="color: #ffee00">;если нажать Enter, то запускаем игру заново.</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">28</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> newgame<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;если нажата левая кнопка мыши, то...</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; sel=p<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span>\c<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Select</span> sel <span style="color: #ffee00">;определяем куда мы ткнули мышей</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> kl<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> kl<span style="color: #33ffdd;">-1</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\s$=<span style="color: #00ff66;">&quot;б!&quot;</span> <span style="color: #ffee00">;б - это типа &quot;бомба!&quot; или б**, кому как нравится.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clear<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clear<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Default</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span>\s$=<span style="color: #aaffff; font-weight: bold;">Str</span><span style=" ">&#40;</span>p<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span>\c<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End Select</span> <br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #ffee00">;если нажата правая кнопка мыши, то делаем пометку, либо снимаем ее.</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span>\b=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span>\b=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span>\s$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> bomb=bomb<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span>\b=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span>\s$=<span style="color: #00ff66;">&quot;X&quot;</span> <span style="color: #ffee00">;&quot;поставим крест на бомбе!&quot; &nbsp;:)</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> bomb=bomb<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> bomb=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> newgame<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #ffee00">;функция отображения всего этого на экране &nbsp;</span><br />
drawing<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <br />
<span style="color: #aaffff; font-weight: bold;">Function</span> drawing<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span> <br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> kl<span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> kl<span style="color: #33ffdd;">-1</span> <br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> i*<span style="color: #33ffdd;">20</span>,j*<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> i*<span style="color: #33ffdd;">20</span>,j*<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">150</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">50</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">130</span>,<span style="color: #33ffdd;">130</span>,<span style="color: #33ffdd;">130</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">150</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">150</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">4</span> <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">150</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\c&gt;=<span style="color: #33ffdd;">5</span> <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\b=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">250</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> i*<span style="color: #33ffdd;">20</span><span style="color: #33ffdd;">+5</span>,j*<span style="color: #33ffdd;">20</span><span style="color: #33ffdd;">+1</span>,p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\s$<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #ffee00">;это &quot;украшательство&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">50</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">20</span>,kl*<span style="color: #33ffdd;">20</span><span style="color: #33ffdd;">+5</span>,<span style="color: #00ff66;">&quot;время: &quot;</span>+ttime+<span style="color: #00ff66;">&quot; сек.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">20</span>,kl*<span style="color: #33ffdd;">20</span><span style="color: #33ffdd;">+25</span>,<span style="color: #00ff66;">&quot;бомб: &quot;</span>+kb <br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">20</span>,kl*<span style="color: #33ffdd;">20</span><span style="color: #33ffdd;">+45</span>,<span style="color: #00ff66;">&quot;осталось: &quot;</span>+bomb <span style="color: #ffee00">;а вот эта строчка сильно упрощает жизнь игроку&nbsp;:)</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">50</span><br />
<span style="color: #aaffff; font-weight: bold;">Oval</span> kl*<span style="color: #33ffdd;">20</span><span style="color: #33ffdd;">-45</span>,kl*<span style="color: #33ffdd;">20</span><span style="color: #33ffdd;">+20</span>,<span style="color: #33ffdd;">40</span>,<span style="color: #33ffdd;">40</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Oval</span> kl*<span style="color: #33ffdd;">20</span><span style="color: #33ffdd;">-20</span>,kl*<span style="color: #33ffdd;">20</span><span style="color: #33ffdd;">+30</span>,<span style="color: #33ffdd;">8</span>,<span style="color: #33ffdd;">8</span><br />
<span style="color: #aaffff; font-weight: bold;">Oval</span> kl*<span style="color: #33ffdd;">20</span><span style="color: #33ffdd;">-35</span>,kl*<span style="color: #33ffdd;">20</span><span style="color: #33ffdd;">+30</span>,<span style="color: #33ffdd;">8</span>,<span style="color: #33ffdd;">8</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> kl*<span style="color: #33ffdd;">20</span><span style="color: #33ffdd;">-35</span>,kl*<span style="color: #33ffdd;">20</span><span style="color: #33ffdd;">+45</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> newgame<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
bomb=kb<br />
<span style="color: #ffee00">;создаем пустое поле</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> kl<span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> kl<span style="color: #33ffdd;">-1</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span> = <span style="color: #aaffff; font-weight: bold;">New</span> pole<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\s$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\b=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #ffee00">;заполняем поле бомбами и расставляем цифры</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> k=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> kb<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
i=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,kl<span style="color: #33ffdd;">-2</span><span style=" ">&#41;</span><br />
j=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,kl<span style="color: #33ffdd;">-2</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\c&lt;&gt;<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">-1</span>,j<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>\c&lt;&gt;<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">-1</span>,j<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>\c=p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">-1</span>,j<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>\c<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">-1</span>,j<span style=" ">&#41;</span>\c&lt;&gt;<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">-1</span>,j<span style=" ">&#41;</span>\c=p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">-1</span>,j<span style=" ">&#41;</span>\c<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">-1</span>,j<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>\c&lt;&gt;<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">-1</span>,j<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>\c=p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">-1</span>,j<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>\c<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>\c&lt;&gt;<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> p<span style=" ">&#40;</span>i,j<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>\c=p<span style=" ">&#40;</span>i,j<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>\c<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">+1</span>,j<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>\c&lt;&gt;<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">+1</span>,j<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>\c=p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">+1</span>,j<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>\c<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">+1</span>,j<span style=" ">&#41;</span>\c&lt;&gt;<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">+1</span>,j<span style=" ">&#41;</span>\c=p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">+1</span>,j<span style=" ">&#41;</span>\c<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">+1</span>,j<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>\c&lt;&gt;<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">+1</span>,j<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>\c=p<span style=" ">&#40;</span>i<span style="color: #33ffdd;">+1</span>,j<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>\c<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>\c&lt;&gt;<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> p<span style=" ">&#40;</span>i,j<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>\c=p<span style=" ">&#40;</span>i,j<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>\c<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">Exit</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
<span style="color: #aaffff; font-weight: bold;">Forever</span> <br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
ttime=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функция очистки поля (пустые клетки) </span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> clear<span style=" ">&#40;</span>is,js<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i=is <span style="color: #aaffff; font-weight: bold;">To</span> kl<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=js <span style="color: #aaffff; font-weight: bold;">To</span> kl<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\s$=<span style="color: #00ff66;">&quot;+&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=js <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\s$=<span style="color: #00ff66;">&quot;+&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i=is <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=js <span style="color: #aaffff; font-weight: bold;">To</span> kl<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\s$=<span style="color: #00ff66;">&quot;+&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=js <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span>i,j<span style=" ">&#41;</span>\s$=<span style="color: #00ff66;">&quot;+&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i=is <span style="color: #aaffff; font-weight: bold;">To</span> kl<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=js <span style="color: #aaffff; font-weight: bold;">To</span> kl<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>j,i<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span>j,i<span style=" ">&#41;</span>\s$=<span style="color: #00ff66;">&quot;+&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=js <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>j,i<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span>j,i<span style=" ">&#41;</span>\s$=<span style="color: #00ff66;">&quot;+&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i=is <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=js <span style="color: #aaffff; font-weight: bold;">To</span> kl<span style="color: #33ffdd;">-1</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>j,i<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span>j,i<span style=" ">&#41;</span>\s$=<span style="color: #00ff66;">&quot;+&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=js <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> p<span style=" ">&#40;</span>j,i<span style=" ">&#41;</span>\c=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p<span style=" ">&#40;</span>j,i<span style=" ">&#41;</span>\s$=<span style="color: #00ff66;">&quot;+&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span> <br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.94.D0.B2.D0.B8.D0.B6.D0.BA.D0.B8_.D0.B4.D0.BB.D1.8F_.D1.81.D0.BF.D0.BE.D1.80.D1.82.D0.B8.D0.B2.D0.BD.D1.8B.D1.85_.D1.81.D0.B8.D0.BC.D1.83.D0.BB.D1.8F.D1.82.D0.BE.D1.80.D0.BE.D0.B2"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D1%80%D1%83%D0%B4%D0%BD%D0%BE%D1%81%D1%82%D0%B8_%D0%BF%D0%B5%D1%80%D0%B5%D0%B4%D0%B2%D0%B8%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_%28%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B4%D0%B2%D0%B8%D0%B6%D0%BA%D0%BE%D0%B2%29&amp;action=edit&amp;section=4" title="Править секцию: Движки для спортивных симуляторов">править</a>]</span> <span class="mw-headline">Движки для спортивных симуляторов</span></h2>
<p>В данном случае, как и случае настольных игр, все зависит от того, какую именно игру вы хотите сделать. Однако имеется несколько моментов одинаковых для всех игр такого типа. Поговорим о них. Для гонок общими являются такие моменты, как хорошо проработанная физика, реалистичное поведение транспорта, возможность апгрейда транспорта, и др. Если вы создаете авиасимулятор, то вам необходимо создать полную имитацию сложного управления того, на чем вы летаете. В командных играх самым сложным является придумать удобное управление. Обычно пользуются ручным либо автоматическим переключением между игроками. Управление передается ближайшему к мячу игроку. При ведении мяча игроком, он (мяч) либо временно привязывается к игроку, либо направляется им через повороты его в сторону движения игрока. Вообще все симуляторы характерны тем, что они полностью копируют реальное поведения того чем вы управляете. Собственно поэтому они так и называются. Принцип создания гонок и авиасимуляторов показан в стандартных примерах блица, кроме того там нет ничего сложного в простейшем случае, поэтому не будем на них останавливаться. Рассмотрим командные спортивные симуляторы.
</p><p>Вот программа, показывающая принцип реализации передачи управления игроку ближайшему к мячу в командных играх.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span> <span style="color: #ffee00">;инициализируем графику</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;присваиваем буффер</span><br />
<span style="color: #aaffff; font-weight: bold;">HidePointer</span> <span style="color: #ffee00">;скрываем курсор</span><br />
<br />
<span style="color: #ffee00">;создаем тип игроков</span><br />
<span style="color: #aaffff; font-weight: bold;">Type</span> player <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> obj, dist#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span> <br />
<br />
<span style="color: #ffee00">; создаем массив игроков</span><br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> c.player<span style=" ">&#40;</span><span style="color: #33ffdd;">6</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;цикл создания игроков</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">5</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; c<span style=" ">&#40;</span>i<span style=" ">&#41;</span>= <span style="color: #aaffff; font-weight: bold;">New</span> player<br />
&nbsp; &nbsp; &nbsp; &nbsp; c<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\obj=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> c<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\obj,i*<span style="color: #33ffdd;">3</span><span style="color: #33ffdd;">-9</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">3</span>-<span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>i*<span style="color: #33ffdd;">2</span><span style="color: #33ffdd;">-6</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
actpl=<span style="color: #33ffdd;">1</span> <span style="color: #ffee00">;сначала активным будет первый игрок</span><br />
<br />
bol=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;создаем мяч</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> bol,<span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">20</span> <span style="color: #ffee00">;присваиваем цвет</span><br />
<br />
campiv=<span style="color: #aaffff; font-weight: bold;">CreatePivot</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;создаем целевой пивот для камеры</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;создаем камеру</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">-30</span> <span style="color: #ffee00">;размещаем камеру</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #33ffdd;">40</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">;поворачиваем камеру</span><br />
<br />
l=<span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;создаем освещение</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> distCur#=<span style="color: #33ffdd;">100</span> <span style="color: #ffee00">;задаем начальную максимальную дистанцию</span><br />
<br />
<span style="color: #ffee00">;главный цикл=======================================================</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
<span style="color: #ffee00">;блок управления мячем</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> bol,<span style="color: #33ffdd;">-0.2</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> bol,<span style="color: #33ffdd;">0.2</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> bol,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0.2</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> bol,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-0.2</span><br />
<br />
<span style="color: #ffee00">;увеличиваем текущую дистанцию до максимума</span><br />
distCur#=<span style="color: #33ffdd;">100</span><br />
<span style="color: #ffee00">;сканируем всех игроков и записываем в тип дистанцию </span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">5</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; c<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\dist#=<span style="color: #aaffff; font-weight: bold;">EntityDistance</span><span style=" ">&#40;</span>c<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\obj,bol<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
<br />
<span style="color: #ffee00">;выбираем активного игрока т. е. ближайшего к мячу</span><br />
<span style="color: #ffee00">;если сюда поставить условие if KeyDown(...) Then </span><br />
<span style="color: #ffee00">;то выбор будет осуществляться по нажатию клавиши</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">5</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> c<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\dist#&lt;=distCur# <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; distCur#=c<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\dist#<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; actpl=i <span style="color: #ffee00">;нашли! это активный игрок.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
<span style="color: #ffee00">;и окончание условия</span><br />
<span style="color: #ffee00">;EndIf</span><br />
<br />
<span style="color: #ffee00">;присваиваем цвета игрокам</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">5</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EntityColor</span> c<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\obj,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">100</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
<br />
<span style="color: #ffee00">;с активным игроком можно что-то делать, например поменять цвет:</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> c<span style=" ">&#40;</span>actpl<span style=" ">&#41;</span>\obj,<span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span> <span style="color: #ffee00">;теперь у активного игрока другой цвет</span><br />
<br />
<span style="color: #ffee00">;перемещаем цель камеры к активному игроку</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> campiv,<span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>c<span style=" ">&#40;</span>actpl<span style=" ">&#41;</span>\obj,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>c<span style=" ">&#40;</span>actpl<span style=" ">&#41;</span>\obj,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style="color: #33ffdd;">-10</span><br />
<br />
<span style="color: #ffee00">;плавно двигаем камеру</span><br />
camdx#=<span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span> campiv,<span style="color: #33ffdd;">1</span> <span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span> camera,<span style="color: #33ffdd;">1</span> <span style=" ">&#41;</span><br />
camdy#=<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span> campiv,<span style="color: #33ffdd;">1</span> <span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span> camera,<span style="color: #33ffdd;">1</span> <span style=" ">&#41;</span><br />
camdz#=<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span> campiv,<span style="color: #33ffdd;">1</span> <span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span> camera,<span style="color: #33ffdd;">1</span> <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> camera,camdx*.<span style="color: #33ffdd;">03</span>,camdy*.<span style="color: #33ffdd;">03</span>,camdz*.<span style="color: #33ffdd;">03</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;обновляем мир</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">;рендерим мир</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span> <span style="color: #ffee00">;меняем буферы</span><br />
<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #ffee00">;конец</span></div>
<a name=".D0.94.D0.B2.D0.B8.D0.B6.D0.BA.D0.B8_.D0.B4.D0.BB.D1.8F_RTS_.D0.B8_.D0.BF.D0.BE.D1.88.D0.B0.D0.B3.D0.BE.D0.B2.D1.8B.D1.85_.D1.81.D1.82.D1.80.D0.B0.D1.82.D0.B5.D0.B3.D0.B8.D0.B9"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D1%80%D1%83%D0%B4%D0%BD%D0%BE%D1%81%D1%82%D0%B8_%D0%BF%D0%B5%D1%80%D0%B5%D0%B4%D0%B2%D0%B8%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_%28%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B4%D0%B2%D0%B8%D0%B6%D0%BA%D0%BE%D0%B2%29&amp;action=edit&amp;section=5" title="Править секцию: Движки для RTS и пошаговых стратегий">править</a>]</span> <span class="mw-headline">Движки для RTS и пошаговых стратегий</span></h2>
<p>От RPG стратегии отличаются тем, что там имеется большее количество персонажей которыми можно управлять. В RTS есть возможность выделения рамкой нескольких персонажей и одновременного управления ими. В пошаговых стратегиях есть автоматическая передача хода во время битвы и ограничение хода игрока по времени или его "усталости". Для реализации подобного эффекта достаточно ввести переменную отвечающую за это. Для прорисовки рамки можно воспользоваться такой вот функцией:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> Ramcax1<br />
<p><span style="color: #aaffff; font-weight: bold;">Global</span> Ramcay1<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> RefreshRamca<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; Ramcax1=<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; Ramcay1=<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">200</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; Ramcax2=<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; Ramcay2=<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Line</span> Ramcax1,Ramcay1,Ramcax2,Ramcay1<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Line</span> Ramcax1,Ramcay2,Ramcax2,Ramcay2<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Line</span> Ramcax1,Ramcay1,Ramcax1,Ramcay2<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Line</span> Ramcax2,Ramcay1,Ramcax2,Ramcay2<br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; Ramcax1=<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; Ramcay1=<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span> <br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Avel" title="Участник:Avel">Агнислав Липкан</a> (e-mail: avelnet@yandex.ru)
</p>
<!-- Saved in parser cache with key db1:pcache:idhash:1707-0!1!0!!ru!2 and timestamp 20071112104815 -->
<div class="printfooter">
Получено с <a href="rpdsp1-e.html">http://blitzetcetera.org/index.php/%D0%A2%D1%80%D1%83%D0%B4%D0%BD%D0%BE%D1%81%D1%82%D0%B8_%D0%BF%D0%B5%D1%80%D0%B5%D0%B4%D0%B2%D0%B8%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_%28%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B4%D0%B2%D0%B8%D0%B6%D0%BA%D0%BE%D0%B2%29</a></div>
			<!-- end content -->			<div class="visualClear"></div>				</td>				<td class="rightside">				</td>			</tr>		</table>		</div>	</div>		</div>	
		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</div></body>
<!-- Mirrored from localhost/index.php/%D0%A2%D1%80%D1%83%D0%B4%D0%BD%D0%BE%D1%81%D1%82%D0%B8_%D0%BF%D0%B5%D1%80%D0%B5%D0%B4%D0%B2%D0%B8%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B4%D0%B2%D0%B8%D0%B6%D0%BA%D0%BE%D0%B2) by HTTrack Website Copier/3.x [XR&CO'2007], Mon, 12 Nov 2007 11:20:45 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>