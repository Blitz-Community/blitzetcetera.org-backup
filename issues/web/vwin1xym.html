<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru" dir="ltr">	
<!-- Mirrored from localhost/index.php/%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%967_-_%D0%BE%D0%BA%D1%82%D1%8F%D0%B1%D1%80%D1%8C_2007 by HTTrack Website Copier/3.x [XR&CO'2007], Mon, 12 Nov 2007 11:19:10 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />				<meta name="keywords" content="Выпуск №7 - октябрь 2007,Напиши статью!,Avel,Dimanche13,Grover,Impersonalis,JohnK,Matt Merkulov,Tadeus,Norton,Jimon" />
		<link rel="shortcut icon" href="http://blitzetcetera.org/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="http://blitzetcetera.org/opensearch_desc.php" title="Blitz Et Cetera (Русский)" />
		<title>Выпуск №7 - октябрь 2007 — Blitz Et Cetera</title>		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "bvih5rde.css?63"; /*]]>*/</style>		<link rel="stylesheet" type="text/css" media="print" href="gcxktlm6.css?63" />		<link rel="stylesheet" type="text/css" media="handheld" href="zumsslq_.css?63" />		<!--[if lt IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE50Fixes.css?63";</style><![endif]-->		<!--[if IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE55Fixes.css?63";</style><![endif]-->		<!--[if IE 6]><style type="text/css">@import "/skins/OfflineNew/IE60Fixes.css?63";</style><![endif]-->		<!--[if IE 7]><style type="text/css">@import "/skins/OfflineNew/IE70Fixes.css?63";</style><![endif]-->		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?63"></script>		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->		<script type= "text/javascript">/*<![CDATA[*/
var skin = "OfflineNew";
var stylepath = "/skins";
var wgArticlePath = "/index.php/$1";
var wgScriptPath = "";
var wgServer = "http://blitzetcetera.org/";
var wgCanonicalNamespace = "";
var wgCanonicalSpecialPageName = false;
var wgNamespaceNumber = 0;
var wgPageName = "Выпуск_№7_-_октябрь_2007";
var wgTitle = "Выпуск №7 - октябрь 2007";
var wgAction = "view";
var wgArticleId = "690";
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "ru";
var wgContentLanguage = "ru";
var wgBreakFrames = false;
var wgCurRevisionId = "3645";
/*]]>*/</script>
		<script type="text/javascript" src="2nq-6cel.js?63"><!-- wikibits js --></script>		<script type="text/javascript" src="http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=js"><!-- site js --></script>		<style type="text/css">/*<![CDATA[*/
@import "http://blitzetcetera.org/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=MediaWiki:OfflineNew.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=css&amp;maxage=18000";
/*]]>*/</style>		<!-- Head Scripts -->	</head><body  class="mediawiki ns-0 ltr page-Выпуск_№7_-_октябрь_2007">	<div id="globalWrapper">	<div id="logocontainer">		<table align="center">		  <tr>				<td id="blitzetclogo">				</td>			</tr>		</table>	</div>	<div id="magbar">	Журнал о программированнии на языках Blitz3D, BlitzMax, BlitzPlus	</div>		<div id="column-content">	<div id="content">		<a name="top" id="top"></a>				<div id="bodyContent">		<table cellspacing=0 cellpadding=0 width=100%>			<tr>			  <td class="leftside">				</td>				<td class="sheetbody">					<h1 class="sheet">Выпуск №7 - октябрь 2007</h1>			<h3 id="siteSub">Материал из Blitz Et Cetera.</h3>			<div id="contentSub"></div>			<!-- start content -->			<a name="Contents"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%967_-_%D0%BE%D0%BA%D1%82%D1%8F%D0%B1%D1%80%D1%8C_2007&amp;action=edit&amp;section=1" title="Править секцию: Contents">править</a>]</span> <span class="mw-headline">Contents</span></h2>
<ul><li>Вступление
<ul><li><a href="#Предисловие редактора (выпуск 7)">Предисловие редактора (выпуск 7)</a>
</li><li><a href="#Результаты конкурса (выпуск 7)">Результаты конкурса (выпуск 7)</a>
</li></ul>
</li><li>Обзоры
<ul><li><a href="#Особенности BlitzMax">Особенности BlitzMax</a> - Oxid 
</li></ul>
</li><li>Новичкам
<ul><li><a href="#Коллизии в BlitzMax">Коллизии в BlitzMax</a> - Assari, перевел <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:JohnK" title="Участник:JohnK">JohnK</a> 
</li><li><a href="#Отражение луча от произвольной поверхности в 3D">Отражение луча от произвольной поверхности в 3D</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Grover" title="Участник:Grover">Grover</a> 
</li></ul>
</li><li>Тонкости кодинга
<ul><li><a href="#Оформление программ">Оформление программ</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> 
</li><li><a href="#BlitzMax и LUA">BlitzMax и LUA</a>
</li><li><a href="#Отладка программы консольным методом">Отладка программы консольным методом</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Grover" title="Участник:Grover">Grover</a> 
</li></ul>
</li><li>Структуры данных
<ul><li><a href="#Форматы данных">Форматы данных</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> 
</li><li><a href="#Упаковка данных с помощью TeraBit DataPak">Упаковка данных с помощью TeraBit DataPak</a> - Grisu, перевел ZKINNER 
</li><li><a href="#Работа с surface в памяти Blitz3D">Работа с surface в памяти Blitz3D</a> - ANDREYman 
</li><li><a href="#Списки">Списки</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Impersonalis" title="Участник:Impersonalis">Impersonalis</a> 
</li><li><a href="#Загрузка и сохранение">Загрузка и сохранение</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Impersonalis" title="Участник:Impersonalis">Impersonalis</a> 
</li></ul>
</li><li>Разработки
<ul><li><a href="#Несколько реализаций инвентаря. Работа с типами и массивами.">Несколько реализаций инвентаря. Работа с типами и массивами.</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Avel" title="Участник:Avel">Агнислав Липкан</a> 
</li><li><a href="#Основы создания сетевых игр с использованием DirectPlay">Основы создания сетевых игр с использованием DirectPlay</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Tadeus" title="Участник:Tadeus">Tadeus</a> 
</li><li><a href="#Создание системы шифрования файлов с распаковкой в память">Создание системы шифрования файлов с распаковкой в память</a> - <a href="http://blitzetcetera.org/index.php?title=%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Jimon&amp;action=edit" class="new" title="Участник:Jimon">Jimon</a> 
</li><li><a href="#Тайловая игра на BlitzMax">Тайловая игра на BlitzMax</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Dimanche13" title="Участник:Dimanche13">Dimanche13</a>
</li></ul>
</li></ul>
<ul><li><ul><li><a href="#Система частиц на примере салюта">Система частиц на примере салюта</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Grover" title="Участник:Grover">Grover</a> 
</li><li><a href="#Ввод текста с клавиатуры в графическом режиме">Ввод текста с клавиатуры в графическом режиме</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Grover" title="Участник:Grover">Grover</a> 
</li></ul>
</li><li>Дизайнеру
<ul><li><a href="#Боксинг (на примере создания авто FordKa)">Боксинг (на примере создания авто FordKa)</a> - <a href="http://blitzetcetera.org/index.php?title=%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Norton&amp;action=edit" class="new" title="Участник:Norton">Norton</a> 
</li></ul>
</li><li>Юмор
<ul><li><a href="#Анекдоты и шутки в тему">Анекдоты и шутки в тему</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Avel" title="Участник:Avel">Агнислав Липкан</a> 
</li></ul>
</li><li>В заключение
<ul><li><a href="#В следующем выпуске (выпуск 7)">В следующем выпуске (выпуск 7)</a>
</li></ul>
</li></ul>
<p></td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Предисловие редактора (выпуск 7)"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Предисловие редактора (выпуск 7)&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Предисловие редактора (выпуск 7)&amp;action=edit">править</a>]</span><span class="mw-headline">Предисловие редактора (выпуск 7)</span></h1>
<p>Здравствуйте, уважаемые читатели. Ну вот наконец и седьмой выпуск журнала. Несколько месяцев копились статьи, чтобы в итоге объем нового выпуска сравнялся с объемом 3-го и 4-го (я более всего склоняюсь к принятию их за стандарт или эталон). И вот, казалось бы, объем набран - дело за формированием нового выпуска, но все пришлось отложить, т. к. стали происходить глобальные изменения.
</p>
</p><p>Во-первых, на форуме Boolean.Name появилось предложение сменить дизайн. DMX выложил на форум свои наброски, которые смотрелись получше старого варианта (хотя, нашлись и те, кому старый дизайн был ближе). Это был шаг вперед и мы вместе МоКой (одним из завсегдатаев форума), который предложил свою помощь, внедрили новый дизайн в компилятор сайта и я обновил все страницы.
</p><p>Дальше - больше. Давно было желание прикрутить к движку возможность комментировать статьи. Чтобы пользователь сразу после прочтения мог высказать свое мнение и написать пожелания. Как раз кстати я вышел на контакт с Александром Альрушди (он автор нескольких статей и старой системы развертывающихся секций в сборнике программ) и мы начали прикидывать как это реализовать.
</p><p>И тут - Bright Idea! Вы наверняка знакомы с огромной многоязычной энциклопедией "Википедия". Так вот, я с некоторого времени начал все больше читать статьи из нее и попутно интересоваться механизмом ее работы. И в какой-то момент я понял - это отличное решение для нашего журнала! Ведь если сделать журнал википодобным, будет гораздо легче формировать структуру, редактировать статьи, исправлять мелкие ошибки, заносить и категоризировать код и т. п. Больше никаких компиляций! А главное - любой, не напрягаясь, сможет принять в этом участие. Продвинутая система истории исправлений позволит гибко отслеживать правки, поправлять начинающих редакторов и пресекать вандализм.
</p><p>Решено! И вот я уже ищу подходящий движок. И тут оказывается: не нужно далеко ходить - вот он, движок Википедии, свободно распространяемый, с открытым кодом, кучей модулей-расширений и на PHP, что тоже было плюсом для нас. Это MediaWiki (<a href="http://mediawiki.org/" class="external free" title="http://mediawiki.org" rel="nofollow">http://mediawiki.org</a>).
</p><p>Началась долгая работа по подстройке движка под наши нужды и внесению информации. Мне очень пригодилась помощь Александра, большое спасибо ему. Мы изменили стандартный дизайн Википедии и сделали из него аналогичный новому журнальному. Мы добавили расширения для подсветки кода, я переработал и внедрил новую структуру категорий и шаблонов, занес страницы и загрузил изображения, код.
</p><p>Работа близилась к завершению, но тут SubZero, наш бессменный хостер и админ форума Boolean.Name, предложил создать домен для журнала и выделить больше ресурсов. И началась сложная работа по переезду и конфигурации движка под новые условия. Но вот, главный этап этой работы завершен и теперь мы можем приветствовать вас на BlitzEtCetera.Org!
</p><p>Еще один нюанс - я думаю, что многим игровым (и не только) проектам недостает такой же возможности удобного коллективного редактирования и структурирования информационной базы, как теперь в журнале. Поэтому я организовал викихостинг для блиц проектов (я долго копался в коде и примерах и нашел оптимальное решение). Теперь каждый владелец более-менее разработанного проекта на Blitz3D / BliztPlus / BlitzMax может открыть свою автономную вики в домене третьего уровня (например MyProject.BlitzEtCetera.Org) . Уже сейчас на Blitz et cetera.org хостятся 3 проекта - Krihat, War of the future и Fallout Action.
</p><p>Это все заняло достаточно много времени и объем накопившихся статей опять зашкалил. В этот раз, кстати, их рекордное количество - 20шт, причем еще 2 я перенес на следующий выпуск.
</p><p>Нортон написал отличный иллюстрированный урок по моделированию в 3DSMax - создание модели автомобиля.
</p><p>JohnK перевел статью про разные типы коллизии в BlitzMax.
</p><p>Статья Oxid'а об особенностях BlitzMax была перенесена с его сайта.
</p><p>Агнислав Липкан прислал небольшой сборник анекдотов и написал свой вариант создания игрового инвентаря.
</p><p>Я составил небольшое руководство для начинающих по форматированию кода и описал преимущества и недостатки графических и звуковых форматов.
</p><p>Zkinner перевел статью Grisu о работе с упаковщиком данных TeraBit DataPak.
</p><p>AndreyMan описал способ доступа к вертексам Blitz3D-поверхностей в программах на других языках (создание dll).
</p><p>Леонид Волошин (Tadeus) написал урок по использованию технологии DirectPlay в Blitz3D.
</p><p>Jimon раскрыл аспекты шифрования данных в BlitzMax-программах.
</p><p>Вопросы загрузки и записи данных были рассмотрены Impersonalis'ом. В дрругой статье он описывает и сравнивает различные виды списков.
</p><p>Ну а Dimanche13 решил написать более понятную, чем мои "Зверские колобки" статью о создании двумерного платформера, пока это 1-я часть.
</p><p>Grover анонсировал 4 статьи со своего сайта (об отражении / системе частиц / консоли / вводе текста) и прислал еще одну - про создание сервер-клиентского приложения.
</p><p>В общем, журнал вполне себе процветает и движется вперед. Но в очередной раз хочу напомнить вам, что журнал существует за счет прежде всего статей. Ваших статей. Поэтому если вам есть что рассказать о ваших экспериментах, есть опыт, которым вы можете поделиться - <a href="http://blitzetcetera.org/index.php/%D0%9D%D0%B0%D0%BF%D0%B8%D1%88%D0%B8_%D1%81%D1%82%D0%B0%D1%82%D1%8C%D1%8E%21" title="Напиши статью!">напишите статью</a>! Это просто. Тем более теперь, с вики-движком&nbsp;:).
</p><p>Ваше участие - правки, мнения, идеи - тоже важны, поэтому не стесняйтесь править и комментировать (для любой страницы есть соответствующая страница обсуждения, перейти на нее вы можете кликнув по вкладке "обсудить" на верху страницы). Вы можете начать вносить правки в любой момент, но можете подойти к делу более серьезно - сначала зарегистрироваться в системе (пункт "представиться системе" сверху-справа).
</p>
<div align="right">Матвей Меркулов</div>
<p></td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Результаты конкурса (выпуск 7)"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Результаты конкурса (выпуск 7)&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Результаты конкурса (выпуск 7)&amp;action=edit">править</a>]</span><span class="mw-headline">Результаты конкурса (выпуск 7)</span></h1>
</p>
<a name=".D0.A1.D0.BB.D1.83.D1.87.D0.B0.D0.B9.D0.BD.D0.BE.D0.B5_.D1.87.D0.B8.D1.81.D0.BB.D0.BE.2C_.D0.BA.D1.80.D0.BE.D0.BC.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B_%D0%BA%D0%BE%D0%BD%D0%BA%D1%83%D1%80%D1%81%D0%B0_%28%D0%B2%D1%8B%D0%BF%D1%83%D1%81%D0%BA_7%29&amp;action=edit&amp;section=1" title="Результаты конкурса (выпуск 7)">править</a>]</span> <span class="mw-headline">Случайное число, кроме</span></h2>
<p>Эта задача заинтересовала обитателей форума <a href="http://www.blitzbasic.com/" class="external free" title="http://www.blitzbasic.com" rel="nofollow">http://www.blitzbasic.com</a> и они предложили несколько решений. Напомню условие:
</p><p><i>Напишите функцию, возвращающее случайное число из заданного диапазона, кроме указанного. Разрешается писать код только после команды Return, т. е. изменять возвращаемое значение. </i>
</p><p>Floyd применил интересный метод, домножающий результат опреации Rand на число. незначительно большее 1, создав за счет этого промежуток в выдаваемых числах при округлении:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">For</span> n = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">To</span> <span style="color: #FFFFFF;">19</span><br />
<p>&nbsp; &nbsp; &nbsp; &nbsp; res1$ = res1$ + RandExcept<span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">5</span>, <span style="color: #FFFFFF;">5</span><span style=" ">&#41;</span> + <span style="color: #00FF66;">&quot;, &quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; res2$ = res2$ + RandExcept<span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">5</span>, <span style="color: #FFFFFF;">3</span><span style=" ">&#41;</span> + <span style="color: #00FF66;">&quot;, &quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; res3$ = res3$ + RandExcept<span style=" ">&#40;</span><span style="color: #FFFFFF;">-3</span>, <span style="color: #FFFFFF;">2</span>, <span style="color: #FFFFFF;">-1</span><span style=" ">&#41;</span> + <span style="color: #00FF66;">&quot;, &quot;</span><br />
<span style="color: #ffff00; font-weight: bold;">Next</span><br />
<span style="color: #ffff00; font-weight: bold;">Print</span> <span style="color: #00FF66;">&quot;Test 1, from 0 to 5 except 5: &quot;</span> + res1$<br />
<span style="color: #ffff00; font-weight: bold;">Print</span> <span style="color: #00FF66;">&quot;Test 2, from 0 to 5 except 3: &quot;</span> + res2$<br />
<span style="color: #ffff00; font-weight: bold;">Print</span> <span style="color: #00FF66;">&quot;Test 3, from -3 to 2 except -1: &quot;</span> + res3$<br />
<br />
<span style="color: #B1E7EB;">' The idea is to generate equally spaced double precision</span><br />
<span style="color: #B1E7EB;">' numbers with a gap very slightly larger than 1. Values are</span><br />
<span style="color: #B1E7EB;">' converted to integer with Floor.</span><br />
<br />
<span style="color: #B1E7EB;">' The gap must be carefully chosen so that excl is missed.</span><br />
<br />
<span style="color: #B1E7EB;">' Suppose the numbers were 3.97, 4.99, 6.01, 7.03, where the gap is 1.02.</span><br />
<span style="color: #B1E7EB;">' The Floor values are 3, 4, 6, 7 and the value 5 has been skipped.</span><br />
<br />
<span style="color: #B1E7EB;">' Assumes reasonable values: low &lt;= excl &lt;= high &nbsp; and &nbsp; low &lt; high.</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Function</span> RandEx<span style=" ">&#40;</span> low , high , excl <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Return</span> &nbsp;<span style="color: #ffff00; font-weight: bold;">Floor</span><span style=" ">&#40;</span> excl + <span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span> <span style="color: #FFFFFF;">1</span> + low - excl , high - excl <span style=" ">&#41;</span> * <span style=" ">&#40;</span> <span style="color: #FFFFFF;">1</span> + <span style="color: #FFFFFF;">1</span>! / <span style="color: #FFFFFF;">2</span> ^ <span style="color: #FFFFFF;">34</span> <span style=" ">&#41;</span> - <span style="color: #FFFFFF;">1</span>! / <span style="color: #FFFFFF;">2</span>^<span style="color: #FFFFFF;">35</span> <span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<p>Koriolis решил задачу, использовав автомассивы и индексацию элементов:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">For</span> n = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">To</span> <span style="color: #FFFFFF;">19</span><br />
<p>&nbsp; &nbsp; &nbsp; &nbsp; res1$ = res1$ + RandExcept<span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">5</span>, <span style="color: #FFFFFF;">5</span><span style=" ">&#41;</span> + <span style="color: #00FF66;">&quot;, &quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; res2$ = res2$ + RandExcept<span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">5</span>, <span style="color: #FFFFFF;">3</span><span style=" ">&#41;</span> + <span style="color: #00FF66;">&quot;, &quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; res3$ = res3$ + RandExcept<span style=" ">&#40;</span><span style="color: #FFFFFF;">-3</span>, <span style="color: #FFFFFF;">2</span>, <span style="color: #FFFFFF;">-1</span><span style=" ">&#41;</span> + <span style="color: #00FF66;">&quot;, &quot;</span><br />
<span style="color: #ffff00; font-weight: bold;">Next</span><br />
<span style="color: #ffff00; font-weight: bold;">Print</span> <span style="color: #00FF66;">&quot;Test 1, from 0 to 5 except 5: &quot;</span> + res1$<br />
<span style="color: #ffff00; font-weight: bold;">Print</span> <span style="color: #00FF66;">&quot;Test 2, from 0 to 5 except 3: &quot;</span> + res2$<br />
<span style="color: #ffff00; font-weight: bold;">Print</span> <span style="color: #00FF66;">&quot;Test 3, from -3 to 2 except -1: &quot;</span> + res3$<br />
<br />
<span style="color: #ffff00; font-weight: bold;">Function</span> RandExcept<span style=" ">&#40;</span>v1, v2, ev<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Return</span> <span style=" ">&#91;</span><span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span>v1, ev<span style="color: #FFFFFF;">-1</span><span style=" ">&#41;</span>, <span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span>ev<span style="color: #FFFFFF;">+1</span>,v2<span style=" ">&#41;</span><span style=" ">&#93;</span><span style=" ">&#91;</span><span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span>v1,v2<span style="color: #FFFFFF;">-1</span><span style=" ">&#41;</span>&gt;=ev<span style=" ">&#93;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<p>Jhanson предложил другое решение, основанное на замене исключаемого числа на крайнее в строке.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">For</span> n = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">To</span> <span style="color: #FFFFFF;">19</span><br />
<p>&nbsp; &nbsp; &nbsp; &nbsp; res1$ = res1$ + RandExcept<span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">5</span>, <span style="color: #FFFFFF;">5</span><span style=" ">&#41;</span> + <span style="color: #00FF66;">&quot;, &quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; res2$ = res2$ + RandExcept<span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">5</span>, <span style="color: #FFFFFF;">3</span><span style=" ">&#41;</span> + <span style="color: #00FF66;">&quot;, &quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; res3$ = res3$ + RandExcept<span style=" ">&#40;</span><span style="color: #FFFFFF;">-3</span>, <span style="color: #FFFFFF;">2</span>, <span style="color: #FFFFFF;">-1</span><span style=" ">&#41;</span> + <span style="color: #00FF66;">&quot;, &quot;</span><br />
<span style="color: #ffff00; font-weight: bold;">Next</span><br />
<span style="color: #ffff00; font-weight: bold;">Print</span> <span style="color: #00FF66;">&quot;Test 1, from 0 to 5 except 5: &quot;</span> + res1$<br />
<span style="color: #ffff00; font-weight: bold;">Print</span> <span style="color: #00FF66;">&quot;Test 2, from 0 to 5 except 3: &quot;</span> + res2$<br />
<span style="color: #ffff00; font-weight: bold;">Print</span> <span style="color: #00FF66;">&quot;Test 3, from -3 to 2 except -1: &quot;</span> + res3$<br />
<br />
<span style="color: #ffff00; font-weight: bold;">Function</span> RandExcept<span style=" ">&#40;</span>v1, v2, ev<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Return</span> <span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">Trim</span><span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">Replace</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot; &quot;</span>+<span style="color: #ffff00; font-weight: bold;">String</span><span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span>v1, v2<span style="color: #FFFFFF;">-1</span><span style=" ">&#41;</span><span style=" ">&#41;</span>+<span style="color: #00FF66;">&quot; &quot;</span>, <span style="color: #00FF66;">&quot; &quot;</span>+<span style="color: #ffff00; font-weight: bold;">String</span><span style=" ">&#40;</span>ev<span style=" ">&#41;</span>+<span style="color: #00FF66;">&quot; &quot;</span>,<span style="color: #ffff00; font-weight: bold;">String</span><span style=" ">&#40;</span>v2<span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<p>Ну и мой вариант – он основан на выборе из двух чисел – результатов операции Rand для интервалов слева и справо от выкидываемого значения. Числа временно помещаются в строку и ее часть, соответствующая одному из чисел выбирается со степенями вероятности, пропорциональными кол-вам чисел в каждом интервале:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">For</span> n = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">To</span> <span style="color: #FFFFFF;">19</span><br />
<p>&nbsp; &nbsp; &nbsp; &nbsp; res1$ = res1$ + RandExcept<span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">5</span>, <span style="color: #FFFFFF;">5</span><span style=" ">&#41;</span> + <span style="color: #00FF66;">&quot;, &quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; res2$ = res2$ + RandExcept<span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">5</span>, <span style="color: #FFFFFF;">3</span><span style=" ">&#41;</span> + <span style="color: #00FF66;">&quot;, &quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; res3$ = res3$ + RandExcept<span style=" ">&#40;</span><span style="color: #FFFFFF;">-3</span>, <span style="color: #FFFFFF;">2</span>, <span style="color: #FFFFFF;">-1</span><span style=" ">&#41;</span> + <span style="color: #00FF66;">&quot;, &quot;</span><br />
<span style="color: #ffff00; font-weight: bold;">Next</span><br />
<span style="color: #ffff00; font-weight: bold;">Print</span> <span style="color: #00FF66;">&quot;Test 1, from 0 to 5 except 5: &quot;</span> + res1$<br />
<span style="color: #ffff00; font-weight: bold;">Print</span> <span style="color: #00FF66;">&quot;Test 2, from 0 to 5 except 3: &quot;</span> + res2$<br />
<span style="color: #ffff00; font-weight: bold;">Print</span> <span style="color: #00FF66;">&quot;Test 3, from -3 to 2 except -1: &quot;</span> + res3$<br />
<br />
<span style="color: #ffff00; font-weight: bold;">Function</span> RandExcept<span style=" ">&#40;</span>v1, v2, ev<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Return</span> <span style="color: #ffff00; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span>v1, ev - <span style="color: #FFFFFF;">1</span><span style=" ">&#41;</span> + <span style="color: #00FF66;">&quot; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;</span> + <span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span>ev + <span style="color: #FFFFFF;">1</span>, v2<span style=" ">&#41;</span>, <span style="color: #FFFFFF;">12</span> * <span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span>v1,v2 - <span style="color: #FFFFFF;">1</span><span style=" ">&#41;</span> &gt;= ev<span style=" ">&#41;</span><span style=" ">&#41;</span>.<span style="">ToInt</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<p></td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Особенности BlitzMax"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Особенности BlitzMax&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Особенности BlitzMax&amp;action=edit">править</a>]</span><span class="mw-headline">Особенности BlitzMax</span></h1>
</p>
<a name=".D0.9F.D1.80.D0.B8.D1.8F.D1.82.D0.BD.D0.BE.D0.B5_.D0.B2_BlitzMax"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9E%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8_BlitzMax&amp;action=edit&amp;section=1" title="Особенности BlitzMax">править</a>]</span> <span class="mw-headline">Приятное в BlitzMax</span></h2>
<p>Плюсы BlitzMax, которые обнаружились при работе с ним:
</p>
<ul><li>Можно сразу делать инициализацию локальных переменных, в том числе и массивов:
</li></ul>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Local</span> a%<span style=" ">&#91;</span><span style=" ">&#93;</span> = <span style=" ">&#91;</span><span style="color: #FFFFFF;">1</span>,<span style="color: #FFFFFF;">2</span>,<span style="color: #FFFFFF;">3</span><span style=" ">&#93;</span></div>
<ul><li>Инициализация при объявлении полей класса - уменьшается количество текста, которое нужно писать программисту, т.к. часто отпадает необходимость писать конструктор:
</li></ul>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Field</span> mObj:<span style="color: #ffff00; font-weight: bold;">Object</span> = <span style="color: #ffff00; font-weight: bold;">new</span> TMyType</div>
<ul><li>Обращение к каждому элементу строки через индекс:
</li></ul>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">a$ = <span style="color: #00FF66;">&quot;blablabla&quot;</span>; <span style="color: #ffff00; font-weight: bold;">print</span> a<span style=" ">&#91;</span><span style="color: #FFFFFF;">3</span><span style=" ">&#93;</span>;</div>
<p>но нельзя сделать присвоение вида:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">a<span style=" ">&#91;</span><span style="color: #FFFFFF;">3</span><span style=" ">&#93;</span>=<span style="color: #FFFFFF;">46</span>, т.к это будет только для проверки символов строки.</div>
<ul><li>Строка является объектом. Можно записать:
</li></ul>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">a$ = <span style="color: #00FF66;">&quot;blablabla&quot;</span>; a.<span style="">length</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<ul><li>Указатели с индексным доступом:
</li></ul>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">p: <span style="color: #ffff00; font-weight: bold;">Byte</span> <span style="color: #ffff00; font-weight: bold;">Ptr</span>; p<span style=" ">&#91;</span><span style="color: #FFFFFF;">3</span><span style=" ">&#93;</span> = <span style="color: #FFFFFF;">0</span>;</div>
<ul><li>Цикл for/until - в отличие от for/to, переменная увеличивается до величины, не включая ее. Что удобно для работы с массивами, начинающимися с 0.
</li><li>Довольно таки просто реальзовать переключение оконного и полнооконного графических режимов.
</li><li>Символьные эквиваленты простых типов - это экономит время. Например: a$, вместо - a:String.
</li><li>Компилятор многопроходный, поэтому не возникает косяков с порядком объявления классов. Т.е. можно использовать класс в тексте, а его описание сделать потом.
</li></ul>
<p><a href="http://blitzmax.3dn.ru/publ/2-1-0-2" class="external text" title="http://blitzmax.3dn.ru/publ/2-1-0-2" rel="nofollow">оригинал главы</a><br />
<a href="http://blitzmax.3dn.ru/publ/2-1-0-2#comments" class="external text" title="http://blitzmax.3dn.ru/publ/2-1-0-2#comments" rel="nofollow">комментарии на сайте автора</a>
</p><p><br />
</p>
<a name=".D0.9D.D0.B5.D0.BF.D1.80.D0.B8.D1.8F.D1.82.D0.BD.D0.BE.D0.B5:_.D0.BE_.D1.8F.D0.B7.D1.8B.D0.BA.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9E%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8_BlitzMax&amp;action=edit&amp;section=2" title="Особенности BlitzMax">править</a>]</span> <span class="mw-headline">Неприятное: о языке</span></h2>
<ul><li>Отсутствие перегрузки функций. Это большое зло. Это надо, это сокращает время для написания кода. Плюс этот недостаток порождает целый ряд других.
</li></ul>
<p>Пример: Нужен менеджер ресурсов. Там нужен такой метод LoadRes(target:TypeOfResource var, url$). Вот при перегрузке функций, нужная функция в зависимости от типа нужного ресурса будет подставляться на этапе сборки. А без перегрузки я должен: первое - писать свой обработчик по типу ресурса (если сделать одну функцию с параметром типа общего объекта - Object) - тратить свое время на лишний код! И второе - этот код будет выполняться во время работы процесса, что будет снижать быстродействие! Уже два ОГРОМЕННЫХ МИНУСА!
Можно обойти это немного, конкретизировав методы загрузки ( LoadImage(url$), LoadSound(url$) ), но это немного снизит удобство. Т.к. для каждого ресурса надо будет помнить свою функцию.
</p>
<ul><li>Отсутствие конструкторов с параметрами. Писать функции для создания классов - не очень то и удобно с точки зрения поддержки и развития кода. - Их ведь нельзя наследовать и п1 - нельзя перегружать. Делать для инициализации статические методы (тоже что и функции по сути) при наличии потомков - тоже неудачно и упирается в отсутствие перегрузки функций и методов - см.сл.п.
</li><li>Неправильная или глючная поддержка в потомках возвращаемых значений методов. Т.е. в потомке нельзя переопределить тип возвращаемого значения. Оно логично со второго раза, а с третьего - видно, что не менее логично, если тип возвращаемого значения - объект, то в методе потомка можно возвращать потомка от исходного значения-объекта. Чем плохо конкретно - тем, что нельзя писать одноименные методы-конструкторы для потомков и предков красиво и без извратов (приведения типов, что делает код громоздким и невыразительным). А так же методы копирования. Т.е., по сути, нет перегрузки методов (и функций), что неудобно.
</li><li>Невозможность создания указателей на типы пользователя. Например я сделал тип TRGBA_Color с полями R, G, В, и А соответсвенно для цветов и прозрачности. Сделать так я не могу:
</li></ul>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Local</span> p:TRGBA_Color <span style="color: #ffff00; font-weight: bold;">Ptr</span> = TRGBA_Color <span style="color: #ffff00; font-weight: bold;">Ptr</span><span style=" ">&#40;</span>bmp.<span style="">PixelPtr</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><span style=" ">&#41;</span></div>
<p>Т.е. получить указатель на пикселы и работать с ним красиво - p.R = 100. Приходится делать это указателем на байты, что с ЯП высокого уровня не очень то и ассоциируется. Похоже, это связано с тем, что каждый тип является объектом и переменная этого типа уже и есть указатель на объект и заботой о защите памяти (только safe - функционал). Приведение типов или индексный доступ, конечно, не защищены от "дурака" - прогламмера (unsafe - функционал), но позволяют "не дураку" нормально и удобно работать.
</p>
<ul><li>Нет команды SinCos, которая поддерживается новыми процессорами и позволяет быстрее производить операции просчета вращения и т.п., т.к. обычно надо и синус и косинус угла, а одной командой это явно сделать быстрее, чем двумя.
</li><li>Статический step в циклах. Иногда надо, чтобы при проходе по массиву приращение индекса менялось. Приходится делать через while/wend.
</li><li>Нет оператора With. Можно сделать аналог, но это увеличивает громоздкость кода.
</li><li>Система слежения за освободившейся памятью (менеджер памяти языка) и автоматическим удалением не нужных уже объектов, хоть и хороша и удобна, но не совершенна. И порой возникали утечки из-за перекрестных ссылок (кросслинков). Т.е. все равно приходится следить за корректной очисткой памяти, что отвлекает от основного процесса написания кода, увеличивает объем текста программы и в сумме эти два фактора приводят к увеличению времени написания программы. Плюс это не характерно для ЯП высокого уровня - менеджер памяти должен быть на высоте. Так что это получается что-то среднее между ЯП высокого и среднего уровней.
</li></ul>
<p>Утечки возникают даже не при кросс-линках а и в ситуациях, когда возникать не должны. Например: объект-контейнер, содержит в себе список других объектов. Объекты содержат поле с линком на элемент списка типа TLink, - не на сам контейнер. На этот контейнер ссылается глобальная переменная, поэтому он и "живет". Глюк: если в методе объекта из списка контейнера глобальная переменная переопределяется (в "пусто" или другой контейнер), то память не очищается! Контейнер не удаляется! При освобождении объекта в другом месте - все нормально и память освобождается. Глюк лечится, если объект из контейнера при переопределении глобальной переменной выбрасывается из списка - Tlink.Remove(). Но вообще-то такого быть не должно.
</p>
<ul><li>Нет указателей на методы типов. Указатели на функции - есть, а на методы - нет. А это облегчило бы написание кода в некоторых случаях.
</li><li>Нет нормальной полноценной совместимости (приведения) типов. Неоднократно сталкивался с тем, что надо было массив TObject[] преобразовать к моему типу (например для возврата из функции, для конвертирования из TList к массиву). Приходилось писать свои функции для преобразования вроде ObjArrayToTMytypeArray: TMytype[]( Object[] ). Можно в принципе и без этого - приводить типы уже во время работы с массивом, но наглядность и легкость чтения кода теряются. А это надо для реюзабельности кода.
</li></ul>
<p><i>П.с.: Таки сделали приведение типов для массивов - хорошо хоть развивается язык, а не стоит на месте.
П.п.с.: Млин. Криво работает. Нулевые массивы на выходе часто.</i>
</p>
<ul><li>Нет директивы inline. Нужна она! И не только для ускорения работы кода.
</li><li>Глюк с продолжением строки: если второй строкой идет комментарий, то выдается ошибка:
</li></ul>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Field</span> pms:<span style="color: #ffff00; font-weight: bold;">TPixmap</span><span style=" ">&#91;</span><span style=" ">&#93;</span> = <span style=" ">&#91;</span> ..<br />
<span style="color: #B1E7EB;">'LoadImage(&quot;images/gem_1_rotate.png&quot;) ..</span></div>
<p>- это нужно для комментирования при экспериментах с различными значениями в массиве.
</p>
<ul><li>Оптимизация кода очень плохая. Нет оптимизации по использованию методов - методы, которые ни разу не использовались в коде, все равно компилируются. Тот код, который пишется, буквально переводится один в один.
</li><li>Нет инкапсуляции, т.е. защищенных и открытых методов и полей класса. Есть ее какое-то подобие на уровне модуля, но не в классе. А отсутствие инкапсуляции - это есть unsafe.
</li><li>Нет автоматического приведения типов. Т.е. если в функции объявлен один тип, а передается другой, причем совместимый (общий класс Object), возникает ошибка.
</li><li>Игры с типами не доделаны. Вот начал я привыкать к этим играм с типизацией и ощутил необходимость ссылки на тип. То, что в С++ шаблонами можно сделать. Такая переменная в которой нужный тип обозначен - очень нужно для наследования и для различных фабрик объектов, чтоб кода писать меньше. А то можно и приустать конструкторы под каждый новый тип переписывать, раз уж нет их с параметрами и перегрузки функций тоже нет.
</li></ul>
<p><i>П.с.:&nbsp;!!! Я придумал, как это обойти. В нужных нам классах метод Copy(), создающий копию класса. Неужели сделали перегрузку хоть на уровне преобразования возвращаемого результата с учетом наследования. Но - нужно самому писать весь код по копированию.</i>
</p>
<ul><li>Нет автоматических конструкторов копирования объектов. Приходится писать самому - а это время. А время - деньги.
</li><li>Несколько глупо реализовано конструирование объектов при наследовании. Переопределенный конструктор предка вызывается по любому, даже если мы его не вызываем и его вызов нам не нужен, т.к. мы переопределяем конструктор в наследнике.
</li></ul>
<p>Практический пример: нужно незначительное изменение предка. Предок использует поле объекта одного типа, в наследнике нужно это же поле, но другого типа. В конструкторе этот объект создается. В наследнике значит надо переопределить создание этого объекта на нужный нам тип. Но в конструкторе предка этот объект тоже создается, а потом пересоздается в наследнике. Конечно, менеджер памяти лишний объект потом удалит, но вообще получается очень глупое и неразумное использование ресурсов. Хорошо если этот объект маленький, а если требует серьезных расчетов, подгрузки ресурсов и т.д. - получится заметное снижение производительности. Поэтому предок надо писать заново либо с нуля, либо с предка предка, еще не имеющего нужных нам полей объектов. Вывод: Язык не очень дружелюбен к наследованию и, следовательно, к хорошей поддержке крупных и долгосрочных проектов.
</p>
<ul><li>Нет макросов и шаблонов. Хотя бы макросы блин - это уже несколько заменило бы шаблоны. А нужно это чтобы не писать кучу однотипного кода с небольшими вариациями. Это бы прилично сократило время на набор текстов программ.
</li></ul>
<p><a href="http://blitzmax.3dn.ru/publ/2-1-0-3" class="external text" title="http://blitzmax.3dn.ru/publ/2-1-0-3" rel="nofollow">оригинал главы</a><br />
<a href="http://blitzmax.3dn.ru/publ/2-1-0-3#comments" class="external text" title="http://blitzmax.3dn.ru/publ/2-1-0-3#comments" rel="nofollow">комментарии на сайте автора</a>
</p>
<a name=".D0.9D.D0.B5.D0.BF.D1.80.D0.B8.D1.8F.D1.82.D0.BD.D0.BE.D0.B5:_.D0.BE_.D0.B1.D0.B8.D0.B1.D0.BB.D0.B8.D0.BE.D1.82.D0.B5.D0.BA.D0.B0.D1.85"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9E%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8_BlitzMax&amp;action=edit&amp;section=3" title="Особенности BlitzMax">править</a>]</span> <span class="mw-headline">Неприятное: о библиотеках</span></h2>
<ul><li>Нет списка со значениями, не являющимися объектами. Например, целыми - Int.
</li><li>Списки не очень удобно реализованы. Было бы хорошо наличие у элементов списка TLink поля Parent, для ссылки на родительский список (И поля Child для многоуровневых древовидных списков). Это связано с менеджером памяти языка, который не в состоянии корректно удалять объекты с кросслинками.
</li><li>Утечка памяти в функции LoadImage при загрузке *.png. Ее практически не заметно, т.к. вылазит она при особых случаях, например при перегрузке картинок, что обычно не требуется - они загружаются один раз обычно. Но, например, при отсутствии менеджера ресурсов, когда нам нужно перезагружать изображение (при обработке скриптов, например), то утечка становится заметной. Причем внутренний меденжер памяти утечку не показывает.
</li></ul>
<p><i>Прим.: при загрузке *.jpg утечки нет.</i>
</p>
<ul><li>При создании нового pixmap, он не инициализируется. Т.е. мы создали новый pixmap, а там мешанина из пикселов, а не черный или белый или заданный программистом фон. Надо писать функции заполнения новообразованных пиксмапов, а это - время/деньги.
</li><li>Неясности со шрифтами: LoadImageFont("Arial.ttf":) не приводит к ожидаемому результату, а с полным путем LoadImageFont("C:\Windows\Fonts\Arial.ttf":) все работает. Хотелось бы без указания путей. Хоть и есть фонт по умолчанию.
</li><li>Отсутствие такого хорошего понятия как контекст устройства. Есть в вынь и в пурике ( StartDrawing(OutputID) ). На CreateGraphics(:) его заменить нельзя - если разрешение не поддерживается, контекст не создается. Это очень-очень плохо. Нельзя рисовать нормально в оффскрин окно. Другими словами рисовать в текстуру (спрайт) можно только ручками через массив пикселей, что медленно. Сторонние библиотеки для этого - платные.
</li><li>Метод pixmap. Paste(:) не проверяет размеры - это приводит к глюкам с затиранием памяти и необходимостью писать много чего своими ручками. Это unsafe (при том, что полезные вещи в страхе этого самого unsafe не делаются), и время/деньги на дополнительный код.
</li><li>Глючность идиотическая, надеялся, что такого не встречу. Пример: когда работа с пиксмапами формата PF_RGBA8888 проходит отлично, а смена формата на PF_BGRA8888 приводит к непонятным глюкам в официальных библиотечных функциях.
</li><li>Глюки при работе с созданием пиксмапов, если их делаешь много, то возникает глюк. Этот глюк как-то связан с форматом картинки. При формате PF_BGRA8888 он возникает раньше. GCCollect() не помогает, дело не в переполнении, а хз в чем.
</li><li>Звук: Полная распаковка/загрузка в память, потом проигрывание. Это приводит к тому, что мы в программе уже запустили звук на проигрывание, а оно начинается позже - после полной распаковки. Это заметно даже на не сильно больших звуках, не треках. Сначала было совсем жестко - распаковка была не в отдельном процессе и можно было нарваться на притормаживания при попытках проиграть звук. Сейчас сделали распаковку в фоне (отдельным процессом). Этим убрались притормаживания всего приложения при проигрывании. Но остались паузы между желаемым началом проигрывания (вызовом в коде) и реальным началом, когда уже слышен звук.
</li></ul>
<p>При этом фоновая распаковка породила другую проблему. Тормоза при не фоновой распаковке можно было обойти правильной организацией ресурсов. Загрузкой и распаковкой звуков в начале игры или уровня, когда можно и подождать. Таким образом, при самой игре звуки проигрывались уже распакованные из памяти, не вызывая никаких нареканий. Теперь при такой организации, если приложение загрузилось достаточно быстро, а звуки в фоне не распаковались, то опять есть паузы в начале работы, между тем, когда звук должен проиграться и когда он звучит на самом деле. Вылез теперь немного иной недостаток - невозможность узнать, когда звук распакован, чтобы дождаться полной загрузки ресурсов.
Правильнее бы делать блочную распаковку/загрузку и проигрывание. Как в винампе, например. Когда подгружается кусок и распаковывается быстро и играется сразу, незаметно для слуха. А потом в фоне догружаются остальные части.
</p>
<ul><li>Нет форматирования текста. Для вывода например дробного числа с 3-мя знаками после запятой и т.п. Нужно для нормального отображения информации, чтобы строки не налезали друг на друга. Можно сказать, что для игр и не важно, но а вывод вспомогательной дебаг информации?- очень даже нужно.
</li><li>Нет математических функций для округления чисел с плавающей запятой до нужного количества знаков после запятой. Почти, то-же что и п.2.11, но с математической точки зрения. Но нужно было для того-же (вывод плавающих чисел).
</li><li>Не обновляется содержимое окна при таскании его за заголовок (с тем-же фреймвоком от Поп-Кап таких проблем нет).
</li><li>Нет команд для временной передачи лишнего времени системе. В Win и PalmOS это вполне возможно, в других ОС, думаю, тоже.
</li><li>У стандартного таймера нет возможности изменять частоту в процессе его работы. Частота задается только один раз при создании таймера.
</li><li>Неточности при определении столкновений.
</li></ul>
<p><a href="http://blitzmax.3dn.ru/publ/2-1-0-4" class="external text" title="http://blitzmax.3dn.ru/publ/2-1-0-4" rel="nofollow">оригинал главы</a><br />
<a href="http://blitzmax.3dn.ru/publ/2-1-0-4#comments" class="external text" title="http://blitzmax.3dn.ru/publ/2-1-0-4#comments" rel="nofollow">комментарии на сайте автора</a>
</p>
<a name=".D0.9D.D0.B5.D0.BF.D1.80.D0.B8.D1.8F.D1.82.D0.BD.D0.BE.D0.B5:_.D0.BE_.D1.80.D0.B0.D0.B7.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D0.BA.D0.B5_.D0.B8.D0.B3.D1.80"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9E%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8_BlitzMax&amp;action=edit&amp;section=4" title="Особенности BlitzMax">править</a>]</span> <span class="mw-headline">Неприятное: о разработке игр</span></h2>
<ul><li>Нет поддержки шрифтов с произвольной шириной и утилит для работы с ними. Моноширинные - это вчерашний день.
</li><li>Нет зачатков даже движка как в Blitz3D. Есть просто набор либ для работы с сетью, звуком графикой и устройствами ввода (мышь, клавиатура, джойстик). Джентльменский набор, но "ни цента больше".
</li><li>Нет и намека на партиклы. О редакторе молчу, хотя бы классы или либы для работы с ними были какие-то. А современный уровень игростроения их требует. Все надо делать самому - опять время/деньги. Хотя есть пара сторонних убогих движков частиц. И даже с редакторами.
</li><li>ГУИ. Игровое конечно. Опять полное отсутствие. Хотя тут проще - есть сторонние библиотеки. И даже бесплатные.
</li><li>Нет поддержки треккерных форматов звука. Но можно использовать сторонние библиотеки.
</li><li>Нет физики. Есть сторонние модули.
</li></ul>
<p><a href="http://blitzmax.3dn.ru/publ/2-1-0-5" class="external text" title="http://blitzmax.3dn.ru/publ/2-1-0-5" rel="nofollow">оригинал главы</a><br />
<a href="http://blitzmax.3dn.ru/publ/2-1-0-5#comments" class="external text" title="http://blitzmax.3dn.ru/publ/2-1-0-5#comments" rel="nofollow">комментарии на сайте автора</a>
</p>
<hr />
<p>Автор: Oxid
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Коллизии в BlitzMax"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Коллизии в BlitzMax&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Коллизии в BlitzMax&amp;action=edit">править</a>]</span><span class="mw-headline">Коллизии в BlitzMax</span></h1>
</p>
<a name=".D0.9F.D0.B5.D1.80.D0.B2.D0.B0.D1.8F_.D1.87.D0.B0.D1.81.D1.82.D1.8C"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=1" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">Первая часть</span></h2>
<a name=".D0.92.D1.81.D1.82.D1.83.D0.BF.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=2" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">Вступление</span></h3>
<p>Играть в игру, где разные движущиеся объекты пролетают сквозь друг друга, не интересно. Даже в такой простой игре как Пинг Понг есть механизм столкновения.
</p><p>Простейший способ определения коллизии - это когда два объекта "накладываются" друг на друга. Существует много способов проверки на столкновение, но лучше начинать с простых.
<p>Пересечение Прямоугольников
Самый простой способ проверки коллизии - это пересечение прямоугольников.
</p>
</p><p>Давайте рассмотрим пример:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Graphics</span> <span style="color: #FFFFFF;">640</span>,<span style="color: #FFFFFF;">480</span><br />
<p><span style="color: #ffff00; font-weight: bold;">While</span> <span style="color: #ffff00; font-weight: bold;">Not</span> <span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span>key_escape<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
<span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span><br />
<span style="color: #ffff00; font-weight: bold;">DrawRect</span> <span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">200</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span><br />
<span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">255</span><br />
<span style="color: #ffff00; font-weight: bold;">DrawRect</span> <span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span><br />
<span style="color: #ffff00; font-weight: bold;">Flip</span><br />
<span style="color: #ffff00; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll1-01.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll1-01.png" src="dqriiirk.png" width="500" height="396" /></a></span></div></div>
<p>Как вы могли заметить из кода выше, при пересечении прямоугольников ничего не происходит. Это из-за того, что в коде нет проверки коллизии.
</p><p>Давайте добавим ее, используя команду RectsOverlap (Пересечение прямоугольников) И при столкновении сменим цвет синего прямоугольника.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Graphics</span> <span style="color: #FFFFFF;">640</span>,<span style="color: #FFFFFF;">480</span><br />
<p><span style="color: #ffff00; font-weight: bold;">While</span> <span style="color: #ffff00; font-weight: bold;">Not</span> <span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span>key_escape<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
<span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span><br />
<span style="color: #ffff00; font-weight: bold;">DrawRect</span> <span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">200</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span><br />
<span style="color: #ffff00; font-weight: bold;">If</span> RectsOverlap<span style=" ">&#40;</span><span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">200</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span><br />
<span style="color: #ffff00; font-weight: bold;">Else</span><br />
<span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">255</span><br />
<span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
<span style="color: #ffff00; font-weight: bold;">DrawRect</span> <span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span><br />
<span style="color: #ffff00; font-weight: bold;">Flip</span><br />
<span style="color: #ffff00; font-weight: bold;">Wend</span><br />
<span style="color: #ffff00; font-weight: bold;">End</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Function</span> RectsOverlap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#40;</span>x0, y0, w0, h0, x2, y2, w2, h2<span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">If</span> x0 &gt; <span style=" ">&#40;</span>x2 + w2<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style=" ">&#40;</span>x0 + w0<span style=" ">&#41;</span> &lt; x2 <span style="color: #ffff00; font-weight: bold;">Then</span> <span style="color: #ffff00; font-weight: bold;">Return</span> <span style="color: #ffff00; font-weight: bold;">False</span><br />
<span style="color: #ffff00; font-weight: bold;">If</span> y0 &gt; <span style=" ">&#40;</span>y2 + h2<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style=" ">&#40;</span>y0 + h0<span style=" ">&#41;</span> &lt; y2 <span style="color: #ffff00; font-weight: bold;">Then</span> <span style="color: #ffff00; font-weight: bold;">Return</span> <span style="color: #ffff00; font-weight: bold;">False</span><br />
<span style="color: #ffff00; font-weight: bold;">Return</span> <span style="color: #ffff00; font-weight: bold;">True</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll1-02.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll1-02.png" src="yp077pfn.png" width="420" height="200" /></a></span></div></div>
<p>Как вы могли заметить, синий прямоугольник становится красным каждый раз, когда происходит пересечение (коллизия).
</p>
<a name=".D0.9F.D0.B5.D1.80.D0.B5.D1.81.D0.B5.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.9F.D1.80.D1.8F.D0.BC.D0.BE.D1.83.D0.B3.D0.BE.D0.BB.D1.8C.D0.BD.D0.B8.D0.BA.D0.B0_.D0.B8_.D0.9A.D1.80.D1.83.D0.B3.D0.B0"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=3" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">Пересечение Прямоугольника и Круга</span></h3>
<p>Давайте немного изменим код, дабы вместо прямоугольника появился овал:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Graphics</span> <span style="color: #FFFFFF;">640</span>,<span style="color: #FFFFFF;">480</span><br />
<p><span style="color: #ffff00; font-weight: bold;">While</span> <span style="color: #ffff00; font-weight: bold;">Not</span> <span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span>key_escape<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
<span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span><br />
<span style="color: #ffff00; font-weight: bold;">DrawRect</span> <span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">200</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span><br />
<span style="color: #ffff00; font-weight: bold;">If</span> RectsOverlap<span style=" ">&#40;</span><span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">200</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span><br />
<span style="color: #ffff00; font-weight: bold;">Else</span><br />
<span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">255</span><br />
<span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
<span style="color: #ffff00; font-weight: bold;">DrawOval</span> <span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #FFFFFF;">-50</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #FFFFFF;">-50</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span><br />
<span style="color: #ffff00; font-weight: bold;">Flip</span><br />
<span style="color: #ffff00; font-weight: bold;">Wend</span><br />
<span style="color: #ffff00; font-weight: bold;">End</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Function</span> RectsOverlap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#40;</span>x0, y0, w0, h0, x2, y2, w2, h2<span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">If</span> x0 &gt; <span style=" ">&#40;</span>x2 + w2<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style=" ">&#40;</span>x0 + w0<span style=" ">&#41;</span> &lt; x2 <span style="color: #ffff00; font-weight: bold;">Then</span> <span style="color: #ffff00; font-weight: bold;">Return</span> <span style="color: #ffff00; font-weight: bold;">False</span><br />
<span style="color: #ffff00; font-weight: bold;">If</span> y0 &gt; <span style=" ">&#40;</span>y2 + h2<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style=" ">&#40;</span>y0 + h0<span style=" ">&#41;</span> &lt; y2 <span style="color: #ffff00; font-weight: bold;">Then</span> <span style="color: #ffff00; font-weight: bold;">Return</span> <span style="color: #ffff00; font-weight: bold;">False</span><br />
<span style="color: #ffff00; font-weight: bold;">Return</span> <span style="color: #ffff00; font-weight: bold;">True</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<p>Как вы заметили, функция больше не работает должным образом. Нам нужна другая функция, которая поможет нам определить коллизию между овалом и прямоугольником. Вот она:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Graphics</span> <span style="color: #FFFFFF;">640</span>,<span style="color: #FFFFFF;">480</span><br />
<p><span style="color: #ffff00; font-weight: bold;">While</span> <span style="color: #ffff00; font-weight: bold;">Not</span> <span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span>key_escape<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
<span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span><br />
<span style="color: #ffff00; font-weight: bold;">DrawRect</span> <span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">200</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span><br />
<span style="color: #ffff00; font-weight: bold;">If</span> CircRectsOverlap<span style=" ">&#40;</span><span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">200</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">50</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span><br />
<span style="color: #ffff00; font-weight: bold;">Else</span><br />
<span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">255</span><br />
<span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
<span style="color: #ffff00; font-weight: bold;">DrawOval</span> <span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #FFFFFF;">-50</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #FFFFFF;">-50</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span><br />
<span style="color: #ffff00; font-weight: bold;">Flip</span><br />
<span style="color: #ffff00; font-weight: bold;">Wend</span><br />
<span style="color: #ffff00; font-weight: bold;">End</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Function</span> CircRectsOverlap<span style=" ">&#40;</span>x0, y0, w0, h0, cx, cy, r<span style=" ">&#41;</span><br />
testX=cX<br />
testY=cY<br />
<span style="color: #ffff00; font-weight: bold;">If</span> TestX &lt; x0 <span style="color: #ffff00; font-weight: bold;">Then</span> TestX=x0<br />
<span style="color: #ffff00; font-weight: bold;">If</span> TestX &gt; <span style=" ">&#40;</span>x0+w0<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Then</span> TestX=<span style=" ">&#40;</span>x0+w0<span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">If</span> TestY &lt; y0 <span style="color: #ffff00; font-weight: bold;">Then</span> Testy=y0<br />
<span style="color: #ffff00; font-weight: bold;">If</span> TestY &gt; <span style=" ">&#40;</span>y0+h0<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Then</span> Testy=<span style=" ">&#40;</span>y0+h0<span style=" ">&#41;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Return</span> <span style=" ">&#40;</span><span style=" ">&#40;</span>cX-TestX<span style=" ">&#41;</span>*<span style=" ">&#40;</span>cX-TestX<span style=" ">&#41;</span>+<span style=" ">&#40;</span>cY-TestY<span style=" ">&#41;</span>*<span style=" ">&#40;</span>cY-TestY<span style=" ">&#41;</span><span style=" ">&#41;</span>&lt;r*r<br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll1-03.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll1-03.png" src="duhuadi3.png" width="420" height="200" /></a></span></div></div>
<a name=".D0.A4.D1.83.D0.BD.D0.BA.D1.86.D0.B8.D0.B8_.D0.BA.D0.BE.D0.BB.D0.BB.D0.B8.D0.B7.D0.B8.D0.B9_.D0.B2_BlitzMax"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=4" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">Функции коллизий в BlitzMax</span></h3>
<p>Если нам захочется использовать отдельную функцию для каждой пары различных объектов, у нас будут проблемы. Так же если это не функция RectsOverlap можно заметить, что математика в функциях на проверку столкновений становиться сложнее.
</p><p>К счастью, BlitzMax (а точнее Max2D) предоставляет пару функций, которые облегчат нам жизнь. А теперь давайте посмотрим, как можно использовать встроенные в Max2D функции.
</p>
<a name="ImagesCollide"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=5" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">ImagesCollide</span></h3>
<p>Самая простая функция в BlitzMax это ImagesCollide. Она имеет следующий синтаксис:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> <span style="color: #ffff00; font-weight: bold;">ImagesCollide</span><span style=" ">&#40;</span>image1:TImage,x1,y1,frame1,image2:TImage,x2,y2,frame2<span style=" ">&#41;</span></div>
<p>Функции требуется два изображения, которые надо проверить, а так же их положение на экране. Мы можем игнорировать параметр Frame, указав вместо значения - ноль.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">ImagesCollide</span><span style=" ">&#40;</span>Alien,<span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">200</span>,<span style="color: #FFFFFF;">0</span>,Player,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span></div>
<p>Итак, позиция НЛО = (150,200), а позиция игрока равна позиции мыши. Скомпилируйте код, что бы увидеть функцию в действии:
</p>
<center>
<p><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-BlobShip.png" class="image" title="Изображение:BMax-BlobShip.png"><img alt="Изображение:BMax-BlobShip.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-BlobShip.png" src="y-4ybzg0.png" width="64" height="64" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-UFO.png" class="image" title="Изображение:BMax-UFO.png"><img alt="Изображение:BMax-UFO.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-UFO.png" src="54w2qc_x.png" width="160" height="128" /></a>
</p>
</center>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Graphics</span> <span style="color: #FFFFFF;">640</span>,<span style="color: #FFFFFF;">480</span><br />
<p><span style="color: #ffff00; font-weight: bold;">Local</span> Player:TImage=<span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-BlobShip.png&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Local</span> Alien:TImage=<span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-UFO.png&quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">While</span> <span style="color: #ffff00; font-weight: bold;">Not</span> <span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span>key_escape<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
<span style="color: #ffff00; font-weight: bold;">DrawImage</span> Alien,<span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">200</span><br />
<span style="color: #ffff00; font-weight: bold;">DrawImage</span> Player,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">ImagesCollide</span><span style=" ">&#40;</span>Alien,<span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">200</span>,<span style="color: #FFFFFF;">0</span>,Player,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">SetClsColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span><br />
<span style="color: #ffff00; font-weight: bold;">Else</span><br />
<span style="color: #ffff00; font-weight: bold;">SetClsColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span><br />
<span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
<span style="color: #ffff00; font-weight: bold;">Flip</span><br />
<span style="color: #ffff00; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll1-04.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll1-04.png" src="ql-7rqt_.png" width="420" height="200" /></a></span></div></div>
<p>Как вы могли заметить, использовать эту функцию очень просто.
</p>
<a name="ImagesCollide_.D1.81_.D0.90.D0.BD.D0.B8.D0.BC.D0.B0.D1.86.D0.B8.D0.B5.D0.B9"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=6" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">ImagesCollide с Анимацией</span></h3>
<p>Давайте разберемся с параметром Frame, который мы пропустили ранее. Что бы коллизия работала с анимационным изображением нужно немного изменить код:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-Explosion.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-Explosion.png" src="im-1swz5.png" width="256" height="256" /></a></span></div></div>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Graphics</span> <span style="color: #FFFFFF;">640</span>,<span style="color: #FFFFFF;">480</span><br />
<p><span style="color: #ffff00; font-weight: bold;">Local</span> Player:TImage=<span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-BlobShip.png&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Local</span> Alien:TImage=<span style="color: #ffff00; font-weight: bold;">LoadAnimImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-Explosion.png&quot;</span>,<span style="color: #FFFFFF;">64</span>,<span style="color: #FFFFFF;">64</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">16</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Local</span> Frame:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">0</span><br />
<span style="color: #ffff00; font-weight: bold;">Local</span> AnimDelay:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">10</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">While</span> <span style="color: #ffff00; font-weight: bold;">Not</span> <span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span>key_escape<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
<span style="color: #ffff00; font-weight: bold;">DrawImage</span> Alien,<span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">200</span>, Frame<br />
<span style="color: #ffff00; font-weight: bold;">DrawImage</span> Player,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">ImagesCollide</span><span style=" ">&#40;</span>Alien,<span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">200</span>,Frame,Player,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">SetClsColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span><br />
<span style="color: #ffff00; font-weight: bold;">Else</span><br />
<span style="color: #ffff00; font-weight: bold;">SetClsColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span><br />
<span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
<span style="color: #ffff00; font-weight: bold;">Flip</span><br />
<span style="color: #ffff00; font-weight: bold;">If</span> AnimDelay&lt;<span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Then</span><br />
Frame&nbsp;:+ <span style="color: #FFFFFF;">1</span><br />
<span style="color: #ffff00; font-weight: bold;">If</span> Frame&gt;<span style="color: #FFFFFF;">15</span> <span style="color: #ffff00; font-weight: bold;">Then</span> Frame=<span style="color: #FFFFFF;">0</span><br />
AnimDelay=<span style="color: #FFFFFF;">10</span><br />
<span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
AnimDelay&nbsp;:- <span style="color: #FFFFFF;">1</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll1-05.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll1-05.png" src="sbe1a2yq.png" width="420" height="200" /></a></span></div></div>
<p>Чтобы использовать ImagesCollide с анимационными изображениями, нам нужен параметр, характеризующий кадр анимации, что бы потом использовать в функции ImagesCollide. А увеличение параметров AnimDelay и Frame сделано для того, что бы анимация проигрывалась должным образом.
</p>
<a name="ImagesCollide_.D1.81_.D0.9C.D0.B0.D1.81.D1.88.D1.82.D0.B0.D0.B1.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5.D0.BC"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=7" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">ImagesCollide с Масштабированием</span></h3>
<p>Blitzmax позволяет масштабировать изображения в реальном времени. Это можно сделать с помощью функции SetScale, ее синтаксис таков:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> <span style="color: #ffff00; font-weight: bold;">SetScale</span><span style=" ">&#40;</span> scale_x#,scale_y# <span style=" ">&#41;</span></div>
<p>К сожалению, если используется функция SetScale, ImagesCollide не работает должным образом. Что бы убедится в этом, скомпилируйте этот код:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Graphics</span> <span style="color: #FFFFFF;">640</span>,<span style="color: #FFFFFF;">480</span><br />
<p><span style="color: #ffff00; font-weight: bold;">Local</span> Player:TImage=<span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-BlobShip.png&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Local</span> Alien:TImage=<span style="color: #ffff00; font-weight: bold;">LoadAnimImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-Explosion.png&quot;</span>,<span style="color: #FFFFFF;">64</span>,<span style="color: #FFFFFF;">64</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">16</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Local</span> Frame:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">0</span><br />
<span style="color: #ffff00; font-weight: bold;">Local</span> AnimDelay:<span style="color: #ffff00; font-weight: bold;">int</span>=<span style="color: #FFFFFF;">10</span><br />
<span style="color: #ffff00; font-weight: bold;">Local</span> PlayerSize:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">1</span><br />
<span style="color: #ffff00; font-weight: bold;">Local</span> AlienSize:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">2</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">While</span> <span style="color: #ffff00; font-weight: bold;">Not</span> <span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span>key_escape<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
<span style="color: #ffff00; font-weight: bold;">SetScale</span> AlienSize,AlienSize<br />
<span style="color: #ffff00; font-weight: bold;">DrawImage</span> Alien,<span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">100</span>,Frame<br />
<span style="color: #ffff00; font-weight: bold;">SetScale</span> PlayerSize,PlayerSize<br />
<span style="color: #ffff00; font-weight: bold;">DrawImage</span> Player,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">ImagesCollide</span><span style=" ">&#40;</span>Alien,<span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">100</span>,Frame,Player,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">SetClsColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span><br />
<span style="color: #ffff00; font-weight: bold;">Else</span><br />
<span style="color: #ffff00; font-weight: bold;">SetClsColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span><br />
<span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
<span style="color: #ffff00; font-weight: bold;">Flip</span><br />
<span style="color: #ffff00; font-weight: bold;">If</span> AnimDelay&lt;<span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Then</span><br />
Frame&nbsp;:+ <span style="color: #FFFFFF;">1</span><br />
<span style="color: #ffff00; font-weight: bold;">If</span> Frame&gt;<span style="color: #FFFFFF;">15</span> <span style="color: #ffff00; font-weight: bold;">Then</span> Frame=<span style="color: #FFFFFF;">0</span><br />
AnimDelay=<span style="color: #FFFFFF;">10</span><br />
<span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
AnimDelay&nbsp;:- <span style="color: #FFFFFF;">1</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll1-06.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll1-06.png" src="ql-7rqt_-2.png" width="500" height="396" /></a></span></div></div>
<p>К счастью в BlitzMax есть еще одна функция, которая позволяет работать с масштабированными изображениями, чудо функция зовется ImagesCollide2,ее синтаксис таков:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> <span style="color: #ffff00; font-weight: bold;">ImagesCollide2</span><span style=" ">&#40;</span>image1:TImage, x1, y1, frame1, rot1#, scalex1#, scaley1#, image2:TImage, x2, y2, frame2, rot2#, scalex2#, scaley2#<span style=" ">&#41;</span></div>
<p>(Прим. Переводчика: Запомните! Функция не будет вращать или масштабировать изображение! Она лишь учитывает эти факторы, для определения коллизии!)
</p><p>Итак, все, что нам нужно чтобы использовать ImagesCollide2, это добавить:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">ImagesCollide2</span><span style=" ">&#40;</span>Alien, <span style="color: #FFFFFF;">150</span>, <span style="color: #FFFFFF;">100</span>, Frame, <span style="color: #FFFFFF;">0</span>, AlienSize, AlienSize, Player, <span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>, <span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>, <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">0</span>, PlayerSize, PlayerSize<span style=" ">&#41;</span></div>
<p>Теперь вы можете смело заменять ImagesCollide на ImagesCollide2, только не забудьте учитывать фактор вращения и масштабирования.
</p>
<a name="ImagesCollide_.D1.81_.D0.92.D1.80.D0.B0.D1.89.D0.B5.D0.BD.D0.B8.D0.B5.D0.BC"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=8" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">ImagesCollide с Вращением</span></h3>
<p>Этот пункт я оставил вам, как упражнение, чтобы вы выяснили, что нужно ввести, чтобы функция заработала&nbsp;:)
</p>
<a name=".D0.98.D1.82.D0.BE.D0.B3.D0.B8"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=9" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">Итоги</span></h3>
<p>Сначала в этом туториале мы разобрали два простых (и быстрых) способа проверки на коллизии. Жаль, что они работают только с кругами и прямоугольниками.
</p><p>А так как многие игры полностью состоят из изображений, мы рассмотрели и разобрали функции ImagesCollide и ImagesCollide2.
</p><p>Далее мы рассмотрим более сложную систему коллизий в BlitzMax.
</p>
<a name=".D0.92.D1.82.D0.BE.D1.80.D0.B0.D1.8F_.D1.87.D0.B0.D1.81.D1.82.D1.8C"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=10" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">Вторая часть</span></h2>
<a name=".D0.92.D1.81.D1.82.D1.83.D0.BF.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_2"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=11" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">Вступление</span></h3>
<p>В прошлой части мы увидели, как проверить объекты на коллизию, используя простые команды RectOverlaps и CircRectOverlaps. Так же рассмотрели пиксель-совершенные команды на проверку коллизий - ImagesCollide и ImagesCollide2.
</p><p>В этой части мы рассмотрим другие команды, на проверку коллизий.
</p>
<a name="CollideImage"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=12" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">CollideImage</span></h3>
<p>Давайте попробуем решить проблему неправильного определения коллизий, путем использования этой функции. Синтаксис этой функции вводит в заблуждение. Он представлен ниже, а теперь давайте заменим код таким образом, что бы он работал, мы не будем сейчас вникать в подробности, просто будем использовать CollideImage:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> <span style="color: #ffff00; font-weight: bold;">CollideImage</span>:<span style="color: #ffff00; font-weight: bold;">Object</span><span style=" ">&#91;</span><span style=" ">&#93;</span><span style=" ">&#40;</span>image:TImage,x,y,frame,collidemask%,writemask%,id:<span style="color: #ffff00; font-weight: bold;">Object</span>=<span style="color: #ffff00; font-weight: bold;">Null</span><span style=" ">&#41;</span></div>
<p>Заметьте, изменения выделены (серый текст это то, что осталось без изменения с прошлого раза)
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Graphics</span> <span style="color: #FFFFFF;">640</span>,<span style="color: #FFFFFF;">480</span><br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Player:TImage=<span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-BlobShip.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Alien:TImage=<span style="color: #ffff00; font-weight: bold;">LoadAnimImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-Explosion.png&quot;</span>,<span style="color: #FFFFFF;">64</span>,<span style="color: #FFFFFF;">64</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">16</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Frame:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">0</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> AnimDelay:<span style="color: #ffff00; font-weight: bold;">int</span>=<span style="color: #FFFFFF;">10</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> PlayerSize:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">1</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> AlienSize:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">2</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">While</span> <span style="color: #ffff00; font-weight: bold;">Not</span> <span style="color: #ffff00; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span>key_escape<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Cls</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">ResetCollisions</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetScale</span> AlienSize,AlienSize<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawImage</span> Alien,<span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">100</span>,Frame<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>Alien,<span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">100</span>,Frame,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">2</span><span style=" ">&#41;</span><br />
&nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetScale</span> PlayerSize,PlayerSize<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawImage</span> Player,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>Player,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">2</span>,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetClsColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetClsColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Flip</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> AnimDelay&lt;<span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;Frame&nbsp;:+ <span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">If</span> Frame&gt;<span style="color: #FFFFFF;">15</span> <span style="color: #ffff00; font-weight: bold;">Then</span> Frame=<span style="color: #FFFFFF;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;AnimDelay=<span style="color: #FFFFFF;">10</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; AnimDelay&nbsp;:- <span style="color: #FFFFFF;">1</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Wend</span><br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span></div>
<center>
<p><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-BlobShip.png" class="image" title="Изображение:BMax-BlobShip.png"><img alt="Изображение:BMax-BlobShip.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-BlobShip.png" src="y-4ybzg0.png" width="64" height="64" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-UFO.png" class="image" title="Изображение:BMax-UFO.png"><img alt="Изображение:BMax-UFO.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-UFO.png" src="54w2qc_x.png" width="160" height="128" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-Explosion.png" class="image" title="Изображение:BMax-Explosion.png"><img alt="Изображение:BMax-Explosion.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-Explosion.png" src="im-1swz5.png" width="256" height="256" /></a>
</p>
</center>
<p>Если вы скомпилируете этот код, то заметите, что коллизии все так же точно определяются, как и в прошлой части туториала.
</p>
<a name=".D0.A1.D0.BB.D0.BE.D0.B9_.D0.9A.D0.BE.D0.BB.D0.BB.D0.B8.D0.B7.D0.B8.D0.B8"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=13" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">Слой Коллизии</span></h3>
<p>Новая система коллизий в BlitzMax основана на слоях, для того чтобы использовать ее, вы должны проделать следующие шаги:
</p>
<ul><li>Для начала, нужно удостовериться, что нужный слой - пуст.
</li><li>Записать изображение, которое будет проверяться на коллизии, в нужный слой.
</li><li>Проверять изображение на коллизии.
</li></ul>
<p>Вы можете использовать 32 слоя. В примере выше мы использовали первый слой. Так же, в пример, мы прошли все 3 шага:
</p><p>Функция ResetCollisions() очищает все слои коллизий. Можно так же очистить только желаемый слой, например, для очищения второго слоя, мы должны написать так - ResetCollision(2)
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">ResetCollisions</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Первое CollideImage-выражение приписывает изображение инопланетянина ко второму слою коллизий.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>Alien,<span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">100</span>,Frame,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">2</span><span style=" ">&#41;</span></div>
<p>А это CollideImage выражение проверяет весь второй слой, а следовательно и изображение инопланетянина, с изображением Игрока.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>Player,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">2</span>,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span></div>
<p>А вот что Марк Сибли говорит о новой системе коллизий:
</p><p><i>Главная идея параметров collidemask и writemask в том, что они являются "битмасками" (т.е.: 1,2,4,8,16 и т.д.) это дает вам до 32 'слоев' для проверки на коллизии. Например, вы можете создать следующие слои:</i>
</p><p>background=0, monsters=1, pickups=2, player=3.
</p><p>Для этих слоев битмаски 1,2,4,8 соответственно.
</p><p>Использование битмасок, в отличие от просто номера слоя, дает преимущество в том, что вы можете обозначить несколько слоев, например: битмаска с номером 3 означает два слоя: нулевой и первый (2+1).
</p><p>Функция CollideImage одновременно записывает изображение в слой, в диапазоне от 0 до 31 (это зависит от параметра writemask) и проверяет на коллизии со слоями в диапазоне от 0 до 31 (это зависит от параметра collidemask).
</p><p>'Запись Изображения' несет в себе включение всего, что связано с изображением, а так же вращение и масштабирование. Или же проще - физическая 'запись' изображения.
</p><p>Как вы помните, Марк говорил о параметрах collidemask% и writemask%:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> <span style="color: #ffff00; font-weight: bold;">CollideImage</span>:<span style="color: #ffff00; font-weight: bold;">Object</span><span style=" ">&#91;</span><span style=" ">&#93;</span><span style=" ">&#40;</span>image:TImage,x,y,frame,collidemask%,writemask%,id:<span style="color: #ffff00; font-weight: bold;">Object</span>=<span style="color: #ffff00; font-weight: bold;">Null</span><span style=" ">&#41;</span></div>
<p>Чтобы приписать изображение к первому слою, мы должны записать так:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>Alien,<span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">100</span>,Frame,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">1</span><span style=" ">&#41;</span></div>
<p>Так же мы можем приписать наше изображением к двум слоям одновременно. Здесь мы записываем в первый и второй слои:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>Alien,<span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">100</span>,Frame,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">3</span><span style=" ">&#41;</span></div>
<p>Примерно также мы можем проверить слой на коллизии, манипулируя параметром collidemask%:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>Player,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">1</span>,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span></div>
<p>Или же проверить два слоя сразу:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>Player,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">3</span>,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span></div>
<p>Прелесть слоев коллизий в том, что мы можем проверять на коллизии только нужные нам слои. Прежде чем рассмотреть пример этого, давайте разберем еще одну важную часть этой системы:
</p>
<a name=".D0.92.D0.BE.D0.B7.D0.B2.D1.80.D0.B0.D1.89.D0.B5.D0.BD.D0.B8.D0.B5_.D0.9C.D0.B0.D1.81.D1.81.D0.B8.D0.B2.D0.BE.D0.B2_.D0.9E.D0.B1.D1.8A.D0.B5.D0.BA.D1.82.D0.BE.D0.B2_.D0.BA.D0.BE.D0.BB.D0.BB.D0.B8.D0.B7.D0.B8.D1.8F.D0.BC.D0.B8"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=14" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">Возвращение Массивов Объектов коллизиями</span></h3>
<p>Как вы помните, если происходят коллизии, то функция проверки на коллизию, возвращает значение true (истина)
</p><p>Функция CollideImage имеет больше возможностей в плане проверки на коллизии. Давайте рассмотрим до сих пор не знакомые нам параметры в синтаксисе этой функции, а именно Object[ ] и id:Object.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> <span style="color: #ffff00; font-weight: bold;">CollideImage</span>:<span style="color: #ffff00; font-weight: bold;">Object</span><span style=" ">&#91;</span><span style=" ">&#93;</span><span style=" ">&#40;</span>image:TImage,x,y,frame,collidemask%,writemask%,id:<span style="color: #ffff00; font-weight: bold;">Object</span>=<span style="color: #ffff00; font-weight: bold;">Null</span><span style=" ">&#41;</span></div>
<p>Запомните, что существует два вида функции CollideImage,
</p>
<ul><li>Первая, для записи, с использованием параметра writemask
</li><li>Вторая, для чтения, с использованием collidemask
</li></ul>
<p>Когда мы записываем изображение в слой, параметр id:Object позволяет опознавать изображение.
</p><p>После записи, при чтении, функция вернет все объекты, вовлеченные в коллизию в виде массива объектов.
</p><p>Вот простой пример, иллюстрирующий это:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Strict</span><br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Graphics</span> <span style="color: #FFFFFF;">640</span>,<span style="color: #FFFFFF;">480</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">AutoMidHandle</span> <span style="color: #ffff00; font-weight: bold;">True</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> SpaceShip:TImage=<span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-BlobShip.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> AlienShip1:TImage=<span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-UFO.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> AlienShip2:TImage=<span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-UFO.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> R:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">0</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> G:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">0</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> B:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">ResetCollisions</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawImage</span> AlienShip1, <span style="color: #FFFFFF;">250</span>,<span style="color: #FFFFFF;">100</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>AlienShip1,<span style="color: #FFFFFF;">250</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">1</span>,AlienShip1<span style=" ">&#41;</span><br />
&nbsp; <br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawImage</span> AlienShip2, <span style="color: #FFFFFF;">400</span>,<span style="color: #FFFFFF;">100</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>AlienShip2,<span style="color: #FFFFFF;">400</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">1</span>,AlienShip2<span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> p:<span style="color: #ffff00; font-weight: bold;">Object</span><span style=" ">&#91;</span><span style=" ">&#93;</span>=<span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>Spaceship,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">1</span>,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> i:TImage=<span style="color: #ffff00; font-weight: bold;">EachIn</span> &nbsp; p<br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Select</span> i<br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> AlienShip1<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; R=<span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> &nbsp; AlienShip2<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; G=<span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Select</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">SetColor</span> R,G,B &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawImage</span> SpaceShip,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Flip</span><br />
&nbsp; <br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">Until</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>KEY_ESCAPE<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>В этом примере, при коллизии, происходит смена цвета. Мы так же можем провести проверку на коллизии между двумя кораблями, просто используя выражение CollideImage, в результате мы бы получили массив.
</p>
<center>
<p><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll2-01.png" class="image" title="Изображение:Coll2-01.png"><img alt="Изображение:Coll2-01.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll2-01.png" src="bdh2roew.png" width="500" height="396" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll2-02.png" class="image" title="Изображение:Coll2-02.png"><img alt="Изображение:Coll2-02.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll2-02.png" src="banoz8m5.png" width="500" height="396" /></a>
</p>
</center>
<p>Если для объекта AlienShip1 вы не напишете последний параметр в функции CollideImage, вы не сможете провести проверку коллизий. Попробуйте, и вы увидите:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">DrawImage</span> AlienShip1, <span style="color: #FFFFFF;">250</span>,<span style="color: #FFFFFF;">100</span> <span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>AlienShip1,<span style="color: #FFFFFF;">250</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">1</span>,<span style="color: #ffff00; font-weight: bold;">Null</span><span style=" ">&#41;</span></div>
<p>Если вы проделаете подобное и для объекта SpaceShip то в массиве объектов, возвращаемого функцией, его не будет, это важно понять, так как при проверки на коллизии результат может быть не тем, что нужен. Так что вы можете просто написать лишний код, а желательно, избавлять себя от него.
</p>
<a name=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D1.80_.D1.81.D0.BB.D0.BE.D1.8F_.D0.BA.D0.BE.D0.BB.D0.BB.D0.B8.D0.B7.D0.B8.D0.B9"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=15" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">Пример слоя коллизий</span></h3>
<p>Ниже, пример определения коллизий между разными слоями:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Strict</span><br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Graphics</span> <span style="color: #FFFFFF;">640</span>,<span style="color: #FFFFFF;">480</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">AutoMidHandle</span> <span style="color: #ffff00; font-weight: bold;">True</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> SpaceShip:TImage=<span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-BlobShip.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> AlienShip1:TImage=<span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-UFO.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> AlienShip2:TImage=<span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-UFO.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> R:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">0</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> G:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">0</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> B:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">ResetCollisions</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">3</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawImage</span> AlienShip1, <span style="color: #FFFFFF;">250</span>,<span style="color: #FFFFFF;">100</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>AlienShip1,<span style="color: #FFFFFF;">250</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">1</span>,AlienShip1<span style=" ">&#41;</span><br />
&nbsp; <br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawImage</span> AlienShip2, <span style="color: #FFFFFF;">400</span>,<span style="color: #FFFFFF;">100</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>AlienShip2,<span style="color: #FFFFFF;">400</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">2</span>,AlienShip2<span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> Collision_Layer:<span style="color: #ffff00; font-weight: bold;">int</span>=<span style="color: #FFFFFF;">2</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> p:<span style="color: #ffff00; font-weight: bold;">Object</span><span style=" ">&#91;</span><span style=" ">&#93;</span>=<span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>Spaceship,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">0</span>,Collision_Layer,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> i:TImage=<span style="color: #ffff00; font-weight: bold;">EachIn</span> p<br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Select</span> i<br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> AlienShip1<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; R=<span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> AlienShip2<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; G=<span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Select</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">SetColor</span> R,G,B &nbsp; &nbsp;<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawImage</span> SpaceShip,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Flip</span><br />
&nbsp; <br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">Until</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>KEY_ESCAPE<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Скомпилировав, вы увидите, что коллизия происходит только между одинаковыми слоями. Чтобы сделать проверку между двумя кораблями, вы должны присвоить переменной Collision_Layer значение 3.
</p>
<a name=".D0.98.D1.82.D0.BE.D0.B3.D0.B8_2"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=16" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">Итоги</span></h3>
<p>В этой части мы рассмотрели способ проверки коллизий с помощью функции CollideImage.
</p><p>Стоит запомнить, что BlitzMax предоставляет 32 слоя коллизий. Следует повторить:
</p>
<ul><li>Сначала очищаем слои коллизий или один, нужный нам слой с помощью функции ResetCollisions(слой#)
</li><li>Записать в слой(и) изображение, которое мы будем проверять
</li><li>Считывать слой(и) для проверки на коллизии
</li></ul>
<p>И не забудьте, что слои являются битмасковыми
</p>
<a name=".D0.A2.D1.80.D0.B5.D1.82.D1.8C.D1.8F_.D1.87.D0.B0.D1.81.D1.82.D1.8C"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=17" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">Третья часть</span></h2>
<a name=".D0.92.D1.81.D1.82.D1.83.D0.BF.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_3"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=18" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">Вступление</span></h3>
<p>В предыдущей части мы узнали, как проверять коллизии с помощью функции CollideImage. При использовании CollideImage, проверка - пиксель-совершенная. Это можно проверить путем медленного движения игрока на корабль.
</p><p>Но, к сожалению, пиксель-совершенные коллизии тратят много ресурсов компьютера, что, естественно, приведет к падению FPS.
</p><p>BlitzMax предоставляет еще одну функцию, похожую на CollideImage- CollideRect. Давайте рассмотрим принцип ее работы.
</p>
<a name="CollideRect"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=19" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">CollideRect</span></h3>
<p>Синтаксис CollideRect схож с синтаксисом функции CollideImage
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> <span style="color: #ffff00; font-weight: bold;">CollideRect</span>:<span style="color: #ffff00; font-weight: bold;">Object</span><span style=" ">&#91;</span><span style=" ">&#93;</span><span style=" ">&#40;</span>x,y,w,h,collidemask%,writemask%,id:<span style="color: #ffff00; font-weight: bold;">Object</span>=<span style="color: #ffff00; font-weight: bold;">Null</span><span style=" ">&#41;</span></div>
<p>Давайте перепишем код, с использованием функции CollideRect.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Strict</span><br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Graphics</span> <span style="color: #FFFFFF;">640</span>,<span style="color: #FFFFFF;">480</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">AutoMidHandle</span> <span style="color: #ffff00; font-weight: bold;">True</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> SpaceShip:TImage=<span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-BlobShip.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> AlienShip1:TImage=<span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-UFO.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> AlienShip2:TImage=<span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;BMax-UFO.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> w:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #ffff00; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>SpaceShip<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> h:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #ffff00; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>SpaceShip<span style=" ">&#41;</span><br />
<br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> R:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">0</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> G:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">0</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> B:<span style="color: #ffff00; font-weight: bold;">Int</span>=<span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">ResetCollisions</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawImage</span> AlienShip1, <span style="color: #FFFFFF;">250</span>,<span style="color: #FFFFFF;">100</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>AlienShip1,<span style="color: #FFFFFF;">250</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">1</span>,AlienShip1<span style=" ">&#41;</span><br />
&nbsp; <br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawImage</span> AlienShip2, <span style="color: #FFFFFF;">400</span>,<span style="color: #FFFFFF;">100</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">CollideImage</span><span style=" ">&#40;</span>AlienShip2,<span style="color: #FFFFFF;">400</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">1</span>,AlienShip2<span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> p:<span style="color: #ffff00; font-weight: bold;">Object</span><span style=" ">&#91;</span><span style=" ">&#93;</span>=<span style="color: #ffff00; font-weight: bold;">CollideRect</span><span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-w,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-h,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">1</span>,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> i:TImage=<span style="color: #ffff00; font-weight: bold;">EachIn</span> p<br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Select</span> i<br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> AlienShip1<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; R=<span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> AlienShip2<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; G=<span style="color: #FFFFFF;">255</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Select</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">SetColor</span> R,G,B <br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawRect</span> <span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-w,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-h,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span><br />
<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawImage</span> &nbsp; SpaceShip,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Flip</span><br />
&nbsp; <br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">Until</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>KEY_ESCAPE<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<center>
<p><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-BlobShip.png" class="image" title="Изображение:BMax-BlobShip.png"><img alt="Изображение:BMax-BlobShip.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-BlobShip.png" src="y-4ybzg0.png" width="64" height="64" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-UFO.png" class="image" title="Изображение:BMax-UFO.png"><img alt="Изображение:BMax-UFO.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:BMax-UFO.png" src="54w2qc_x.png" width="160" height="128" /></a>
</p>
</center>
<p>Обратите внимание, что коллизия происходит тогда, когда прямоугольник соприкасается с кораблем. Попробуйте запустить эту программу, без использования выражения DrawRect, и вы увидите, что коллизия ведет себя, так же как и раньше, при использовании функции CollideRect.
</p>
<center>
<p><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll3-01.png" class="image" title="Изображение:Coll3-01.png"><img alt="Изображение:Coll3-01.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll3-01.png" src="096nivay.png" width="500" height="396" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll3-02.png" class="image" title="Изображение:Coll3-02.png"><img alt="Изображение:Coll3-02.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Coll3-02.png" src="n3hyad9-.png" width="500" height="396" /></a>
</p>
</center>
<p>Самое классное в функции CollideRect - это то, что она возвращает массив объектов, которые "накрыл" прямоугольник. Используя этот массив, вы можете провести пиксель - совершенную проверку на коллизию, между объектами в этом массиве. Вот демонстрация этого:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Local</span> p:<span style="color: #ffff00; font-weight: bold;">Object</span><span style=" ">&#91;</span><span style=" ">&#93;</span>=<span style="color: #ffff00; font-weight: bold;">CollideRect</span><span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-w,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-h,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">100</span>,<span style="color: #FFFFFF;">1</span>,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
<p><span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> i:TImage=<span style="color: #ffff00; font-weight: bold;">EachIn</span> p<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">ImagesCollide</span><span style=" ">&#40;</span>i,<span style="color: #FFFFFF;">150</span>,<span style="color: #FFFFFF;">200</span>,<span style="color: #FFFFFF;">0</span>,SpaceShip,<span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetClsColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetClsColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">Next</span></div>
<a name="AutoMidHandle"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=20" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">AutoMidHandle</span></h3>
<p>Обратите внимание, что локальное начало координат рисуемого изображения является очень важным аспектом, при проверке на коллизии. Не забывайте, что функции CollideImage/CollideRect и DrawImage используют x- и y-координаты изображения, а так же MidHandle-фактор, то есть, для точного определения коллизий вы должны использовать одинаковые данные.
</p>
<a name=".D0.92.D1.8B.D0.B1.D0.BE.D1.80_.D1.89.D0.B5.D0.BB.D1.87.D0.BA.D0.BE.D0.BC_.D0.BC.D1.8B.D1.88.D0.B8.2C_.D1.81_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_CollideRect"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=21" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">Выбор щелчком мыши, с помощью CollideRect</span></h3>
<p>Вот небольшой пример, как можно использовать CollideRect для определения выбора. Не забывайте 'записывать' в слой коллизии изображения, которые будут выбраны.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">CollideRect</span><span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">2</span>,<span style="color: #FFFFFF;">2</span>,<span style="color: #FFFFFF;">1</span>,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">And</span> <span style="color: #ffff00; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">1</span><span style=" ">&#41;</span><br />
<p>&nbsp; <span style=" ">&#40;</span>Ваш Код<span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">EndIf</span></div>
<p>Вот версия для искушенных: возвращенный объект вы можете использовать для дальнейших действий.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Local</span> p:<span style="color: #ffff00; font-weight: bold;">Object</span><span style=" ">&#91;</span><span style=" ">&#93;</span>=<span style="color: #ffff00; font-weight: bold;">CollideRect</span><span style=" ">&#40;</span><span style="color: #ffff00; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #ffff00; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #FFFFFF;">2</span>,<span style="color: #FFFFFF;">2</span>,<span style="color: #FFFFFF;">1</span>,<span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">And</span> <span style="color: #ffff00; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">1</span><span style=" ">&#41;</span><br />
<p><span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> i:TImage=<span style="color: #ffff00; font-weight: bold;">EachIn</span> p<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Select</span> i<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> Alien<br />
&nbsp; &nbsp; &nbsp; <span style=" ">&#40;</span>Ваш Код<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> Player<br />
&nbsp; &nbsp; &nbsp; <span style=" ">&#40;</span>Ваш Код<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndSelect</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">Next</span></div>
<a name=".D0.98.D1.82.D0.BE.D0.B3.D0.B8_3"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D0%B8_%D0%B2_BlitzMax&amp;action=edit&amp;section=22" title="Коллизии в BlitzMax">править</a>]</span> <span class="mw-headline">Итоги</span></h3>
<p>Третья часть этого туториала продемонстрировала вам, как можно провести проверку на коллизии быстрым и простым путем - используя функцию CollideRect. Вы вольны экспериментировать и именно вы должны определить, где использование этой функции для вас оптимально. А если вам непонятно, как использовать ее, воспользуйтесь функцией CollideImage.
</p><p>Вот и всё. Надеюсь, вы поняли, как делать проверку на коллизии в BlitzMax.
</p>
<div align="right"><a href="http://blitzetcetera.org/images/9/94/BlitzMax_Collisions.zip" class="internal" title="BlitzMax Collisions.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: Assari, 2006<br />
Перевод: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:JohnK" title="Участник:JohnK">JohnK</a> (e-mail: JohnK_08@mail.ru, ICQ: 438-180-831), 2007
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Отражение луча от произвольной поверхности в 3D"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Отражение луча от произвольной поверхности в 3D&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Отражение луча от произвольной поверхности в 3D&amp;action=edit">править</a>]</span><span class="mw-headline">Отражение луча от произвольной поверхности в 3D</span></h1>
<p>Как узнать, куда полетит шарик после столкновения с кубиком? Сразу вспоминаем фразу: «Угол отражения равен углу падения». Правильно!!! Но что делать, если мы не знаем угол падения? Всё просто…
</p>
</p><p>Нам необходимо знать направление полета шарика. Для этого нам нужны три числа: на сколько мячик сместится по оси X, по оси Y и по оси Z. То есть, шарик вылетел из точки (0,0,0) после перемещения его координата (4,2,4) – это и есть вектор направления полета шарика. Обозначим его V(vx,vy,vz)
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Reflection01.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Reflection01.jpg" src="ugvlyx05.jpg" width="320" height="261" /></a></span></div></div>
<p>Если траектория шарика может меняться со временем (например, сдуло ветром), то вектор перемещения шарика можно вычислить путем вычитания предыдущих координат шарика из нынешних.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Reflection02.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Reflection02.jpg" src="rgt18cei.jpg" width="320" height="261" /></a></span></div></div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">vx = x_new - x_old = <span style="color: #33ffdd;">8</span> – <span style="color: #33ffdd;">6</span> = <span style="color: #33ffdd;">2</span><br />
vy = y_new – y_old = <span style="color: #33ffdd;">4</span> – <span style="color: #33ffdd;">1</span> = <span style="color: #33ffdd;">3</span></div> 
<p>Так же вычисляется и vz.
</p><p>Еще необходимо знать, как повернута плоскость кубика, с которой шарик столкнулся. Для этого существует вектор нормали. Это перпендикуляр к плоскости. Назовем его вектор N(nx,ny,nz).
</p><p>В Blitz 3D вектор нормали можно узнать, используя команды CollisionNX(),CollisionNY(),CollisionNZ(). Используются они в цикле от 1 до CountCollisions(entity).
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">For</span> k=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">CountCollisions</span><span style=" ">&#40;</span>sharik<span style=" ">&#41;</span><br />
<p><br />
nx#=<span style="color: #aaffff; font-weight: bold;">CollisionNX</span><span style=" ">&#40;</span>sharik,k<span style=" ">&#41;</span><br />
ny#=<span style="color: #aaffff; font-weight: bold;">CollisionNY</span><span style=" ">&#40;</span>sharik,k<span style=" ">&#41;</span><br />
nz#=<span style="color: #aaffff; font-weight: bold;">CollisionNZ</span><span style=" ">&#40;</span>sharik,k<span style=" ">&#41;</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">Next</span></div>
<p>nx, ny, nz – вектор нормали плоскости, с которой столкнулся шарик.
</p><p>Итак, мы знаем направление полета шарика vx, vy, vz и направление плоскости, с которой шарик столкнулся. Можно начинать считать:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">For</span> k=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">CountCollisions</span><span style=" ">&#40;</span>sharik<span style=" ">&#41;</span><br />
<p><br />
<span style="color: #ffee00">; Находим векрот нормали плоскости</span><br />
nx#=<span style="color: #aaffff; font-weight: bold;">CollisionNX</span><span style=" ">&#40;</span>sharik,k<span style=" ">&#41;</span><br />
ny#=<span style="color: #aaffff; font-weight: bold;">CollisionNY</span><span style=" ">&#40;</span>sharik,k<span style=" ">&#41;</span><br />
nz#=<span style="color: #aaffff; font-weight: bold;">CollisionNZ</span><span style=" ">&#40;</span>sharik,k<span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">; Находим вектор полета шарика</span><br />
vx#=<span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>sharik<span style=" ">&#41;</span>-old_x#<br />
vy#=<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>sharik<span style=" ">&#41;</span>-old_y#<br />
vz#=<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>sharik<span style=" ">&#41;</span>-old_z#<br />
<br />
<span style="color: #ffee00">; Вычисление нового вектора полета шарика (1)</span><br />
dot#=vx*nx+vy*ny+vz*nz<br />
ex#=nx*dot<br />
ey#=ny*dot<br />
ez#=nz*dot<br />
new_x=vx-ex*<span style="color: #33ffdd;">2</span><br />
new_y=vy-ey*<span style="color: #33ffdd;">2</span><br />
new_z=vz-ez*<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;<br />
</p>
New_x, new_y, new_z – новый вектор направления полета шарика.</div>
<p>Вычисления после нахождения векторов – это поворот вектора полета шарика вокруг вектора нормали плоскости на 180 градусов. Процесс вычисления поворота одного вектора вокруг другого на любой угол очень трудоемкий. Но так как у нас угол всегда постоянен, то формула сокращается до той, что представлена в программе выше (1).
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Reflection03.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Reflection03.jpg" src="xb0uc_x4.jpg" width="320" height="261" /></a></span></div></div>
<p>Альфа ( угол падения) равен Бета (угол отражения).
</p><p>Для направления шарика на новый вектор полета применим команду AlignToVector:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">AlignToVector</span> sharik,new_x,new_y,new_z,<span style="color: #33ffdd;">3</span></div>
<p>ВСЁ!!!
</p>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Grover" title="Участник:Grover">Grover</a> (e-mail: mail_grover@mail.ru)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Оформление программ"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Оформление программ&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Оформление программ&amp;action=edit">править</a>]</span><span class="mw-headline">Оформление программ</span></h1>
<p>Немного советов начинающим по оформлению программ для удобства редактирования и чтения:
</p>
</p>
<ul><li>Называйте переменные, константы, функции, типы и методы так, чтобы было понятно, для чего они предназначены. Если плохо знаете английский - пишите транслитом. Ведь гораздо понятнее (особенно поначалу)
</li></ul>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">risunki = <span style="color: #ffff00; font-weight: bold;">CreateImage</span><span style=" ">&#40;</span>RazmerRisunkovX, RazmerRisunkovY, KolvoRisunkov<span style=" ">&#41;</span></div>
<p>чем
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">i = <span style="color: #ffff00; font-weight: bold;">CreateImage</span><span style=" ">&#40;</span>ixs, iys, q<span style=" ">&#41;</span></div>
<p>В конечном счете, важно соблюсти баланс между краткостью и понятностью кода, чтобы тратить минимум времени на чтение (особенно при отладке) и редактирование. Можно условиться о сокращениях часто встречающихся характеристик (например q - quantity - количество). Лучше использовать для выделения слов заглавные буквы, чем символ подчеркивания (RazmerRisunkovX вместо razmer_risunkov_x), т. к. такие названия занимают меньше места. 
</p>
<ul><li>Делайте отступы для обозначения вложенных в циклы (For-Next, Repeat-Forever, While-Wend), условия (If-Then-Else-End If), типы (Type, Method, Function) и т. п. команд. Рекомендую использовать Tab вместо пробела, т. к. множество редакторов, включая MaxIDE "заточены" именно под него - при переходе на следующую строку они автоматически добавляют нужное кол-во Tab'ов.
</li></ul>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">For</span> Y = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Until</span> FieldYSize<br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> X = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Until</span> FieldXSize<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> frame<span style=" ">&#91;</span>X, Y<span style=" ">&#93;</span> &gt; DoNotDrawTile <span style="color: #ffff00; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; XX = TileSize * X + FieldDX<br />
&nbsp; &nbsp; &nbsp; YY = TileSize * Y + FieldDY<br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawImage</span> images, XX, YY, Frame<span style=" ">&#91;</span>X, Y<span style=" ">&#93;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">Next</span></div>
<ul><li>Используйте константы, если в программе требуется использовать одно и то же число (например, ширину поля) несколько раз. Гораздо проще заменить значение константы (или перевести ее в переменную), чем искать и менять значения по всей программе.
</li></ul>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Const</span> FieldXSize = <span style="color: #FFFFFF;">80</span>, FieldYSize = <span style="color: #FFFFFF;">60</span><br />
<p><br />
<span style="color: #ffff00; font-weight: bold;">For</span> Y = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Until</span> FieldYSize<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> X = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Until</span> FieldXSize<br />
&nbsp; &nbsp; Frame<span style=" ">&#91;</span>X, Y<span style=" ">&#93;</span> = <span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">2</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">Next</span></div>
<ul><li>Если вы не используете моноширинный (с фиксированной шириной букв) шрифт, то для удобочитаемости обрамляйте операторы (=, &gt;, &lt;, +, -, *, /, ^, |, &amp;) пробелами, ставьте пробел после запятой. У обычных шрифтов есть весомое преимущество: они компактнее, а значит вы увидите больше символов на отображаемой части рабочего пространства.
</li></ul>
<ul><li>Возможно, вам будет проще отлаживать программу, если все переменные будут заданы заранее (и будут жестко определены их типы). В таком случае, пишите в начале программы команду "SuperScript". Тогда вы будете застрахованы от выявления ошибочно набранного названия переменной (впрочем, если существует переменная и с "неправильным" названием, то искать ошибку вам все равно придется). Еще при этом повысится понятность кода.
</li></ul>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="BlitzMax и LUA"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:BlitzMax и LUA&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=BlitzMax и LUA&amp;action=edit">править</a>]</span><span class="mw-headline">BlitzMax и LUA</span></h1>
</p>
<a name=".D0.A0.D0.B0.D0.B1.D0.BE.D1.82.D0.B0_.D1.81_LUA_.D0.B2_BlitzMax"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=BlitzMax_%D0%B8_LUA&amp;action=edit&amp;section=1" title="BlitzMax и LUA">править</a>]</span> <span class="mw-headline">Работа с LUA в BlitzMax</span></h2>
<p>1. Инициализация LUA. Для инициализация LUA можно использовать следующий код:
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">Local LUA:Byte Ptr<br />
<p>LUA = lua_open<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span><br />
luaopen_base<span style="color: #66cc66;">&#40;</span>LUA<span style="color: #66cc66;">&#41;</span><br />
luaopen_io<span style="color: #66cc66;">&#40;</span>LUA<span style="color: #66cc66;">&#41;</span><br />
luaopen_string<span style="color: #66cc66;">&#40;</span>LUA<span style="color: #66cc66;">&#41;</span><br />
</p>
luaopen_math<span style="color: #66cc66;">&#40;</span>LUA<span style="color: #66cc66;">&#41;</span></div>
где LUA - дескриптор скриптового движка. После завершения работы можно закрыть LUA, используя команду lua_close(индификатор_движка), например: <div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">Local LUA:Byte Ptr 'тут какие-то команды lua_close<span style="color: #66cc66;">&#40;</span>LUA<span style="color: #66cc66;">&#41;</span></div>
<p>2. Выполнение файла со скриптом. Для выполнения файла содержащего скрипт написанный на LUA используется команда lua_dofile(идентификатор_движка, имя_файла), например для выполнения файла test.lua:
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">lua_dofile<span style="color: #66cc66;">&#40;</span>LUA, <span style="color: #ff0000;">&quot;test.lua&quot;</span>.ToCString<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span></div>
<p>ToCString() добавлять обязательно, т.к. обычные строки функция не принимает. Также имеются функции lua_dostring() и lua_dobuffer() но в BlitzMax 1.14 их нет.
</p><p>3. Регистрация функций Блица в LUA Для этого используется функция lua_register(идентификатор_движка, имя_функции_в_ЛУА, имя_регистрируемой_функции_в_Блице). Наример функция DrawText:
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">Function Draw_Text:Int<span style="color: #66cc66;">&#40;</span>lua:Byte Ptr<span style="color: #66cc66;">&#41;</span><br />
<p>Local text$ = String.FromCString<span style="color: #66cc66;">&#40;</span>lua_tostring<span style="color: #66cc66;">&#40;</span>lua, <span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span><br />
Local x = lua_tonumber<span style="color: #66cc66;">&#40;</span>lua, <span style="color: #cc66cc;">2</span><span style="color: #66cc66;">&#41;</span><br />
Local y = lua_tonumber<span style="color: #66cc66;">&#40;</span>lua, <span style="color: #cc66cc;">3</span><span style="color: #66cc66;">&#41;</span><br />
DrawText text$, x, y<br />
</p>
End Function</div>
<p>регистрируем так:
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">lua_register<span style="color: #66cc66;">&#40;</span>LUA, <span style="color: #ff0000;">&quot;draw_text&quot;</span>.ToCString<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>, draw_text<span style="color: #66cc66;">&#41;</span></div>
<p>4. Импорт переменной из Блица в LUA. Для этого надо 1) поместить значения переменной в Блице в стек 2) считать его оттуда в переменную LUA. Для этого используем функции:
</p>
<ul><li> lua_pushnumber(индификатор_движка, число) - для чисел
</li><li> lua_pushstring(индификатор_движка, строка) - для строк
</li><li> lua_setglobal(индификатор_движка, имя_переменной_в_ЛУА) - для считывания  Т.к. LUA может преобразовывать строки в числа автоматически, то можно использовать lua_pushstring и для чисел. Например, перенесем переменные a1=10 и a2="qwerty" в LUA:
</li></ul>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">lua_pushnumber<span style="color: #66cc66;">&#40;</span>LUA, a1<span style="color: #66cc66;">&#41;</span><br />
<p>lua_setglobal<span style="color: #66cc66;">&#40;</span>LUA, <span style="color: #ff0000;">&quot;a1&quot;</span><span style="color: #66cc66;">&#41;</span><br />
lua_pushstring<span style="color: #66cc66;">&#40;</span>LUA, a2<span style="color: #66cc66;">&#41;</span><br />
</p>
lua_setglobal<span style="color: #66cc66;">&#40;</span>LUA, <span style="color: #ff0000;">&quot;a2&quot;</span><span style="color: #66cc66;">&#41;</span></div>
<p>5. Создание функций для регистрации в LUA. В LUA получиться зарегистрировать не любую функцию. Например такую:
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">Function SimpleFunction<span style="color: #66cc66;">&#40;</span>first, second<span style="color: #66cc66;">&#41;</span><br />
<p>Print first + second<br />
</p>
End Function</div>
<p>не получится. Для создания функции предназначенной для регистрации в LUA можно использовать такой шаблон:
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">Function имя_функции:Int<span style="color: #66cc66;">&#40;</span>lua:Byte Ptr<span style="color: #66cc66;">&#41;</span> 'обработка параметров функции<br />
<p>'сам текст функции<br />
</p>
End Function</div>
<p>Параметры функции можно будет получить используя их индексы, например функция вызывалась из LUA так: function("qwerty", 12345), тогда строка qwerty имеет индекс 1, а число 12345 индекс 2. Получить их для использования в функции можно так:
</p>
<ul><li> Для строки - Local text$ = String.FromCString(lua_tostring(lua, 1))
</li><li> Для числа - Local number = lua_tonumber(lua, 2)
</li></ul>
<p>Можно конечно для чисел использовать и
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">Local text$ = String.FromCString<span style="color: #66cc66;">&#40;</span>lua_tostring<span style="color: #66cc66;">&#40;</span>lua, <span style="color: #cc66cc;">2</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span></div>
<p>а потом
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">number = text$.ToInt<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div>
<p>но зачем? Вообще функции при вызове из LUA могут иметь любое количество параметров, например предыдущую функцию можно вызвать так:
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;"><span style="color: #b1b100;">function</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">&quot;qwerty&quot;</span>, <span style="color: #cc66cc;">12345</span>, <span style="color: #ff0000;">&quot;second string&quot;</span><span style="color: #66cc66;">&#41;</span></div>
<p>Но если параметры функции будут обрабатываться так:
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">Local text$ = String.FromCString<span style="color: #66cc66;">&#40;</span>lua_tostring<span style="color: #66cc66;">&#40;</span>lua, <span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span><br />
Local number = lua_tonumber<span style="color: #66cc66;">&#40;</span>lua, <span style="color: #cc66cc;">2</span><span style="color: #66cc66;">&#41;</span></div>
<p>То строка "second string" не будет принята во внимание, для ее обработки надо добавить строку:
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">Local text2$ = String.FromCString<span style="color: #66cc66;">&#40;</span>lua_tostring<span style="color: #66cc66;">&#40;</span>lua, <span style="color: #cc66cc;">3</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span></div>
<p>т. е. обработать параметр с индексом 3. Ну а после обработки делайте что хотите с этими параметрами.
</p>
<a name=".D0.A1.D0.B8.D0.BD.D1.82.D0.B0.D0.BA.D1.81.D0.B8.D1.81_LUA"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=BlitzMax_%D0%B8_LUA&amp;action=edit&amp;section=2" title="BlitzMax и LUA">править</a>]</span> <span class="mw-headline">Синтаксис LUA</span></h2>
<p>1. В LUA имеется 6 типов данных: nil, number (число), string (строка), function (функция), userdata (пользовательские данные) и table (таблица). Какой тип для чего, думаю, объяснять не надо. Замечу только что table это есть массивы, но дело в том, что LUA поддерживает ассоциативные массивы, наример данные о пользователе - a["name"],a["email"],a["birthday"] и т.д., т.е. элементы могут индексироваться не только числами, но и какими-либо строками, что может облегчить работу с ними.
</p><p>2. Идентификатором в LUA может быть любая строка символов, цифр и символов подчеркивания, не начинающаяся цифрой. Вообще индификаторы в LUA могут состоять и из русских букв, но если в системе русский не установлен, то произойдет ошибка, поэтому лучше использовать только латинские буквы. Следующие слова зарезервированы, и не могут использоваться как идентификаторы: and, break, do, else, elseif, return, end, for, function, if, in, then, local, nil, not, or, repeat, until, while - в общем, стандартный набор. Язык LUA чувтвителен к регистру и, например, and это не одно и то же, что и AND или And.
</p>
<ul><li> Комментарии в LUA начинаются с двух тире '--' и продолжаются до конца строки.
</li><li> Строки могут быть разграничены одиночными или двойными кавычками, и могут содержать C-подобные управляющие последовательности: \a (bell), \b (backspace), \f (form feed), \n (newline), \r (carriage return), \t (horizontal tab), \v (vertical tab), \\ (backslash), \" (double quote), \' (single quote), и \newline. Символ в строке может также быть определен числовым значением, через управляющую последовательность \ddd, где ddd последовательность до трех десятичных цифр. Строки в LUA могут содержать любое 8-разрядное значение, включая вложенные нули, которые могут быть определены как \000.
</li><li> Строки могут также быть разграничены парами [[ ... ]]. Символы в этой форме в скобках могут занимать по несколько строк, содержать вложенные пары скобок [[ ... ]] и не интерпретировать управляющие последовательности. Например, выражения 
</li></ul>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;"><span style="color: #ff0000;">&quot;qwerty<span style="color: #000099; font-weight: bold;">\n</span>123&quot;</span></div>
<p>и
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;"><span style="color: #66cc66;">&#91;</span><span style="color: #66cc66;">&#91;</span>qwerty <span style="color: #cc66cc;">123</span><span style="color: #66cc66;">&#93;</span><span style="color: #66cc66;">&#93;</span></div> идентичны.
<p>3. Блоки. Блоком является список инструкций. Синтаксис такой: "do инструкции end". Блоки можно использовать для прекращения выполнения инструкций в любом месте, также блоки могут быть использованы для управления областью видимости локальных переменных.
</p><p>4. В LUA поддерживаются многократные присваивания. Т.е. в левой части вы пишите список переменных, а в правой список значений, оба этих списка разделяются запятыми. Например
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">a,b,c=<span style="color: #cc66cc;">1</span>,<span style="color: #cc66cc;">2</span>,<span style="color: #cc66cc;">3</span></div>
<p>равносильно:
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">a=<span style="color: #cc66cc;">1</span> b=<span style="color: #cc66cc;">2</span> c=<span style="color: #cc66cc;">3</span></div>
<p>Надо заметить, что сначала оцениваются все индексы слева и все значения справа, а только потом делается присваивание, например:
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">a=<span style="color: #cc66cc;">3</span><br />
a,b<span style="color: #66cc66;">&#91;</span>a<span style="color: #66cc66;">&#93;</span>=<span style="color: #cc66cc;">1</span>,<span style="color: #cc66cc;">2</span></div>
<p>Здесь b[3] будет присвоено 2, а b[1] не будет затронуто, т.к. b[a] оценен до того как a было присвоено значение 1. Многократное присваивание можно использовать, чтобы поменять значения двух переменных:
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">a,b=b,a</div>
<p>5. Условия, циклы
</p>
<ul><li> Инструкция if. Синтаксис стандартен:
</li></ul>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;"><span style="color: #b1b100;">if</span> условие <span style="color: #b1b100;">then</span> инструкции <span style="color: #b1b100;">else</span> инструкции <span style="color: #b1b100;">end</span></div> Можно использовать и elseif.
<ul><li> Инструкция while. Синтаксис:
</li></ul>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;"><span style="color: #b1b100;">while</span> условие <span style="color: #b1b100;">do</span> инструкции <span style="color: #b1b100;">end</span></div>
<ul><li> Инструкция repeat. Синтаксис:
</li></ul>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;"><span style="color: #b1b100;">repeat</span> инструкции <span style="color: #b1b100;">until</span> условие</div>
<ul><li> Инструкция for. Синтаксис:
</li></ul>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;"><span style="color: #b1b100;">for</span> переменная=начальное_значение,конечное_значение<span style="color: #66cc66;">&#91;</span>,шаг<span style="color: #66cc66;">&#93;</span> <span style="color: #b1b100;">do</span> инструкции <span style="color: #b1b100;">end</span></div>
<p>Параметр "шаг" можно опустить и тогда будет использоваться 1.
</p><p>6. LUA поддерживает обычные арифметические операторы: двоичный + (сложение), - (вычитание), * (умножение), / (деление), ^ (возведение в степень).
</p><p>7. Реляционные операторы: ==, ~=, &lt;, &gt;, &lt;=, &gt;=. Они возвращают nil как ложь и любое другое значение как истину.
</p><p>8. Логические операторы: and, or, not
</p><p>9. Оператором объединения являются две точки '..', если операнд - число, то он преобразуется в строку.
</p><p>10. Таблицы (массивы). Для создания таблицы используется конструкция типа:
</p>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">a=<span style="color: #66cc66;">&#123;</span><span style="color: #ff0000;">&quot;qwerty&quot;</span>,<span style="color: #cc66cc;">1</span>,<span style="color: #cc66cc;">2</span><span style="color: #66cc66;">&#125;</span></div>
НО! Строка qwerty будет 1 а не 0 элементом! Для того чтобы добавить 0 элемент можно использовать конструкцию типа: <div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">a=<span style="color: #66cc66;">&#123;</span><span style="color: #66cc66;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #66cc66;">&#93;</span>=<span style="color: #ff0000;">&quot;qwerty&quot;</span>,<span style="color: #cc66cc;">1</span>,<span style="color: #cc66cc;">2</span><span style="color: #66cc66;">&#125;</span></div> и тогда строка qwerty будет нулевым элементом. Соответственно так можно устанавливать любой элемент таблицы. Для создания ассоциативного массива используется конструкция типа: <div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">a=<span style="color: #66cc66;">&#123;</span>f=<span style="color: #cc66cc;">1</span>,s=<span style="color: #cc66cc;">2</span>,t=<span style="color: #cc66cc;">3</span><span style="color: #66cc66;">&#125;</span></div> Таблицы в LUA могут содержать разные типы данных одновременно.
<p>11. LUA имеет несколько базисных функций:
</p>
<ul><li> call(func,arg) - вызывает функцию func с параметрами заданными в таблице arg, это равносильно следующему коду:
</li></ul>
<div class="lua" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">func<span style="color: #66cc66;">&#40;</span>arg<span style="color: #66cc66;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#93;</span>,arg<span style="color: #66cc66;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #66cc66;">&#93;</span>,etc<span style="color: #66cc66;">&#41;</span></div>
<ul><li> dofile(filename) - откроет файл filename и выполнит его содержимое как LUA код.
</li><li> dostring(string) - выполнит полученную строку как LUA код.
</li><li> foreach(table, func) - выполнит функцию func для каждого элемента таблицы table, используя индексы и их значения как параметры функции.
</li><li> foreachi(table, func) - похожа на предыдущую, но использует только числовые индексы.
</li><li> getglobal(name) - получает значение глобальной переменной name.
</li><li> getn(table) - возвращает размер таблицы.
</li><li> print(строка1,строка2...) - получает любое количество параметров и печатает их значения.
</li><li> setglobal(name, value) - присваивает глобально переменной name значение value.
</li><li> sort(table) - отсортирует таблицу table
</li><li> tinsert(table[,pos],value) - вставляет в таблицу table значение value в позицию pos, сдвигая остальные элементы. Если pos не задано, то значение вставляется, как последний элемент.
</li><li> tremove(table[,pos]) - удалит из таблицы table элемент pos, сдвинув остальные элементы. Если pos не задан, то удалится последний элемент.
</li><li> type(var) - возвращает тип переменной var, как строку("nil", "number", "string", "table", "function", "userdata").
</li></ul>
<p>12. Работа со строками.
</p>
<ul><li> strbyte (str[,n]) - возвращает числовой код n-го элемента строки str.
</li><li> strlen(str) - вернет длину строки.
</li><li> strlower(str) - вернет строку в нижнем регистре.
</li><li> strrep(str,n) - вернет строку являющуюся суммой n копий строки str.
</li><li> strsub(str,s[,e]) - вернет часть строки str начинающуюся с символа s и заканчивающегося символом e (s и e - номера символов в строке). Если написать strsub(str,-n) то функция вернет n последних символов строки.
</li><li> strupper(str) - вернет строку в верхнем регистре.
</li></ul>
<p>13. Математические функции: abs, acos, asin, atan, atan2, ceil, cos, deg, exp, floor, log, log10, max, min, mod, rad, sin, sqrt, tan, frexp, ldexp, random, randomseed
</p><p>14. Работа с файлами:
</p>
<ul><li> openfile(filename,mode) - Откроет файл filename в режиме mode. Возможные режимы:
<ul><li> r - режим чтения.
</li><li> w - режим записи.
</li><li> a - режим добавления к концу.
</li><li> r+ - режим обновления, все ранее записанные данные сохраняются.
</li><li> w+ - режим обновления, все ранее записанные данные уничтожаются.
</li><li> a+ - режим модификации, предыдущие данные сохраняются, запись позволяется только в конце файла.
</li></ul>
</li><li> closefile(handle) - закроет файл.
</li><li> remove(filename) - удаляет файл.
</li><li> rename(name1,name2) - переименовывает из name1 в name2.
</li><li> readfrom(filename) - читает из файла.
</li><li> writeto(filename) - пишет в файл, старые данные не сохраняются.
</li><li> appendto(filename) - пишет в файл, старые данные сохраняются.
</li><li> flush (filehandle) - сохраняет все изменения в открытом файле.
</li><li> write(filehandle,value1,...) - Пишет все полученные значения в файл.
</li></ul>
<p>В конце скажу, что файлы с LUA кодом могут быть 2х форматов: прекомпилированные или просто текстовые. При загрузке LUA автоматически определит формат. Для компиляции байт-кода необходимо скачать LUA с офф. сайта и скомпилировать lua.exe, используемый для перегона текстовых файлов в бинарные. Офф. сайт - <a href="http://www.lua.org/" class="external free" title="http://www.lua.org" rel="nofollow">http://www.lua.org</a>
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Отладка программы консольным методом"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Отладка программы консольным методом&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Отладка программы консольным методом&amp;action=edit">править</a>]</span><span class="mw-headline">Отладка программы консольным методом</span></h1>
<p>Это скорее не урок, а описание одного из методов отладки кода.
</p>
</p><p>Консольный метод отладки я позаимствовал из игр (из всех, которые знаю).
<p>К примеру, вам надо проверить как прыгает главный БОСС в конце уровня.
Вы скажете, ставим герою 99999999999% жизни, всё оружие да побольше и в путь!!!
</p>
</p><p>Или более простой способ - телепортировать героя в конец уровня.
<p>Согласен, вы посмотрели и решили, что БОСС должен прыгать выше. Что ж, снова ждем, пока загрузится игра и т.д. и т.п. ...
Таким образом, что бы подобрать всего один параметр (высота прыжка БОССа), вы потратили минут 20, а то и все 60. Грустно... Есть решение!!!
</p>
</p><p>В главном цикле программы пишем:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">88</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> Consol<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">; Если нажата клавиша &lt; F12 &gt;</span></div>
<p>Прежде чем писать процедуру, подготовим код.
Пусть за высоту прыжка БОССа отвечает переменная UP.
Переменная должна быть объявлена как Global, т.е. в том месте программы, где написано
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">UP=<span style="color: #33ffdd;">10</span></div>
<p>Исправляем на&nbsp;:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> UP=<span style="color: #33ffdd;">10</span><br />
<p>Это необходимо для того, что бы переменную можно было изменять в любой другой функции. Теперь можно писать саму функцию:<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> consol<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
comand$=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Enter command &gt; &quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> comand$=<span style="color: #00ff66;">&quot;UP&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> UP=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;UP = &quot;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Всё! Запускаем программу, телепортируемся к БОССу, а эта редиска прыгает на 10! Нажимаем F12, в верхнем левом углу появляется надпись:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">Enter command &gt;</div>
<p>Пишем «UP» (без кавычек) и нажимаем Enter, новая надпись:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">Enter command &gt; UP<br />
UP =</div>
<p>Пишем «20» (без кавычек) и нажимаем Enter, вот теперь БОСС запрыгал на 20. Если вдруг не прыгает, значит, Вы что-то не так сделали.
</p><p>Таким образом, один раз написав функцию Consol(), и пополняя ее в процессе разработки, Вы будете тратить меньше времени на подбор параметров.
</p><p>Рассмотрим данный способ на более конкретном примере:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Include</span> <span style="color: #00ff66;">&quot;bah.bb&quot;</span> <span style="color: #ffee00">; подключаем нашу библиотеку</span><br />
<br />
cam=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> cam,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-20</span><br />
lit=<span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">57</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> create_bah<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">300</span><span style=" ">&#41;</span> <span style="color: #ffee00">; При нажатии наа</span><br />
<span style="color: #ffee00">;«Пробел» создать салют</span><br />
<br />
update_bah<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">; Просчитать новое положение частиц</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Изображение для программы:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Salute.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Salute.png" src="kn32szkw.png" width="64" height="64" /></a></span></div></div>
<p>Вот библиотека Bah.bb, ее нужно вставить в программу:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sparcs<br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">Field</span> x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> speed#<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> time_life#<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> Create_bah<span style=" ">&#40;</span>x#,y#,z#,col<span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i= <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> col<br />
<br />
e.sparcs = <span style="color: #aaffff; font-weight: bold;">New</span> sparcs<br />
e\x=x<br />
e\y=y<br />
e\z=z<br />
e\speed=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span>-.<span style="color: #33ffdd;">4</span>,.<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span><br />
e\time_life=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">40</span>,<span style="color: #33ffdd;">70</span><span style=" ">&#41;</span><br />
e\entity=<span style="color: #aaffff; font-weight: bold;">LoadSprite</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Salute.png&quot;</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> e\entity,x,y,z<br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> e\entity,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">360</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">360</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">360</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> Update_bah<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> w.sparcs =<span style="color: #aaffff; font-weight: bold;">Each</span> sparcs<br />
<br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> w\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,w\speed<br />
w\time_life=w\time_life<span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> w\time_life&lt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">FreeEntity</span> w\entity<br />
<span style="color: #aaffff; font-weight: bold;">Delete</span> w<br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Изменяем тело программы:
</p><p>1. После строки Include “bah.bb” вставляем:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> X#=<span style="color: #33ffdd;">0</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Global</span> Y#=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Z#=<span style="color: #33ffdd;">0</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Global</span> Col=<span style="color: #33ffdd;">300</span></div>
<p>2. Изменяем параметры функции create_bah():
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">create_bah<span style=" ">&#40;</span>X,Y,Z,Col<span style=" ">&#41;</span></div>
<p>3. Добавляем вызов функции Consol() – после строки update_bah() пишем&nbsp;:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">88</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> Consol<span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>У Вас должно получиться следующее:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Include</span> <span style="color: #00ff66;">&quot;bah.bb&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> X#=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Y#=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Z#=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Col=<span style="color: #33ffdd;">300</span><br />
<br />
cam=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> cam,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-20</span><br />
lit=<span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">57</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> create_bah<span style=" ">&#40;</span>X,Y,Z,Col<span style=" ">&#41;</span><br />
<br />
update_bah<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">88</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> Consol<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Можно приступать к созданию консольной функции:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> consol<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><br />
comand$=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Enter comand &gt; &quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> comand$=<span style="color: #00ff66;">&quot;X&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> X=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;New X = &quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> comand$=<span style="color: #00ff66;">&quot;Y&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> X=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;New Y = &quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> comand$=<span style="color: #00ff66;">&quot;Z&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> X=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;New Z = &quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> comand$=<span style="color: #00ff66;">&quot;Col&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> X=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;New Col = &quot;</span><span style=" ">&#41;</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Запускаем и пробуем:
Нажимаем Пробел… Бабах..х..хх..х… В центре экрана.
Теперь нажимаем F12 и пишем имя переменной, которую хотим изменить, например Col (количество частиц). На предложение «New Col =» пишем 10 и нажимаем Enter.
Снова жмем Пробел… Фу, как некрасиво.
</p><p>На этом можно закончить, но есть маленький совет:
<p>В начале функции Consol() дописываем:
</p>
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;X&quot;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Y&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Z&quot;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Col&quot;</span></div>
<p>Теперь при нажатии на F12 Мы видим список всех команд, которые мы можем вводить. Только не забывайте этот список дополнять при создании новых команд.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span><br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Include</span> <span style="color: #00ff66;">&quot;bah.bb&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> X#=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Y#=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Z#=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> Col=<span style="color: #33ffdd;">300</span><br />
<br />
cam=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> cam,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-20</span><br />
lit=<span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">57</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> create_bah<span style=" ">&#40;</span>X,Y,Z,Col<span style=" ">&#41;</span><br />
<br />
update_bah<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">88</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> Consol<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> consol<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;X&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Y&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Z&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Col&quot;</span><br />
<br />
comand$=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Enter comand &gt; &quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> comand$=<span style="color: #00ff66;">&quot;X&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> X=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;New X = &quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> comand$=<span style="color: #00ff66;">&quot;Y&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> Y=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;New Y = &quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> comand$=<span style="color: #00ff66;">&quot;Z&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> Z=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;New Z = &quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> comand$=<span style="color: #00ff66;">&quot;Col&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> Col=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;New Col = &quot;</span><span style=" ">&#41;</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/0/0a/Console_Debug.zip" class="internal" title="Console Debug.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Grover" title="Участник:Grover">Grover</a> (e-mail: mail_grover@mail.ru)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Форматы данных"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Форматы данных&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Форматы данных&amp;action=edit">править</a>]</span><span class="mw-headline">Форматы данных</span></h1>
</p>
<a name=".D0.92.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A4%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D1%8B_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85&amp;action=edit&amp;section=1" title="Форматы данных">править</a>]</span> <span class="mw-headline">Введение</span></h2>
<p>Я заметил, что многие программисты (даже опытные) совершенно не заботятся о хранении данных для программ. Например, видел такую вещь: каждый спрайт был сохранен в отдельном bmp-файле размером с экран. В итоге, данные занимали десяток мегабайт, когда могли - сотню килобайт. В наш век 100х-гиговых винчестеров, DVD и процессоров с частотой, измеряемой в гигагерцах, это, конечно, не столь критично, как раньше, а простая архивация всей игры даст вполне приемлемый для скачивания объем. Но некоторые форматы позволяют ужать данные гораздо более эффективно. Кроме того, не думаю, что стоит выставлять напоказ свою лень и непрофессионализм, потому что в программе и данных кто-нибудь да будет копаться (тем более, если доступны исходники). А если вы создадите сайт с рисунками в формате BMP, на него заходить, конечно, будут. Но только один раз, обалдев при этом от потраченого трафика.
</p>
<a name=".D0.93.D1.80.D0.B0.D1.84.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B5_.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.82.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A4%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D1%8B_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85&amp;action=edit&amp;section=2" title="Форматы данных">править</a>]</span> <span class="mw-headline">Графические форматы</span></h2>
<p>Итак, вот основные форматы хранения изображений, которые могут пригодиться:
</p>
<a name="JPG_.28JPEG.29"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A4%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D1%8B_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85&amp;action=edit&amp;section=3" title="Форматы данных">править</a>]</span> <span class="mw-headline">JPG (JPEG)</span></h3>
<p>Здесь применяется алгоритм сжатия с потерями, т. е. перекодированный в этот формат файл будет отличаться от оригинала (наверняка вы замечали на сильно сжатых фотографиях артефакты в виде "блочности" и "ряби" - это потому, что кодируются кусочки 8х8 пикселов). Поэтому, его стоит применять для рисунков с множеством деталей, фотографий и других прямоугольных изображений. Сжатие: в 6 раз (почти неотличим от оригинала), в 40 раз (приемлемое качество), в 150 раз (плохое качество). Имеются две разновидности: полноцветный (256 оттенков красного, зеленого и синего, RGB) и оттенки серого (256, Grayscale). Так что, если ваше изображение не цветное, лучше использовать второй вариант, т. к. он в 3 раза компактнее.
</p><p>Дополнительные ссылки:
</p>
<ul><li><a href="http://www.jpeg.org/jpeg/index.html" class="external text" title="http://www.jpeg.org/jpeg/index.html" rel="nofollow">JPEG.ORG</a>
</li><li><a href="http://www.faqs.org/faqs/jpeg-faq/" class="external text" title="http://www.faqs.org/faqs/jpeg-faq/" rel="nofollow">JPEG-FAQ (англ.)</a>
</li><li><a href="http://en.wikipedia.org/wiki/JPEG" class="external text" title="http://en.wikipedia.org/wiki/JPEG" rel="nofollow">JPEG - wikipedia (англ.)</a>
</li></ul>
<a name="PNG_.28Portable_Network_Graphics.29"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A4%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D1%8B_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85&amp;action=edit&amp;section=4" title="Форматы данных">править</a>]</span> <span class="mw-headline">PNG (Portable Network Graphics)</span></h3>
<p>Здесь потери данных не происходит, но файл уменьшается, соответственно, не так значительно. Изображение может быть полноцветным (RGB) или с палитрой (от 2 до 256 цветов, каждый из которых также определяется интенсивностью красного, зеленого и синего в пределах от 0 до 255). Кроме того, есть возможно прицепить к изображению альфа-канал (карту, определяющую коэффициент прозрачности каждого пиксела изображения в диапазоне от 0 (полностью прозрачен) до 255 (полностью непрозрачен)). Если нет альфа-канала, то можно пометить один цвет, как "прозрачный". Хорошо сжимает изображения с большими одноцветными областями. Незаменим в тех случаях, когда малейшее изменение рисунка неприемлемо (это могут быть различные вспомогательные слои), либо где требуется альфа-канал (и для одного альфа-канала). Коэфициент сжатия лучше всегда выставлять на максимум.
Существует одна технология, реализованная в этом формате - т. н. интерлейсинг. Ее полезно применять для изображений, использующихся на сайтах, ведь они обычно грузятся достаточно длительное время. Обычные изображения грузятся так, будто опускают вниз закрывающую ширму. При интерлейсинге же, данные сохраняются таким образом, что уже при загрузке небольшой части файла изображения, формируется его грубое подобие (чтобы можно было понять, что изображено), по мере догрузки, на изображении проступают детали и, в конце концов, когда изображение загружается полностью, оно становится равным оригиналу.
</p><p>Дополнительные ссылки:
</p>
<ul><li><a href="http://libpng.org/pub/png/" class="external text" title="http://libpng.org/pub/png/" rel="nofollow">LibPNG</a>
</li><li><a href="http://en.wikipedia.org/wiki/PNG" class="external text" title="http://en.wikipedia.org/wiki/PNG" rel="nofollow">PNG - wikipedia (англ.)</a>
</li><li><a href="http://www.w3.org/TR/PNG/" class="external text" title="http://www.w3.org/TR/PNG/" rel="nofollow">Спецификация PNG</a>
</li></ul>
<a name="GIF_.28Graphics_Interchange_Format.29"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A4%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D1%8B_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85&amp;action=edit&amp;section=5" title="Форматы данных">править</a>]</span> <span class="mw-headline">GIF (Graphics Interchange Format)</span></h3>
<p>Только палитровый режим (с возможностью задания прозрачного цвета), зато есть возможность анимации. Процедуры интерлейсинга и сжатия устарели и уступают PNGшным. B языках Blitz нет стандартных процедур для загрузки изображений такого формата, но для сайтов он неплохо подходит, в частности, для вставки анимированных изображений. Дополнительные ссылки: 
</p>
<ul><li><a href="http://members.aol.com/royalef/gifabout.htm" class="external text" title="http://members.aol.com/royalef/gifabout.htm" rel="nofollow">О формате GIF (англ.)</a>
</li><li><a href="http://en.wikipedia.org/wiki/GIF" class="external text" title="http://en.wikipedia.org/wiki/GIF" rel="nofollow">GIF - wikipedia (англ.)</a>
</li></ul>
<p>А вот BMP и TGA лучше не использовать - изображение либо не сжимается вовсе, либо сжимается примитивным RLE-алгоритмом. Раньше TGA использовали из-за возможности вставить в файл альфа-канал, но теперь, когда и PNG обладает такой возможностью, TGA летит в топку.
</p><p>Для конверсии изображений хорошо подходит Adobe Photoshop, в котором есть очень полезный режим "Save for Web", где вы можете, регулируя параметры, сразу увидеть искажения изображения при конверсии и его размер в результате. Еще вариант - скачать <a href="http://faststone.org/" class="external text" title="http://faststone.org" rel="nofollow">Fast Stone Image Viewer</a> - бесплатный просмотровщик / конвертер изображений. Он позволяет перегонять изображения (и наборы изображений) во все разновидности JPG / PNG.
</p><p>Дополнительные материалы:
</p>
<ul><li><a href="http://en.wikipedia.org/wiki/Image_file_formats" class="external text" title="http://en.wikipedia.org/wiki/Image_file_formats" rel="nofollow">Форматы изображений - wikipedia (англ.)</a>
</li><li><a href="http://en.wikipedia.org/wiki/Comparison_of_graphics_file_formats" class="external text" title="http://en.wikipedia.org/wiki/Comparison_of_graphics_file_formats" rel="nofollow">Сравнение форматов изображений - wikipedia (англ.)</a>
</li></ul>
<a name=".D0.97.D0.B2.D1.83.D0.BA.D0.BE.D0.B2.D1.8B.D0.B5_.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.82.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A4%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D1%8B_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85&amp;action=edit&amp;section=6" title="Форматы данных">править</a>]</span> <span class="mw-headline">Звуковые форматы</span></h2>
<p>Формат WAV сразу отметается, как расточительно жрущий дисковое пространство (сжатия вообще нет или простейшее). Гораздо лучший вариант - алгоритм сжатия звука с потерями. Это OGG (большой плюс этого формата - в том, что использовать его можно совершенно бесплатно) или MP3, WMA (только для Blitz3D / BlitzPlus). Вы можете выбрать битрейт - это кол-во битов на секунду звука. Для игр вполне достаточно 128kbps (сжатие в 6 раз по сравнению с WAV-моно, музыка) и 64kbps (в 12 раз, речь). Для очень качественного звука - 320kbps (в 2.5 раза). Битрейт может быть и меняющимся (variable), это позволит добиться большего сжатия при большем качестве (комплексные участки сожмутся с высоким битрейтом, простые (например, тишина) - с низким). Стерео, скорей всего, будет излишним, частота - стандартная, 44100Hz.
</p><p>Бесплатные программы конвертации звуковых форматов лежат на сайте <a href="http://www.free-codecs.com/Software/Audio_Encoders.htm" class="external text" title="http://www.free-codecs.com/Software/Audio_Encoders.htm" rel="nofollow">Free-Codecs.com</a>.
</p><p>Дополнительная информация по формату OGG:
</p>
<ul><li><a href="http://www.vorbis.com/faq/" class="external text" title="http://www.vorbis.com/faq/" rel="nofollow">FAQ (англ.)</a>
</li><li><a href="http://xiph.org/ogg/doc/" class="external text" title="http://xiph.org/ogg/doc/" rel="nofollow">Документация (англ.)</a>
</li></ul>
<p>Кроме файлов, хранящих непосредственно, звуковую дорожку, существуют и т. н. музыкальные модули. Это файлы, где хранится информация, какие звуки, когда и в какой тональности проигрывать, какие инструменты использовать. Самый известный - формат MIDI(mid). Файлы этого формата очень немного "весят", а звучание, благодаря современным программным синтезаторам, встроенным в систему, получается очень неплохое, особенно классических произведений. Однако, "мидишность" все равно чувствуется за километр из-за ограниченного набора инструментов. Гораздо большую свободу предоставляют форматы "треккеров" - xm, it, s3m, umx и т. д. Эти файлы содержат звуковые дорожки (обычно короткие и замкнутые), которые проигрываются с разной частотой и добавлением всяких эффектов (можно, например, вставить дисторшн-гитару и барабанный ритм). В результате получаются очень "живые" и приятные на слух композиции. Так была написана музыка к Unreal, Deus Ex и многим другим играм. Размер этих файлов также не очень велик и его еще можно уменьшить, если преобразовать модуль в формат mo3 (со сжатием звуковых дорожек a la MP3), но он стандартными средствами Blitz не поддерживается. Много музыки в этих форматах лежит на сайте <a href="http://modarchive.org/" class="external text" title="http://modarchive.org" rel="nofollow">modarchive.org</a>.
</p>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)<br />
Благодарности: alcoSHoLiK, Diablo1909 за дополнения и комментарии к статье
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Упаковка данных с помощью TeraBit DataPak"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Упаковка данных с помощью TeraBit DataPak&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Упаковка данных с помощью TeraBit DataPak&amp;action=edit">править</a>]</span><span class="mw-headline">Упаковка данных с помощью TeraBit DataPak</span></h1>
</p>
<a name=".D0.92.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5_2"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A3%D0%BF%D0%B0%D0%BA%D0%BE%D0%B2%D0%BA%D0%B0_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85_%D1%81_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_TeraBit_DataPak&amp;action=edit&amp;section=1" title="Упаковка данных с помощью TeraBit DataPak">править</a>]</span> <span class="mw-headline">Введение</span></h2>
<p>Вы наверняка знаете о том, что разработчики игр часто запаковывают ресурсы своих игр для того чтобы облегчить их распространение и защитить данные от использования посторонними людьми. Один из самых, на мой взгляд, лучших, бесплатных  упаковщиков является Terabit DataPacker от Lee Page. В этой статье я попробую объяснить, как правильно хранить ресурсы вашего проекта.
</p>
<a name=".D0.A7.D1.82.D0.BE_.D1.82.D0.B0.D0.BA.D0.BE.D0.B5_Terabit_DataPacker.3F"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A3%D0%BF%D0%B0%D0%BA%D0%BE%D0%B2%D0%BA%D0%B0_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85_%D1%81_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_TeraBit_DataPak&amp;action=edit&amp;section=2" title="Упаковка данных с помощью TeraBit DataPak">править</a>]</span> <span class="mw-headline">Что такое Terabit DataPacker?</span></h2>
<p>Из названия все итак понятно, но вот что говорит сам Lee: "TeraBit DataPacker был разработан для того, чтобы вы могли защищать свои медиа-файлы от похитителей. Это не идеальная защита, но она доставит много неприятностей тем, кто попытается ее взломать. Если вы хотите, чтобы игру могли модифицировать, то просто дайте возможность пользователям создавать свои собственные архивы и раздайте им соответствующие ключи."
</p><p>Некоторые моменты, которые следует помнить:
<p>Рекомендуется  самим стараться делать файлы как можно меньше.
Сам Terabit DataPacker не сжимает их! Обычно файлы изображений хранят в формате PNG. Если у вас большие красочные изображения, которым не нужна прозрачность, то лучше использовать формат JPG. Музыку обычно хранят в OGG или MP3 (но последнее защищено авторскими правами).
</p>
</p>
<a name=".D0.9F.D0.BE.D0.B4.D0.B3.D0.BE.D1.82.D0.BE.D0.B2.D0.B8.D1.82.D0.B5.D0.BB.D1.8C.D0.BD.D1.8B.D0.B9_.D1.8D.D1.82.D0.B0.D0.BF"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A3%D0%BF%D0%B0%D0%BA%D0%BE%D0%B2%D0%BA%D0%B0_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85_%D1%81_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_TeraBit_DataPak&amp;action=edit&amp;section=3" title="Упаковка данных с помощью TeraBit DataPak">править</a>]</span> <span class="mw-headline">Подготовительный этап</span></h2>
<p>Вам понадобятся следующие файлы:
</p>
<ul><li><a href="http://blitzetcetera.org/images/2/26/PakMaker.zip" class="internal" title="PakMaker.zip">Медиа:PakMaker.zip</a> - Terabit DataPacker (также содержит примеры) 
</li><li>DataPak01.bb - Пример 1 (обычная программа)
</li><li>DataPak02.bb - Пример 2 (Использующая архив data.pak) 
</li><li>DataPak-Grisu.png - небольшое изображение (64x64)
</li></ul>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:DataPak-Grisu.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:DataPak-Grisu.png" src="mk5-13mx.png" width="64" height="64" /></a></span></div></div>
<a name=".D0.98.D1.82.D0.B0.D0.BA.2C_.D0.BD.D0.B0.D1.87.D0.BD.D0.B5.D0.BC"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A3%D0%BF%D0%B0%D0%BA%D0%BE%D0%B2%D0%BA%D0%B0_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85_%D1%81_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_TeraBit_DataPak&amp;action=edit&amp;section=4" title="Упаковка данных с помощью TeraBit DataPak">править</a>]</span> <span class="mw-headline">Итак, начнем</span></h2>
<p>Скачайте и распакуйте архив DATAPAK.ZIP. Нам не нужны все файлы из этого архива, поэтому создайте еще одну папку TUTORIAL, а в ней папку DATA. Скопируйте BONES.BB и PACKMAKER.EXE в TUTORIAL, а GRISU.PNG в папку DATA.
</p><p>Совет: Вам следует всегда хранить файлы ресурсов в папках отличных от директории где вы храните исходники. Это позволяет держать файлы упорядоченными и облегчает запаковку данных. В проектах побольше вы можете создавать еще и поддиректории в папке DATA такие как IMAGES, MEDIA, MUSIC, MODELS. Но для нас сейчас будет достаточно одной папки.
</p>
<a name=".D0.A8.D0.B0.D0.B3_.D0.BF.D0.B5.D1.80.D0.B2.D1.8B.D0.B9:_.D0.9F.D0.B8.D1.88.D0.B5.D0.BC_.D1.81.D0.B2.D0.BE.D1.8E_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D0.BC.D1.83"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A3%D0%BF%D0%B0%D0%BA%D0%BE%D0%B2%D0%BA%D0%B0_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85_%D1%81_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_TeraBit_DataPak&amp;action=edit&amp;section=5" title="Упаковка данных с помощью TeraBit DataPak">править</a>]</span> <span class="mw-headline"><i><b>Шаг первый: Пишем свою программу</b></i></span></h2>
<p>Для начала нам потребуется программа, которая будет использовать наш архив. Нет ничего проще. Я уже подготовил одну такую:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;</span><br />
<p><span style="color: #ffee00">; Пример 1: Программа, использующая один рисунок в качестве фонового таила.</span><br />
<span style="color: #ffee00">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><br />
<br />
<span style="color: #ffee00">; [ Переменные ]_____________________________________________</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> IMGGrisu &nbsp;<span style="color: #ffee00">; переменная хранящая хэндл изображения</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> angle#,r# <span style="color: #ffee00">; угол и радиус, используемые для вращения текста</span><br />
<br />
<br />
<span style="color: #ffee00">; [ Loading Data ]__________________________________________</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> LoadData<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; IMGGrisu=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;DATA\grisu.png&quot;</span><span style=" ">&#41;</span> <span style="color: #ffee00">; Загружает картинку</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">MaskImage</span> IMGGrisu,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span> &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Создает маску</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> <br />
<br />
<span style="color: #ffee00">; [ Main Loop ]_____________________________________________</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span>,<span style="color: #33ffdd;">16</span>,<span style="color: #33ffdd;">2</span> &nbsp;<span style="color: #ffee00">; устанавливаем графический режим</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">; устанавливаем буфер</span><br />
<span style="color: #aaffff; font-weight: bold;">ClsColor</span> <span style="color: #33ffdd;">33</span>,<span style="color: #33ffdd;">57</span>,<span style="color: #33ffdd;">73</span> &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Цвет фона</span><br />
angle#=<span style="color: #33ffdd;">0</span>:r#=<span style="color: #33ffdd;">0</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Обнуляем угол и радиус</span><br />
<br />
LoadData<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Загружаем все данные</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> &nbsp; &nbsp;<span style="color: #ffee00">; Пока не нажата клавиша ESC,&nbsp;:</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> IMGGrisu &gt; <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">TileImage</span> IMGGrisu,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">; Рисуем картинку если она есть &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><br />
<br />
&nbsp; angle=<span style=" ">&#40;</span>angle<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">360</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Рассчитываем вращение</span><br />
&nbsp; r=<span style=" ">&#40;</span>r<span style="color: #33ffdd;">+0.5</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">300</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span>+<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>angle<span style=" ">&#41;</span>*r,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span>-<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>angle<span style=" ">&#41;</span>*r,<span style="color: #00ff66;">&quot;Grisu's Tutorial No. 1&quot;</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span> <span style="color: #ffee00">; Добавим немного текста</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Конец основного цикла</span><br />
&nbsp;<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Выход их программы</span></div>
<p>Программа использует только GRISU.PNG из нашей папки DATA в качестве фонового рисунка. Загрузка файла выполнена с помощью отдельной функции так же, как и в больших проектах. Таким образом, мы сразу делаем рациональную структуру кода.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> LoadData<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><br />
&nbsp; IMGGrisu=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Data\GRISU.PNG&quot;</span><span style=" ">&#41;</span> <span style="color: #ffee00">; Загружает картинку</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">MaskImage</span> IMGGrisu,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span> &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Создает маску</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<a name=".D0.A8.D0.B0.D0.B3_2._.D0.A1.D0.BE.D0.B7.D0.B4.D0.B0.D0.B5.D0.BC_.D1.81.D0.B2.D0.BE.D0.B9_.D1.81.D0.BE.D0.B1.D1.81.D1.82.D0.B2.D0.B5.D0.BD.D0.BD.D1.8B.D0.B9_Data.pak"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A3%D0%BF%D0%B0%D0%BA%D0%BE%D0%B2%D0%BA%D0%B0_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85_%D1%81_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_TeraBit_DataPak&amp;action=edit&amp;section=6" title="Упаковка данных с помощью TeraBit DataPak">править</a>]</span> <span class="mw-headline">Шаг 2. Создаем свой собственный Data.pak</span></h2>
<p>Для этого запустим PACKMAKER.EXE. Он будет выглядеть примерно так:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:DataPak01.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:DataPak01.jpg" src="kh72vn2-.jpg" width="639" height="423" /></a></span></div></div>
<ul><li>Теперь просто выберите файлы, которые вы хотите запаковать, просто щелкнув по ним левой кнопкой мыши. Сейчас нам нужно, что бы был выбран файл DATA\GRISU.PNG
</li><li>Так же нам нужно что бы файл был закодирован, для этого поставьте галочку напротив "Secure my Data with Encryption".
</li><li>Вы можете создавать новый ключ для каждого из ваших проектов или разных ресурсов Для нашего обучения мы будем использовать ключи: 9FAF43FB в качестве "Basic Key" и 629FC914 в качестве "Header Mask". Заметьте что Initialisation Code внизу окна меняется в то время как вы вводите новые ключи.
</li><li>Кликните на "Create Pak Archive", создастся архив DATA.PAK, который будет содержать все выбранные вами файлы.
</li><li>Наконец запишите "Initialisation Code", мы будем использовать его в дальнейшем.
</li></ul>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:DataPak02.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:DataPak02.jpg" src="07ypig28.jpg" width="640" height="424" /></a></span></div></div>
<a name=".D0.A8.D0.B0.D0.B3_3:_.D0.9C.D0.BE.D0.B4.D0.B8.D1.84.D0.B8.D1.86.D0.B8.D1.80.D1.83.D0.B5.D0.BC_.D0.BD.D0.B0.D1.88.D1.83_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D0.BC.D1.83"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A3%D0%BF%D0%B0%D0%BA%D0%BE%D0%B2%D0%BA%D0%B0_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85_%D1%81_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_TeraBit_DataPak&amp;action=edit&amp;section=7" title="Упаковка данных с помощью TeraBit DataPak">править</a>]</span> <span class="mw-headline">Шаг 3: Модифицируем нашу программу</span></h2>
<ul><li>Теперь у нас есть файл DATA.PAK. Но наша программа не сможет прочитать данные хранящиеся внутри него без некоторых изменений в коде.
</li><li>Блитц должен распознавать функции Terabit Packer. Поэтому добавим Include Bones.bb" в начало исходника.
</li><li>Нам также потребуется директория, в которую будут распаковываться файлы:  PakOutputDir="". Она может находится где угодно. По-умолчанию файлы будут распакованы в основную директорию вашей программы.
</li><li>Теперь добавьте код инициализации, который вы только что написали.
</li><li>Установите флаг "PakBulkoverwrite=True", старые файлы данных с одинаковыми именами будут перезаписываться. Полезно когда файлы изменяются во время разработки.
</li></ul>
<p>Весь код заголовка будет выглядеть примерно так:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;________________________________________</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Include</span> <span style="color: #00ff66;">&quot;Bones.bb&quot;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Добавим функции упаковщика</span><br />
PakOutputDir <span style="color: #00ff66;">&quot;&quot;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />
PakInit &nbsp; &nbsp; &nbsp;<span style="color: #00ff66;">&quot;Data.pak&quot;</span>, $9FAF43FB, <span style="color: #00ff66;">&quot;TMP&quot;</span>, $629FC914 <span style="color: #ffee00">; Это ваша инициализирующая команда</span><br />
</p>
PakBulkOverWrite = <span style="color: #aaffff; font-weight: bold;">True</span> &nbsp;<span style="color: #ffee00">; Установите это &nbsp;True во время разработки, False при релизе.</span></div>
<p>Теперь наша программа знает как распознавать наш DATA.PAK. Последнее что осталось сделать это изменить функцию LoadData(). Каждый раз когда мы захотим обратиться к DATA.PAK нам будет нужно немного изменить родные функции блица. Для этого  добавьте "PAK(" - ")" к использующимся командам. Помните, что в кавычках должно быть только название файла без остальных параметров функции.
</p><p>Пример:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">Sound=<span style="color: #aaffff; font-weight: bold;">LoadSound</span><span style=" ">&#40;</span>Pak<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;data\crazysound.mp3&quot;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<p>AnimImg=<span style="color: #aaffff; font-weight: bold;">LoadAnimImage</span><span style=" ">&#40;</span>Pak<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;data\animation.png&quot;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">64</span>,<span style="color: #33ffdd;">64</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
</p>
Texture=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span>Pak<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;data\texture.jpg&quot;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">56</span><span style=" ">&#41;</span></div>
<p>Все что нам нужно это загрузить картинку. Сделайте следующие изменения:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">IMGGrisu=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span>Pak<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;DATA\GRISU.PNG&quot;</span><span style=" ">&#41;</span><span style=" ">&#41;</span></div>
<p>Программа теперь будет работать без ваших файлов данных. В нашем примере это картинка GRISU.PNG. Но как вы могли заметить, временный файл который распаковывается при использовании ( TMPGRISU.PNG ) все еще назодится в папке DATA. Даже если программа выключается.
</p><p>Каждый раз когда вам понадобятся ресурсы из вашего DATA.PAK вы можете дописывать функцию DlPAK(). Она всегда будет удалять последний распакованный файл.
</p><p>Если вы не хотите каждый раз вызывать эту функцию, то можете написать ее в конце вашего кода. Она удалит все временные файлы.
</p><p>Использование DLPak() может сказаться на производительности если ее часто использовать.
</p><p>Файл DataPak02.bb содержит все текущие изменения:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;</span><br />
<p><span style="color: #ffee00">; Пример 2: Программа, использующая один рисунок в качестве фонового тайла.</span><br />
<span style="color: #ffee00">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Использует отдельный архив с ресурсами.</span><br />
<br />
<span style="color: #ffee00">; [ Terabit Packer ]________________________________________</span><br />
<span style="color: #aaffff; font-weight: bold;">Include</span> <span style="color: #00ff66;">&quot;Bones.bb&quot;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Добавим функции упаковщика</span><br />
PakOutputDir <span style="color: #00ff66;">&quot;&quot;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />
PakInit &nbsp; &nbsp; &nbsp;<span style="color: #00ff66;">&quot;Data.pak&quot;</span>, $9FAF43FB, <span style="color: #00ff66;">&quot;TMP&quot;</span>, $629FC914 <span style="color: #ffee00">; Это ваша инициализирующая команда</span><br />
PakBulkOverWrite = <span style="color: #aaffff; font-weight: bold;">True</span> &nbsp;<span style="color: #ffee00">; Установите это в True во время разработки, в False при релизе.</span><br />
<br />
<span style="color: #ffee00">; [ Переменные ]_____________________________________________</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> IMGGrisu &nbsp;<span style="color: #ffee00">; переменная хранящая хэндл изображения</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> angle#,r# <span style="color: #ffee00">; угол и радиус, используемые для вращения текста</span><br />
<br />
<br />
<br />
<br />
<span style="color: #ffee00">; [ Loading Data ]__________________________________________</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> LoadData<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; IMGGrisu=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span>Pak<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;DATA\GRISU.PNG&quot;</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #ffee00">; Загружает изображение, ничего особенного!</span><br />
&nbsp; &nbsp; DlPak<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Удаляет временный файл</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">MaskImage</span> IMGGrisu,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span> &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Создает маску</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span> <br />
<br />
<br />
<span style="color: #ffee00">; [ Main Loop ]_____________________________________________</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span>,<span style="color: #33ffdd;">16</span>,<span style="color: #33ffdd;">2</span> &nbsp;<span style="color: #ffee00">; устанавливаем графический режим</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">; устанавливаем буфер</span><br />
<span style="color: #aaffff; font-weight: bold;">ClsColor</span> <span style="color: #33ffdd;">33</span>,<span style="color: #33ffdd;">57</span>,<span style="color: #33ffdd;">73</span> &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Цвет фона</span><br />
angle#=<span style="color: #33ffdd;">0</span>:r#=<span style="color: #33ffdd;">0</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Обнуляем угол и радиус</span><br />
<br />
LoadData<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Загружаем все данные</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> &nbsp; &nbsp;<span style="color: #ffee00">; Пока не нажата клавиша ESC,&nbsp;:</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> IMGGrisu &gt; <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">TileImage</span> IMGGrisu,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span> <span style="color: #ffee00">; Рисуем картинку если она есть &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><br />
<br />
&nbsp; angle=<span style=" ">&#40;</span>angle<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">360</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Рассчитываем вращение</span><br />
&nbsp; r=<span style=" ">&#40;</span>r<span style="color: #33ffdd;">+0.5</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Mod</span> <span style="color: #33ffdd;">300</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span>+<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>angle<span style=" ">&#41;</span>*r,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2</span>-<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>angle<span style=" ">&#41;</span>*r,<span style="color: #00ff66;">&quot;Grisu's Tutorial No. 1&quot;</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span> <span style="color: #ffee00">; Добавим немного текста</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Конец основного цикла</span><br />
&nbsp;<br />
PakClean<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Удаляет все ранее использованные ресурсы</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Выход</span></div>
<a name=".D0.97.D0.B0.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A3%D0%BF%D0%B0%D0%BA%D0%BE%D0%B2%D0%BA%D0%B0_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85_%D1%81_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_TeraBit_DataPak&amp;action=edit&amp;section=8" title="Упаковка данных с помощью TeraBit DataPak">править</a>]</span> <span class="mw-headline">Заключение</span></h2>
<p>Теперь вы можете хранить свои ресурсы в одном большом архиве и использовать его в ваших программах. Если вы захотите запаковывать ваши исполняемые файлы, то для этого можно использовать бесплатную программу UPX Packer.
</p>
<div align="right"><a href="http://blitzetcetera.org/images/f/f3/TeraBit_DataPack.zip" class="internal" title="TeraBit DataPack.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: Grisu (e-mail: s.sarbok@gmx.de)<br />
Перевод: ZKINNER (e-mail: zkinner@gmail.com)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Работа с surface в памяти Blitz3D"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Работа с surface в памяти Blitz3D&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Работа с surface в памяти Blitz3D&amp;action=edit">править</a>]</span><span class="mw-headline">Работа с surface в памяти Blitz3D</span></h1>
<p>Для эффективной и максимально быстрой работы с вершинами и треугольниками, операции над ними можно производить непосредственно в памяти из внешних библиотек, не прибегая к встроенным командам блица.
</p>
</p><p>В качестве примера напишем функцию для преобразования всех вершин выбранного сурфейса в глобальную систему координат произвольной Entity, в качастве среды разработки возьмём MSVC++ 6.0.
</p><p>Для начала нам нужно получить адрес сурфейса(сетки), где хранятся Vertex Buffer и Index Buffer(треугольники).
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">SurfHandle = <span style="color: #aaffff; font-weight: bold;">GetSurface</span><span style=" ">&#40;</span>model, <span style="color: #33ffdd;">1</span> <span style=" ">&#41;</span> <span style="color: #ffee00">;хендл(адрес) сурфейса.</span></div>
<p>(прим. структуру сурфейса можно посмотреть здесь: <a href="http://blitz.pp.ru/forum/showthread.php?s=&amp;threadid=203" class="external free" title="http://blitz.pp.ru/forum/showthread.php?s=&amp;threadid=203" rel="nofollow">http://blitz.pp.ru/forum/showthread.php?s=&amp;threadid=203</a>)
</p><p>Vertex Buffer лежит по смещению (SurfHandle + 28байт), Index Buffer - (SurfHandle + 44байта).
</p><p>Для простоты работы с вершинами можно создать специальную структуру, с помощью которой мы будем обращаться к параметрам вершины:
</p>
<div class="cpp" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;"><span style="color: #0000ff;">typedef</span> <span style="color: #0000ff;">struct</span> _BBVERTEX<br />
<p><span style="color: #000000;">&#123;</span><br />
<span style="color: #0000ff;">float</span> x,y,z;<br />
<span style="color: #0000ff;">float</span> nx,ny,nz;<br />
<span style="color: #0000ff;">char</span> a,r,g,b;<br />
<span style="color: #0000ff;">float</span> u0,v0;<br />
<span style="color: #0000ff;">float</span> u1,v1;<br />
<span style="color: #0000ff;">char</span> i1,i2,i3,i4;<br />
<span style="color: #0000ff;">float</span> w1,w2,w3,w4;<br />
<br />
</p>
<span style="color: #000000;">&#125;</span> BBVERTEX, *LPBBVERTEX;</div>
<p>Точно также можно сделать и для треугольников:
</p>
<div class="cpp" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;"><span style="color: #0000ff;">typedef</span> <span style="color: #0000ff;">struct</span> _BBTRIANGE<br />
<p><span style="color: #000000;">&#123;</span><br />
<span style="color: #0000ff;">unsigned</span> <span style="color: #0000ff;">short</span> a,b,c;<br />
<br />
</p>
<span style="color: #000000;">&#125;</span> BBTRIANGE, *LPBBTRIANGE;</div>
<p>(прим. Треугольник - это последовательность 3-х индексов в IndexBuffer соответственно)
</p><p>Для получения положения Entity (поворот, размер, позиция), воспользуемся её матрицей трансформации.
<p>Глобальная матрица хранится по смещению (SurfHandle + 216байт), таже матрица, но с учётом Tween(если используется), хранится по адресу (SurfHandle + 516байт).
</p>
</p><p>(прим. В спецификации DirectX используются матрицы размерностью 4х4, но для пространственных преобразований достаточно матрицы 3х4, она и хранится в структуре Entity в блице)
</p><p>Получение матрицы:
</p>
<div class="cpp" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;"><span style="color: #0000ff;">float</span> EMatrix11= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+44</span><span style="color: #000000;">&#41;</span>;<br />
<p><span style="color: #0000ff;">float</span> EMatrix12= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+45</span><span style="color: #000000;">&#41;</span>;<br />
<span style="color: #0000ff;">float</span> EMatrix13= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+46</span><span style="color: #000000;">&#41;</span>;<br />
<br />
<span style="color: #0000ff;">float</span> EMatrix21= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+47</span><span style="color: #000000;">&#41;</span>;<br />
<span style="color: #0000ff;">float</span> EMatrix22= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+48</span><span style="color: #000000;">&#41;</span>;<br />
<span style="color: #0000ff;">float</span> EMatrix23= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+49</span><span style="color: #000000;">&#41;</span>;<br />
<br />
<span style="color: #0000ff;">float</span> EMatrix31= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+50</span><span style="color: #000000;">&#41;</span>;<br />
<span style="color: #0000ff;">float</span> EMatrix32= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+51</span><span style="color: #000000;">&#41;</span>;<br />
<span style="color: #0000ff;">float</span> EMatrix33= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+52</span><span style="color: #000000;">&#41;</span>;<br />
<br />
<span style="color: #0000ff;">float</span> EMatrix41= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+53</span><span style="color: #000000;">&#41;</span>;<br />
<span style="color: #0000ff;">float</span> EMatrix42= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+54</span><span style="color: #000000;">&#41;</span>;<br />
</p>
<span style="color: #0000ff;">float</span> EMatrix43= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+55</span><span style="color: #000000;">&#41;</span>;</div>
<p>(прим. В С++ значение смещения для указателей учитывается в соответствии с их типом, например, если используется тип Float(4байта), то смещение на 40 байт будет указано как +10)
</p><p>Для преобразования координат вершины, нужно перемножить их на матрицу:
</p>
<div class="cpp" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;"><span style="color: #ff0000;">//координаты исходной сетки.</span><br />
<p>x=SrcVertexBuffer<span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.x;<br />
y=SrcVertexBuffer<span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.y;<br />
z=SrcVertexBuffer<span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.z;<br />
<br />
<span style="color: #ff0000;">//преобразованные координаты.</span><br />
DestVertexBuffer <span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.x = EMatrix11*x + EMatrix21*y + EMatrix31*z + EMatrix41;<br />
DestVertexBuffer <span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.y = EMatrix12*x + EMatrix22*y + EMatrix32*z + EMatrix42;<br />
</p>
DestVertexBuffer <span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.z = EMatrix13*x + EMatrix23*y + EMatrix33*z + EMatrix43;</div>
<p>Количество вершин можно получить так:
</p>
<div class="cpp" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;"><span style="color: #0000ff;">int</span> VertexCount = <span style="color: #000000;">&#40;</span> *<span style="color: #000000;">&#40;</span>surfaceSrc<span style="color: #0000dd;">+8</span><span style="color: #000000;">&#41;</span> - *<span style="color: #000000;">&#40;</span>surfaceSrc<span style="color: #0000dd;">+7</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#41;</span>/<span style="color: #0000dd;">64</span>;</div>
<p>(прим. 64 - количество байт на одну вершину)
</p><p>Цикл перебора вершин будет выглядеть так:
</p>
<div class="cpp" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;"><span style="color: #0000ff;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #0000ff;">int</span> vertex = <span style="color: #0000dd;">0</span>; vertex<br />
<p><span style="color: #000000;">&#123;</span><br />
x=SrcVertexBuffer<span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.x;<br />
y=SrcVertexBuffer<span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.y;<br />
z=SrcVertexBuffer<span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.z;<br />
<br />
DestVertexBuffer <span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.x = EMatrix11*x + EMatrix21*y + EMatrix31*z + EMatrix41;<br />
DestVertexBuffer <span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.y = EMatrix12*x + EMatrix22*y + EMatrix32*z + EMatrix42;<br />
DestVertexBuffer <span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.z = EMatrix13*x + EMatrix23*y + EMatrix33*z + EMatrix43;<br />
</p>
<span style="color: #000000;">&#125;</span></div>
<p>Таким образом Мы можем вертеть сетку в соответствии с позицией любой Entity&nbsp;:)
</p><p>(Прим. При изменении координат вершин мы изменяем размер всей сетки, но блиц проверяет её видимость по старому размеру, поэтому корректнее также изменять и параметры ограничивающего бокса(Bounding Box) - см. структуру меша)
</p><p>Полный код функции:
</p>
<div class="cpp" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;">BBDECL <span style="color: #0000ff;">void</span> TransformSurfaceToMatrix<span style="color: #000000;">&#40;</span> <span style="color: #0000ff;">unsigned</span> <span style="color: #0000ff;">int</span> *surfaceSrc, <span style="color: #0000ff;">unsigned</span> <span style="color: #0000ff;">int</span> *surfaceDest, <span style="color: #0000ff;">float</span> *Entity <span style="color: #000000;">&#41;</span><br />
<p><br />
<span style="color: #000000;">&#123;</span><br />
LPBBVERTEX SrcVertexBuffer, DestVertexBuffer&nbsp;;<br />
<br />
<span style="color: #0000ff;">float</span> x,y,z;<br />
<br />
<span style="color: #0000ff;">float</span> EMatrix11= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+44</span><span style="color: #000000;">&#41;</span>;<br />
<span style="color: #0000ff;">float</span> EMatrix12= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+45</span><span style="color: #000000;">&#41;</span>;<br />
<span style="color: #0000ff;">float</span> EMatrix13= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+46</span><span style="color: #000000;">&#41;</span>;<br />
<br />
<span style="color: #0000ff;">float</span> EMatrix21= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+47</span><span style="color: #000000;">&#41;</span>;<br />
<span style="color: #0000ff;">float</span> EMatrix22= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+48</span><span style="color: #000000;">&#41;</span>;<br />
<span style="color: #0000ff;">float</span> EMatrix23= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+49</span><span style="color: #000000;">&#41;</span>;<br />
<br />
<span style="color: #0000ff;">float</span> EMatrix31= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+50</span><span style="color: #000000;">&#41;</span>;<br />
<span style="color: #0000ff;">float</span> EMatrix32= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+51</span><span style="color: #000000;">&#41;</span>;<br />
<span style="color: #0000ff;">float</span> EMatrix33= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+52</span><span style="color: #000000;">&#41;</span>;<br />
<br />
<span style="color: #0000ff;">float</span> EMatrix41= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+53</span><span style="color: #000000;">&#41;</span>;<br />
<span style="color: #0000ff;">float</span> EMatrix42= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+54</span><span style="color: #000000;">&#41;</span>;<br />
<span style="color: #0000ff;">float</span> EMatrix43= *<span style="color: #000000;">&#40;</span>Entity<span style="color: #0000dd;">+55</span><span style="color: #000000;">&#41;</span>;<br />
<br />
SrcVertexBuffer = <span style="color: #000000;">&#40;</span><span style="color: #0000ff;">struct</span> _BBVERTEX *<span style="color: #000000;">&#41;</span>*<span style="color: #000000;">&#40;</span>surfaceSrc <span style="color: #0000dd;">+7</span><span style="color: #000000;">&#41;</span>; <span style="color: #ff0000;">//Адрес начала вершинного буфера исходной сетки</span><br />
DestVertexBuffer = <span style="color: #000000;">&#40;</span><span style="color: #0000ff;">struct</span> _BBVERTEX *<span style="color: #000000;">&#41;</span>*<span style="color: #000000;">&#40;</span>surfaceDest<span style="color: #0000dd;">+7</span><span style="color: #000000;">&#41;</span>; <span style="color: #ff0000;">//Адрес начала вершинного буфера трансформируемой сетки</span><br />
<br />
</p>
<ul><li><span style="color: #000000;">&#40;</span>surfaceDest<span style="color: #0000dd;">+16</span><span style="color: #000000;">&#41;</span>=<span style="color: #0000dd;">0</span>; <span style="color: #ff0000;">//Обнуление этого флага означает изменение вертекс буфера, после чего он будет передан видеокарте</span><br />
</li></ul>
<p><br />
<span style="color: #0000ff;">int</span> VertexCount = <span style="color: #000000;">&#40;</span> *<span style="color: #000000;">&#40;</span>surfaceSrc<span style="color: #0000dd;">+8</span><span style="color: #000000;">&#41;</span> - *<span style="color: #000000;">&#40;</span>surfaceSrc<span style="color: #0000dd;">+7</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#41;</span>/<span style="color: #0000dd;">64</span>; <span style="color: #ff0000;">//Количество вершин в сетке</span><br />
<br />
<span style="color: #0000ff;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #0000ff;">int</span> vertex = <span style="color: #0000dd;">0</span>; vertex<br />
<span style="color: #000000;">&#123;</span><br />
x=SrcVertexBuffer<span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.x;<br />
y=SrcVertexBuffer<span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.y;<br />
z=SrcVertexBuffer<span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.z;<br />
<br />
<span style="color: #ff0000;">// Здесь мы производим перемножение координат вершины исходной сетки на матрицу и запись результата в изменяемую сетку</span><br />
DestVertexBuffer <span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.x = EMatrix11*x + EMatrix12*y + EMatrix13*z + EMatrix41;<br />
DestVertexBuffer <span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.y = EMatrix21*x + EMatrix22*y + EMatrix23*z + EMatrix42;<br />
DestVertexBuffer <span style="color: #000000;">&#91;</span>vertex<span style="color: #000000;">&#93;</span>.z = EMatrix31*x + EMatrix32*y + EMatrix33*z + EMatrix43;<br />
<span style="color: #000000;">&#125;</span><br />
<br />
</p>
<span style="color: #000000;">&#125;</span></div>
<p>Пример использования в Blitz3D:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">-30</span><br />
<br />
light=<span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> light,<span style="color: #33ffdd;">50</span>,<span style="color: #33ffdd;">80</span>,<span style="color: #33ffdd;">0</span><br />
<br />
Entity1=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Entity1,<span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> Entity1,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">5</span><br />
<br />
SurfaceSrc = <span style="color: #aaffff; font-weight: bold;">GetSurface</span><span style=" ">&#40;</span>Entity1, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
Vcount = <span style="color: #aaffff; font-weight: bold;">CountVertices</span><span style=" ">&#40;</span>SurfaceSrc<span style=" ">&#41;</span><br />
<br />
Entity2=<span style="color: #aaffff; font-weight: bold;">CopyMesh</span><span style=" ">&#40;</span>Entity1<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> Entity2,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> Entity2,<span style="color: #33ffdd;">-30</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
SurfaceDest = <span style="color: #aaffff; font-weight: bold;">GetSurface</span><span style=" ">&#40;</span>Entity2, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> Entity1, <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">57</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">5</span>, <span style="color: #00ff66;">&quot;Don't ransformate&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">5</span>, <span style="color: #00ff66;">&quot;Transformating SurfaceSrc(Red color)&quot;</span><br />
TransformSurfaceToMatrix SurfaceSrc, SurfaceDest, Entity1<br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Flip</span> <span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/1/14/SurfaceSample.zip" class="internal" title="SurfaceSample.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: ANDREYman (сайт: <a href="http://andreyman.ucoz.ru/" class="external free" title="http://andreyman.ucoz.ru/" rel="nofollow">http://andreyman.ucoz.ru/</a>)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Списки"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Списки&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Списки&amp;action=edit">править</a>]</span><span class="mw-headline">Списки</span></h1>
<p>Сразу предупреждаю: статья является моим субъективным мнением, и гуру программирования покажется весьма условной и поверхностной. Но всё же для большинства начинающих, на мой взгляд, покажет преимущества и недостатки такого рода организации памяти, как связанные списки.
</p>
</p>
<a name=".D0.9E.D1.82.D1.81.D1.82.D1.83.D0.BF.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BF%D0%B8%D1%81%D0%BA%D0%B8&amp;action=edit&amp;section=1" title="Списки">править</a>]</span> <span class="mw-headline">Отступление</span></h2>
<p>Одно из проявлений какого-то архетипа мышления пользователя (видео-файл - видео, mp3 - музыка: ну никак не желают многие себе представить, что это одни и те же буковки по-разному обработанные). Так вот одно из проявлений этого архетипа - что массив нечто большее, чем просто переменная. Безусловно, во многих средах об этом вообще сложно догадаться - все низкоуровневые команды скрыты от глаз пользователя (от греха подальше). А, между тем, переменная-массив, (на нижеследующем рисунке - map) всего лишь так или иначе сохранённый адрес одного (!) байта в памяти (мои скромные познания в языках подсказывают мне, что утверждение весьма спорное, но не исключающее факта сохранения адреса). Что просто-таки бросается в глаза, если реализовать данную ситуацию на С++ (см. рисунок). Доступ ко всем элементам массива осуществляется из знания адреса и размера &lt;места&gt; занимаемого одним элементом (размер определяется исходя из типа массива, который так или иначе указывается при инициализации {опять же за все среды не ручаюсь}). Так в С++ обращение к массиву:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">map<span style=" ">&#91;</span><span style="color: #33ffdd;">2</span><span style=" ">&#93;</span>=<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;</span></div>
<p>[] - это всего лишь оператор, перегруженный для всех объектов массивов, независимо от их типа. Его работа заключается в том, что он берёт левый операнд (адрес первого байта) и прибавляет к нему число, переданное в качестве правого операнда (2), помноженное на размер одного элемента (в данном случае - целочисленный массив - 4 байта на число). Таким образом, приведённая выше конструкция при значении адреса первого байта массива допустим 5, вернёт после своего выполнения 5 + 2 * 4 = 5 + 8 = 13. После чего по адресу 13 (соответственно, 13, 14, 15 и 16-ый адреса) будет записано число равное единице.
</p><p>Так же стоит ознакомиться с понятием - косвенная адресация. Вот цитата из Википедии:
</p><p><i>Адресацией называется указание адреса (номера) регистра (ячейки) памяти или шага программы. В калькуляторах предусмотрено 2 вида адресации - прямая и косвенная.</i>
</p>
<ul><li>Прямая адресация. Непосредственное указание адреса называется прямой адресацией (&lt;это число помести в регистр 4&gt;).
</li><li>Косвенная адресация. Если адрес указывается числом, хранящимся в регистре памяти, то адресация будет косвенной (&lt;в регистре 4 узнай, в какой регистр поместить это число&gt;). Этот регистр называется регистром адресации. Его нельзя будет использовать для хранения исходных данных или промежуточных результатов.
</li></ul>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Lists3-01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Lists3-01.gif" src="bs9a_fmr.gif" width="572" height="341" /></a></span></div></div>
<a name=".D0.9C.D0.B0.D1.81.D1.81.D0.B8.D0.B2_.D1.81.D1.82.D1.80.D1.83.D0.BA.D1.82.D1.83.D1.80"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BF%D0%B8%D1%81%D0%BA%D0%B8&amp;action=edit&amp;section=2" title="Списки">править</a>]</span> <span class="mw-headline">Массив структур</span></h2>
<p>В общем, с ним дело обстоит, так же как и с обычным массивом, только объект хранения (элемент массива) обычно занимает несколько больше места, чем 4 байта. А потому все смещения вычисляются по такому же принципу.
</p><p>На b3d нельзя создать динамический массив структур внутри типа или функции, не прибегая к ухищрениям - для всех структур одного типа существует единый глобальный двунаправленный связанный список, навигация по которому осуществляется командами:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Before</span><br />
<p><span style="color: #aaffff; font-weight: bold;">After</span><br />
<span style="color: #aaffff; font-weight: bold;">Last</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">First</span></div>
<p>И специальным циклом перебора с использованием команды Each. На С++ динамический массив создать можно, но зато никаких удобностей (или неудобств?) вроде предыдущих команд по умолчанию нет.
</p>
<a name=".D0.9F.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC.D1.8B_.D1.81_.D0.BC.D0.B0.D1.81.D1.81.D0.B8.D0.B2.D0.B0.D0.BC.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BF%D0%B8%D1%81%D0%BA%D0%B8&amp;action=edit&amp;section=3" title="Списки">править</a>]</span> <span class="mw-headline">Проблемы с массивами</span></h2>
<p>Помимо невозможности реализовать на некоторых языках подобную организацию памяти, а также невероятно медленных и громоздких в случае с массивами операций сортировки, сдвига, удаления элемента и (не дай бог!) изменения размера массива без утраты уже имеющихся значений (функцию realloc для С++ в расчёт не берём, тем более, что и она не всегда выручает) заставляет искать решение в иных способах хранения данных в памяти.
</p><p>Следующий рисунок иллюстрирует громоздкость перестановки элемента массива.
<p>Можете представить себе массив как формочку для льда: чёткая геометрическая структура. Ведь в принципе для задач не важно: &lt;поменять местами&gt; два одинаковых хранилища информации или &lt;поменять местами&gt; их значения. В алгоритмах работы с массивами - применяется второй метод. Однако, как видно из рисунка, далеко не всегда метод рационален. Иногда надо именно &lt;поменять местами&gt; хранилища.
</p>
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Lists3-02.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Lists3-02.gif" src="pxz5fm-a.gif" width="302" height="376" /></a></span></div></div>
<p>Собственно, почему это набор из структур должен и физически представлять собой рядом находящиеся участки памяти? Ведь, используя косвенную адресацию, мы можем составить таблицу, в которой чётко и ясно укажем адрес в памяти, где хранится тот или иной элемент, а ещё проще - каждый элемент &lt;знает&gt;, где хранится следующий за ним.
</p><p>Для сравнения, вспомните очередь в магазине. Каждый человек стоит за другим - это массив, но вот один человек отходит в другой отдел и просит впередистоящего запомнить его, т.к. отходит он ненадолго. Теперь эти два человека представляют собой список. Кстати говоря, очередь - это, с точки зрения программирования, линейный список с организацией FIFO (первый вошедший - первым выходит).
</p><p>Эта статья ориентирована на линейные списки на B3D, поэтому реализовывать их будем именно на нём. С использованием команд OBJECT и HANDLE. Вообще говоря, эти команды работаю не с настоящими физическими адресами, а с индексами (порядковыми номерами) экземпляров типа, но для нас это большой роли не играет. Поэтому в будущем я буду использовать слово &lt;адрес&gt;, подразумевая &lt;порядковый номер&gt;.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> Type_element<br />
<p>&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> information%<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> ptr_next%<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>Вот так будет описан элемент массива:
</p>
<ul><li>поле с информацией (в данном случае - целое число; вообще - всё что угодно, вплоть до указателя на другой список)
</li><li>число, хранящее "адрес" следующего элемента - указатель.
</li></ul>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> Type_element<br />
<p><span style="color: #aaffff; font-weight: bold;">Field</span> information%<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> ptr_next%<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> CreateList<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
E.Type_element=<span style="color: #aaffff; font-weight: bold;">New</span> Type_element<br />
<span style="color: #aaffff; font-weight: bold;">Return</span> Handle<span style=" ">&#40;</span>E<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> ADD2List<span style=" ">&#40;</span>ListHandle,number%<span style=" ">&#41;</span><br />
E.Type_element=Object.Type_element<span style=" ">&#40;</span>ListHandle<span style=" ">&#41;</span><br />
ENew.Type_element=<span style="color: #aaffff; font-weight: bold;">New</span> Type_element<br />
ENew\information=number<br />
ENew\ptr_next=<span style="color: #33ffdd;">0</span><br />
<span style="color: #ffee00">;=</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> E\ptr_next<br />
E=Object.Type_element<span style=" ">&#40;</span>E\ptr_next<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
E\ptr_next=Handle<span style=" ">&#40;</span>ENew<span style=" ">&#41;</span><br />
<span style="color: #ffee00">;=</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> Handle<span style=" ">&#40;</span>ENew<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> OutPutList<span style=" ">&#40;</span>ListHandle<span style=" ">&#41;</span><br />
E.Type_element=Object.Type_element<span style=" ">&#40;</span>ListHandle<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Local</span> count=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
E=Object.Type_element<span style=" ">&#40;</span>E\ptr_next<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> E=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
count=count<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">Print</span> E\information<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> count<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SwapInList<span style=" ">&#40;</span>ListHandle,A%,B%<span style=" ">&#41;</span><br />
E.Type_element=Object.Type_element<span style=" ">&#40;</span>ListHandle<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Local</span> X.Type_element<br />
<span style="color: #aaffff; font-weight: bold;">Local</span> Y.Type_element<br />
<span style="color: #aaffff; font-weight: bold;">Local</span> count=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> E\ptr_next<br />
E=Object.Type_element<span style=" ">&#40;</span>E\ptr_next<span style=" ">&#41;</span><br />
count=count<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> count=A X=E<br />
<span style="color: #aaffff; font-weight: bold;">If</span> count=B Y=E<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> X=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Or</span> Y=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Error!&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">False</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #ffee00">;=</span><br />
swap_information=X\information<br />
X\information=Y\information<br />
Y\information=swap_information<br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<br />
MyList=CreateList<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
ADD2List<span style=" ">&#40;</span>MyList,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
ADD2List<span style=" ">&#40;</span>MyList,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
ADD2List<span style=" ">&#40;</span>MyList,<span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><br />
ADD2List<span style=" ">&#40;</span>MyList,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span><br />
OutPutList<span style=" ">&#40;</span>MyList<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;=====&quot;</span><br />
SwapInList<span style=" ">&#40;</span>MyList,<span style="color: #33ffdd;">4</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
OutPutList<span style=" ">&#40;</span>MyList<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;=====&quot;</span><br />
SwapInList<span style=" ">&#40;</span>MyList,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span><br />
OutPutList<span style=" ">&#40;</span>MyList<span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Вот пример реализации со списком.
</p>
<a name=".D0.9D.D0.B5.D0.BA.D0.BE.D1.82.D0.BE.D1.80.D1.8B.D0.B5_.D0.B2.D0.B8.D0.B4.D1.8B_.D0.BB.D0.B8.D0.BD.D0.B5.D0.B9.D0.BD.D1.8B.D1.85_.D1.81.D0.BF.D0.B8.D1.81.D0.BA.D0.BE.D0.B2"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BF%D0%B8%D1%81%D0%BA%D0%B8&amp;action=edit&amp;section=4" title="Списки">править</a>]</span> <span class="mw-headline">Некоторые виды линейных списков</span></h2>
<ul><li>По обработке (в том числе - добавление/удаление) элементов]
<ul><li>Стек - все исключения и включения элементов происходят с одного конца списка - его вершины (LIFO)
</li><li>Очередь - все исключения происходят с одного конца, а включения - с другого конца списка (FIFO)
</li><li>Дек - линейный список, в котором исключения и включения выполняются только с концов списка.
</li><li>Очередь с приоритетами - очередь, в которой все элементы имеют приоритет, в таком списке первым удаляется (обрабатывается) элемент с наивысшим приоритетом. Если элементов с таим приоритетом несколько - первым обрабатывается тот, который "пришёл" в очередь раньше (вспоминается список закачек в DownloadMaster).
</li><li>Дек с ограниченным выходом - исключения только с одного конца.
</li><li>Дек с ограниченным входом - включения только с одного конца.
</li></ul>
</li></ul>
<ul><li>По способу связи элементов
<ul><li>однонаправленные - рассмотрены выше в статье
</li><li>двунаправленные - каждый элемент содержит указатель и на последующий, и на предыдущий элемент.
</li></ul>
</li></ul>
<a name=".D0.97.D0.B0.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_2"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BF%D0%B8%D1%81%D0%BA%D0%B8&amp;action=edit&amp;section=5" title="Списки">править</a>]</span> <span class="mw-headline">Заключение</span></h2>
<p>Несмотря на всю привлекательность использования списков, это всё-таки не панацея, и отказываться от массивов полностью не стоит. Хранение адресов элементов влечёт за собой дополнительные растраты памяти. Довольно сложные операции по переприсваиванию адресов нерационально (как по времени, так и по читабельности) использовать на маленьких или малоподвижных (в ходе выполнения программы) наборах данных. В общем, надо уметь выбирать, что в данном случае рациональнее (хотя списки и универсальнее).
</p>
<a name="P.S."></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BF%D0%B8%D1%81%D0%BA%D0%B8&amp;action=edit&amp;section=6" title="Списки">править</a>]</span> <span class="mw-headline">P.S.</span></h2>
<p>Используя косвенную адресацию можно организовывать и другие (не только списки) способы хранения и обработки информации.
</p><p>Проводя аналогию с очередью и отошедшим в другой отдел покупателем, нельзя не заметить следующую замечательную особенность - один и тот же покупатель может занять место сразу в нескольких очередях, а сам вообще пойти в кафе (читёр!) - т.е. формально один объект (покупатель) сразу находится в нескольких очередях! Подобная хитрость может, пригодится и в программировании - допустим, сразу несколько элементов должны содержать один и тоже объект (его нельзя тиражировать для каждого элемента либо по соображениям внутренней логики алгоритма или в целях экономии памяти {например, если объект - проекция тела файла}). В данной ситуации опять же уместно использовать косвенную адресацию. Правда, появляется потенциальный минус на приоритет обработки (очередь одновременно подошла сразу в нескольких отделах) или отслеживание ссылок в никуда (если после обработки в одной из очередей - по логике программы - объект должен быть удалён, то это, возможно, надо как-то обозначить и в остальных, ссылающихся на него, элементах).
</p><p>Также, подобным образом удобно кодировать различного рода графы, например деревья (получили широкое применение в алгоритмах игроделов; используются для быстрой сортировки; юзание в алгоритме A*).
</p>
<div align="right"><a href="http://blitzetcetera.org/images/1/15/Lists3.bb" class="internal" title="Lists3.bb">скачать исходный код</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Impersonalis" title="Участник:Impersonalis">Impersonalis</a> (e-mail: impersonalis@boolean.name)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Загрузка и сохранение"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Загрузка и сохранение&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Загрузка и сохранение&amp;action=edit">править</a>]</span><span class="mw-headline">Загрузка и сохранение</span></h1>
</p>
<a name=".D0.92.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5_3"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%97%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0_%D0%B8_%D1%81%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5&amp;action=edit&amp;section=1" title="Загрузка и сохранение">править</a>]</span> <span class="mw-headline">Введение</span></h2>
<p>Довольно частый вопрос на форумах. Почему-то многие начинающие считают, что сохранение - это какой-то полумистический процесс, доступный только гуру, и, сводящийся, как минимум, чуть ли не к дампу памяти процесса (стереотип сродни тому, что видео-файл - это видео, музыкальный - это музыка; т.е. человек не воспринимает, что ВСЁ ЭТО - всего лишь байты и, при определённом раскладе, один и тот же файл может быть и видео и текстом - зависит от метода обработки). Возможно это связано со зрелищностью программирования игр; думаю, если бы всё сводилось к какой-нибудь школьной задачке типа: сохраните числа, введенные с клавиатуры - вопросов бы поубавилось. Так в чём же дело? Не стоит забывать, что всё в игровом мире описывается структурами данных, т.е., в конечном счёте, числами - можно сказать - Matrix =) Думаю, из вышеприведённых выкладок нетрудно умозаключить следующее: никакие сверх-хитрые приёмы мы юзать не будем, достаточно лишь сохранить параметры (характеристики, обобщённые координаты/силы, etc) в файл.
</p>
<a name=".D0.A2.D0.B5.D1.81.D1.82"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%97%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0_%D0%B8_%D1%81%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5&amp;action=edit&amp;section=2" title="Загрузка и сохранение">править</a>]</span> <span class="mw-headline">Тест</span></h2>
<p>Напишем примитивненькую прогу для теста:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> R=<span style="color: #33ffdd;">60</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> Sphere2D<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> x<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> y<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> createSphere2D.Sphere2D<span style=" ">&#40;</span>x,y<span style=" ">&#41;</span><br />
&nbsp; S.Sphere2D=<span style="color: #aaffff; font-weight: bold;">New</span> Sphere2D<br />
&nbsp; S\x=x<br />
&nbsp; S\y=y<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> S<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> DrawALLSphere2D<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> S.Sphere2D=<span style="color: #aaffff; font-weight: bold;">Each</span> Sphere2D<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Oval</span> S\x-R,S\y-R,R*<span style="color: #33ffdd;">2</span>,R*<span style="color: #33ffdd;">2</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; CreateSphere2D<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; DrawALLSphere2D<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Запустите её и покликайте левым ухом мыша по экрану. В месте долбления будет появляться круг...
<i>Вот сейчас задумался над названием типа Sphere2D... Бывает и хуже...&nbsp;:)</i>
</p>
<a name=".D0.A1.D0.BE.D1.85.D1.80.D0.B0.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%97%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0_%D0%B8_%D1%81%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5&amp;action=edit&amp;section=3" title="Загрузка и сохранение">править</a>]</span> <span class="mw-headline">Сохранение</span></h2>
<p>Наша цель - запечатлеть всю эту красоту из кружочков для потомков. Создадим специальную функцию.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SaveLevel<span style=" ">&#40;</span>name$<span style=" ">&#41;</span><br />
<p>&nbsp; File=<span style="color: #aaffff; font-weight: bold;">WriteFile</span><span style=" ">&#40;</span>name$+<span style="color: #00ff66;">&quot;.txt&quot;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>name$ -какое-то произвольное имя сохранялки. Имя для файла с этой сохранялкой, вы, конечно, можете придумать любое (например, чтобы легче пропарсить какие-нибудь параметры (дата/имя_игрока/etc),вынести их в имя файла), но в данном примере оно будет тупо повторять имя сохранялки. И иметь расширение TXT (с расширением те же особенности, что и с первой частью имени - может быть любым, зависит от конкретики задачи).
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SaveLevel<span style=" ">&#40;</span>name$<span style=" ">&#41;</span><br />
<p>&nbsp; File=<span style="color: #aaffff; font-weight: bold;">WriteFile</span><span style=" ">&#40;</span>name$+<span style="color: #00ff66;">&quot;.txt&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> S.Sphere2D=<span style="color: #aaffff; font-weight: bold;">Each</span> Sphere2D<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">CloseFile</span><span style=" ">&#40;</span>File<span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Вот здесь и появляется проблема - вычленение необходимого минимума информации. Но с этим, боюсь, вам придётся разбираться самолично. Здесь же - очевидно, что нам необходимы координаты сфер.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> SaveLevel<span style=" ">&#40;</span>name$<span style=" ">&#41;</span><br />
<p>&nbsp; File=<span style="color: #aaffff; font-weight: bold;">WriteFile</span><span style=" ">&#40;</span>name$+<span style="color: #00ff66;">&quot;.txt&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> S.Sphere2D=<span style="color: #aaffff; font-weight: bold;">Each</span> Sphere2D<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">WriteInt</span><span style=" ">&#40;</span>File,S\x<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">WriteInt</span><span style=" ">&#40;</span>File,S\y<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">CloseFile</span><span style=" ">&#40;</span>File<span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Каким образом сохранять число - строкой или 4-мя байтами - также зависит от конкретики задачи. Здесь мы пойдём по пути минимального расхода дискового пространства.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<p>&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; CreateSphere2D<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; Savelevel<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;1&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; DrawALLSphere2D<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Flip</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Wend</span></div>
<p>Собственно, можно уже тестить: понатыркать кружочков и нажать правую кнопку мыши. После чего, в папке с прогой появится файл 1.txt, содержащий необходимую информацию.
</p>
<a name=".D0.97.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.BA.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%97%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0_%D0%B8_%D1%81%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5&amp;action=edit&amp;section=4" title="Загрузка и сохранение">править</a>]</span> <span class="mw-headline">Загрузка</span></h2>
<p>Теперь займёмся загрузкой "уровня".
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> LoadLevel<span style=" ">&#40;</span>name$<span style=" ">&#41;</span><br />
<p>&nbsp; file=<span style="color: #aaffff; font-weight: bold;">ReadFile</span><span style=" ">&#40;</span>name$+<span style="color: #00ff66;">&quot;.txt&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">CloseFile</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Одна из распространённых ошибок - люди забывают очистить игровой мир, перед его загрузкой, в результате чего получают 2ух главных героев,двойное кол-во монстров и т.п.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> LoadLevel<span style=" ">&#40;</span>name$<span style=" ">&#41;</span><br />
<p>&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> <span style="color: #aaffff; font-weight: bold;">Each</span> Sphere2D<br />
&nbsp; file=<span style="color: #aaffff; font-weight: bold;">ReadFile</span><span style=" ">&#40;</span>name$+<span style="color: #00ff66;">&quot;.txt&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">CloseFile</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Организуем цикл чтения и создания объектов.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> LoadLevel<span style=" ">&#40;</span>name$<span style=" ">&#41;</span><br />
<p>&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> <span style="color: #aaffff; font-weight: bold;">Each</span> Sphere2D<br />
&nbsp; file=<span style="color: #aaffff; font-weight: bold;">ReadFile</span><span style=" ">&#40;</span>name$+<span style="color: #00ff66;">&quot;.txt&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">Eof</span><span style=" ">&#40;</span>File<span style=" ">&#41;</span><br />
&nbsp; &nbsp; a=<span style="color: #aaffff; font-weight: bold;">ReadInt</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span><br />
&nbsp; &nbsp; b=<span style="color: #aaffff; font-weight: bold;">ReadInt</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span><br />
&nbsp; &nbsp; CreateSphere2D<span style=" ">&#40;</span>a,b<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">CloseFile</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>ВАЖНО: всегда контролируйте себя - если вы для объектов сохраняли сначал х а затем y, то и грузить их надо в том же порядке. И ещё: чтобы не запутаться в порядке загрузки и передачи загруженного в функции, лучше конструкции типа:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">CreateSphere2D<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">ReadInt</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">ReadInt</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span><span style=" ">&#41;</span></div>
<p>заменять на:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">a=<span style="color: #aaffff; font-weight: bold;">ReadInt</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span><br />
<p>b=<span style="color: #aaffff; font-weight: bold;">ReadInt</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span><br />
</p>
CreateSphere2D<span style=" ">&#40;</span>a,b<span style=" ">&#41;</span></div>
<p>Немного модифицируем прогу:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> R=<span style="color: #33ffdd;">60</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> Sphere2D<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> x<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> y<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> createSphere2D.Sphere2D<span style=" ">&#40;</span>x,y<span style=" ">&#41;</span><br />
&nbsp; S.Sphere2D=<span style="color: #aaffff; font-weight: bold;">New</span> Sphere2D<br />
&nbsp; S\x=x<br />
&nbsp; S\y=y<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> S<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> DrawALLSphere2D<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> S.Sphere2D=<span style="color: #aaffff; font-weight: bold;">Each</span> Sphere2D<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Oval</span> S\x-R,S\y-R,R*<span style="color: #33ffdd;">2</span>,R*<span style="color: #33ffdd;">2</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> SaveLevel<span style=" ">&#40;</span>name$<span style=" ">&#41;</span><br />
&nbsp; File=<span style="color: #aaffff; font-weight: bold;">WriteFile</span><span style=" ">&#40;</span>name$+<span style="color: #00ff66;">&quot;.txt&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> S.Sphere2D=<span style="color: #aaffff; font-weight: bold;">Each</span> Sphere2D<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">WriteInt</span><span style=" ">&#40;</span>File,S\x<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">WriteInt</span><span style=" ">&#40;</span>File,S\y<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">CloseFile</span><span style=" ">&#40;</span>File<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> LoadLevel<span style=" ">&#40;</span>name$<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> <span style="color: #aaffff; font-weight: bold;">Each</span> Sphere2D<br />
&nbsp; file=<span style="color: #aaffff; font-weight: bold;">ReadFile</span><span style=" ">&#40;</span>name$+<span style="color: #00ff66;">&quot;.txt&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">Eof</span><span style=" ">&#40;</span>File<span style=" ">&#41;</span><br />
&nbsp; &nbsp; a=<span style="color: #aaffff; font-weight: bold;">ReadInt</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span><br />
&nbsp; &nbsp; b=<span style="color: #aaffff; font-weight: bold;">ReadInt</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span><br />
&nbsp; &nbsp; CreateSphere2D<span style=" ">&#40;</span>a,b<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">CloseFile</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; CreateSphere2D<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">64</span><span style=" ">&#41;</span> Savelevel<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;1&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">65</span><span style=" ">&#41;</span> Loadlevel<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;1&quot;</span><span style=" ">&#41;</span>:<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
&nbsp; DrawALLSphere2D<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Вот и всё - F6=сохранить, F7=загрузить.
</p>
<div align="right"><a href="http://blitzetcetera.org/images/5/5a/SaveLoad.bb" class="internal" title="SaveLoad.bb">скачать исходный код</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Impersonalis" title="Участник:Impersonalis">Impersonalis</a> (e-mail: impersonalis@boolean.name)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Несколько реализаций инвентаря. Работа с типами и массивами."></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Несколько реализаций инвентаря. Работа с типами и массивами.&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Несколько реализаций инвентаря. Работа с типами и массивами.&amp;action=edit">править</a>]</span><span class="mw-headline">Несколько реализаций инвентаря. Работа с типами и массивами.</span></h1>
</p>
<div align="right">Omnia mea mecum porto. (лат. Все свое ношу с собой.)<br />
Цицерон</div>
<p>Кто пытался делать инвентарь, тот знает, что основная проблема - это соединение клеток на экране и кода программы. Весьма сложно также не допустить наложения объектов друг на друга. Сейчас я попробую объяснить, как сделать инвентарь. Приступим.
</p><p>Создадим глобальные переменные, которые будут отвечать за количество клеток в поле и их размер. Это поможет нашей программе быть универсальной и впоследствии можно будет динамично изменять вместимость инвентаря.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> ImH=<span style="color: #33ffdd;">30</span> &nbsp; &nbsp;<span style="color: #ffee00">;&lt;= высота одной клетки</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Global</span> ImW=<span style="color: #33ffdd;">30</span> &nbsp; &nbsp; <span style="color: #ffee00">;&lt;= ширина одной клетки</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> nachx=<span style="color: #33ffdd;">100</span> <span style="color: #ffee00">;&lt;= начальное положение поля по x</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> nachy=<span style="color: #33ffdd;">100</span> <span style="color: #ffee00">;&lt;= начальное положение поля по y</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> vertic=<span style="color: #33ffdd;">4</span> &nbsp; &nbsp; <span style="color: #ffee00">;&lt;= клеток вниз</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Global</span> goriz=<span style="color: #33ffdd;">8</span> &nbsp; &nbsp; <span style="color: #ffee00">;&lt;= клеток вправо</span></div>
<p>Теперь зададим графический режим и создадим камеру (предполагается, что будет использоваться в 3D игре).
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">500</span>,<span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> camera,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span></div>
<p>Вот и самое главное, создаем массив картинок и массив соответствующий ему, но хранящий цифры. Это и будет основа нашего инвентаря. Заполняем все элементы массива, как пустые и загружаем изображение пустой клетки в цикле.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Dim</span> image<span style=" ">&#40;</span>goriz*vertic<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Dim</span> imageyn<span style=" ">&#40;</span>goriz*vertic<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
i=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> i &lt; goriz*vertic<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp;image<span style=" ">&#40;</span>i<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Inventory1-SmallItem0.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;imageyn<span style=" ">&#40;</span>i<span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;i=i<span style="color: #33ffdd;">+1</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Wend</span></div>
<p>Вам понадобится картинка пустого отсека, впрочем, вы бы, наверняка и сами смогли ее нарисовать. Создадим еще пару предметов для нашего инвентаря.
</p>
<center>
<p><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Inventory1-SmallItem0.png" class="image" title="Изображение:Inventory1-SmallItem0.png"><img alt="Изображение:Inventory1-SmallItem0.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Inventory1-SmallItem0.png" src="z01hoy8r.png" width="30" height="30" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Inventory1-SmallItem1.png" class="image" title="Изображение:Inventory1-SmallItem1.png"><img alt="Изображение:Inventory1-SmallItem1.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Inventory1-SmallItem1.png" src="99qlomxz.png" width="30" height="30" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Inventory1-SmallItem2.png" class="image" title="Изображение:Inventory1-SmallItem2.png"><img alt="Изображение:Inventory1-SmallItem2.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Inventory1-SmallItem2.png" src="r_vvcec5.png" width="30" height="30" /></a>
</p>
</center>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">image<span style=" ">&#40;</span><span style="color: #33ffdd;">3</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Inventory1-SmallItem1.png&quot;</span><span style=" ">&#41;</span><br />
<p>imageyn<span style=" ">&#40;</span><span style="color: #33ffdd;">3</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
image<span style=" ">&#40;</span><span style="color: #33ffdd;">11</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Inventory1-SmallItem2.png&quot;</span><span style=" ">&#41;</span><br />
</p>
imageyn<span style=" ">&#40;</span><span style="color: #33ffdd;">11</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span></div>
<p>Я специально выбрал произвольные элементы массива. Нам понадобятся изображения предметов. Они могут быть любые, главное, чтобы они соответствовали по ширине и высоте нашим клеткам. Так же надо, чтобы у них был черный фон для его прозрачности, но это не обязательно. Нарисуйте их сами или воспользуйтесь моими.
</p><p>Что ж, давайте, отобразим наше поле. Сначала главный цикл:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> exitprogram=<span style="color: #aaffff; font-weight: bold;">True</span><br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">True</span> <span style="color: #aaffff; font-weight: bold;">Then</span> exitprogram=<span style="color: #aaffff; font-weight: bold;">True</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Для отображения поля на экране создадим функцию draw():
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>k=<span style="color: #33ffdd;">1</span><br />
i=<span style="color: #33ffdd;">1</span><br />
j=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> i &lt; vertic<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; j=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> j &lt; goriz<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">DrawImage</span> image<span style=" ">&#40;</span>k<span style=" ">&#41;</span>,nachx+j*ImW,nachy+i*ImH<br />
&nbsp; &nbsp; &nbsp; &nbsp;j=j<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;k=k<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
&nbsp; &nbsp; i=i<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Эта функция отображает каждое из изображений массива image() в определенном месте экрана. Для этого используется двойной цикл. В нем: переменные i, j - это переменные циклов, по которым рассчитывается позиция изображения. Переменная k - это счетчик элементов массива, он перебирает все элементы.
Все, можно проверять!
</p><p>Выглядит неплохо. Но хотелось бы иметь возможность динамичного добавления вещей в инвентарь. Давайте создадим функцию, которая добавляет предмет в инвентарь.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> addim<span style=" ">&#40;</span>imstr$<span style=" ">&#41;</span><br />
<p>i=<span style="color: #33ffdd;">1</span><br />
l=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> i &lt; goriz*vertic<span style="color: #33ffdd;">+1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> imageyn<span style=" ">&#40;</span>i<span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;imageyn<span style=" ">&#40;</span>i<span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp;image<span style=" ">&#40;</span>i<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span>imstr$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp;i=goriz*vertic<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; l=<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp;i=i<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; l=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> l=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">RuntimeError</span> <span style="color: #00ff66;">&quot;нет места!&quot;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Что, думаете, что она слишком большая для простого добавления предмета? А, вот и нет. Тут не так все просто, как кажется. Нужно учесть то, что клетка, куда мы собираемся "положить" наш предмет может оказаться не пустой, а так же то, что в инвентаре может вообще не быть места. Вот тут-то нам и понадобиться второй массив. Его элементы могут принимать два значения: 1 и 0. Т. е. занято, пусто. В цикле проверяем все клетки и кладем предмет в первую пустую клетку, после чего выходим из цикла. Если пустых клеток нет, то пишем, что в инвентаре нет места и выходим. В принципе выходить не обязательно, поэтому можете заменить RuntimeError на text, например.
В главный цикл добавляем вызов этой функции по нажатию клавиши пробел:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">57</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> addim<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Inventory1-SmallItem1.png&quot;</span><span style=" ">&#41;</span></div>
<p>Ну, вот уже на что-то похоже. Неплохо бы еще иметь возможность самому менять положение предметов, например мышкой. Это очень занимательное занятие. Создадим еще одну функцию refresh().
В ней будет оцениваться, есть ли в вашей виртуальной руке предмет или нет, поэтому перед главным циклом указываем глобальную переменную:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> vlog=<span style="color: #33ffdd;">0</span></div>
<p>Теперь о функции. Она должна перемещать предметы по полю и менять их местами при наложении одного предмета на другой. Нам понадобиться три временных изображения. Одно возле мыши и два для копирования, поэтому дописываем в программу:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> tempimage1=<span style="color: #aaffff; font-weight: bold;">CreateImage</span><span style=" ">&#40;</span>ImW,ImH<span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Global</span> tempimage2=<span style="color: #aaffff; font-weight: bold;">CreateImage</span><span style=" ">&#40;</span>ImW,ImH<span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Global</span> tempimage3=<span style="color: #aaffff; font-weight: bold;">CreateImage</span><span style=" ">&#40;</span>ImW,ImH<span style=" ">&#41;</span></div>
<p>Так как они будут использоваться в функциях, то должны быть глобальны.
Добавляем в функцию отображения следующий код:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> vlog=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">DrawImage</span> tempimage1,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-ImW/<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-ImH/<span style="color: #33ffdd;">2</span></div>
<p>Это необходимо для того, чтобы картинка следовала за мышью при перемещении.
Теперь сама функция refresh():
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> refresh<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &gt; nachx+ImW <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &lt; nachx+ImW*<span style=" ">&#40;</span>goriz<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &gt; nachy+ImH <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &lt; nachy+ImH*<span style=" ">&#40;</span>vertic<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> vlog=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; nom=<span style=" ">&#40;</span><span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachy<span style=" ">&#41;</span>/ImH<span style=" ">&#41;</span>*goriz<span style=" ">&#41;</span>-<span style=" ">&#40;</span>goriz-<span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachx<span style=" ">&#41;</span>/ImW<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; tempimage1=<span style="color: #aaffff; font-weight: bold;">CopyImage</span><span style=" ">&#40;</span>image<span style=" ">&#40;</span>nom<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; image<span style=" ">&#40;</span>nom<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Inventory1-SmallItem0.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; vlog=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; imageyn<span style=" ">&#40;</span>nom<span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; nom=<span style=" ">&#40;</span><span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachy<span style=" ">&#41;</span>/ImH<span style=" ">&#41;</span>*goriz<span style=" ">&#41;</span>-<span style=" ">&#40;</span>goriz-<span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachx<span style=" ">&#41;</span>/ImW<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> imageyn<span style=" ">&#40;</span>nom<span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; tempimage2=<span style="color: #aaffff; font-weight: bold;">CopyImage</span><span style=" ">&#40;</span>image<span style=" ">&#40;</span>nom<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; image<span style=" ">&#40;</span>nom<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">CopyImage</span><span style=" ">&#40;</span>tempimage1<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; vlog=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; imageyn<span style=" ">&#40;</span>nom<span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;tempimage3=<span style="color: #aaffff; font-weight: bold;">CopyImage</span><span style=" ">&#40;</span>image<span style=" ">&#40;</span>nom<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;image<span style=" ">&#40;</span>nom<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">CopyImage</span><span style=" ">&#40;</span>tempimage1<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;tempimage1=<span style="color: #aaffff; font-weight: bold;">CopyImage</span><span style=" ">&#40;</span>tempimage3<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;vlog=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Вначале стоит условие проверяющее находится ли мышь в зоне поля. Далее если был сделан клик левой кнопкой мыши, то в зависимости от того, в каком состоянии находится переменная vlog, выполняется одно из следующих действий. В случае когда предмет взят возможно два варианта: положить его в пустую клетку, поменять его с предметом лежащим в клетке. Думаю, что теперь все понятно. Реализовать удаление предметов достаточно просто, а их связь с предметами выбранными игроком можно реализовать копированием. Это я оставляю вам.
Вот весь код программы:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;(c) Agnislav Lipcan</span><br />
<p><span style="color: #ffee00">; &nbsp; &nbsp; &nbsp;инвентарь</span><br />
<span style="color: #ffee00">;avelnet@yandex.ru</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> ImH=<span style="color: #33ffdd;">30</span> &nbsp; &nbsp;<span style="color: #ffee00">;&lt;= высота одной клетки</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> ImW=<span style="color: #33ffdd;">30</span> &nbsp; &nbsp; <span style="color: #ffee00">;&lt;= ширина одной клетки</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> nachx=<span style="color: #33ffdd;">100</span> <span style="color: #ffee00">;&lt;= начальное положение поля по x</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> nachy=<span style="color: #33ffdd;">100</span> <span style="color: #ffee00">;&lt;= начальное положение поля по y</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> vertic=<span style="color: #33ffdd;">4</span> &nbsp; &nbsp; <span style="color: #ffee00">;&lt;= клеток вниз</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> goriz=<span style="color: #33ffdd;">8</span> &nbsp; &nbsp; <span style="color: #ffee00">;&lt;= клеток вправо</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">500</span>,<span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">CameraClsColor</span> camera,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> image<span style=" ">&#40;</span>goriz*vertic<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> imageyn<span style=" ">&#40;</span>goriz*vertic<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
i=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> i &lt; goriz*vertic<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp;image<span style=" ">&#40;</span>i<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Inventory1-SmallItem0.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;imageyn<span style=" ">&#40;</span>i<span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;i=i<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> vlog=<span style="color: #33ffdd;">0</span><br />
<br />
image<span style=" ">&#40;</span><span style="color: #33ffdd;">3</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Inventory1-SmallItem1.png&quot;</span><span style=" ">&#41;</span><br />
imageyn<span style=" ">&#40;</span><span style="color: #33ffdd;">3</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
image<span style=" ">&#40;</span><span style="color: #33ffdd;">11</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Inventory1-SmallItem2.png&quot;</span><span style=" ">&#41;</span><br />
imageyn<span style=" ">&#40;</span><span style="color: #33ffdd;">11</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> tempimage1=<span style="color: #aaffff; font-weight: bold;">CreateImage</span><span style=" ">&#40;</span>ImW,ImH<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> tempimage2=<span style="color: #aaffff; font-weight: bold;">CreateImage</span><span style=" ">&#40;</span>ImW,ImH<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> tempimage3=<span style="color: #aaffff; font-weight: bold;">CreateImage</span><span style=" ">&#40;</span>ImW,ImH<span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;main cikles</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> exitprogram=<span style="color: #aaffff; font-weight: bold;">True</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">True</span> <span style="color: #aaffff; font-weight: bold;">Then</span> exitprogram=<span style="color: #aaffff; font-weight: bold;">True</span><br />
<br />
refresh<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">57</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> addim<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Inventory1-SmallItem1.png&quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<span style="color: #ffee00">;functions</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
k=<span style="color: #33ffdd;">1</span><br />
i=<span style="color: #33ffdd;">1</span><br />
j=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> i &lt; vertic<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; j=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> j &lt; goriz<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">DrawImage</span> image<span style=" ">&#40;</span>k<span style=" ">&#41;</span>,nachx+j*ImW,nachy+i*ImH<br />
&nbsp; &nbsp; &nbsp; &nbsp;j=j<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;k=k<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
&nbsp; &nbsp; i=i<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> vlog=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">DrawImage</span> tempimage1,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-ImW/<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-ImH/<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> refresh<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &gt; nachx+ImW <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &lt; nachx+ImW*<span style=" ">&#40;</span>goriz<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &gt; nachy+ImH <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &lt; nachy+ImH*<span style=" ">&#40;</span>vertic<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> vlog=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; nom=<span style=" ">&#40;</span><span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachy<span style=" ">&#41;</span>/ImH<span style=" ">&#41;</span>*goriz<span style=" ">&#41;</span>-<span style=" ">&#40;</span>goriz-<span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachx<span style=" ">&#41;</span>/ImW<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; tempimage1=<span style="color: #aaffff; font-weight: bold;">CopyImage</span><span style=" ">&#40;</span>image<span style=" ">&#40;</span>nom<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; image<span style=" ">&#40;</span>nom<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Inventory1-SmallItem0.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; vlog=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; imageyn<span style=" ">&#40;</span>nom<span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; nom=<span style=" ">&#40;</span><span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachy<span style=" ">&#41;</span>/ImH<span style=" ">&#41;</span>*goriz<span style=" ">&#41;</span>-<span style=" ">&#40;</span>goriz-<span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachx<span style=" ">&#41;</span>/ImW<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> imageyn<span style=" ">&#40;</span>nom<span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; tempimage2=<span style="color: #aaffff; font-weight: bold;">CopyImage</span><span style=" ">&#40;</span>image<span style=" ">&#40;</span>nom<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; image<span style=" ">&#40;</span>nom<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">CopyImage</span><span style=" ">&#40;</span>tempimage1<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; vlog=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; imageyn<span style=" ">&#40;</span>nom<span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;tempimage3=<span style="color: #aaffff; font-weight: bold;">CopyImage</span><span style=" ">&#40;</span>image<span style=" ">&#40;</span>nom<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;image<span style=" ">&#40;</span>nom<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">CopyImage</span><span style=" ">&#40;</span>tempimage1<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;tempimage1=<span style="color: #aaffff; font-weight: bold;">CopyImage</span><span style=" ">&#40;</span>tempimage3<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp;vlog=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> addim<span style=" ">&#40;</span>imstr$<span style=" ">&#41;</span><br />
i=<span style="color: #33ffdd;">1</span><br />
l=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> i &lt; goriz*vertic<span style="color: #33ffdd;">+1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> imageyn<span style=" ">&#40;</span>i<span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;imageyn<span style=" ">&#40;</span>i<span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp;image<span style=" ">&#40;</span>i<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span>imstr$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp;i=goriz*vertic<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; l=<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp;i=i<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp; l=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> l=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">RuntimeError</span> <span style="color: #00ff66;">&quot;нет места!&quot;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Теперь реализуем кое-что посложнее, а заодно поработаем с типами. В инвентаре кроме картинки надо хранить еще и другую информацию: цену, название, 3Dмодель, описание. Можно для всего этого завести отдельные массивы или несколько многомерных массивов, но лучше воспользоваться типами - это очень удобно. Так же хотелось бы что бы предметы могли занимать больше одной клетки. Поэтому мы изменим логику программы. Теперь у нас будет не поле клеток, а некий набор предметов, которые могут находиться в инвентаре, вне его, быть выбраны игроком в качестве оружия. Для простоты не будем учитывать тип предмета, а так же примем ограничение, что предмет занимает четное количество клеток, т. е. как минимум 2.
</p><p>Приступим. Начало примерно такое же:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> ImH=<span style="color: #33ffdd;">30</span> &nbsp; &nbsp;<span style="color: #ffee00">;&lt;= высота одной клетки</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Global</span> ImW=<span style="color: #33ffdd;">30</span> &nbsp; &nbsp;<span style="color: #ffee00">;&lt;= ширина одной клетки</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> nachx=<span style="color: #33ffdd;">70</span> <span style="color: #ffee00">;&lt;= начальное положение поля по x минус ImW</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> nachy=<span style="color: #33ffdd;">70</span> <span style="color: #ffee00">;&lt;= начальное положение поля по y минус ImH</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> vertic=<span style="color: #33ffdd;">6</span> &nbsp;<span style="color: #ffee00">;&lt;= клеток вниз</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> goriz=<span style="color: #33ffdd;">8</span> &nbsp; <span style="color: #ffee00">;&lt;= клеток вправо</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> kolvovesh=<span style="color: #33ffdd;">2</span> &nbsp; <span style="color: #ffee00">;общее количество вещей</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> mouse &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;мыша</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Global</span> orugnom=<span style="color: #33ffdd;">0</span> &nbsp; &nbsp; <span style="color: #ffee00">;первое выбранное оружие</span></div>
<p>Создаем экран и камеру.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">700</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">AppTitle</span> <span style="color: #00ff66;">&quot;inventar&quot;</span><br />
<br />
font=<span style="color: #aaffff; font-weight: bold;">LoadFont</span><span style=" ">&#40;</span>courier ,<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">SetFont</span> font<br />
<br />
</p>
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Надеюсь, что пояснять данные строки не надо.
Создаем поле клеток. Оно у нас все-таки будет, но теперь оно не главное.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Dim</span> pole<span style=" ">&#40;</span>goriz<span style="color: #33ffdd;">+1</span>,vertic<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span></div>
<p>Загружаем изображение пустой клетки.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> noneim=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Inventory1-SmallItem0.png&quot;</span><span style=" ">&#41;</span></div>
<p>Теперь создаем новый тип с параметрами: кол-во занимаемых клеток, позиция в поле по x и y, картинка. Можно добавить и другие параметры, но это уже усовершенствование:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> predmet<br />
<p>&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> kolvokletok,posx,posy<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> gde <span style="color: #ffee00">;0-не активно; 1-в инвентаре; 2-выбрано</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> image <span style="color: #ffee00">;картинка</span><br />
&nbsp; <span style="color: #ffee00">;Field cena, sila, lovkost&nbsp;;параметры</span><br />
&nbsp; <span style="color: #ffee00">;Field name$&nbsp;;название</span><br />
&nbsp; <span style="color: #ffee00">;field model&nbsp;;3d модель</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>Теперь создаем массив вещей нашего типа.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Dim</span> pr.predmet<span style=" ">&#40;</span>kolvovesh<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span></div>
<p>Нам, как и в прошлом случае понадобится временная картинка для мыши и еще две временных переменных для определения того, где в данный момент находится предмет.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> tempimage<br />
<p><span style="color: #aaffff; font-weight: bold;">Global</span> temp1=<span style="color: #33ffdd;">0</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Global</span> temp2=<span style="color: #33ffdd;">0</span></div>
<p>Главный цикл не сильно изменился:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<p><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; refresh<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Теперь о функции создания. Не будем проверять свободное место в инвентаре, это вы уже умеете делать. Просто создадим вещь и положим в определенную позицию поля.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> newvesh<span style=" ">&#40;</span>x,y,kl,im$<span style=" ">&#41;</span><br />
<p>pr<span style=" ">&#40;</span>num<span style=" ">&#41;</span> = <span style="color: #aaffff; font-weight: bold;">New</span> predmet<br />
pr<span style=" ">&#40;</span>num<span style=" ">&#41;</span>\posx=x<br />
pr<span style=" ">&#40;</span>num<span style=" ">&#41;</span>\posy=y<br />
pr<span style=" ">&#40;</span>num<span style=" ">&#41;</span>\kolvokletok=kl<br />
pr<span style=" ">&#40;</span>num<span style=" ">&#41;</span>\image=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span>im$<span style=" ">&#41;</span><br />
pr<span style=" ">&#40;</span>num<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">1</span><br />
num=num<span style="color: #33ffdd;">+1</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Глобальная переменная num отвечает за номер элемента массива вещей.
Вот так выглядит вызов функции:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> num=<span style="color: #33ffdd;">1</span><br />
<p>newvesh<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">6</span>,<span style="color: #00ff66;">&quot;Inventory1-Item1.png&quot;</span><span style=" ">&#41;</span><br />
</p>
newvesh<span style=" ">&#40;</span><span style="color: #33ffdd;">4</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">8</span>,<span style="color: #00ff66;">&quot;Inventory1-Item2.png&quot;</span><span style=" ">&#41;</span></div>
<p>Вам понадобятся изображения предметов. Не забывайте о соответствии ширины и высоты.
</p>
<center>
<p><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Inventory1-Item1.png" class="image" title="Изображение:Inventory1-Item1.png"><img alt="Изображение:Inventory1-Item1.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Inventory1-Item1.png" src="vhzf-wtn.png" width="60" height="90" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Inventory1-Item2.png" class="image" title="Изображение:Inventory1-Item2.png"><img alt="Изображение:Inventory1-Item2.png" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Inventory1-Item2.png" src="vhzf-wtn-2.png" width="60" height="120" /></a>
</p>
</center>
<p>Теперь нарисуем все это на экране. Принцип тот же.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> vertic<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> goriz<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DrawImage</span> noneim,nachx+j*ImW,nachy+i*ImH<br />
&nbsp; &nbsp; <span style="color: #ffee00">;Text nachx+j*ImW+5,nachy+i*ImH+5,pole(j,i)</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DrawImage</span> noneim,<span style="color: #33ffdd;">507</span>+j*ImW,<span style="color: #33ffdd;">368</span>+i*ImH<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> &nbsp;kolvovesh<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DrawImage</span> pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\image,nachx+pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\posx*ImW,nachx+pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\posy*ImH<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DrawImage</span> pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\image,<span style="color: #33ffdd;">505</span>,<span style="color: #33ffdd;">367</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> mouse=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">DrawImage</span> tempimage,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Тут мы сначала в цикле рисуем поле из пустых клеток. Закомментированная строка будет показывать номер вещи, которая находится в клетке. Это полезно на начальных этапах, чтобы лучше понять, как это работает. Если в клетке ничего нет, то ноль. Потом опять в цикле рисуем место, куда можно будет положить оружие при его выборе. Далее перебираем в цикле все вещи и в зависимости от того, чему равен параметр gde, либо отображаем их в инвентаре, либо в качестве выбранного оружия, либо не отображаем совсем. В конце рисуем возле курсора картинку, если переменная mouse=1 т. е. взят предмет. Можно проверять. Теперь о функции refresh(). Тут все совсем поменялось.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> refresh<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> vertic<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> goriz<br />
&nbsp; &nbsp; pole<span style=" ">&#40;</span>j,i<span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> &nbsp;kolvovesh<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> k=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\kolvokletok*<span style="color: #33ffdd;">0.5</span><span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> m=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; pole<span style=" ">&#40;</span>pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\posx+m,pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\posy+k<span style=" ">&#41;</span>=i<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &gt; nachx+ImW <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &lt; nachx+ImW*<span style=" ">&#40;</span>goriz<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &gt; nachy+ImH <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &lt; nachy+ImH*<span style=" ">&#40;</span>vertic<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> mouse=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pole<span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachx<span style=" ">&#41;</span>/ImW,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachy<span style=" ">&#41;</span>/ImH<span style=" ">&#41;</span> &lt;&gt; <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; mouse=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; i=pole<span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachx<span style=" ">&#41;</span>/ImW,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachy<span style=" ">&#41;</span>/ImH<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; temp1=i<br />
&nbsp; &nbsp; &nbsp; &nbsp; tempimage=pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\image<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; temp2=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> k=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\kolvokletok*<span style="color: #33ffdd;">0.5</span><span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> m=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pole<span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachx<span style=" ">&#41;</span>/ImW+m,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachy<span style=" ">&#41;</span>/ImH+k<span style=" ">&#41;</span> &lt;&gt; <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> temp2=pole<span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachx<span style=" ">&#41;</span>/ImW+m,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachy<span style=" ">&#41;</span>/ImH+k<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> &nbsp;temp2=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\posx=<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachx<span style=" ">&#41;</span>/ImW<br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\posy=<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachy<span style=" ">&#41;</span>/ImH<br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; temp1=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; mouse=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pr<span style=" ">&#40;</span>temp2<span style=" ">&#41;</span>\kolvokletok &gt;= pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\kolvokletok <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\posx=pr<span style=" ">&#40;</span>temp2<span style=" ">&#41;</span>\posx<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\posy=pr<span style=" ">&#40;</span>temp2<span style=" ">&#41;</span>\posy<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp2<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tempimage=pr<span style=" ">&#40;</span>temp2<span style=" ">&#41;</span>\image<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; temp1=temp2<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &gt; <span style="color: #33ffdd;">505</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &lt; <span style="color: #33ffdd;">565</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &gt; <span style="color: #33ffdd;">367</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &lt; <span style="color: #33ffdd;">427</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> mouse=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> orugnom &lt;&gt; <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>orugnom<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">2</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; temp=temp1<br />
&nbsp; &nbsp; &nbsp; &nbsp; temp1=orugnom<br />
&nbsp; &nbsp; &nbsp; &nbsp; tempimage=pr<span style=" ">&#40;</span>orugnom<span style=" ">&#41;</span>\image<br />
&nbsp; &nbsp; &nbsp; &nbsp; orugnom=temp<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">2</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; orugnom=temp1<br />
&nbsp; &nbsp; &nbsp; &nbsp; temp1=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; mouse=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> orugnom &lt;&gt; <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; mouse=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>orugnom<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; temp1=orugnom<br />
&nbsp; &nbsp; &nbsp; &nbsp; tempimage=pr<span style=" ">&#40;</span>orugnom<span style=" ">&#41;</span>\image<br />
&nbsp; &nbsp; &nbsp; &nbsp; orugnom=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Описываю по порядку.
Заполняем в двойном цикле все элементы поля как нулевые.
Перебираем все вещи и если они находятся в инвентаре, то в двойном цикле заполняем все клетки, которые он занимает его номером.
Далее идут операции с мышью. Они работают по тому же принципу, что и раньше. Сначала проверяется, не нажата ли мышь в поле инвентаря, а затем в поле выбранного оружия. Если мышь пуста, то ей присваивается номер клетки, над которой она находится. Если не пуста, то проверяется, поместиться ли предмет туда, куда вы его кладете. Если да, то кладете его, если нет, то ничего не происходит. Если под вами предмет, то возможно два варианта. Если предмет взятый занимает меньше либо столько же места, сколько тот, что под ним, то они меняются. Иначе ничего не происходит. Все это проверяется с помощью итерационных циклов и условий. Надеюсь, что вы разберетесь. Если же нет, то пишите мне на мыло, постараюсь ответить. Напоследок, привожу полный код:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;(c) Agnislav Lipcan</span><br />
<p><span style="color: #ffee00">; &nbsp; &nbsp; &nbsp;inventar</span><br />
<span style="color: #ffee00">;avelnet@yandex.ru</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">700</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">AppTitle</span> <span style="color: #00ff66;">&quot;inventar&quot;</span><br />
<br />
font=<span style="color: #aaffff; font-weight: bold;">LoadFont</span><span style=" ">&#40;</span>courier ,<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">SetFont</span> font<br />
<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> ImH=<span style="color: #33ffdd;">30</span> &nbsp; &nbsp;<span style="color: #ffee00">;&lt;= высота одной клетки</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> ImW=<span style="color: #33ffdd;">30</span> &nbsp; &nbsp;<span style="color: #ffee00">;&lt;= ширина одной клетки</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> nachx=<span style="color: #33ffdd;">70</span> <span style="color: #ffee00">;&lt;= начальное положение поля по x минус ImW</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> nachy=<span style="color: #33ffdd;">70</span> <span style="color: #ffee00">;&lt;= начальное положение поля по y минус ImH</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> vertic=<span style="color: #33ffdd;">6</span> &nbsp;<span style="color: #ffee00">;&lt;= клеток вниз</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> goriz=<span style="color: #33ffdd;">8</span> &nbsp; <span style="color: #ffee00">;&lt;= клеток вправо</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> kolvovesh=<span style="color: #33ffdd;">2</span> &nbsp; <span style="color: #ffee00">;общее количество вещей</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> mouse &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;мыша</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> orugnom=<span style="color: #33ffdd;">0</span> &nbsp; &nbsp; <span style="color: #ffee00">;первое выбранное оружие</span><br />
<br />
<span style="color: #ffee00">;создаем массив клеток инвентаря</span><br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> pole<span style=" ">&#40;</span>goriz<span style="color: #33ffdd;">+1</span>,vertic<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;картинка пустоты</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> noneim=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Inventory1-SmallItem0.png&quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> predmet<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> kolvokletok,posx,posy<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> gde <span style="color: #ffee00">;0-не активно; 1-в инвентаре; 2-выбрано</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> image <span style="color: #ffee00">;картинка</span><br />
&nbsp; <span style="color: #ffee00">;Field cena, sila, lovkost&nbsp;;параметры</span><br />
&nbsp; <span style="color: #ffee00">;Field name$&nbsp;;название</span><br />
&nbsp; <span style="color: #ffee00">;field model&nbsp;;3d модель</span><br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> tempimage<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> temp1=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> temp2=<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #ffee00">;создаем массив предметов</span><br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> pr.predmet<span style=" ">&#40;</span>kolvovesh<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;temp</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> num=<span style="color: #33ffdd;">1</span><br />
newvesh<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">6</span>,<span style="color: #00ff66;">&quot;Inventory1-Item1.png&quot;</span><span style=" ">&#41;</span><br />
newvesh<span style=" ">&#40;</span><span style="color: #33ffdd;">4</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">8</span>,<span style="color: #00ff66;">&quot;Inventory1-Item2.png&quot;</span><span style=" ">&#41;</span><br />
<br />
<br />
<span style="color: #ffee00">;************************* &nbsp;main cikles &nbsp;****************************</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; refresh<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<span style="color: #ffee00">;************************* &nbsp; &nbsp; &nbsp; &nbsp;end &nbsp; &nbsp; &nbsp; &nbsp; ***************************</span><br />
<br />
<span style="color: #ffee00">;************************* &nbsp; &nbsp; functions &nbsp; &nbsp; ***************************</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> vertic<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> goriz<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DrawImage</span> noneim,nachx+j*ImW,nachy+i*ImH<br />
&nbsp; &nbsp; <span style="color: #ffee00">;Text nachx+j*ImW+5,nachy+i*ImH+5,pole(j,i)</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DrawImage</span> noneim,<span style="color: #33ffdd;">507</span>+j*ImW,<span style="color: #33ffdd;">368</span>+i*ImH<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> &nbsp;kolvovesh<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DrawImage</span> pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\image,nachx+pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\posx*ImW,nachx+pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\posy*ImH<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">DrawImage</span> pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\image,<span style="color: #33ffdd;">505</span>,<span style="color: #33ffdd;">367</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> mouse=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">DrawImage</span> tempimage,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> refresh<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> vertic<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> j=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> goriz<br />
&nbsp; &nbsp; pole<span style=" ">&#40;</span>j,i<span style=" ">&#41;</span>=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> &nbsp;kolvovesh<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> k=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\kolvokletok*<span style="color: #33ffdd;">0.5</span><span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> m=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; pole<span style=" ">&#40;</span>pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\posx+m,pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\posy+k<span style=" ">&#41;</span>=i<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &gt; nachx+ImW <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &lt; nachx+ImW*<span style=" ">&#40;</span>goriz<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &gt; nachy+ImH <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &lt; nachy+ImH*<span style=" ">&#40;</span>vertic<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> mouse=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pole<span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachx<span style=" ">&#41;</span>/ImW,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachy<span style=" ">&#41;</span>/ImH<span style=" ">&#41;</span> &lt;&gt; <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; mouse=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; i=pole<span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachx<span style=" ">&#41;</span>/ImW,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachy<span style=" ">&#41;</span>/ImH<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; temp1=i<br />
&nbsp; &nbsp; &nbsp; &nbsp; tempimage=pr<span style=" ">&#40;</span>i<span style=" ">&#41;</span>\image<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; temp2=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> k=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\kolvokletok*<span style="color: #33ffdd;">0.5</span><span style="color: #33ffdd;">-1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> m=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pole<span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachx<span style=" ">&#41;</span>/ImW+m,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachy<span style=" ">&#41;</span>/ImH+k<span style=" ">&#41;</span> &lt;&gt; <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> temp2=pole<span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachx<span style=" ">&#41;</span>/ImW+m,<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachy<span style=" ">&#41;</span>/ImH+k<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> &nbsp;temp2=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\posx=<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachx<span style=" ">&#41;</span>/ImW<br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\posy=<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-nachy<span style=" ">&#41;</span>/ImH<br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; temp1=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; mouse=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pr<span style=" ">&#40;</span>temp2<span style=" ">&#41;</span>\kolvokletok &gt;= pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\kolvokletok <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\posx=pr<span style=" ">&#40;</span>temp2<span style=" ">&#41;</span>\posx<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\posy=pr<span style=" ">&#40;</span>temp2<span style=" ">&#41;</span>\posy<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp2<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tempimage=pr<span style=" ">&#40;</span>temp2<span style=" ">&#41;</span>\image<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; temp1=temp2<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &gt; <span style="color: #33ffdd;">505</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &lt; <span style="color: #33ffdd;">565</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &gt; <span style="color: #33ffdd;">367</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &lt; <span style="color: #33ffdd;">427</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> mouse=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> orugnom &lt;&gt; <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>orugnom<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">2</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; temp=temp1<br />
&nbsp; &nbsp; &nbsp; &nbsp; temp1=orugnom<br />
&nbsp; &nbsp; &nbsp; &nbsp; tempimage=pr<span style=" ">&#40;</span>orugnom<span style=" ">&#41;</span>\image<br />
&nbsp; &nbsp; &nbsp; &nbsp; orugnom=temp<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>temp1<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">2</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; orugnom=temp1<br />
&nbsp; &nbsp; &nbsp; &nbsp; temp1=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; mouse=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> orugnom &lt;&gt; <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; mouse=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; pr<span style=" ">&#40;</span>orugnom<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; temp1=orugnom<br />
&nbsp; &nbsp; &nbsp; &nbsp; tempimage=pr<span style=" ">&#40;</span>orugnom<span style=" ">&#41;</span>\image<br />
&nbsp; &nbsp; &nbsp; &nbsp; orugnom=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> newvesh<span style=" ">&#40;</span>x,y,kl,im$<span style=" ">&#41;</span><br />
pr<span style=" ">&#40;</span>num<span style=" ">&#41;</span> = <span style="color: #aaffff; font-weight: bold;">New</span> predmet<br />
pr<span style=" ">&#40;</span>num<span style=" ">&#41;</span>\posx=x<br />
pr<span style=" ">&#40;</span>num<span style=" ">&#41;</span>\posy=y<br />
pr<span style=" ">&#40;</span>num<span style=" ">&#41;</span>\kolvokletok=kl<br />
pr<span style=" ">&#40;</span>num<span style=" ">&#41;</span>\image=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span>im$<span style=" ">&#41;</span><br />
pr<span style=" ">&#40;</span>num<span style=" ">&#41;</span>\gde=<span style="color: #33ffdd;">1</span><br />
num=num<span style="color: #33ffdd;">+1</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/b/bc/Inventory_1.zip" class="internal" title="Inventory 1.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Avel" title="Участник:Avel">Агнислав Липкан</a> (E-mail: avelnet@yandex.ru)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Основы создания сетевых игр с использованием DirectPlay"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Основы создания сетевых игр с использованием DirectPlay&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Основы создания сетевых игр с использованием DirectPlay&amp;action=edit">править</a>]</span><span class="mw-headline">Основы создания сетевых игр с использованием DirectPlay</span></h1>
<p>Итак, вы решили, что достаточно круты для создания сетевой игры? Значит, вы пришли по адресу. В этом руководстве я постараюсь подробно описать, как сделать сие чудо. Что собой представляет сетевая игра? Есть как минимум два компьютера - сервер и клиент. Сервер - это тот, кто создает игру, а клиент, соответственно, тот, кто к ней подключается. Причем, на одном компьютере можно запустить несколько игровых сеансов, но вот скорость, с которой они будут работать - это уже вопрос отдельный. Далее, каждый компьютер имеет свой адрес, именуемый IP-адресом. IP-адрес выглядит, например, вот так: "77.122.56.45". Чтобы подключится к серверу, клиент должен ввести его IP-адрес, однако тут есть один маленький нюанс, который может сильно подпортить жизнь. Это, так называемые, прокси. Прокси - это когда один компьютер имеет доступ в Интернет через другой компьютер. И подключенных к Интернету таким способом может быть хоть вся локальная сеть. Однако, они все имеют один IP-адрес - IP-адрес сервера. Видите проблему? Если сеанс создан на подключенным таким образом компьютером, к нему подключится нельзя. Впрочем, этот компьютер может подключаться к другим в сети. Но, к сожалению, к Blitz'у это не относится. И в первом и во втором случае он банально выдает ошибку. Я до сих пор ищу решение этой проблемы внутренними средствами. А вот внешние есть - например, спец. библиотеки, написанные на других языках.Например, K-Net Lib. Мы же будем использовать средство Blitz'а именуемое DirectPlay. Но не беспокойтесь - даже, если у вас Интернет через прокси (кстати, Интернет может быть через прокси провайдера), то вы сможете опробовать игру в оффлайне.
</p>
</p><p>Дело в том, что есть очень полезные специальные адреса. Один из них, именуемый "loopback" всегда подразумевает под собой IP-адрес машины, на котором запущена игра. Этот IP-адрес - "127.0.0.1". Запомните его, потому что он понадобится вам очень часто.
</p><p>После длинной теории, наверняка вам не терпится приступить к практике. Если вы хорошо прочитали и запомнили теорию, то можно приступать. Итак, смело вбиваем:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">NetGame=<span style="color: #aaffff; font-weight: bold;">StartNetGame</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Что же делает эта команда? Она вызывает диалоговое окно, в котором вы выбираем тип подключения, вводим IP-адрес сервера и, конечно, выбираем нужный нам сеанс. Некоторых сбивает это с толку, впрочем, я объясню. Сначала выбираете тип соединения в верхнем списке. Для локальной сети и Интернета рекомендую пункт с TCP/IP. Затем при выборе последнего выскакивает окно с просьбой ввести IP сервера. Если вы сервер - оставляйте пустым, если клиент - введите адрес сервера. В остальных случаях придется вводить параметры СОМ-порта, либо номер телефона для модемного соединения. Если мы клиент - в нижнем поле вводим имя сеанса и нажимаем кнопочку "Create New game" и смело идем в игру. Если же мы клиент - то двойным кликом щелкаем на нужном сеансе. Как видите, все довольно просто.
</p><p>Эта функция возвращает 0 - подключение/создание сеанса не удалось, 1 - удачно подключились, 2 - удачно создали сеанс. Прервать сеанс можно прервать командой StopNetGame. Разрывается сеанс только на локальной машине! Причем, если сервер выходил из игры, то сервером становится другой игрок. И второму отправляется системное сообщение типа 102. Впрочем, о типах сообщений попозже.
</p><p>Есть еще две функции, заменающие ее. Это HostNetGame и JoinNetGame. Первая запускает сеанс (нужно указать имя) и возвращает 2 при удаче, 0 - при неудаче. Вторая подключается к сеансу (нужно указать имя и IP) и возвращает 1 при удаче и 0 - при неудаче.
</p><p>Далее, одна из самых важных команд - СreateNetPlayer. В скобках надо указать имя игрока. Обычно указывается имя, введенное с клавиатуры. Внимание! Это создает локального игрока! И только локального. Когда кто-то другой создает своего игрока, то остальным отправляется сообщение с типом 100. Поэтому надо добавлять имена, IDы, а также всю остальную информацию о игроках в типы. Рекомендуется именно в типы, так как  в таком случае не будет ограничений по количеству игроков. Функция возвращает ID созданного игрока. Запишите его в секцию про свое alter ego.
</p><p>Дальше - DeleteNetPlayer. Удаляет локального игрока по IDу. Может встать вопрос - а почему собственно, может быть несколько игроков на одном ПК? А в некоторых играх может быть так, что несколько игроков играют вот так за одним компьютером.
</p><p>RecvNetMsg. Без нее вы не сможете получать никаких сообщений. Она возвращает  True, если пришло сообщение и False, если нет.
</p><p>NetMsgType. Возвращает тип сообщения. О, вот мы и добрались до типов. Итак, повторим, и скажу про новые. 100 - новый игрок(приходит от пришедшего игрока), 101 - игрок ушел (приходит от ушедшего игрока), 102 - теперь мы сервер, 200 - сеанс накрылся медным тазом. Сообщения в диапазоне 1 - 99 - пользовательские. Некоторые могут спросить - а зачем много типов сообщений? А для того, чтобы не путать сообщения с 3Д-координатами, и сообщения чата.
</p><p>NetMsgFrom. Возвращает ID игрока, пославшего последнее сообщение.
</p><p>NetMsgTo. Возвращает ID игрока, которому слали сообщение.
</p><p>NetMsgData. Возвращает содержание сообщения. ВНИМАНИЕ! Обьединяйте данные в одну строку! Во-первых, вы избежите жутких тормозов, а во-вторых сократите траффик.
</p><p>NetPlayerName. Возвращает имя игрока по его ID.
</p><p>NetPlayerLocal. Возвращает True, если указанный ID игрока совпадает с нашим и False иначе.
</p><p>SendNetMsg. Первый параметр - тип сообщения, второй - содержание, третье - наш ID, четвертое - ID получателя (0 если всем), пятое (необязательный параметр) -  приоритет сообщений. Правда, если приоритет высокий, то скорость посылки сообщения низкая. Рекомендуется для чата.
</p><p>Вот мы и разобрали, что есть что. Если вам нужны более точные сведения, то посмотрите справку, или мой перевод ее на Boolean.name -&gt; Blitz3D -&gt; Переводы -&gt; Перевод раздела DirectPlay. И хотя там довольно много ошибок и неточностей, он понятен.
</p><p>Далее, сделаем небольшую игру про кубики. Итак.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> Player<br />
<p>&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> name$,id,ent<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>Создаем тип игрока, который будет содержать его имя, ID и ссылку на кубик.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> cam<br />
<p><span style="color: #aaffff; font-weight: bold;">Global</span> myent<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> myid<br />
</p>
<span style="color: #aaffff; font-weight: bold;">Global</span> myname$</div>
<p>Инициализируем глобальные переменные: для камеры, ссылку на свой кубик, ссылку на свой ID, ссылку на свое имя.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span>,<span style="color: #33ffdd;">2</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
jng=<span style="color: #aaffff; font-weight: bold;">JoinNetGame</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;World Arena&quot;</span>,<span style="color: #00ff66;">&quot;127.0.0.1&quot;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Not</span> jng <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">HostNetGame</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;World Arena&quot;</span><span style=" ">&#41;</span></div>
<p>Инициализируем графику и создаем игру. Заметьте - мы сначала пробуем подключится к сеансу на своем компьютере, а если его нет - создаем. Это очень удобно для тестирования и отладки. Я надеюсь, вы не забыли loopback?
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">p.Player=<span style="color: #aaffff; font-weight: bold;">New</span> Player<br />
<p>p\name=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Enter your name:&quot;</span><span style=" ">&#41;</span><br />
p\id=<span style="color: #aaffff; font-weight: bold;">CreateNetPlayer</span><span style=" ">&#40;</span>p\name<span style=" ">&#41;</span><br />
p\ent=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
myname=p\name<br />
myid=p\id<br />
</p>
myent=p\ent</div>
<p>Создаем игрока. Также даем значения ссылкам на будущее. Рекомендую вам тоже так делать.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">cam=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> cam,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">-5</span></div>
<p>Создаем и располагаем камеру - трудно не догадаться&nbsp;:).
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<p>&nbsp; UpdatePlayer<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; UpdateNetwork<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Flip</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Wend</span></div>
<p>Цикл - сердце игры&nbsp;:) Далее, приведу функции.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> UpdatePlayer<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">17</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> myent,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,.<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">31</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> myent,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-.<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">30</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">TurnEntity</span> myent,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">32</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">TurnEntity</span> myent,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">SendNetMsg</span> <span style="color: #33ffdd;">2</span>,PackMsg$<span style=" ">&#40;</span>myent<span style=" ">&#41;</span>,myid,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> UpdateNetwork<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">RecvNetMsg</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Select</span> <span style="color: #aaffff; font-weight: bold;">NetMsgType</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">100</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; p.Player=<span style="color: #aaffff; font-weight: bold;">New</span> Player<br />
&nbsp; &nbsp; &nbsp; &nbsp; p\id=<span style="color: #aaffff; font-weight: bold;">NetMsgFrom</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; p\name=<span style="color: #aaffff; font-weight: bold;">NetPlayerName</span><span style=" ">&#40;</span>p\id<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; p\ent=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">101</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; p.Player=FindPlayer<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">NetMsgFrom</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> p\ent<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> p<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; p.Player=FindPlayer<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">NetMsgFrom</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; UnpackMsg<span style=" ">&#40;</span>p\ent,<span style="color: #aaffff; font-weight: bold;">NetMsgData</span>$<span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> FindPlayer.Player<span style=" ">&#40;</span> id <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> p.Player=<span style="color: #aaffff; font-weight: bold;">Each</span> Player<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> p\id=id <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> p<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> PackMsg$<span style=" ">&#40;</span>ent<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>ent<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;|&quot;</span>+<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>ent<span style=" ">&#41;</span>+<span style="color: #00ff66;">&quot;|&quot;</span>+<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>ent<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> UnpackMsg<span style=" ">&#40;</span>ent,dat$<span style=" ">&#41;</span><br />
&nbsp; xp=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>dat$,<span style="color: #00ff66;">&quot;|&quot;</span><span style=" ">&#41;</span><br />
&nbsp; x=<span style="color: #aaffff; font-weight: bold;">Float</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>dat$,xp<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; dat$=<span style="color: #aaffff; font-weight: bold;">Right</span><span style=" ">&#40;</span>dat$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>dat$<span style=" ">&#41;</span>-xp<span style=" ">&#41;</span><br />
&nbsp; zp=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>dat$,<span style="color: #00ff66;">&quot;|&quot;</span><span style=" ">&#41;</span><br />
&nbsp; z=<span style="color: #aaffff; font-weight: bold;">Float</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>dat$,zp<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; dat$=<span style="color: #aaffff; font-weight: bold;">Right</span><span style=" ">&#40;</span>dat$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>dat$<span style=" ">&#41;</span>-zp<span style=" ">&#41;</span><br />
&nbsp; yaw=<span style="color: #aaffff; font-weight: bold;">Float</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>dat$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>dat$<span style=" ">&#41;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> ent,x,<span style="color: #33ffdd;">0</span>,z<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> ent,<span style="color: #33ffdd;">0</span>,yaw,<span style="color: #33ffdd;">0</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Первая обеспечивает управление кубиком, вторая - проверяет, есть ли новые сообщение и реагирует на них. Третья - ищет игрока по типу, четвертая - объединяет данные в одно. Как я уже говорил, это делается для экономии трафика, и чтобы не было тормозов. Пятая - распаковывает запакованное&nbsp;:). Ну а также перемещает нужный кубик куда надо.
</p><p>Как видите, создавать сетевые игры - это не так сложно как, возможно, кажется на первый взгляд. А может быть когда-нибудь вы сделаете супер-пупер ММОРПГ?&nbsp;:). В любом случае, желаю удачи.
</p>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Tadeus" title="Участник:Tadeus">Волошин Леонид аka Tadeus</a>
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Создание системы шифрования файлов с распаковкой в память"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Создание системы шифрования файлов с распаковкой в память&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Создание системы шифрования файлов с распаковкой в память&amp;action=edit">править</a>]</span><span class="mw-headline">Создание системы шифрования файлов с распаковкой в память</span></h1>
</p>
<a name=".D0.9D.D0.B5.D0.BC.D0.BD.D0.BE.D0.B3.D0.BE_.D1.82.D0.B5.D0.BE.D1.80.D0.B8.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B_%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D1%81_%D1%80%D0%B0%D1%81%D0%BF%D0%B0%D0%BA%D0%BE%D0%B2%D0%BA%D0%BE%D0%B9_%D0%B2_%D0%BF%D0%B0%D0%BC%D1%8F%D1%82%D1%8C&amp;action=edit&amp;section=1" title="Создание системы шифрования файлов с распаковкой в память">править</a>]</span> <span class="mw-headline">Немного теории</span></h2>
<p>В общем, большинство любительских систем делает распаковку в tmp-файлы, потому что программа, которая использует такую систему, не может грузить ресурсы из памяти. Например Блиц3д: для того, чтобы заставить его грузить картинки из памяти, Maxus'у пришлось извратится и переопределять функции чтения файла. Такой метод не очень удобен при кроссплатформеных приложениях, но это уже выходит за рамки этой статьи.
</p><p>Итак, немного теории: в БлицМаксе это можно было сделать несколькими путями:
</p>
<ul><li>Переопределить функции чтения из файла, но это слишком сложно для нас, и много кропотливой работы
</li><li>Написать свой модуль-загрузчик (типа pngloader.mod) - не универсально, можно шифровать только файлы, которые грузит загрузчик
</li><li>Использовать возможность загрузки ресурсов из потоков - вот это мы и будем использовать
</li></ul>
<p>БлицМакс позволяет в функцию чтения файла вместо имени файла подавать поток ... И вообще, там подается url:Object, а Object'ом может быть что угодно, хоть имя файла, хоть веб-сайт. И, соответственно, наш поток тоже может туда подать. В общем, алгоритм такой&nbsp;:
</p>
<ul><li>Мы пишем функции кодировки / декодировки TStream
</li><li>Мы пишем простенькую функцию - враппер
</li><li>Потом делаем простенький пример как это использовать
</li></ul>
<a name=".D0.91.D0.BE.D0.BB.D1.8C.D1.88.D0.B5_.D0.BF.D1.80.D0.B0.D0.BA.D1.82.D0.B8.D0.BA.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B_%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D1%81_%D1%80%D0%B0%D1%81%D0%BF%D0%B0%D0%BA%D0%BE%D0%B2%D0%BA%D0%BE%D0%B9_%D0%B2_%D0%BF%D0%B0%D0%BC%D1%8F%D1%82%D1%8C&amp;action=edit&amp;section=2" title="Создание системы шифрования файлов с распаковкой в память">править</a>]</span> <span class="mw-headline">Больше практики</span></h2>
<p>Я не буду описывать сами алгоритмы шифрования, потому что их много и это совершенно другая тема. Остановимся на банальном:
</p>
<ul><li>Шифровка байта - это byte_code = byte + 10
</li><li>Расшифровка - это byte = byte_code - 10
</li></ul>
<p>Метод "шифрования" банален, но потом вы можете сделать и свои методы.
</p>
<a name=".D0.A8.D0.B8.D1.84.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BF.D0.BE.D1.82.D0.BE.D0.BA.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B_%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D1%81_%D1%80%D0%B0%D1%81%D0%BF%D0%B0%D0%BA%D0%BE%D0%B2%D0%BA%D0%BE%D0%B9_%D0%B2_%D0%BF%D0%B0%D0%BC%D1%8F%D1%82%D1%8C&amp;action=edit&amp;section=3" title="Создание системы шифрования файлов с распаковкой в память">править</a>]</span> <span class="mw-headline">Шифрование потока</span></h2>
<p>Так, начнем с функции шифрования потока. Напишем костяк функции&nbsp;:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> CodeStream:<span style="color: #ffff00; font-weight: bold;">TStream</span><span style=" ">&#40;</span>in:<span style="color: #ffff00; font-weight: bold;">TStream</span><span style=" ">&#41;</span> <br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<p>Теперь создадим поток, в который можно спокойно записывать и так же спокойно читать из него. Но как же его создать, если поток всегда к чему-то прикреплен? В БлицМаксе есть такая полезная штука как TBank, это, можно сказать, массив с неопределенным размером и работает он по принципу стека .. но это нам не важно. Нам важно что&nbsp;:
</p>
<ul><li>Принимает любой размер
</li><li>К нему можно прицепить поток
</li></ul>
<p>Создадим наш поток вывода:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Local</span> bank:<span style="color: #ffff00; font-weight: bold;">TBank</span> = <span style="color: #ffff00; font-weight: bold;">New</span> <span style="color: #ffff00; font-weight: bold;">TBank</span> <br />
<span style="color: #ffff00; font-weight: bold;">Local</span> out_stream:<span style="color: #ffff00; font-weight: bold;">TStream</span> = <span style="color: #ffff00; font-weight: bold;">OpenStream</span><span style=" ">&#40;</span>bank<span style=" ">&#41;</span></div>
<p>Думаю, все банально ясно .. Так, идем дальше, для начала запишем какую-то фразу, пусть эта фраза будет заголовком для нашего Pak-Файла:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">out_stream.<span style="color: #ffff00; font-weight: bold;">WriteString</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;Start_Pak&quot;</span><span style=" ">&#41;</span></div>
<p>Потом при чтении мы будем сверяться с ней и выдавать ошибку, если заголовок не правилен. Дальше запишем размер данных для шифрования, это удобно и позволяет вычислить программерские ошибки если что:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">out_stream.<span style="color: #ffff00; font-weight: bold;">WriteInt</span><span style=" ">&#40;</span>in.<span style="">Size</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span></div>
<p>Теперь перейдем к самому интересному - будем шифровать входящий поток:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">While</span> <span style="color: #ffff00; font-weight: bold;">Not</span> <span style="color: #ffff00; font-weight: bold;">Eof</span><span style=" ">&#40;</span>in<span style=" ">&#41;</span> <br />
<p>out_stream.<span style="color: #ffff00; font-weight: bold;">WriteByte</span><span style=" ">&#40;</span> in.<span style="color: #ffff00; font-weight: bold;">ReadByte</span><span style=" ">&#40;</span><span style=" ">&#41;</span> + <span style="color: #FFFFFF;">10</span> <span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">Wend</span></div>
<p>Все банально, просто и тормозно. Теперь запишем конец файла (чтобы потом при чтении сверяться):
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">out_stream.<span style="color: #ffff00; font-weight: bold;">WriteString</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;End_Pak&quot;</span><span style=" ">&#41;</span></div>
<p>"Сбросим" на ноль потоки:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">out_stream.<span style="">Seek</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
in.<span style="">Seek</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span></div>
<p>(это вообще важно, их же потом тоже будут использовать&nbsp;! ) и вернем поток из функции
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Return</span> out_stream</div>
<p>Вот и все, наша функция шифрования потока закончена&nbsp;!
</p>
<a name=".D0.94.D0.B5.D0.BA.D0.BE.D0.B4.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BF.D0.BE.D1.82.D0.BE.D0.BA.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B_%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D1%81_%D1%80%D0%B0%D1%81%D0%BF%D0%B0%D0%BA%D0%BE%D0%B2%D0%BA%D0%BE%D0%B9_%D0%B2_%D0%BF%D0%B0%D0%BC%D1%8F%D1%82%D1%8C&amp;action=edit&amp;section=4" title="Создание системы шифрования файлов с распаковкой в память">править</a>]</span> <span class="mw-headline">Декодирование потока</span></h2>
<p>Если вы прочитали прошлый раздел, то все для вас довольно просто. Теперь минимум объяснений и больше кода. Костяк функции:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> DecodeStream:<span style="color: #ffff00; font-weight: bold;">TStream</span><span style=" ">&#40;</span>in:<span style="color: #ffff00; font-weight: bold;">TStream</span><span style=" ">&#41;</span><br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> bank:<span style="color: #ffff00; font-weight: bold;">TBank</span> = <span style="color: #ffff00; font-weight: bold;">New</span> <span style="color: #ffff00; font-weight: bold;">TBank</span> <span style="color: #ffff00; font-weight: bold;">Local</span><br />
&nbsp; out_stream:<span style="color: #ffff00; font-weight: bold;">TStream</span> = <span style="color: #ffff00; font-weight: bold;">OpenStream</span><span style=" ">&#40;</span>bank<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #B1E7EB;">'.... здесь будет наш последуйший код&nbsp;:)</span><br />
&nbsp; out_stream.<span style="">Seek</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
&nbsp; in.<span style="">Seek</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Return</span> out_stream<br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<p>Теперь проверяем начальный заголовок и читаем, сколько данных записано:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Local</span> Header$ = in.<span style="color: #ffff00; font-weight: bold;">ReadString</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">9</span><span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">If</span> Header &lt;&gt; <span style="color: #00FF66;">&quot;Start_Pak&quot;</span> <span style="color: #ffff00; font-weight: bold;">Then</span> <span style="color: #ffff00; font-weight: bold;">RuntimeError</span> <span style="color: #00FF66;">&quot;pak corrupt&quot;</span> <span style="color: #ffff00; font-weight: bold;">Local</span> DataSize% = in.<span style="color: #ffff00; font-weight: bold;">ReadInt</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Если вам обломно считать, сколько букв в вашем заголовке, то пользуйтесь функциями ReadLine \ WriteLine для записи и чтения заголовка. Теперь дешифруем сами данные файла:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> dat% = <span style="color: #FFFFFF;">1</span> <span style="color: #ffff00; font-weight: bold;">To</span> DataSize<br />
<p>&nbsp; out_stream.<span style="color: #ffff00; font-weight: bold;">WriteByte</span> <span style=" ">&#40;</span> in.<span style="color: #ffff00; font-weight: bold;">ReadByte</span><span style=" ">&#40;</span><span style=" ">&#41;</span> - <span style="color: #FFFFFF;">10</span> <span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">Next</span></div>
<p>Используем "1 to DataSize", потому что в БлицМаксе "for" доходит до последнего значения ... Далее сверяем фразу в конце файла, чтобы проверить, что мы не ошиблись:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Local</span> EndHeader$ = in.<span style="color: #ffff00; font-weight: bold;">ReadString</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">7</span><span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">If</span> EndHeader &lt;&gt; <span style="color: #00FF66;">&quot;End_Pak&quot;</span> <span style="color: #ffff00; font-weight: bold;">Then</span> <span style="color: #ffff00; font-weight: bold;">RuntimeError</span> <span style="color: #00FF66;">&quot;pak data corrupt&quot;</span></div>
<p>Вот и все! Подведем итог: вот наши функции шифрования и дешифрования потока:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> CodeStream:<span style="color: #ffff00; font-weight: bold;">TStream</span><span style=" ">&#40;</span>in:<span style="color: #ffff00; font-weight: bold;">TStream</span><span style=" ">&#41;</span><br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> bank:<span style="color: #ffff00; font-weight: bold;">TBank</span> = <span style="color: #ffff00; font-weight: bold;">New</span> <span style="color: #ffff00; font-weight: bold;">TBank</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> out_stream:<span style="color: #ffff00; font-weight: bold;">TStream</span> = <span style="color: #ffff00; font-weight: bold;">OpenStream</span><span style=" ">&#40;</span>bank<span style=" ">&#41;</span><br />
&nbsp; out_stream.<span style="color: #ffff00; font-weight: bold;">WriteString</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;Start_Pak&quot;</span><span style=" ">&#41;</span><br />
&nbsp; out_stream.<span style="color: #ffff00; font-weight: bold;">WriteInt</span><span style=" ">&#40;</span>in.<span style="">Size</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">While</span> <span style="color: #ffff00; font-weight: bold;">Not</span> <span style="color: #ffff00; font-weight: bold;">Eof</span><span style=" ">&#40;</span>in<span style=" ">&#41;</span><br />
&nbsp; &nbsp; out_stream.<span style="color: #ffff00; font-weight: bold;">WriteByte</span><span style=" ">&#40;</span> in.<span style="color: #ffff00; font-weight: bold;">ReadByte</span><span style=" ">&#40;</span><span style=" ">&#41;</span> + <span style="color: #FFFFFF;">10</span> <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Wend</span><br />
&nbsp; out_stream.<span style="color: #ffff00; font-weight: bold;">WriteString</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;End_Pak&quot;</span><span style=" ">&#41;</span><br />
&nbsp; out_stream.<span style="">Seek</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
&nbsp; in.<span style="">Seek</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Return</span> out_stream<br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Function</span> DecodeStream:<span style="color: #ffff00; font-weight: bold;">TStream</span><span style=" ">&#40;</span>in:<span style="color: #ffff00; font-weight: bold;">TStream</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> bank:<span style="color: #ffff00; font-weight: bold;">TBank</span> = <span style="color: #ffff00; font-weight: bold;">New</span> <span style="color: #ffff00; font-weight: bold;">TBank</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> out_stream:<span style="color: #ffff00; font-weight: bold;">TStream</span> = <span style="color: #ffff00; font-weight: bold;">OpenStream</span><span style=" ">&#40;</span>bank<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Header$ = in.<span style="color: #ffff00; font-weight: bold;">ReadString</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">9</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Header &lt;&gt; <span style="color: #00FF66;">&quot;Start_Pak&quot;</span> <span style="color: #ffff00; font-weight: bold;">Then</span> <span style="color: #ffff00; font-weight: bold;">RuntimeError</span> <span style="color: #00FF66;">&quot;pak corrupt&quot;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> DataSize% = in.<span style="color: #ffff00; font-weight: bold;">ReadInt</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> dat% = <span style="color: #FFFFFF;">1</span> <span style="color: #ffff00; font-weight: bold;">To</span> DataSize<br />
&nbsp; &nbsp; out_stream.<span style="color: #ffff00; font-weight: bold;">WriteByte</span> <span style=" ">&#40;</span> in.<span style="color: #ffff00; font-weight: bold;">ReadByte</span><span style=" ">&#40;</span><span style=" ">&#41;</span> - <span style="color: #FFFFFF;">10</span> <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> EndHeader$ = in.<span style="color: #ffff00; font-weight: bold;">ReadString</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">7</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> EndHeader &lt;&gt; <span style="color: #00FF66;">&quot;End_Pak&quot;</span> <span style="color: #ffff00; font-weight: bold;">Then</span> <span style="color: #ffff00; font-weight: bold;">RuntimeError</span> <span style="color: #00FF66;">&quot;pak data corrupt&quot;</span><br />
&nbsp; out_stream.<span style="">Seek</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
&nbsp; in.<span style="">Seek</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Return</span> out_stream<br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<a name=".D0.A4.D1.83.D0.BD.D0.BA.D1.86.D0.B8.D0.B8_.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D1.8B_.D1.81_.D0.BF.D0.BE.D1.82.D0.BE.D0.BA.D0.B0.D0.BC.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B_%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D1%81_%D1%80%D0%B0%D1%81%D0%BF%D0%B0%D0%BA%D0%BE%D0%B2%D0%BA%D0%BE%D0%B9_%D0%B2_%D0%BF%D0%B0%D0%BC%D1%8F%D1%82%D1%8C&amp;action=edit&amp;section=5" title="Создание системы шифрования файлов с распаковкой в память">править</a>]</span> <span class="mw-headline">Функции работы с потоками</span></h2>
<p>Все довольно просто и особой необходимости в таких функциях нет. Они нужны, чтобы было меньше писанины, чтобы было понятнее - не сводить в одну строчку, как обычно, а расписать побольше:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> ReadPakFile:<span style="color: #ffff00; font-weight: bold;">TStream</span><span style=" ">&#40;</span>filename$<span style=" ">&#41;</span><br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> file:<span style="color: #ffff00; font-weight: bold;">TStream</span> = <span style="color: #ffff00; font-weight: bold;">ReadFile</span><span style=" ">&#40;</span>filename<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> out:<span style="color: #ffff00; font-weight: bold;">TStream</span> = DecodeStream<span style=" ">&#40;</span>file<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">CloseFile</span><span style=" ">&#40;</span>file<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Return</span> out<br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<p>И функция шифрования пак-файла (полезная вещь, однако):
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> WritePakFile<span style=" ">&#40;</span>filename_in$,filename_out$<span style=" ">&#41;</span><br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> file:<span style="color: #ffff00; font-weight: bold;">TStream</span> = <span style="color: #ffff00; font-weight: bold;">ReadFile</span><span style=" ">&#40;</span>filename_in<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> file_out:<span style="color: #ffff00; font-weight: bold;">TStream</span> = <span style="color: #ffff00; font-weight: bold;">WriteFile</span><span style=" ">&#40;</span>filename_out<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> out:<span style="color: #ffff00; font-weight: bold;">TStream</span> = CodeStream<span style=" ">&#40;</span>file<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">While</span> <span style="color: #ffff00; font-weight: bold;">Not</span> <span style="color: #ffff00; font-weight: bold;">Eof</span><span style=" ">&#40;</span>out<span style=" ">&#41;</span><br />
&nbsp; &nbsp; file_out.<span style="color: #ffff00; font-weight: bold;">WriteByte</span><span style=" ">&#40;</span>out.<span style="color: #ffff00; font-weight: bold;">ReadByte</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Wend</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">CloseFile</span> file_out out.<span style="">Close</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<p>Все довольно просто и сделано так, чтобы вам было понятно. Пример использования, очень банально:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">WritePakFile<span style=" ">&#40;</span><span style="color: #00FF66;">&quot;test.png&quot;</span>,<span style="color: #00FF66;">&quot;test.pak&quot;</span><span style=" ">&#41;</span><br />
img:TImage = <span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span>ReadPakFile<span style=" ">&#40;</span><span style="color: #00FF66;">&quot;test.pak&quot;</span><span style=" ">&#41;</span><span style=" ">&#41;</span></div>
<p>Вот и все. Алгоритм шифрования можно усложнить до бесконечности, но целью статьи было просто показать как это использовать в БМаксе, так что юзайте.
</p>
<div align="right"><a href="http://blitzetcetera.org/images/5/5b/Encryption.zip" class="internal" title="Encryption.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php?title=%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Jimon&amp;action=edit" class="new" title="Участник:Jimon">Jimon</a> (e-mail: jimon.j1m0n@gmail.com)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Тайловая игра на BlitzMax"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Тайловая игра на BlitzMax&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Тайловая игра на BlitzMax&amp;action=edit">править</a>]</span><span class="mw-headline">Тайловая игра на BlitzMax</span></h1>
</p>
<a name=".D0.92.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5_4"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D0%B0%D1%8F_%D0%B8%D0%B3%D1%80%D0%B0_%D0%BD%D0%B0_BlitzMax&amp;action=edit&amp;section=1" title="Тайловая игра на BlitzMax">править</a>]</span> <span class="mw-headline">Введение</span></h2>
<p>Привет! Этот тутор поможет вам понять, как строятся игры на основе плиток (далее - тайлов). Надеюсь, что приведенная здесь информация будет полезной для начинающих гейм-девелоперов.
</p><p>Я не претендую на абсолютное знание предмета и всех его тонкостей, это, так сказать, мой взгляд на данную тему. Многое, что здесь написано, взято не с потолка, а уже много лет используется другими людьми, я лишь адаптировал код под BlitzMax, конечно, добавив некоторые моменты и от себя. Вот главные ресурсы, с которых была взята информация по данной теме:
</p><p><br />
</p>
<ul><li><a href="http://www.tonypa.pri.ee/tbw/start.html" class="external free" title="http://www.tonypa.pri.ee/tbw/start.html" rel="nofollow">http://www.tonypa.pri.ee/tbw/start.html</a> пожалуй, это главная ссылка, здесь приведены основные принципы построения тайловых игр, исходники для FlashMX2004 (ver7).
</li><li><a href="http://www.dionaholding.ru/news/articles/tbg_flash?PHPSESSID=2fecc224531c56dbee2ef2954fc6ed07" class="external free" title="http://www.dionaholding.ru/news/articles/tbg_flash?PHPSESSID=2fecc224531c56dbee2ef2954fc6ed07" rel="nofollow">http://www.dionaholding.ru/news/articles/tbg_flash?PHPSESSID=2fecc224531c56dbee2ef2954fc6ed07</a>  - это тоже самое, только переведенное на русский язык, исходники те же
</li><li><a href="http://jnrdev.72dpiarmy.com/" class="external free" title="http://jnrdev.72dpiarmy.com" rel="nofollow">http://jnrdev.72dpiarmy.com</a> - еще один сайт по данной тематике, исходники для С++ движок SDL.
</li></ul>
<p>Это далеко не всё, есть и другие источники, можете накопать еще что-нибудь в Интернете.
</p><p>Сразу хочу заметить несколько моментов:
</p>
<ul><li>Я пишу программы с директивой SuperStrict. Где-то читал, что эта директива заставляет программу работать быстрее, каких-то документальных подтверждений этой теории я не нашел, но если это правда, то почему бы ей и не пользоваться. А использую я ее лишь для того, чтобы избежать ошибок в правильном написании переменных и чтобы видеть к каким типам они принадлежат.
</li><li>Я не использую всякие значки типа $, % и т.д. в объявлении переменных. И все параметры функций заключены в скобки ( ). Так уж у меня повелось, и это единственное обоснование.
</li><li>В названии типа я всегда ставлю вначале букву T , так если хочу создать тип Level, то я называю его TLevel,(буква T от слова Type).
</li><li>Функцию создания любого объекта, я называю Create() и она всегда находится внутри типа, для которого используется. Доступ к ней производится через точку. Например: TLevel.Create() .
</li><li>Функция, в которой происходит рисование объекта на экране, всегда называется Draw().
</li><li>Функция, в которой происходит изменение состояния объекта, изменение размеров, перемещение и другие действия, всегда называется Update().
</li><li>Я не утверждаю, что надо делать так и только так. Вовсе нет, каждый сам хозяин своего кода. Но на протяжении всего тутора, я буду придерживаться своих правил, поэтому и считаю правильным заранее вас об этом предупредить.
</li></ul>
<a name=".D0.A2.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2.D1.8B.D0.B5_.D0.BA.D0.B0.D1.80.D1.82.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D0%B0%D1%8F_%D0%B8%D0%B3%D1%80%D0%B0_%D0%BD%D0%B0_BlitzMax&amp;action=edit&amp;section=2" title="Тайловая игра на BlitzMax">править</a>]</span> <span class="mw-headline">Тайловые карты</span></h2>
<p>Что же такое тайл? Тайл в переводе с англицкого - это плитка. В нашем случае это прямоугольник (чаще - квадрат, реже - шестиугольник) с картинкой. Вы когда-нибудь собирали пазл? Одну большую картинку из множества кусочков. Каждый из кусочков не имел никакой ценности. Помните, что нельзя было понять, что изображено на каждом кусочке, и только соединив несколько соседних можно было увидеть часть рисунка или картины. Так же и в играх, разработчики дробят весь уровень игры (или карту)  на маленькие равные кусочки. Вы ,конечно, спросите, а зачем они это делают? Попытаюсь объяснить подоходчивей. Даже имея 5 разных тайлов, можно нарисовать приличную карту для игры. Просто размещая эти тайлы в нужном вам порядке. Гляньте:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-01.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-01.jpg" src="f3b23faa.jpg" width="432" height="301" /></a></span></div></div>
<p>Мои художественные способности оставляют желать лучшего, так что эта карта - ради объяснения принципа, а не ради красоты. Видите, слева я нарисовал тайлы, которые использую в своей карте, а справа карта, собранная из этих тайлов. Думаю, всё наглядно и понятно. Зачем рисовать новую большую карту, затратив при этом много усилий, когда можно собрать ее по кусочкам, за несколько минут. Разработчики  просто рисуют набор тайлов для карты и нумеруют их. Например так: трава - 0, вода - 1, деревцо - 2, дом - 3, куст - 4. И тогда в памяти компьютера карту можно представить так&nbsp;:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-02.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-02.gif" src="kb9524bq.gif" width="398" height="301" /></a></span></div></div>
<p>Думаю всем очевидны преимущества данного метода: можно собрать множество разных карт с помощью ограниченного набора тайлов. Тайлы обычно бывают квадратными с размерами (ширина х высота)&nbsp;: 16х16, 24х24, 32х32, 64х64, т.е. ширина = высоте. Но вас никто не ограничивает и вы можете делать тайлы, например, 16х8 или другого размера, всё зависит лишь от вашей фантазии и движка вашей игры. Я использую такие тайлы лишь потому, что наборы тайлов таких размеров легко можно найти в интернете, чтобы не рисовать самому(мои худ. способности вы видели выше). Хорошо, с этим мы разобрались. Но есть и еще один параметр тайла. Этот параметр - проходимость. То есть, сможет ли игрок пройти по этому тайлу. Допустим, в вашей игре можно идти по тайлам, обозначающим траву, дорогу или песок, а по другим тайлам идти нельзя, таким как дерево или куст, стена или еще что-то. Так что, договоримся , что для каждого тайла установим параметр &lt;проходимость&gt;! Который будет принимать значения &lt;Да&gt; и &lt;Нет&gt;, разные для каждого тайла.(?) Посмотрите на нашу карту:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-03.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-03.gif" src="z0qzm20z.gif" width="398" height="301" /></a></span></div></div>
<p>Она имеет размеры: 6 тайлов в ширину (от 0 до 5) и 7 тайлов в высоту (от 0 до 6). Или по-другому - 6х7 тайлов. Теперь мы можем видеть, что тайлы по координатам (1,3)&nbsp;; (3,3)  и (4,6) содержат цифру 3, то есть тайл - дом, ну и так далее. Видите: все очень просто. Итак, перечислим все параметры для нашего тайла. Это: ширина и высота тайла, его координаты на тайловой карте, координаты на экране, проходимость и номер картинки в нашем наборе тайлов.
</p><p>Так будет выглядеть тип тайла в Блитце:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TTile<br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> width &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">' ширина тайла</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> height &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">' высота тайла</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> xTile,yTile &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">' координаты на карте(тайловые координаты)</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> x,y &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">' координаты на экране</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> walkable &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">' проходимость</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> image &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">' картинка</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">type</span></div>
<p>Постойте, я ничего не рассказывал про экранные координаты. Ладно, тут дело состоит в том, что у нас пока имеются только координаты тайла в карте, но не на экране. Как их перевести в экранные? Давайте подумаем. Допустим размеры тайла 32х32.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-04.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-04.gif" src="n7127eyp.gif" width="286" height="222" /></a></span></div></div>
<p>Тайл по координатам (0,0) - это трава, следующий за ним тайл (1,0) - это куст, дальше (2,0) - опять трава и т. д. Допустим, первый тайл рисуется прямо с левого верхнего угла экрана, т.е. его х и у равны 0, второй тайл будет рисоваться сразу за первым, правильно. Третий будет рисоваться начиная с окончания второго. Ладно смотрите:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-05.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-05.gif" src="7qkmyk6k.gif" width="286" height="222" /></a></span></div></div>
<p>Я изобразил три тайла, идущих друг за другом, разного цвета, для наглядности примера.
</p><p>Ок. Перевод тайловых координат в экранные очень прост. Давайте домножать тайловые координаты на ширину тайла. Смотрите сами первый тайл (0,0) домножим на 32 - экранные координаты стали (0,0) потому что умножение на 0 дает 0, дальше интереснее - второй тайл (1,0) домножим на 32 (1*32, 0*32) , экранные координаты - (32, 0), третий тайл -(2*32,0*32) - экранные координаты (64, 0). А теперь посмотрите на картинку выше. Ого! Так оно и есть - первый тайл (синенький) начинается с (0,0)&nbsp;; второй(зелененький) - начинается с (32,0), третий(малиновый) - (64,0). Итак повторю, чтобы перейти от тайловых координат к экранным надо домножать на РАЗМЕР ТАЙЛА. Вот так:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">x = xTile * Tile_Width<br />
y = yTile * Tile_Height</div>
<p>ну ,соответственно, если ширина и высота тайла равны, то проще:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">x = xTile * TileSize<br />
y = yTile * TileSize</div>
<p>Ну теперь нам ничего не стоит сделать функцию создания тайла, но для начала создадим список(или лист) в котором будут содержаться(храниться) все созданные нами тайлы, не буду ничего придумывать и назову лист так: TileList.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Global</span> TileList:<span style="color: #ffff00; font-weight: bold;">TList</span> = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>А теперь функция создания тайла:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span>sx:<span style="color: #ffff00; font-weight: bold;">Int</span>, sy:<span style="color: #ffff00; font-weight: bold;">Int</span>, WB:<span style="color: #ffff00; font-weight: bold;">Byte</span><span style=" ">&#41;</span><br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TT:TTile = <span style="color: #ffff00; font-weight: bold;">New</span> TTile<br />
&nbsp; &nbsp; TT.<span style="">width</span> &nbsp;= TiLESIZE<br />
&nbsp; &nbsp; TT.<span style="">height</span> = TiLESIZE<br />
&nbsp; &nbsp; TT.<span style="">xTile</span> = sx<br />
&nbsp; &nbsp; TT.<span style="">yTile</span> = sy<br />
&nbsp; &nbsp; TT.<span style="">x</span> = TT.<span style="">xTile</span> * TT.<span style="">width</span><br />
&nbsp; &nbsp; TT.<span style="">y</span> = TT.<span style="">yTile</span> * TT.<span style="">height</span><br />
&nbsp; &nbsp; TT.<span style="">Walkable</span> = WB<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">ListAddLast</span><span style=" ">&#40;</span>ALLGameObjList , TT<span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<p>Инициализацию картинки сделаете сами, ведь это не сложно. Так же сами напишите метод рисования тайла на экране ( method Draw() ), никаких сложностей возникнуть не должно. До этого я писал, про тайловые карты с видом сверху, но хочу заметить, что также все это относится и к аркадам, у которых вид сбоку. Таким как Марио, Соник и им подобные. Так вот посмотрите еще раз на рисунок карты: как проще ее хранить? Ну конечно же в массиве. Если перевести нашу карту в массив языка Блиц, то получим что-то наподобие этого:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Global</span> TileMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span> =<br />
<p><span style=" ">&#91;</span><span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">4</span>, <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">1</span>, <span style="color: #FFFFFF;">2</span>, <span style="color: #FFFFFF;">0</span>, ..<br />
&nbsp;<span style="color: #FFFFFF;">1</span>, <span style="color: #FFFFFF;">1</span>, <span style="color: #FFFFFF;">1</span>, <span style="color: #FFFFFF;">1</span>, <span style="color: #FFFFFF;">1</span>, <span style="color: #FFFFFF;">1</span>, ..<br />
&nbsp;<span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">2</span>, <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">0</span>, ..<br />
&nbsp;<span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">3</span>, <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">3</span>, <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">0</span>, ..<br />
&nbsp;<span style="color: #FFFFFF;">4</span>, <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">4</span>, <span style="color: #FFFFFF;">0</span>, ..<br />
&nbsp;<span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">2</span>, <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">4</span>, ..<br />
</p>
&nbsp;<span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">4</span>, <span style="color: #FFFFFF;">3</span>, <span style="color: #FFFFFF;">0</span><span style=" ">&#93;</span></div>
<p>Ну, теперь создадим наш главный тип - УРОВЕНЬ! Он будет читать карту из массива, создаст на основе этой карты тайлы и затем уже нарисует нашу тайловую карту!
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TLevel<br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Width&nbsp;: <span style="color: #ffff00; font-weight: bold;">Byte</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Height&nbsp;: <span style="color: #ffff00; font-weight: bold;">Byte</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Map:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span>,<span style=" ">&#93;</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create:TLevel<span style=" ">&#40;</span>MyMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span>,map_width:<span style="color: #ffff00; font-weight: bold;">int</span>,map_height:<span style="color: #ffff00; font-weight: bold;">int</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TM&nbsp;: TLevel = <span style="color: #ffff00; font-weight: bold;">New</span> TLevel<br />
&nbsp; &nbsp; TM.<span style="">Width</span> &nbsp;= map_width &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">' ширина карты в тайлах</span><br />
&nbsp; &nbsp; TM.<span style="">Height</span> = map_height &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">' высота карты в тайлах</span><br />
<br />
&nbsp; &nbsp; TM.<span style="">map</span> = <span style="color: #ffff00; font-weight: bold;">New</span> <span style="color: #ffff00; font-weight: bold;">Int</span> <span style=" ">&#91;</span>TM.<span style="">Width</span>, TM.<span style="">Height</span><span style=" ">&#93;</span><br />
&nbsp; &nbsp; TM.<span style="">load</span><span style=" ">&#40;</span>myMap<span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Return</span> TM<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">type</span></div>
<p>Для карты я специально использовал одномерный массив (TileMap:Int[]), но в типе TLevel этот массив будет переведен в двумерный, я сделал так, а вы делайте, как пожелаете, хоть грузите из файла на диске или прочитайте из DefData, это, опять же, зависит от вашей фантазии. Функция &lt;Create&gt; принимает в параметрах одномерный массив карты и ее размеры - ширину и высоту. Для нашего случая это будет так:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">MyLevel:TLevel = TLevel.<span style="">Create</span><span style=" ">&#40;</span>TileMap, <span style="color: #FFFFFF;">6</span>, <span style="color: #FFFFFF;">7</span><span style=" ">&#41;</span></div>
<p>Теперь напишем метод load, который грузит нашу карту в двумерный массив Мар , создает нужные тайлы и заносит их в список объектов.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Method</span> Load<span style=" ">&#40;</span>arrMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span><span style=" ">&#41;</span><br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> i:<span style="color: #ffff00; font-weight: bold;">Int</span> = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Until</span> Height<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> j:<span style="color: #ffff00; font-weight: bold;">Int</span> = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Until</span> Width<br />
&nbsp; &nbsp; &nbsp; Map<span style=" ">&#91;</span>j , i<span style=" ">&#93;</span> = arrMap<span style=" ">&#91;</span>j + <span style=" ">&#40;</span>i * Width<span style=" ">&#41;</span><span style=" ">&#93;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Map<span style=" ">&#91;</span>j , i<span style=" ">&#93;</span> &lt; <span style="color: #FFFFFF;">15</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; TTile.<span style="">Create</span><span style=" ">&#40;</span>j , i , <span style="color: #ffff00; font-weight: bold;">true</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; TTile.<span style="">Create</span><span style=" ">&#40;</span>j , i , <span style="color: #ffff00; font-weight: bold;">false</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">if</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span></div>
<p>Что же, ничего хитрого в этой функции тоже нет, мы проходим по всему одномерному массиву и заполняем значениями двумерный массив, а заодно и создаем на этих местах тайлы уже известной нам функцией Create, которую мы писали ранее в типе TTile. Здесь стоит заметить, что я разделил тайлы на две группы: одни проходимы (true), а другие нет (false). Разделение произошло в условном операторе (if): первые тайлы, до 15, все проходимы, а остальные - не проходимы. Думаю, это понятно. Кстати, если вы переписали функцию Create в TTile, чтобы еще и загружалась картинка, то надо переделать и эту функцию, чтобы кол-во параметров совпадало. Например так:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">TTile.<span style="">Create</span><span style=" ">&#40;</span>j , i , <span style="color: #ffff00; font-weight: bold;">true</span>, tileSet <span style=" ">&#93;</span><span style=" ">&#41;</span></div>
<p>Но это, опять же, зависит от вашего кода и полностью на ваше усмотрение. Ок. Теперь давайте перейдем непосредственно к созданию нашего тайлового уровня. До этого момента мы только создали (инициализировали) наши тайлы и поместили их в отдельный список (лист), теперь их надо нарисовать. Я не буду использовать никакие картинки, я буду использовать простые квадраты рисуемые БлитцМаксом функцией DrawRect (x,y,width,height). А чтобы отличать проходимые тайлы от непроходимых, я сделаю их разноцветными. Вот так: зеленый - проходимые (true), а непроходимые (false) - красный.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-06.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-06.gif" src="-3_909-6.gif" width="286" height="147" /></a></span></div></div>
<p>Тип TTile остается прежним, просто добавим 2 метода Update и Draw:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">' здесь установим цвет тайла</span><br />
<p>&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Walkable = <span style="color: #ffff00; font-weight: bold;">false</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">'red</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">'green</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">' здесь нарисуем</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawRect</span><span style=" ">&#40;</span>x , y , Width , Height<span style=" ">&#41;</span><br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span></div>
<p>Теперь приступим к самому волнительному моменту: нарисуем уровень, то есть все созданные тайлы, на экране. Для этого в типе TLevel сделаем функцию Render(), которая и нарисует все тайлы.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Method</span> Render<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> CurTile:TTile = <span style="color: #ffff00; font-weight: bold;">EachIn</span> TileList &nbsp;<span style="color: #B1E7EB;">' пройти по всему листу тайлов</span><br />
&nbsp; &nbsp; &nbsp; CurTile.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">' установить цвет текущего тайла</span><br />
&nbsp; &nbsp; &nbsp; CurTile.<span style="">Draw</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">' нарисовать текущий тайл</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span></div>
<p>Уровень я рисовал прямо в массиве. Вот он:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Global</span> LevMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span> = <span style=" ">&#91;</span><span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span><span style=" ">&#93;</span><br />
<br />
</p>
<span style="color: #ffff00; font-weight: bold;">Global</span> Level&nbsp;: TLevel = <span style="color: #ffff00; font-weight: bold;">New</span> TLevel.<span style="">Create</span><span style=" ">&#40;</span>LevMap , <span style="color: #FFFFFF;">20</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span></div>
<p>А вот главный цикл всей программы:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Graphics</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">640</span>, <span style="color: #FFFFFF;">480</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">' установить видеорежим 640х480</span><br />
<p><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Repeat</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">' повторять ..</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Cls</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">' очистить экран</span><br />
<br />
&nbsp; &nbsp; Level.<span style="">Render</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">' рисовать уровень в буфер</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Flip</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">' поместить буфер на экран</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Until</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>KEY_ESCAPE<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp;<span style="color: #B1E7EB;">' .. пока не нажат ESC или крестик окна</span><br />
<br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span></div>
<p>Если у вас не получилось, то вот исходник:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">SuperStrict</span><br />
<p><br />
<span style="color: #ffff00; font-weight: bold;">Global</span> ScrWidth&nbsp;: <span style="color: #ffff00; font-weight: bold;">Int</span> &nbsp;= <span style="color: #FFFFFF;">640</span><br />
<span style="color: #ffff00; font-weight: bold;">Global</span> ScrHeight&nbsp;: <span style="color: #ffff00; font-weight: bold;">Int</span> = <span style="color: #FFFFFF;">480</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Global</span> TileList:<span style="color: #ffff00; font-weight: bold;">TList</span> = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Const</span> TILESIZE:<span style="color: #ffff00; font-weight: bold;">Int</span> &nbsp; = <span style="color: #FFFFFF;">32</span> <br />
<br />
<span style="color: #ffff00; font-weight: bold;">Type</span> TTile<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> x:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> y:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> xTile:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> yTile:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Width:<span style="color: #ffff00; font-weight: bold;">Byte</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Height:<span style="color: #ffff00; font-weight: bold;">Byte</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Walkable:<span style="color: #ffff00; font-weight: bold;">Byte</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span>sx:<span style="color: #ffff00; font-weight: bold;">Int</span>, sy:<span style="color: #ffff00; font-weight: bold;">Int</span>, WB:<span style="color: #ffff00; font-weight: bold;">Byte</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TT:TTile = <span style="color: #ffff00; font-weight: bold;">New</span> TTile<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">width</span> &nbsp;= TILESIZE<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">height</span> = TILESIZE<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">xTile</span> = sx<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">yTile</span> = sy<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">x</span> = TT.<span style="">xTile</span> * TT.<span style="">width</span><br />
&nbsp; &nbsp; &nbsp; TT.<span style="">y</span> = TT.<span style="">yTile</span> * TT.<span style="">height</span><br />
&nbsp; &nbsp; &nbsp; TT.<span style="">Walkable</span> = WB<br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">ListAddLast</span><span style=" ">&#40;</span>TileList , TT<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span> &nbsp;<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> update<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> &nbsp; &nbsp;walkable &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'walkable</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span> &nbsp;<span style="color: #B1E7EB;">'red</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Else</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'NOT walkable</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span> <span style="color: #B1E7EB;">'green</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span> &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span> &nbsp; &nbsp; &nbsp;<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawRect</span><span style=" ">&#40;</span>x,y,Width,Height<span style=" ">&#41;</span> &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Type</span> TLevel<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Width&nbsp;: <span style="color: #ffff00; font-weight: bold;">Byte</span> <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Height&nbsp;: <span style="color: #ffff00; font-weight: bold;">Byte</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Map:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span>,<span style=" ">&#93;</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create:TLevel<span style=" ">&#40;</span>MyMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span>,map_width:<span style="color: #ffff00; font-weight: bold;">Int</span>,map_height:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TM&nbsp;: TLevel = <span style="color: #ffff00; font-weight: bold;">New</span> TLevel &nbsp;<br />
&nbsp; &nbsp; TM.<span style="">Width</span> &nbsp;= map_width<br />
&nbsp; &nbsp; TM.<span style="">Height</span> = map_height<br />
<br />
&nbsp; &nbsp; TM.<span style="">map</span> = <span style="color: #ffff00; font-weight: bold;">New</span> <span style="color: #ffff00; font-weight: bold;">Int</span> <span style=" ">&#91;</span>TM.<span style="">Width</span>, TM.<span style="">Height</span><span style=" ">&#93;</span><br />
&nbsp; &nbsp; TM.<span style="">load</span><span style=" ">&#40;</span>myMap<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Return</span> TM &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span> &nbsp;<br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Load<span style=" ">&#40;</span>arrMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> i:<span style="color: #ffff00; font-weight: bold;">Int</span> = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Until</span> Height<br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> j:<span style="color: #ffff00; font-weight: bold;">Int</span> = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Until</span> Width<br />
&nbsp; &nbsp; &nbsp; &nbsp; Map<span style=" ">&#91;</span>j , i<span style=" ">&#93;</span> = arrMap<span style=" ">&#91;</span>j + <span style=" ">&#40;</span>i * Width<span style=" ">&#41;</span><span style=" ">&#93;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Map<span style=" ">&#91;</span>j , i<span style=" ">&#93;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TTile.<span style="">Create</span><span style=" ">&#40;</span>j , i , <span style="color: #ffff00; font-weight: bold;">True</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TTile.<span style="">Create</span><span style=" ">&#40;</span>j , i , <span style="color: #ffff00; font-weight: bold;">False</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span> &nbsp; &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span> &nbsp;<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Render<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> CurTile:TTile = <span style="color: #ffff00; font-weight: bold;">EachIn</span> TileList<br />
&nbsp; &nbsp; &nbsp; CurTile.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; CurTile.<span style="">Draw</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span> &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
&nbsp; <br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Global</span> LevMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span> = <span style=" ">&#91;</span><span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span><span style=" ">&#93;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Global</span> MyLevel&nbsp;: TLevel = <span style="color: #ffff00; font-weight: bold;">New</span> TLevel.<span style="">Create</span><span style=" ">&#40;</span>LevMap , <span style="color: #FFFFFF;">20</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Graphics</span><span style=" ">&#40;</span>ScrWidth, ScrHeight<span style=" ">&#41;</span> <br />
<br />
<span style="color: #ffff00; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
<br />
&nbsp; &nbsp; MyLevel.<span style="">Render</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Flip</span> <br />
<span style="color: #ffff00; font-weight: bold;">Until</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>KEY_ESCAPE<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span></div>
<a name=".D0.91.D0.BE.D0.BD.D1.83.D1.81.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D0%B0%D1%8F_%D0%B8%D0%B3%D1%80%D0%B0_%D0%BD%D0%B0_BlitzMax&amp;action=edit&amp;section=3" title="Тайловая игра на BlitzMax">править</a>]</span> <span class="mw-headline">Бонусы</span></h2>
<p>Ладно, худо-бедно, уровень нарисован , но какой-то он однообразный, давайте что-ли добавим сюда еще парочку элементов. Ну какая игра, скажите мне, будет без бонусов? Всевозможных монеток, кристаллов, и т. д. Предлагаю поместить их и на нашем уровне. Для этого напишем еще один тип TBonus
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TBonus<br />
<p>&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> x:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> y:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> width:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> height:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> points:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> miny:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> maxy:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> diry:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> speed:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> AnimDelay:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">type</span></div>
<p>Вообще-то (у меня) и бонус тоже будет прямоугольником, только желтого цвета (при хорошем воображении можно представить, что это слиток золота). Он меньше, чем тайл, естественно. Его размеры будут: 16х6. И помните - бонус должен находиться только в проходимом тайле, а иначе как его возьмет игрок? Посмотрите повнимательнее на свойства (переменные) нашего нового типа. Первые 4 понятны и так. А про остальные надо рассказать отдельно:
</p>
<ul><li>points - это очки, которые получит игрок при подборе(?) этого бонуса,
</li><li>miny и maxy - наш бонус не просто будет висеть в воздухе, а будет раскачиваться вверх-вниз, т.е . двигаться по оси Y, как это часто бывает в играх. Так вот эти переменные указывают амплитуду раскачивания, смотрите рисунок:
</li></ul>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-07.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-07.gif" src="mo7ktyce.gif" width="290" height="230" /></a></span></div></div>
<ul><li>Diry - это направление движения при раскачивании бонуса &lt;-1&gt; означает, что бонус движется вверх, а &lt;+1&gt; - соответственно, вниз. (При Diry = 0 бонус двигаться не будет.)
</li><li>Speed - скорость, с которой двигается бонус, то есть на сколько пикселей вверх/вниз он переместится.
</li><li>AnimDelay - это задержка, с которой раскачивается бонус. Регулируя эту переменную, можно регулировать скорость раскачивания.
</li></ul>
<p>Да, кстати , не забудем создать список для хранения наших бонусов:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Global</span> BonusList:<span style="color: #ffff00; font-weight: bold;">TList</span> = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">' вот так</span></div>
<p>Теперь перейдем непосредственно к функции Create для типа TBonus. Эта функция будет создавать бонус на указанном тайле, и заполнит все поля типа(которые я тока что описал) нужной информацией, надо только указать координаты на тайловой карте и очки за этот бонус:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span>sx:<span style="color: #ffff00; font-weight: bold;">Int</span>,sy:<span style="color: #ffff00; font-weight: bold;">Int</span>,pts:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#41;</span><br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TB&nbsp;: TBonus = <span style="color: #ffff00; font-weight: bold;">New</span> TBonus<br />
&nbsp; &nbsp; TB.<span style="">Width</span> = <span style="color: #FFFFFF;">6</span><br />
&nbsp; &nbsp; TB.<span style="">Height</span> = <span style="color: #FFFFFF;">16</span><br />
&nbsp; &nbsp; TB.<span style="">x</span> = sx * TILESIZE + <span style=" ">&#40;</span><span style=" ">&#40;</span>TILESIZE - TB.<span style="">width</span><span style=" ">&#41;</span> / <span style="color: #FFFFFF;">2</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; TB.<span style="">y</span> = sy * TILESIZE + <span style=" ">&#40;</span><span style=" ">&#40;</span>TILESIZE - TB.<span style="">height</span><span style=" ">&#41;</span> / <span style="color: #FFFFFF;">2</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; TB.<span style="">points</span> = pts<br />
&nbsp; &nbsp; TB.<span style="">miny</span> = TB.<span style="">y</span> - <span style="color: #FFFFFF;">4</span><br />
&nbsp; &nbsp; TB.<span style="">maxy</span> = TB.<span style="">y</span> + TB.<span style="">Height</span> + <span style="color: #FFFFFF;">4</span><br />
&nbsp; &nbsp; TB.<span style="">speed</span> = <span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; TB.<span style="">diry</span> = <span style="color: #FFFFFF;">-1</span><br />
&nbsp; &nbsp; TB.<span style="">AnimDelay</span> = <span style="color: #FFFFFF;">5</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">ListAddLast</span><span style=" ">&#40;</span>BonusList ,TB<span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<p>Вот картинка, которая поможет вам в понимании вышеизложенной функции:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-08.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-08.gif" src="r8pn83c_.gif" width="290" height="230" /></a></span></div></div>
<p>Из кода и приведенной картинки все становится очевидным и доходчивым, переводим тайловые координаты в экранные, помещаем бонус в центре тайла и раскачиваем его на 4 пикселя вверх и 4 пикселя вниз, скорость (speed) = 1, начальное направление  вверх (diry = -1). Да, чуть не забыл, при достижении бонусом miny или maxy, мы должны поменять направление раскачивания, учтем это при написании нашего кода. А вот и он:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span><span style=" ">&#40;</span>Animdelay &lt; <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style=" ">&#40;</span> miny &gt; <span style=" ">&#40;</span>y<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> maxy &lt; <span style=" ">&#40;</span>y + height - <span style="color: #FFFFFF;">1</span><span style=" ">&#41;</span> <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; diry = -diry<br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span><br />
<br />
&nbsp; &nbsp; &nbsp; y = y + speed * diry<br />
<br />
&nbsp; &nbsp; &nbsp; AnimDelay = <span style="color: #FFFFFF;">5</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span><br />
<br />
&nbsp; &nbsp; AnimDelay&nbsp;:- <span style="color: #FFFFFF;">1</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawRect</span><span style=" ">&#40;</span>x,y,Width,Height<span style=" ">&#41;</span><br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span></div>
<p>В методе &lt;Draw&gt; ничего примечательного нет. Там устанавливается желтый цвет и рисуется прямоугольник, то есть наш воображаемый бонус. А метод &lt;Update&gt; рассмотрим поподробнее. Здесь как раз и будет происходить раскачивание бонуса , а точнее в строке
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">y = y + speed * diry</div>
<p>новое положение по оси &lt;у&gt; вычисляется как прибавление к старому значению и скорости (speed) домноженной на направление (diry), как я говорил раньше, diry может принимать только 2 значения - &lt;-1&gt; и &lt;+1&gt;, а потому произведение &lt;speed * diry&gt; дает разные ПО ЗНАКУ значения speed, что в свою очередь влияет на то, будет ли скорость вычитаться  или прибавляться к текущей координате. Например: текущая позиция по y = 5, направление - вверх , то есть diry = -1 и скорость (speed) =1, тогда новое значение у:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">y = <span style="color: #FFFFFF;">5</span> + <span style="color: #FFFFFF;">1</span> * <span style=" ">&#40;</span><span style="color: #FFFFFF;">-1</span><span style=" ">&#41;</span> = <span style="color: #FFFFFF;">5</span> - <span style="color: #FFFFFF;">1</span> = <span style="color: #FFFFFF;">4</span></div>
<p>если diry = +1 ,то есть направление вниз:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">y = <span style="color: #FFFFFF;">5</span> + <span style="color: #FFFFFF;">1</span> * <span style="color: #FFFFFF;">1</span> = <span style="color: #FFFFFF;">5</span> + <span style="color: #FFFFFF;">1</span> = <span style="color: #FFFFFF;">6</span></div>
<p>вот так diry влияет на вычисление новой позиции нашего бонуса. Нет, мы ,конечно, могли бы сделать и так: если двигаемся вверх, то вычитать скорость, а если вниз ,то прибавлять.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">If</span> diry = <span style="color: #FFFFFF;">1</span><br />
<p>&nbsp; y = y + speed<br />
<span style="color: #ffff00; font-weight: bold;">else</span> <span style="color: #ffff00; font-weight: bold;">if</span> diry = <span style="color: #FFFFFF;">-1</span><br />
&nbsp; y = y - speed<br />
</p>
<span style="color: #ffff00; font-weight: bold;">end</span> <span style="color: #ffff00; font-weight: bold;">if</span></div>
<p>Но этот способ мне кажется более громоздким, по сравнению с изяществом первого. Впрочем, вы можете использовать любой. Теперь надо ограничить наши движения maxy и miny. Первое что приходит в голову это сделать так:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">If</span> <span style=" ">&#40;</span>y =&lt; miny<span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">' если достигли верха</span><br />
<p>&nbsp; &nbsp; diry = <span style="color: #FFFFFF;">1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">' направить вниз</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">end</span> <span style="color: #ffff00; font-weight: bold;">if</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">if</span> <span style=" ">&#40;</span>y + height &gt;= maxy<span style=" ">&#41;</span> &nbsp; &nbsp; <span style="color: #B1E7EB;">' если достигли низа</span><br />
&nbsp; &nbsp; diry = <span style="color: #FFFFFF;">-1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">' направить вверх</span><br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">end</span> <span style="color: #ffff00; font-weight: bold;">if</span></div>
<p>Но я сделаю чуть иначе:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">If</span> <span style=" ">&#40;</span> miny &gt;= <span style=" ">&#40;</span>y<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> maxy =&lt; <span style=" ">&#40;</span>y + height<span style=" ">&#41;</span> <span style=" ">&#41;</span><br />
<p>&nbsp; &nbsp; diry = -diry<br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span></div>
<p>Строка diry = -diry означает изменить знак diry, то есть если diry был -1, то -(-1) = +1, а если diry = +1 ,то -(+1) = -1. Говоря по-другому ,что важно для нас - эта строка, меняет направление движения на противоположное.
</p><p>Я привел оба эти варианта для того ,чтобы показать, что одну задачу можно решить двумя разными способами, тремя и даже больше. Так что не бывает правильного и не правильного кода, хорошего или плохого. Бывает код ,который работает, то есть выполняет свою прямую задачу, и код ,который не работает! Главное ,чтобы вы сами понимали, то что пишете. А уж потом, когда заматереете в программинге, можно модернизировать и оптимизировать свой код.
</p><p>Вот в общем-то и всё. А нет, не всё! У нас ведь еще введена задержка анимации (AnimDelay). Не каждый вызов метода Update() приводит к перемещению нашего бонуса, а лишь тот, когда AnimDelay &lt; 0 . Ну а если больше нуля, то от задержки отнимается единица, через пять циклов условие соблюдается и движение бонуса происходит. Нехитрый способ задержки, думаю вы его переделаете со временем. Итак, у нас есть функция создания бонусов (Create), метод качания (Update) и метод рисования (Draw). Так чего же мы ждем? Давайте разместим наши бонусы на карте и нарисуем их!
</p><p>Для инициализации их на карте я создал отдельную функцию:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> Init_All_Bonuses<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">15</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">100</span><span style=" ">&#41;</span><br />
&nbsp; Tbonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">7</span> , <span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">100</span><span style=" ">&#41;</span><br />
&nbsp; Tbonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span><br />
&nbsp; Tbonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">3</span> , <span style="color: #FFFFFF;">8</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span><br />
&nbsp; Tbonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">8</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span><br />
&nbsp; Tbonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">5</span> , <span style="color: #FFFFFF;">8</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span><br />
&nbsp; Tbonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">9</span> , <span style="color: #FFFFFF;">7</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span><br />
&nbsp; Tbonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">6</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span><br />
&nbsp; Tbonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">9</span> , <span style="color: #FFFFFF;">2</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span><br />
&nbsp; Tbonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">14</span> , <span style="color: #FFFFFF;">7</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span><br />
&nbsp; Tbonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">17</span> , <span style="color: #FFFFFF;">6</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span><br />
&nbsp; Tbonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">17</span> , <span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span><br />
&nbsp; Tbonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">18</span> , <span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span><br />
&nbsp; Tbonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">3</span> , <span style="color: #FFFFFF;">3</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<p>Здесь 14 бонусов, 2 по 100 очков, 4 по 25 и остальные по 10 очков. Ну теперь осталось отобразить их все на экране. Вы тоже можете создать для этого отдельную функцию, ну а я решил впихнуть всё это в Tlevel.Render(), сразу после рисования тайлов:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> CurBonus:Tbonus= <span style="color: #ffff00; font-weight: bold;">EachIn</span> BonusList<br />
<p>&nbsp; CurBonus.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; CurBonus.<span style="">Draw</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">Next</span></div>
<p>Запускаем и любуемся. Если не получилось, смотрите исходник:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">SuperStrict</span><br />
<p><br />
<span style="color: #ffff00; font-weight: bold;">Global</span> ScrWidth&nbsp;: <span style="color: #ffff00; font-weight: bold;">Int</span> &nbsp;= <span style="color: #FFFFFF;">640</span><br />
<span style="color: #ffff00; font-weight: bold;">Global</span> ScrHeight&nbsp;: <span style="color: #ffff00; font-weight: bold;">Int</span> = <span style="color: #FFFFFF;">480</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Global</span> TileList:<span style="color: #ffff00; font-weight: bold;">TList</span> = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Global</span> BonusList:<span style="color: #ffff00; font-weight: bold;">TList</span> = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Const</span> TILESIZE:<span style="color: #ffff00; font-weight: bold;">Int</span> &nbsp; = <span style="color: #FFFFFF;">32</span> <br />
<br />
<span style="color: #ffff00; font-weight: bold;">Type</span> TTile<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> x:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> y:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> xTBle:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> yTBle:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Width:<span style="color: #ffff00; font-weight: bold;">Byte</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Height:<span style="color: #ffff00; font-weight: bold;">Byte</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Walkable:<span style="color: #ffff00; font-weight: bold;">Byte</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span>sx:<span style="color: #ffff00; font-weight: bold;">Int</span>, sy:<span style="color: #ffff00; font-weight: bold;">Int</span>, WB:<span style="color: #ffff00; font-weight: bold;">Byte</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TT:TTile = <span style="color: #ffff00; font-weight: bold;">New</span> TTile<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">width</span> &nbsp;= TiLESIZE &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">height</span> = TiLESIZE &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">xTBle</span> = sx &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; TT.<span style="">yTBle</span> = sy &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; TT.<span style="">x</span> = TT.<span style="">xTBle</span> * TT.<span style="">width</span> &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">y</span> = TT.<span style="">yTBle</span> * TT.<span style="">height</span> &nbsp; <br />
&nbsp; &nbsp; &nbsp; TT.<span style="">Walkable</span> = WB &nbsp; &nbsp; &nbsp; &nbsp;<br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">ListAddLast</span><span style=" ">&#40;</span>TileList , TT<span style=" ">&#41;</span> &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span> &nbsp;<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> update<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> &nbsp; &nbsp;walkable &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'walkable</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span> &nbsp;<span style="color: #B1E7EB;">'red</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Else</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'NOT walkable</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span> &nbsp; <span style="color: #B1E7EB;">'green</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span> &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span> &nbsp; &nbsp; &nbsp;<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawRect</span><span style=" ">&#40;</span>x,y,Width,Height<span style=" ">&#41;</span> &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Type</span> TLevel<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Width&nbsp;: <span style="color: #ffff00; font-weight: bold;">Byte</span> <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Height&nbsp;: <span style="color: #ffff00; font-weight: bold;">Byte</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Map:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span>,<span style=" ">&#93;</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create:TLevel<span style=" ">&#40;</span>MyMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span>,map_width:<span style="color: #ffff00; font-weight: bold;">Int</span>,map_height:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TM&nbsp;: TLevel = <span style="color: #ffff00; font-weight: bold;">New</span> TLevel &nbsp;<br />
&nbsp; &nbsp; TM.<span style="">Width</span> &nbsp;= map_width<br />
&nbsp; &nbsp; TM.<span style="">Height</span> = map_height<br />
<br />
&nbsp; &nbsp; TM.<span style="">map</span> = <span style="color: #ffff00; font-weight: bold;">New</span> <span style="color: #ffff00; font-weight: bold;">Int</span> <span style=" ">&#91;</span>TM.<span style="">Width</span>, TM.<span style="">Height</span><span style=" ">&#93;</span><br />
&nbsp; &nbsp; TM.<span style="">load</span><span style=" ">&#40;</span>myMap<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Return</span> TM &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span> &nbsp;<br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Load<span style=" ">&#40;</span>arrMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> i:<span style="color: #ffff00; font-weight: bold;">Int</span> = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Until</span> Height<br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> j:<span style="color: #ffff00; font-weight: bold;">Int</span> = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Until</span> Width<br />
&nbsp; &nbsp; &nbsp; &nbsp; Map<span style=" ">&#91;</span>j , i<span style=" ">&#93;</span> = arrMap<span style=" ">&#91;</span>j + <span style=" ">&#40;</span>i * Width<span style=" ">&#41;</span><span style=" ">&#93;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Map<span style=" ">&#91;</span>j , i<span style=" ">&#93;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TTile.<span style="">Create</span><span style=" ">&#40;</span>j , i , <span style="color: #ffff00; font-weight: bold;">True</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TTile.<span style="">Create</span><span style=" ">&#40;</span>j , i , <span style="color: #ffff00; font-weight: bold;">False</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span> &nbsp; &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span> &nbsp;<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Render<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> CurTile:TTile = <span style="color: #ffff00; font-weight: bold;">EachIn</span> TileList<br />
&nbsp; &nbsp; &nbsp; CurTile.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; CurTile.<span style="">Draw</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span> &nbsp;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> CurBonus:TBonus= <span style="color: #ffff00; font-weight: bold;">EachIn</span> BonusList<br />
&nbsp; &nbsp; &nbsp; CurBonus.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; CurBonus.<span style="">Draw</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span> &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
&nbsp; <br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Type</span> TBonus <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> x:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> y:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> width:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> height:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> points:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> miny:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> maxy:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> diry:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> speed:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> AnimDelay:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span>sx:<span style="color: #ffff00; font-weight: bold;">Int</span>,sy:<span style="color: #ffff00; font-weight: bold;">Int</span>,pts:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TB&nbsp;: TBonus = <span style="color: #ffff00; font-weight: bold;">New</span> TBonus<br />
&nbsp; &nbsp; &nbsp; TB.<span style="">Width</span> = <span style="color: #FFFFFF;">6</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">Height</span> = <span style="color: #FFFFFF;">16</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">x</span> = sx * TiLESIZE + <span style=" ">&#40;</span><span style=" ">&#40;</span>TiLESIZE - TB.<span style="">width</span><span style=" ">&#41;</span> / <span style="color: #FFFFFF;">2</span><span style=" ">&#41;</span> &nbsp;<span style="color: #B1E7EB;">'center it</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">y</span> = sy * TiLESIZE + <span style=" ">&#40;</span><span style=" ">&#40;</span>TiLESIZE - TB.<span style="">height</span><span style=" ">&#41;</span> / <span style="color: #FFFFFF;">2</span><span style=" ">&#41;</span> <span style="color: #B1E7EB;">'center it</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">points</span> = pts<br />
&nbsp; &nbsp; &nbsp; TB.<span style="">miny</span> = TB.<span style="">y</span> - <span style="color: #FFFFFF;">4</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">maxy</span> = TB.<span style="">y</span> + TB.<span style="">Height</span> + <span style="color: #FFFFFF;">4</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">diry</span> = <span style="color: #FFFFFF;">-1</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">speed</span> = <span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">AnimDelay</span> = <span style="color: #FFFFFF;">5</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">ListAddLast</span><span style=" ">&#40;</span>BonusList ,TB<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span> &nbsp;<br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span><span style=" ">&#40;</span>Animdelay &lt; <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">If</span> <span style=" ">&#40;</span> miny &gt; <span style=" ">&#40;</span>y<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> maxy &lt; <span style=" ">&#40;</span>y + height - <span style="color: #FFFFFF;">1</span><span style=" ">&#41;</span> <span style=" ">&#41;</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;diry = -diry<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;y = y + speed * diry<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AnimDelay = <span style="color: #FFFFFF;">5</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span> &nbsp;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; AnimDelay&nbsp;:- <span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawRect</span><span style=" ">&#40;</span>x,y,Width,Height<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span> &nbsp;<br />
&nbsp; <br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Global</span> LevMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span> = <span style=" ">&#91;</span><span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span><span style=" ">&#93;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Global</span> MyLevel&nbsp;: TLevel = <span style="color: #ffff00; font-weight: bold;">New</span> TLevel.<span style="">Create</span><span style=" ">&#40;</span>LevMap , <span style="color: #FFFFFF;">20</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Function</span> Init_All_Bonuses<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">3</span> , <span style="color: #FFFFFF;">8</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">8</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">5</span> , <span style="color: #FFFFFF;">8</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">15</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">100</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">7</span> , <span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">100</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">9</span> , <span style="color: #FFFFFF;">7</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">6</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">9</span> , <span style="color: #FFFFFF;">2</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">14</span> , <span style="color: #FFFFFF;">7</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">17</span> , <span style="color: #FFFFFF;">6</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">17</span> , <span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">18</span> , <span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">3</span> , <span style="color: #FFFFFF;">3</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span> &nbsp;<br />
<br />
<span style="color: #B1E7EB;">'----------------------------- main loop -----------------------------</span><br />
<span style="color: #ffff00; font-weight: bold;">Graphics</span><span style=" ">&#40;</span>ScrWidth, ScrHeight<span style=" ">&#41;</span> <br />
<br />
Init_All_Bonuses<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
<br />
&nbsp; &nbsp; MyLevel.<span style="">Render</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Flip</span> <br />
<span style="color: #ffff00; font-weight: bold;">Until</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>KEY_ESCAPE<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span></div>
<a name=".D0.94.D0.B2.D0.B8.D0.B6.D0.B5.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D0%B0%D1%8F_%D0%B8%D0%B3%D1%80%D0%B0_%D0%BD%D0%B0_BlitzMax&amp;action=edit&amp;section=4" title="Тайловая игра на BlitzMax">править</a>]</span> <span class="mw-headline">Движение</span></h2>
<p>Долго смотрел на эти бонусы, летающие вверх  вниз и чуть не загипнотизировался. Скукота. Надо бы еще что-нибудь сделать. Без чего там еще аркад не бывает? Я бы добавил в игру еще платформы, на которые игрок может запрыгнуть и проехать. Это неотъемлемая часть любой аркады. Стоп. Сначала давайте определимся с терминами. Объект ,который может двигаться вверх/вниз (ось у) я буду называть ЛИФТ, а объект , который двигается влево / вправо (ось х) - ПЛАТФОРМА. Ок, для начала я предлагаю создать платформу. Что нам для этого нужно. Надо указать ее начальное расположение, указать конечные точки пути и направление.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-09.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TileGame1-09.gif" src="u2uwne-9.gif" width="307" height="264" /></a></span></div></div>
<p>Я тут изобразил кусочек тайловой карты размером 6х4. А серенький квадрат с белой линией вверху- это платформа. Как вы видите, ее начальные координаты (2,2) и по моей задумке, она должна двигаться влево до (0,2) и вправо до (5,2), красные стрелочки. Или если сказать иначе, то на две клетки влево и на три клетки вправо, от своей начальной позиции. Если принять начальную позицию за ноль(смотрим на цифры снизу), то 2 тайла влево соответствуют &lt;-2&gt;, а 3 вправо - соответствуют &lt;+3&gt;. Мне кажется более удачным задавать перемещение именно так, в относительных координатах, нежели в координатах карты. Договорились? Ок, договорились. Кто не согласен - пишет свой код, кто согласен - читает дальше. Создадим новый тип TmovingX&nbsp;:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TmovingX<br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> x:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> y:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> width:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> height:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> speed:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> dirx:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> mindir:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> maxdir:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">type</span></div>
<p>Так , первые 4 поля нам знакомы, мы все про них знаем.
</p>
<ul><li>Speed - ну это понятно, скорость. То есть на сколько пикселей двигать платформу при передвижении.
</li><li>Dirx - тут как в бонусах, направление движения: dirx = -1, это влево , а dirx = 1 это вправо.
</li><li>Mindir и maxdir - ну это и так понятно
</li></ul>
<p>Забыл добавить: платформа движется только по оси х, тогда y-координату вообще можем отбросить, учтем ее только при задании начальных координат для создания платформы. Кстати, вот так бы выглядела функция создания (Create) для платформы, которая на рисунке выше:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">TmovingX.<span style="">Create</span><span style=" ">&#40;</span> <span style="color: #FFFFFF;">2</span> , <span style="color: #FFFFFF;">2</span> , <span style="color: #FFFFFF;">-2</span> , <span style="color: #FFFFFF;">3</span> , <span style="color: #FFFFFF;">-1</span><span style=" ">&#41;</span></div>
<p>Как вы наверное догадались, первые два параметра - тайловые координаты платформы на карте, затем - на сколько клеток она может перемещаться влево, следующий параметр -  на сколько тайлов вправо, и последний параметр - начальное направление (влево). Вот сама  функция&nbsp;:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span>xt:<span style="color: #ffff00; font-weight: bold;">Int</span> , yt:<span style="color: #ffff00; font-weight: bold;">Int</span> , mn:<span style="color: #ffff00; font-weight: bold;">Int</span> , mx:<span style="color: #ffff00; font-weight: bold;">Int</span>, d:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#41;</span><br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TMX:TmovingX = <span style="color: #ffff00; font-weight: bold;">New</span> TmovingX<br />
<br />
&nbsp; TMX.<span style="">x</span> = xt * TILESIZE<br />
&nbsp; TMX.<span style="">y</span> = yt * TILESIZE<br />
<br />
&nbsp; TMX.<span style="">width</span> = TILESIZE<br />
&nbsp; TMX.<span style="">height</span> = TILESIZE<br />
<br />
&nbsp; TMX.<span style="">speed</span> = <span style="color: #FFFFFF;">1</span><br />
<br />
&nbsp; TMX.<span style="">dirx</span> = d<br />
<br />
&nbsp; TMX.<span style="">mindir</span> = <span style=" ">&#40;</span>mn + xt<span style=" ">&#41;</span> * TILESIZE<br />
&nbsp; TMX.<span style="">maxdir</span> = <span style=" ">&#40;</span>mx + xt + <span style="color: #FFFFFF;">1</span><span style=" ">&#41;</span> * TILESIZE<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">ListAddLast</span><span style=" ">&#40;</span>MovingXList , TMX<span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span></div>
<p>Да , проницательные мои, вы сразу заметили ,что я еще не объявил список для хранения всех платформ. Устраняю упущение:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Global</span> MovingXList:<span style="color: #ffff00; font-weight: bold;">Tlist</span> = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #B1E7EB;">'напишите это сверху, то есть до объявления типа</span></div>
<p>Ну теперь порядок.
</p><p>Метод рисования платформы. Засуну все свои художественные замыслы куда-нибудь поглубже, и сделаю платформу все тем же прямоугольником, но теперь уже серого цвета и с белою полоской сверху.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">128</span> , <span style="color: #FFFFFF;">128</span> , <span style="color: #FFFFFF;">128</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">' установить серый цвет</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawRect</span><span style=" ">&#40;</span>x , y , Width , Height<span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">' нарисовать платформу</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">255</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">' установить белый цвет</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawLine</span><span style=" ">&#40;</span>x , y , x + width - <span style="color: #FFFFFF;">1</span> , y<span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">' нарисовать линию сверху</span><br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span></div>
<p>Ну, это было для вас не сложно, ведь правда? А вот и функция перемещения нашей платформы, на нее поглядите внимательнее:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span><span style=" ">&#40;</span> mindir &gt;= x <span style="color: #ffff00; font-weight: bold;">Or</span> maxdir &lt;= <span style=" ">&#40;</span>x + width<span style=" ">&#41;</span> <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; dirx = - dirx<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
<br />
&nbsp; &nbsp; x = x + speed * dirx<br />
<br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">method</span></div>
<p>Не находите ничего знакомого? Бааа, да это ж брат или точнее сестра Tbonus.Update() только там было перемещение вверх / вниз и внутри тайла, а здесь наша платформа перемещается на бОльшие расстояния и вправо/влево. Но код остался на 90% таким же. Только у поменялся на х. Разве не здорово? Лишь нет задержки анимации (AnimDelay), я решил , что здесь она ни к чему. Но вы можете добавить сюда и этот параметр.
</p><p>Итак нам осталось создать где-нибудь нашу платформу и нарисовать ее на экране. Предлагаю сделать так:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">TmovingX.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">13</span> , <span style="color: #FFFFFF;">3</span> , - <span style="color: #FFFFFF;">2</span> , <span style="color: #FFFFFF;">5</span> , <span style="color: #FFFFFF;">1</span><span style=" ">&#41;</span></div>
<p>Рисуем как обычно, проходим по всему списку, перемещаем и отображаем каждую платформу.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> CurMovingX:TmovingX = <span style="color: #ffff00; font-weight: bold;">EachIn</span> MovingXList<br />
<p>&nbsp; &nbsp; CurMovingX.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; CurMovingX.<span style="">Draw</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span></div>
<p>Вы можете создать для этого отдельную функцию и назвать ее, например, Draw_All_Platforms(), а мне что-то неохота, и потому я опять пихну все в Tlevel.Render(), пусть рисуются  в одном месте тайлы, бонусы и платформы. Зато главный цикл будет поменьше. Вот исходник:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">SuperStrict</span><br />
<p><br />
<span style="color: #ffff00; font-weight: bold;">Global</span> ScrWidth&nbsp;: <span style="color: #ffff00; font-weight: bold;">Int</span> &nbsp;= <span style="color: #FFFFFF;">640</span><br />
<span style="color: #ffff00; font-weight: bold;">Global</span> ScrHeight&nbsp;: <span style="color: #ffff00; font-weight: bold;">Int</span> = <span style="color: #FFFFFF;">480</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Global</span> TileList:<span style="color: #ffff00; font-weight: bold;">TList</span> = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Global</span> BonusList:<span style="color: #ffff00; font-weight: bold;">TList</span> = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Global</span> MovingXList:<span style="color: #ffff00; font-weight: bold;">TList</span> = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Const</span> TILESIZE:<span style="color: #ffff00; font-weight: bold;">Int</span> &nbsp; = <span style="color: #FFFFFF;">32</span> <br />
<br />
<span style="color: #ffff00; font-weight: bold;">Type</span> TTile<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> x:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> y:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> xTile:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> yTile:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Width:<span style="color: #ffff00; font-weight: bold;">Byte</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Height:<span style="color: #ffff00; font-weight: bold;">Byte</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Walkable:<span style="color: #ffff00; font-weight: bold;">Byte</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span>sx:<span style="color: #ffff00; font-weight: bold;">Int</span>, sy:<span style="color: #ffff00; font-weight: bold;">Int</span>, WB:<span style="color: #ffff00; font-weight: bold;">Byte</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TT:TTile = <span style="color: #ffff00; font-weight: bold;">New</span> TTile<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">width</span> &nbsp;= TiLESIZE &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">height</span> = TiLESIZE &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">xTile</span> = sx &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; TT.<span style="">yTile</span> = sy &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; TT.<span style="">x</span> = TT.<span style="">xTile</span> * TT.<span style="">width</span> &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">y</span> = TT.<span style="">yTile</span> * TT.<span style="">height</span> &nbsp; <br />
&nbsp; &nbsp; &nbsp; TT.<span style="">Walkable</span> = WB &nbsp; &nbsp; &nbsp; &nbsp;<br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">ListAddLast</span><span style=" ">&#40;</span>TileList , TT<span style=" ">&#41;</span> &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span> &nbsp;<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> update<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> &nbsp; &nbsp;walkable &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'walkable</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span> &nbsp;<span style="color: #B1E7EB;">'red</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Else</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'NOT walkable</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span> &nbsp; <span style="color: #B1E7EB;">'green</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span> &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span> &nbsp; &nbsp; &nbsp;<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawRect</span><span style=" ">&#40;</span>x,y,Width,Height<span style=" ">&#41;</span> &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Type</span> TLevel<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Width&nbsp;: <span style="color: #ffff00; font-weight: bold;">Byte</span> <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Height&nbsp;: <span style="color: #ffff00; font-weight: bold;">Byte</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Map:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span>,<span style=" ">&#93;</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create:TLevel<span style=" ">&#40;</span>MyMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span>,map_width:<span style="color: #ffff00; font-weight: bold;">Int</span>,map_height:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TM&nbsp;: TLevel = <span style="color: #ffff00; font-weight: bold;">New</span> TLevel &nbsp;<br />
&nbsp; &nbsp; TM.<span style="">Width</span> &nbsp;= map_width<br />
&nbsp; &nbsp; TM.<span style="">Height</span> = map_height<br />
<br />
&nbsp; &nbsp; TM.<span style="">map</span> = <span style="color: #ffff00; font-weight: bold;">New</span> <span style="color: #ffff00; font-weight: bold;">Int</span> <span style=" ">&#91;</span>TM.<span style="">Width</span>, TM.<span style="">Height</span><span style=" ">&#93;</span><br />
&nbsp; &nbsp; TM.<span style="">load</span><span style=" ">&#40;</span>myMap<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Return</span> TM &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span> &nbsp;<br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Load<span style=" ">&#40;</span>arrMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> i:<span style="color: #ffff00; font-weight: bold;">Int</span> = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Until</span> Height<br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> j:<span style="color: #ffff00; font-weight: bold;">Int</span> = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Until</span> Width<br />
&nbsp; &nbsp; &nbsp; &nbsp; Map<span style=" ">&#91;</span>j , i<span style=" ">&#93;</span> = arrMap<span style=" ">&#91;</span>j + <span style=" ">&#40;</span>i * Width<span style=" ">&#41;</span><span style=" ">&#93;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Map<span style=" ">&#91;</span>j , i<span style=" ">&#93;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TTile.<span style="">Create</span><span style=" ">&#40;</span>j , i , <span style="color: #ffff00; font-weight: bold;">True</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TTile.<span style="">Create</span><span style=" ">&#40;</span>j , i , <span style="color: #ffff00; font-weight: bold;">False</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span> &nbsp; &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span> &nbsp;<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Render<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> CurTile:TTile = <span style="color: #ffff00; font-weight: bold;">EachIn</span> TileList<br />
&nbsp; &nbsp; &nbsp; CurTile.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; CurTile.<span style="">Draw</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span> &nbsp;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> CurBonus:TBonus = <span style="color: #ffff00; font-weight: bold;">EachIn</span> BonusList<br />
&nbsp; &nbsp; &nbsp; CurBonus.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; CurBonus.<span style="">Draw</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span> &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> CurMovingX:TMovingX = <span style="color: #ffff00; font-weight: bold;">EachIn</span> MovingXList<br />
&nbsp; &nbsp; &nbsp; CurMovingX.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; CurMovingX.<span style="">Draw</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span> &nbsp; &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
&nbsp; <br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Type</span> TBonus <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> x:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> y:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> width:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> height:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> points:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> miny:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> maxy:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> diry:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> speed:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> AnimDelay:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span>sx:<span style="color: #ffff00; font-weight: bold;">Int</span>,sy:<span style="color: #ffff00; font-weight: bold;">Int</span>,pts:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TB&nbsp;: TBonus = <span style="color: #ffff00; font-weight: bold;">New</span> TBonus<br />
&nbsp; &nbsp; &nbsp; TB.<span style="">Width</span> = <span style="color: #FFFFFF;">6</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">Height</span> = <span style="color: #FFFFFF;">16</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">x</span> = sx * TiLESIZE + <span style=" ">&#40;</span><span style=" ">&#40;</span>TiLESIZE - TB.<span style="">width</span><span style=" ">&#41;</span> / <span style="color: #FFFFFF;">2</span><span style=" ">&#41;</span> &nbsp;<span style="color: #B1E7EB;">'center it</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">y</span> = sy * TiLESIZE + <span style=" ">&#40;</span><span style=" ">&#40;</span>TiLESIZE - TB.<span style="">height</span><span style=" ">&#41;</span> / <span style="color: #FFFFFF;">2</span><span style=" ">&#41;</span> <span style="color: #B1E7EB;">'center it</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">points</span> = pts<br />
&nbsp; &nbsp; &nbsp; TB.<span style="">miny</span> = TB.<span style="">y</span> - <span style="color: #FFFFFF;">4</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">maxy</span> = TB.<span style="">y</span> + TB.<span style="">Height</span> + <span style="color: #FFFFFF;">4</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">diry</span> = <span style="color: #FFFFFF;">-1</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">speed</span> = <span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">AnimDelay</span> = <span style="color: #FFFFFF;">5</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">ListAddLast</span><span style=" ">&#40;</span>BonusList ,TB<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span> &nbsp;<br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span><span style=" ">&#40;</span>Animdelay &lt; <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">If</span> <span style=" ">&#40;</span> miny &gt;= <span style=" ">&#40;</span>y<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> maxy &lt;= <span style=" ">&#40;</span>y + height<span style=" ">&#41;</span> <span style=" ">&#41;</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;diry = -diry<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;y = y + speed * diry<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AnimDelay = <span style="color: #FFFFFF;">5</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span> &nbsp;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; AnimDelay&nbsp;:- <span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawRect</span><span style=" ">&#40;</span>x,y,Width,Height<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span> &nbsp;<br />
&nbsp; <br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Type</span> TMovingX <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> x:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> y:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> width:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> height:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> mindir:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> maxdir:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> dirx:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> speed:<span style="color: #ffff00; font-weight: bold;">Int</span> <br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span>xt:<span style="color: #ffff00; font-weight: bold;">Int</span> , yt:<span style="color: #ffff00; font-weight: bold;">Int</span> , mn:<span style="color: #ffff00; font-weight: bold;">Int</span> , mx:<span style="color: #ffff00; font-weight: bold;">Int</span> , d:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TMX:TMovingX = <span style="color: #ffff00; font-weight: bold;">New</span> TMovingX<br />
<br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">x</span> = xt * TILESIZE<br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">y</span> = yt * TILESIZE<br />
<br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">width</span> = TILESIZE <br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">height</span> = TILESIZE<br />
<br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">speed</span> = <span style="color: #FFFFFF;">1</span><br />
<br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">dirx</span> = d<br />
<br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">mindir</span> = <span style=" ">&#40;</span>mn + xt<span style=" ">&#41;</span> * TILESIZE <br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">maxdir</span> = <span style=" ">&#40;</span>mx + xt + <span style="color: #FFFFFF;">1</span><span style=" ">&#41;</span> * TILESIZE &nbsp; <br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">ListAddLast</span><span style=" ">&#40;</span>MovingXList, TMX<span style=" ">&#41;</span> <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span><span style=" ">&#40;</span> mindir &gt;= x <span style="color: #ffff00; font-weight: bold;">Or</span> maxdir &lt;= <span style=" ">&#40;</span>x + width<span style=" ">&#41;</span> <span style=" ">&#41;</span> &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; dirx = - dirx<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; x&nbsp;:+ speed * dirx<br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span> &nbsp;<br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">128</span> , <span style="color: #FFFFFF;">128</span> , <span style="color: #FFFFFF;">128</span><span style=" ">&#41;</span> &nbsp;<span style="color: #B1E7EB;">' gray</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawRect</span><span style=" ">&#40;</span>x , y , Width , Height<span style=" ">&#41;</span> &nbsp;<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">255</span><span style=" ">&#41;</span> &nbsp;<span style="color: #B1E7EB;">' white line</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawLine</span><span style=" ">&#40;</span>x , y , x + width - <span style="color: #FFFFFF;">1</span> , y<span style=" ">&#41;</span> <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span> &nbsp; &nbsp;<br />
&nbsp; <br />
&nbsp; &nbsp; <br />
<span style="color: #ffff00; font-weight: bold;">Global</span> LevMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span> = <span style=" ">&#91;</span><span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span><span style=" ">&#93;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Global</span> MyLevel&nbsp;: TLevel = <span style="color: #ffff00; font-weight: bold;">New</span> TLevel.<span style="">Create</span><span style=" ">&#40;</span>LevMap , <span style="color: #FFFFFF;">20</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Function</span> Init_All_Bonuses<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">3</span> , <span style="color: #FFFFFF;">8</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">8</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">5</span> , <span style="color: #FFFFFF;">8</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">15</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">100</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">7</span> , <span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">100</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">9</span> , <span style="color: #FFFFFF;">7</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">6</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">9</span> , <span style="color: #FFFFFF;">2</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">14</span> , <span style="color: #FFFFFF;">7</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">17</span> , <span style="color: #FFFFFF;">6</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">17</span> , <span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">18</span> , <span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">3</span> , <span style="color: #FFFFFF;">3</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span> &nbsp;<br />
<br />
TMovingX.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">13</span> , <span style="color: #FFFFFF;">3</span> , - <span style="color: #FFFFFF;">2</span> , <span style="color: #FFFFFF;">5</span> , <span style="color: #FFFFFF;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #B1E7EB;">'----------------------------- main loop -----------------------------</span><br />
<span style="color: #ffff00; font-weight: bold;">Graphics</span><span style=" ">&#40;</span>ScrWidth, ScrHeight<span style=" ">&#41;</span> <br />
<br />
Init_All_Bonuses<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
<br />
&nbsp; &nbsp; MyLevel.<span style="">Render</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Flip</span> <br />
<span style="color: #ffff00; font-weight: bold;">Until</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>KEY_ESCAPE<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span></div>
<p>Можете поэкспериментировать с размерами платформы, сделать ее уже, типа рейки, уменьшить ширину, задать другие координаты и т.д. Кстати, эксперименты с чужим (да и своим) кодом дают большее понимание того, что в нем происходит. А теперь ответственное задание. Сделайте лифт (TmovingY). Ну чтобы вверх/вниз ездил. Думаю того, что я рассказал, достаточно для этого. Дерзайте и всё у вас получится!
</p>
<a name=".D0.9E.D0.B4.D0.B8.D0.BD_.D1.81.D0.BF.D0.B8.D1.81.D0.BE.D0.BA"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D0%B0%D1%8F_%D0%B8%D0%B3%D1%80%D0%B0_%D0%BD%D0%B0_BlitzMax&amp;action=edit&amp;section=5" title="Тайловая игра на BlitzMax">править</a>]</span> <span class="mw-headline">Один список</span></h2>
<p>Блин, что-то мне не нравится. И не нравится вот что. При добавлении нового типа в игру. Надо не только его описать, но и создать список для хранения объектов этого типа. А потом еще крутить вертеть все эти списки по очереди, чтобы всё проапдейтить и нарисовать. Вот было бы здорово иметь ОДИН список, для объектов всех типов. А? Потом просто разок пройтись по этому списку в цикле и всё, красотаааа. И в BlitzMaxе есть такая возможность! Нам поможет механизм наследования. Так, что это вы сразу отворачиваетесь и краснеете? Кто не вкурил руководство от Wave, кто думал что обойдется без этого? Кто у нас слабое звено? Ладно, попытаюсь объяснить. Но начнем по порядку. Стираем на фиг, все списки для хранения тайлов, бонусов и платформ. И создаем один&nbsp;:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Global</span> ALLGameObjList&nbsp;: <span style="color: #ffff00; font-weight: bold;">TList</span> = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Вот так, гордо и пафосно, я назвал новый список, в котором будут содержаться все объекты. Соответственно в каждой функции создания нового объекта Create() надо добавлять созданный объект уже в этот список.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">ListAddLast</span><span style=" ">&#40;</span>ALLGameObjList , Tobj<span style=" ">&#41;</span></div>
<p>Сделали? Теперь все объекты будут в одном списке! А в циклах отрисовки бонусов и платформ, замените прошлые листы на наш супер-мега-пупер-лист. Для бонуса, это будет например так:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> CurBonus:TBonus = <span style="color: #ffff00; font-weight: bold;">EachIn</span> ALLGameObjList<br />
<p>&nbsp; &nbsp; CurBonus.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; CurBonus.<span style="">Draw</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span></div>
<p>Компилим: клево работает!!! Блин, а чего мы выиграли-то? 2 строчки кода (((. Хоть и список у нас теперь один, а так и осталось - для каждого типа свой цикл. Думаем дальше: Вот если бы все объекты были одного типа, то было бы достаточно прокрутить с ним список один раз. То есть сделать один единственный цикл! И нам в этом поможет наследство. Плотнее товарищи, не вижу улыбок на лицах. Наследование - это один из важнейших принципов ООП. И кстати самый благозвучный, остальные без пол-литра не выговоришь. Давайте посмотрим по внимательнее на наши типы, а точнее на их свойства (Field). У них всех есть одинаковые параметры: x, y, width, height. Предлагаю сделать еще один тип - базовый или ,если угодно, родительский. Куда мы их и вынесем&nbsp;:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TParent<br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> x:<span style="color: #ffff00; font-weight: bold;">int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> y:<span style="color: #ffff00; font-weight: bold;">int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> width:<span style="color: #ffff00; font-weight: bold;">int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> height:<span style="color: #ffff00; font-weight: bold;">int</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">type</span></div>
<p>А для чего я это сделал? Представьте, как было бы здорово не писать каждый раз эти одинаковые параметры в новый тип. А взять их из отдельного места. Из другого типа. Или другими словами &lt;унаследовать&gt; их. Я не зря назвал тип &lt;TParent&gt;, то есть &lt;родитель&gt;. Ведь типы, которые от него наследуют параметры, будут его детьми. Это как одна дружная семья типов. И как это сделать, да очень просто. Вот, к примеру, как ваше имя - отчество? Ну, к примеру, зовут вас Иван Сергеевич. Это значит что ваше имя - Ваня, а имя вашего отца (родителя) - Сергей. Вы не поверите, но в Блице это ни чуть не сложнее чем в жизни:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> MyName <span style="color: #ffff00; font-weight: bold;">Extends</span> FatherName &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #B1E7EB;">'Type Иван Extends Сергеевич</span></div>
<p>То есть пишется сначала имя наследника и через Extends имя родителя. И это означает, что вы, то есть ваш тип, теперь обладает теми же параметрами, что и родитель. Тут надо заметить, что параметры имеют только одинаковые названия, но данные в разных типах не одинаковы. Как говорят в Одессе, это две большие разницы. Ну, теория теорией, а я предпочитаю практику. Закомментируем во всех наших типах поля &lt;x&gt;, &lt;y&gt;, &lt;width&gt; и &lt;height&gt;. И давайте первым делом &lt;усыновим&gt; тип TTile, как вы уже догадались, это будет выглядеть так:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TTile <span style="color: #ffff00; font-weight: bold;">Extends</span> TParent</div>
<p>На примере этого типа &lt;усыновите&gt; и остальные(TBonus и TMovingX). Компильте скорее! Все идет. А для чего мы все это делали? Нет, конечно, хорошо, что мы вынесли общие для наших типов параметры в отдельный тип. Но не это самое главное, а то, что теперь все наши типы имеют одного предка, то есть это &lt;дети&gt; одного отца. И имя ему - &lt;TParent&gt;. Ну что, уловили полет мысли?  Ага, мы будем крутить цикл с базовым типом, вот так:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> CurObj:TBase = <span style="color: #ffff00; font-weight: bold;">EachIn</span> ALLGameObjList<br />
<p>&nbsp; &nbsp; CurObj.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; CurObj.<span style="">Draw</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span></div>
<p>А уж он будет обращаться, ко всем своим родственникам в нашем супер-пупер-мега-списке. То есть он пройдет и по TTile и по TBonus и по TMovingX - объектам, если вы их, конечно, усыновили. Компилим:и&nbsp;: опс, не работает. А что пишет-то? Мол, нет у типа TParent метода Update(). Да согласен - нет. У этого типа вообще нет ни одного метода. Мы хотим, чтобы методы Update() и Draw() вызывались не базового типа, а его наследников, так если CurObj - это Bonus, то и вызывать надо Bonus.Update() и так далее. Аналогично дело обстоит и с методом Draw(). Мы-то знаем, что хотим, но BlitzMax не знает. Для того? чтобы он это понял, надо все-таки объявить эти два метода в нашем базовом типе, НО не писать никакого кода, а сделать их АБСТРАКТНЫМИ или по-другому виртуальными:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Abstract</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Abstract</span></div>
<p>Как раз это ключевое слово (Abstract) и подсказывает BlitzMax-у, чтобы он обращался не к методам предка, а к методам его производных типов. Это называется полиморфизм, второй из важнейших признаков ООП. Цитата: &lt;Полиморфизм реализуется с помощью наследования классов (в BlitzMaxe - типов). Класс-потомок наследует сигнатуры методов класса-родителя, но реализация этих методов может быть другой, соответствующей специфике класса-потомка. Это называется переопределением метода.&gt;(Wikipedia). То есть в зависимости от того, к какому типу принадлежит текущий объект, метод такого типа и вызывается - это как раз то, чего мы хотели. Ну, надеюсь, вы поняли. А если нет, то курите, други мои, руководство от Wave, а я пошел пивка попью. Ах, да, теперь все, компилим и радуемся. Вот исходник:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">SuperStrict</span><br />
<p><br />
<span style="color: #ffff00; font-weight: bold;">Global</span> ScrWidth&nbsp;: <span style="color: #ffff00; font-weight: bold;">Int</span> &nbsp;= <span style="color: #FFFFFF;">640</span><br />
<span style="color: #ffff00; font-weight: bold;">Global</span> ScrHeight&nbsp;: <span style="color: #ffff00; font-weight: bold;">Int</span> = <span style="color: #FFFFFF;">480</span><br />
<br />
<span style="color: #B1E7EB;">'Global TileList:TList = CreateList()</span><br />
<span style="color: #B1E7EB;">'Global BonusList:TList = CreateList()</span><br />
<span style="color: #B1E7EB;">'Global MovingXList:TList = CreateList()</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Global</span> ALLGameObjList&nbsp;: <span style="color: #ffff00; font-weight: bold;">TList</span> = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Const</span> TILESIZE:<span style="color: #ffff00; font-weight: bold;">Int</span> &nbsp; = <span style="color: #FFFFFF;">32</span> <br />
<br />
<span style="color: #ffff00; font-weight: bold;">Type</span> TBase<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> x:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> y:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Width:<span style="color: #ffff00; font-weight: bold;">Byte</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Height:<span style="color: #ffff00; font-weight: bold;">Byte</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> update<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Abstract</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> draw<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Abstract</span><br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span> &nbsp;<br />
<br />
<span style="color: #ffff00; font-weight: bold;">Type</span> TTile <span style="color: #ffff00; font-weight: bold;">Extends</span> TBase<br />
<span style="color: #B1E7EB;">' Field x:Int</span><br />
<span style="color: #B1E7EB;">' Field y:Int</span><br />
<span style="color: #B1E7EB;">' Field Width:Byte</span><br />
<span style="color: #B1E7EB;">' Field Height:Byte</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> xTile:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> yTile:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Walkable:<span style="color: #ffff00; font-weight: bold;">Byte</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span>sx:<span style="color: #ffff00; font-weight: bold;">Int</span>, sy:<span style="color: #ffff00; font-weight: bold;">Int</span>, WB:<span style="color: #ffff00; font-weight: bold;">Byte</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TT:TTile = <span style="color: #ffff00; font-weight: bold;">New</span> TTile<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">width</span> &nbsp;= TiLESIZE &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">height</span> = TiLESIZE &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">xTile</span> = sx &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; TT.<span style="">yTile</span> = sy &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; TT.<span style="">x</span> = TT.<span style="">xTile</span> * TT.<span style="">width</span> &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; TT.<span style="">y</span> = TT.<span style="">yTile</span> * TT.<span style="">height</span> &nbsp; <br />
&nbsp; &nbsp; &nbsp; TT.<span style="">Walkable</span> = WB &nbsp; &nbsp; &nbsp; &nbsp;<br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">ListAddLast</span><span style=" ">&#40;</span>ALLGameObjList , TT<span style=" ">&#41;</span> &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span> &nbsp;<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> update<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> &nbsp; &nbsp;walkable &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'not walkable</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span> &nbsp;<span style="color: #B1E7EB;">'red</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Else</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">' walkable</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span> &nbsp; <span style="color: #B1E7EB;">'green</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span> &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span> &nbsp; &nbsp; &nbsp;<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawRect</span><span style=" ">&#40;</span>x,y,Width,Height<span style=" ">&#41;</span> &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Type</span> TLevel<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Width&nbsp;: <span style="color: #ffff00; font-weight: bold;">Byte</span> <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Height&nbsp;: <span style="color: #ffff00; font-weight: bold;">Byte</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Map:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span>,<span style=" ">&#93;</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create:TLevel<span style=" ">&#40;</span>MyMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span>,map_width:<span style="color: #ffff00; font-weight: bold;">Int</span>,map_height:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TM&nbsp;: TLevel = <span style="color: #ffff00; font-weight: bold;">New</span> TLevel &nbsp;<br />
&nbsp; &nbsp; TM.<span style="">Width</span> &nbsp;= map_width<br />
&nbsp; &nbsp; TM.<span style="">Height</span> = map_height<br />
<br />
&nbsp; &nbsp; TM.<span style="">map</span> = <span style="color: #ffff00; font-weight: bold;">New</span> <span style="color: #ffff00; font-weight: bold;">Int</span> <span style=" ">&#91;</span>TM.<span style="">Width</span>, TM.<span style="">Height</span><span style=" ">&#93;</span><br />
&nbsp; &nbsp; TM.<span style="">load</span><span style=" ">&#40;</span>myMap<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Return</span> TM &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span> &nbsp;<br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Load<span style=" ">&#40;</span>arrMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> i:<span style="color: #ffff00; font-weight: bold;">Int</span> = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Until</span> Height<br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> j:<span style="color: #ffff00; font-weight: bold;">Int</span> = <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Until</span> Width<br />
&nbsp; &nbsp; &nbsp; &nbsp; Map<span style=" ">&#91;</span>j , i<span style=" ">&#93;</span> = arrMap<span style=" ">&#91;</span>j + <span style=" ">&#40;</span>i * Width<span style=" ">&#41;</span><span style=" ">&#93;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Map<span style=" ">&#91;</span>j , i<span style=" ">&#93;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TTile.<span style="">Create</span><span style=" ">&#40;</span>j , i , <span style="color: #ffff00; font-weight: bold;">True</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TTile.<span style="">Create</span><span style=" ">&#40;</span>j , i , <span style="color: #ffff00; font-weight: bold;">False</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span> &nbsp; &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span> &nbsp;<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Render<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
<span style="color: #B1E7EB;">' &nbsp; For Local CurTile:TTile = EachIn ALLGameObjList</span><br />
<span style="color: #B1E7EB;">' &nbsp; &nbsp; CurTile.Update()</span><br />
<span style="color: #B1E7EB;">' &nbsp; &nbsp; CurTile.Draw()</span><br />
<span style="color: #B1E7EB;">' &nbsp; Next &nbsp;</span><br />
<span style="color: #B1E7EB;">' &nbsp; </span><br />
<span style="color: #B1E7EB;">' &nbsp; For Local CurBonus:TBonus = EachIn ALLGameObjList</span><br />
<span style="color: #B1E7EB;">' &nbsp; &nbsp; CurBonus.Update()</span><br />
<span style="color: #B1E7EB;">' &nbsp; &nbsp; CurBonus.Draw()</span><br />
<span style="color: #B1E7EB;">' &nbsp; Next &nbsp; &nbsp; &nbsp;</span><br />
<span style="color: #B1E7EB;">' &nbsp; </span><br />
<span style="color: #B1E7EB;">' &nbsp; For Local CurMovingX:TMovingX = EachIn ALLGameObjList</span><br />
<span style="color: #B1E7EB;">' &nbsp; &nbsp; CurMovingX.Update()</span><br />
<span style="color: #B1E7EB;">' &nbsp; &nbsp; CurMovingX.Draw()</span><br />
<span style="color: #B1E7EB;">' &nbsp; Next &nbsp; &nbsp; &nbsp; &nbsp;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> CurObj:TBase = <span style="color: #ffff00; font-weight: bold;">EachIn</span> ALLGameObjList<br />
&nbsp; &nbsp; &nbsp; CurObj.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; CurObj.<span style="">Draw</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span> &nbsp;<br />
&nbsp; &nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
&nbsp; <br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Type</span> TBonus <span style="color: #ffff00; font-weight: bold;">Extends</span> TBase<br />
<span style="color: #B1E7EB;">' Field x:Int</span><br />
<span style="color: #B1E7EB;">' Field y:Int</span><br />
<span style="color: #B1E7EB;">' Field width:Int</span><br />
<span style="color: #B1E7EB;">' Field height:Int</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> points:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> miny:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> maxy:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> diry:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> speed:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> AnimDelay:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span>sx:<span style="color: #ffff00; font-weight: bold;">Int</span>,sy:<span style="color: #ffff00; font-weight: bold;">Int</span>,pts:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TB&nbsp;: TBonus = <span style="color: #ffff00; font-weight: bold;">New</span> TBonus<br />
&nbsp; &nbsp; &nbsp; TB.<span style="">Width</span> = <span style="color: #FFFFFF;">6</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">Height</span> = <span style="color: #FFFFFF;">16</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">x</span> = sx * TiLESIZE + <span style=" ">&#40;</span><span style=" ">&#40;</span>TiLESIZE - TB.<span style="">width</span><span style=" ">&#41;</span> / <span style="color: #FFFFFF;">2</span><span style=" ">&#41;</span> &nbsp;<span style="color: #B1E7EB;">'center it</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">y</span> = sy * TiLESIZE + <span style=" ">&#40;</span><span style=" ">&#40;</span>TiLESIZE - TB.<span style="">height</span><span style=" ">&#41;</span> / <span style="color: #FFFFFF;">2</span><span style=" ">&#41;</span> <span style="color: #B1E7EB;">'center it</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">points</span> = pts<br />
&nbsp; &nbsp; &nbsp; TB.<span style="">miny</span> = TB.<span style="">y</span> - <span style="color: #FFFFFF;">4</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">maxy</span> = TB.<span style="">y</span> + TB.<span style="">Height</span> + <span style="color: #FFFFFF;">4</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">diry</span> = <span style="color: #FFFFFF;">-1</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">speed</span> = <span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; &nbsp; TB.<span style="">AnimDelay</span> = <span style="color: #FFFFFF;">5</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">ListAddLast</span><span style=" ">&#40;</span>ALLGameObjList , TB<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span> &nbsp;<br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span><span style=" ">&#40;</span>Animdelay &lt; <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">If</span> <span style=" ">&#40;</span> miny &gt;= <span style=" ">&#40;</span>y<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> maxy &lt;= <span style=" ">&#40;</span>y + height<span style=" ">&#41;</span> <span style=" ">&#41;</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;diry = -diry<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;y = y + speed * diry<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AnimDelay = <span style="color: #FFFFFF;">5</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">If</span> &nbsp;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; AnimDelay&nbsp;:- <span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawRect</span><span style=" ">&#40;</span>x,y,Width,Height<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span> &nbsp;<br />
&nbsp; <br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Type</span> TMovingX <span style="color: #ffff00; font-weight: bold;">Extends</span> TBase<br />
<span style="color: #B1E7EB;">' Field x:Int</span><br />
<span style="color: #B1E7EB;">' Field y:Int</span><br />
<span style="color: #B1E7EB;">' Field width:Int</span><br />
<span style="color: #B1E7EB;">' Field height:Int</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> mindir:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> maxdir:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> dirx:<span style="color: #ffff00; font-weight: bold;">Int</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> speed:<span style="color: #ffff00; font-weight: bold;">Int</span> <br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span>xt:<span style="color: #ffff00; font-weight: bold;">Int</span> , yt:<span style="color: #ffff00; font-weight: bold;">Int</span> , mn:<span style="color: #ffff00; font-weight: bold;">Int</span> , mx:<span style="color: #ffff00; font-weight: bold;">Int</span> , d:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> TMX:TMovingX = <span style="color: #ffff00; font-weight: bold;">New</span> TMovingX<br />
<br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">x</span> = xt * TILESIZE<br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">y</span> = yt * TILESIZE<br />
<br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">width</span> = TILESIZE <br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">height</span> = TILESIZE<br />
<br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">speed</span> = <span style="color: #FFFFFF;">1</span><br />
<br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">dirx</span> = d<br />
<br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">mindir</span> = <span style=" ">&#40;</span>mn + xt<span style=" ">&#41;</span> * TILESIZE <br />
&nbsp; &nbsp; &nbsp; TMX.<span style="">maxdir</span> = <span style=" ">&#40;</span>mx + xt + <span style="color: #FFFFFF;">1</span><span style=" ">&#41;</span> * TILESIZE &nbsp; <br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">ListAddLast</span><span style=" ">&#40;</span>ALLGameObjList , TMX<span style=" ">&#41;</span> <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span><span style=" ">&#40;</span> mindir &gt;= x <span style="color: #ffff00; font-weight: bold;">Or</span> maxdir &lt;= <span style=" ">&#40;</span>x + width<span style=" ">&#41;</span> <span style=" ">&#41;</span> &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; dirx = - dirx<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; x&nbsp;:+ speed * dirx<br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span> &nbsp;<br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">128</span> , <span style="color: #FFFFFF;">128</span> , <span style="color: #FFFFFF;">128</span><span style=" ">&#41;</span> &nbsp;<span style="color: #B1E7EB;">' gray</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawRect</span><span style=" ">&#40;</span>x , y , Width , Height<span style=" ">&#41;</span> &nbsp;<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">255</span> , <span style="color: #FFFFFF;">255</span><span style=" ">&#41;</span> &nbsp;<span style="color: #B1E7EB;">' white line</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawLine</span><span style=" ">&#40;</span>x , y , x + width - <span style="color: #FFFFFF;">1</span> , y<span style=" ">&#41;</span> <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Method</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span> &nbsp; &nbsp;<br />
&nbsp; <br />
&nbsp; &nbsp; <br />
<span style="color: #ffff00; font-weight: bold;">Global</span> LevMap:<span style="color: #ffff00; font-weight: bold;">Int</span><span style=" ">&#91;</span><span style=" ">&#93;</span> = <span style=" ">&#91;</span><span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">0</span> , <span style="color: #FFFFFF;">1</span> , ..<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span><span style=" ">&#93;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Global</span> MyLevel&nbsp;: TLevel = <span style="color: #ffff00; font-weight: bold;">New</span> TLevel.<span style="">Create</span><span style=" ">&#40;</span>LevMap , <span style="color: #FFFFFF;">20</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Function</span> Init_All_Bonuses<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">3</span> , <span style="color: #FFFFFF;">8</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">8</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">5</span> , <span style="color: #FFFFFF;">8</span> , <span style="color: #FFFFFF;">25</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">15</span> , <span style="color: #FFFFFF;">1</span> , <span style="color: #FFFFFF;">100</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">7</span> , <span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">100</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">9</span> , <span style="color: #FFFFFF;">7</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">6</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">9</span> , <span style="color: #FFFFFF;">2</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">14</span> , <span style="color: #FFFFFF;">7</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">17</span> , <span style="color: #FFFFFF;">6</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">17</span> , <span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">18</span> , <span style="color: #FFFFFF;">4</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
&nbsp; TBonus.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">3</span> , <span style="color: #FFFFFF;">3</span> , <span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span> <br />
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Function</span> &nbsp;<br />
<br />
TMovingX.<span style="">Create</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">13</span> , <span style="color: #FFFFFF;">3</span> , - <span style="color: #FFFFFF;">2</span> , <span style="color: #FFFFFF;">5</span> , <span style="color: #FFFFFF;">1</span><span style=" ">&#41;</span><br />
<br />
<br />
<span style="color: #B1E7EB;">'----------------------------- main loop -----------------------------</span><br />
<span style="color: #ffff00; font-weight: bold;">Graphics</span><span style=" ">&#40;</span>ScrWidth, ScrHeight<span style=" ">&#41;</span> <br />
<br />
Init_All_Bonuses<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
<br />
&nbsp; &nbsp; MyLevel.<span style="">Render</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Flip</span> <br />
<span style="color: #ffff00; font-weight: bold;">Until</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>KEY_ESCAPE<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">Or</span> <span style="color: #ffff00; font-weight: bold;">AppTerminate</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span></div>
<p>Так, на протяжении этой главы, мы создавали себе трудности и сами же их героически преодолевали, в этом и заключается программирование.
</p>
<a name=".D0.92.D1.8B.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A2%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D0%B0%D1%8F_%D0%B8%D0%B3%D1%80%D0%B0_%D0%BD%D0%B0_BlitzMax&amp;action=edit&amp;section=6" title="Тайловая игра на BlitzMax">править</a>]</span> <span class="mw-headline">Выведение</span></h2>
<p>Прошу строго не судить, ведь это моя первая статья. В следующей статье (если она будет) мы поместим на наш уровень героя, которого научим бегать, прыгать, стрелять, запрыгивать и ездить на платформах, а так же собирать бонусы. Все пожелания, а также сообщения об опечатках и багах в коде, пишите мне на почтовый ящик.
</p>
<div align="right"><a href="http://blitzetcetera.org/images/0/00/Tile_Game.zip" class="internal" title="Tile Game.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Dimanche13" title="Участник:Dimanche13">Dimanche13</a> (e-mail: dimanche13@rambler.ru)
</p><p></td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Система частиц на примере салюта"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Система частиц на примере салюта&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Система частиц на примере салюта&amp;action=edit">править</a>]</span><span class="mw-headline">Система частиц на примере салюта</span></h1>
<p>Для создания спецэффектов в 90% случаев используются системы частиц. Система частиц – это набор точек или объектов, поведение которых определяется определенным законам. Например, салют можно представить как систему частиц. Частички это светящиеся шарики, которые разлетаются в разные стороны и гаснут. Вот именно этим примером мы и займемся.
</p>
</p><p>Для работы с частицами требуется как минимум две функции: первая создает частички; вторая задает поведение частиц.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> Create_bah<span style=" ">&#40;</span>x#,y#,z#,col<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> Update_bah<span style=" ">&#40;</span><span style=" ">&#41;</span></div> 
<p>x#, y#, z# - координаты салюта в пространстве
col – количество частиц (светящихся шариков)
</p><p>Самое главное в работе с частицами это Типы или Списки. Для хранения данных о частицам необходимо использовать именно Типы, т.к. массивы в Blitz работают довольно медленно, а в файл записывать еще медленнее.
</p><p>Создаем новый тип:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">; Создаем тип с именем sparcs</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Type</span> sparcs<br />
<br />
<span style="color: #ffee00">; Скорость частицы</span><br />
<span style="color: #aaffff; font-weight: bold;">Field</span> speed#<br />
<br />
<span style="color: #ffee00">; Время жизни частицы (Вечно существовать салют не может)</span><br />
<span style="color: #aaffff; font-weight: bold;">Field</span> time_life#<br />
<br />
<span style="color: #ffee00">; Сама частичка</span><br />
<span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
<br />
<span style="color: #ffee00">; Больше переменных в типе нет.</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>Тип создали. Теперь напишем функцию создания частичек (салюта):
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> Create_bah<span style=" ">&#40;</span>x#,y#,z#,col<span style=" ">&#41;</span><br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i= <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> col<span style="color: #ffee00">; Цикл от 1 до количества частиц в салюте</span><br />
<br />
e.sparcs = <span style="color: #aaffff; font-weight: bold;">New</span> sparcs<span style="color: #ffee00">; Создаем переменную e</span><br />
<span style="color: #ffee00">;типа sparcs (наш тип)</span><br />
e\speed=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span>-.<span style="color: #33ffdd;">4</span>,.<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span><span style="color: #ffee00">; Скорость частицы выбирается</span><br />
<span style="color: #ffee00">;случайно от -0.4 до +0.4</span><br />
e\time_life=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">40</span>,<span style="color: #33ffdd;">70</span><span style=" ">&#41;</span><span style="color: #ffee00">; Время жизни тоже</span><br />
<span style="color: #ffee00">;случайно – так красивее:)</span><br />
<br />
<span style="color: #ffee00">; В качестве шариков загружаем спрайт</span><br />
e\entity=<span style="color: #aaffff; font-weight: bold;">LoadSprite</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;sprite\spark.bmp&quot;</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> e\entity,x,y,z<span style="color: #ffee00">; Устанавливаем частицу на</span><br />
<span style="color: #ffee00">;начальную позицию</span><br />
<br />
<span style="color: #ffee00">; Разворачиваем частицу в случайном направлении</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> e\entity,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">360</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">360</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">360</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Эта функция создаст в памяти список с параметрами каждой частицы. У списков есть недостаток – нельзя просто обратиться к определенной частицы, необходимо каждый раз перебирать каждую. Но этот процесс не заметен в запущенной программе.
</p><p>Для перебора списка используют команду Each. Записывается она в цикле:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">For</span> w.sparcs =<span style="color: #aaffff; font-weight: bold;">Each</span> sparcs</div>
<p>Что означает: поочередно присвоить переменной w типа sparcs все значения списка sparcs. Именно такой цикл нам и нужен для просчеты поведения частиц. Пишем функцию…
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> Update_bah<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">For</span> w.sparcs =<span style="color: #aaffff; font-weight: bold;">Each</span> sparcs<span style="color: #ffee00">; «перебрать» все частицы</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> w\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,w\speed <span style="color: #ffee00">; двинуть частицу</span><br />
<span style="color: #ffee00">; вперед на speed единиц</span><br />
w\time_life=w\time_life<span style="color: #33ffdd;">-1</span> <span style="color: #ffee00">; уменьшить время жизни частицы</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> w\time_life&lt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #ffee00">; если время жизни «истекло», то</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeEntity</span> w\entity <span style="color: #ffee00">; уничтожить частицу (шарик)</span><br />
<span style="color: #aaffff; font-weight: bold;">Delete</span> w <span style="color: #ffee00">; Стереть все записи из памяти о частице.</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>ВНИМАНИЕ&nbsp;!!! Обязательно удаляйте частицу и все записи о ней. Иначе память быстро заполниться ненужными данными и программа начнет работать очень медленно!!!
</p><p>Все&nbsp;!!! Маленькая .bb библиотека готова.
<p>Осталось внедрить ее в программу и запустить..
</p>
</p><p>Полный текст библиотеки:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> sparcs<br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">Field</span> x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> speed#<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> time_life#<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> Create_bah<span style=" ">&#40;</span>x#,y#,z#,col<span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> i= <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> col<br />
<br />
e.sparcs = <span style="color: #aaffff; font-weight: bold;">New</span> sparcs<br />
e\x=x<br />
e\y=y<br />
e\z=z<br />
e\speed=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span>-.<span style="color: #33ffdd;">4</span>,.<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span><br />
e\time_life=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">40</span>,<span style="color: #33ffdd;">70</span><span style=" ">&#41;</span><br />
e\entity=<span style="color: #aaffff; font-weight: bold;">LoadSprite</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Salute.png&quot;</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> e\entity,x,y,z<br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> e\entity,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">360</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">360</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">360</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> Update_bah<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> w.sparcs =<span style="color: #aaffff; font-weight: bold;">Each</span> sparcs<br />
<br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> w\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,w\speed<br />
w\time_life=w\time_life<span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> w\time_life&lt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">FreeEntity</span> w\entity<br />
<span style="color: #aaffff; font-weight: bold;">Delete</span> w<br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Сохраняем файл под именем Bah.bb и создаем новый файл:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Include</span> <span style="color: #00ff66;">&quot;bah.bb&quot;</span> <span style="color: #ffee00">; подключаем нашу библиотеку</span><br />
<br />
cam=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> cam,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-20</span><br />
lit=<span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">57</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> create_bah<span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">300</span><span style=" ">&#41;</span> <span style="color: #ffee00">; При нажатии наа</span><br />
<span style="color: #ffee00">;«Пробел» создать салют</span><br />
<br />
update_bah<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffee00">; Просчитать новое положение частиц</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Изображение для программы:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Salute.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Salute.png" src="kn32szkw.png" width="64" height="64" /></a></span></div></div>
<p>Запускаем и радуемся. Это самый простой пример. Этот принцип можно использовать для создания красивого огня, фонтанов, дыма, грязи из-под колес, шлейфа от двигателя и многого другого. Все на что способна фантазия.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Salute.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Salute.jpg" src="o2l1l4g8.jpg" width="283" height="258" /></a></span></div></div>
<div align="right"><a href="http://blitzetcetera.org/images/4/4b/Salute.zip" class="internal" title="Salute.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Grover" title="Участник:Grover">Grover</a> (e-mail: mail_grover@mail.ru)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Ввод текста с клавиатуры в графическом режиме"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Ввод текста с клавиатуры в графическом режиме&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Ввод текста с клавиатуры в графическом режиме&amp;action=edit">править</a>]</span><span class="mw-headline">Ввод текста с клавиатуры в графическом режиме</span></h1>
<p>Этот урок научит работать со строками и кодами клавиш в среде Blitz.
</p>
</p><p>На сколько я знаю, в Blitz3D нет функции ввода текста с клавиатуры. Конечно, есть команда Input, но она некрасивая и очень тугая. Я предлагаю сделать свою функцию ввода с клавиатуры: красивую и с рамочкой.&nbsp;:)
</p><p>Поставим задачу:
</p>
<ul><li> В точке, где кликнули мышью, появляется окошечко для ввода текста. После ввода текст отображается на экране.
</li></ul>
<p>Вот такая простая задача! Начнем с простого – с мыши и окошка:
Назовем функцию ввода&nbsp;: My_Input()
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">; Устанавливаем графический режим</span><br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">; Устанавливаем шрифт, ибо красиво должно быть.</span><br />
<br />
font=<span style="color: #aaffff; font-weight: bold;">LoadFont</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Times New Roman&quot;</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">SetFont</span> font<br />
<br />
<span style="color: #ffee00">;Создаем текстовую переменную, которую будем отображать на экране</span><br />
<span style="color: #ffee00">; Значок доллара указывает на то, что переменная текстовая</span><br />
Label$=<span style="color: #00ff66;">&quot;Hello World&quot;</span><br />
<br />
<span style="color: #ffee00">; Как обычно &lt;Пока не нажата клавиша Esc выполнять все до оператора Wend&gt;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">; Очистка экрана</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #ffee00">; Выставляем цвет текста</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #ffee00">; Выводим на экран значение нашей переменной и просьбу нажать на кнопку мыши</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #00ff66;">&quot;Click The Mouse Button On A Screen...&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">60</span>,<span style="color: #00ff66;">&quot;Label = &quot;</span>+Label<br />
<span style="color: #ffee00">; Если нажата левая кнопка мыши, тогда…</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<span style="color: #ffee00">; Нашей переменной Label присваиваем значение функции my_input()</span><br />
Label=my_input<span style=" ">&#40;</span>Label$,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">150</span>,<span style="color: #33ffdd;">40</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #ffee00">; Обновить содержимое экрана</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> my_input$<span style=" ">&#40;</span>s$,x#,y#,dx#,dy#<span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Можно запустить и увидеть на экране две строчки текста. В первой написано «Жми мышью на экран» (вольный перевод), а во второй «Hello World» - это значение переменной Label.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TextInput01.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TextInput01.jpg" src="aym16r49.jpg" width="400" height="310" /></a></span></div></div>
<p>При клике мышью пропадает значение переменной (становится равной 0). Это потому, что функция My_Input() пуста, а ее значение, соответственно, равно нулю.
Исправим это:
Как Вы уже заметили, у функции есть 5 входных параметров:
</p>
<ul><li>x#, y# - координаты верхнего левого угла окошка;
</li><li>dx#, dy# - ширина и высота окошка;
</li><li>s$ - это значение по умолчанию, т.е. какой текст уже будет введен при создании окошка.
</li></ul>
<p>Чтобы присвоить функции какое-либо значение, используется команда Return. Впишем в тело функции строку:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> my_input$<span style=" ">&#40;</span>s$,x#,y#,dx#,dy#<span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Return</span> s$<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Теперь при клике на экран, значение переменной не обнуляется.
Пора рисовать само окошко. Для этого впишем в тело функции после строки Function my_input$(s$,x#,y#,dx#,dy#) следующее:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">28</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">200</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> x,y,dx,dy,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> x<span style="color: #33ffdd;">+2</span>,y<span style="color: #33ffdd;">+2</span>,dx<span style="color: #33ffdd;">-4</span>,dy<span style="color: #33ffdd;">-4</span>,<span style="color: #33ffdd;">0</span><br />
view_text= s<br />
<span style="color: #aaffff; font-weight: bold;">Text</span> x+dx/<span style="color: #33ffdd;">2</span>,y+dy/<span style="color: #33ffdd;">2</span>,view_text,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Wend</span></div>
<p>Запускаем и кликаем в любое место экрана. Там где мы был произведен клик, появляется окошко с текстом, равным значению переменной Label. Окно не исчезает до тех пор, пока не будет нажата клавиша Enter (код 28).
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TextInput02.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:TextInput02.jpg" src="eyby7eit.jpg" width="400" height="310" /></a></span></div></div>
<p>Окошко работает нормально. Переходим к этапу ввода текста с клавиатуры.
Для того, чтобы узнать какая клавиша была нажата, в Blitz используются несколько функций. Нам подойдет функция WaitKey(). Эта функция останавливает работу программы до тех пор, пока не будет нажата клавиша, и возвращает код этой клавиши.
</p><p>ВНИМАНИЕ&nbsp;!!! Существует стандартная таблица символов, в которой перечислены все символы и клавиши и их коды (называется ASCII). В Blitz есть своя такая таблица, но с другими кодами (Scancodes). Важно не перепутать к какой таблице обращается функция. Например: В таблице Blitz клавиша Esc имеет код 1, а в стандартной таблице (ASCII) клавиша Esc под кодом 27. Обе таблицы можно найти нажав на иконку «Домик» на панели управления среды Blitz. Затем нажимаем на ссылку «Command Reference». Слева в списке категорий найдете таблицы ASCII и Scancodes. Функция WaitKey работает с таблицей ASCII.
<p>В нашу функцию после строки Flip добавляем код:
</p>
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">k=<span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Теперь программа будет останавливаться на этой строке и ждать нажатия на клавишу. Код нажатой клавиши сохранится в переменной k.
</p><p>Чтобы добавить нажатую клавишу к выводимой строке, допишем:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">s$= s$+<span style="color: #aaffff; font-weight: bold;">Chr</span><span style=" ">&#40;</span>k<span style=" ">&#41;</span></div>
<p>Текст функции на данный момент:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> my_input$<span style=" ">&#40;</span>s$,x#,y#,dx#,dy#<span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">28</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">200</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> x,y,dx,dy,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> x<span style="color: #33ffdd;">+2</span>,y<span style="color: #33ffdd;">+2</span>,dx<span style="color: #33ffdd;">-4</span>,dy<span style="color: #33ffdd;">-4</span>,<span style="color: #33ffdd;">0</span><br />
view_text$=s<br />
<span style="color: #aaffff; font-weight: bold;">Text</span> x+dx/<span style="color: #33ffdd;">2</span>,y+dy/<span style="color: #33ffdd;">2</span>,view_text,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
k=<span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
s$=s$+<span style="color: #aaffff; font-weight: bold;">Chr</span><span style=" ">&#40;</span>k<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> s$<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Запускаем и проверяем. Любая нажатая клавиша добавляется к нашей строке. Сразу заметьте, что при нажатии на клавиши, не содержащие букв или цифр, к строке добавляется какой-то квадратик. Дело в том, что, если к коду не прикреплен символ, то программа рисует квадратик. Это надо исправлять:
</p><p>Посмотрев внимательно в таблицу кодов ASCII, заметим, что коды букв, цифр и спецзнаков лежат в диапазоне от 32 до 126. Воспользуемся этим и поставим условие на добавление символа к строке: Если код нажатой клавиши в диапазоне от 32 до 126, то …
<p>Наша функция примет вид:
</p>
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> my_input$<span style=" ">&#40;</span>s$,x#,y#,dx#,dy#<span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">28</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">200</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> x,y,dx,dy,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> x<span style="color: #33ffdd;">+2</span>,y<span style="color: #33ffdd;">+2</span>,dx<span style="color: #33ffdd;">-4</span>,dy<span style="color: #33ffdd;">-4</span>,<span style="color: #33ffdd;">0</span><br />
view_text$=s<br />
<span style="color: #aaffff; font-weight: bold;">Text</span> x+dx/<span style="color: #33ffdd;">2</span>,y+dy/<span style="color: #33ffdd;">2</span>,view_text,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
k=<span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>k&gt;<span style="color: #33ffdd;">31</span><span style=" ">&#41;</span><span style="color: #aaffff; font-weight: bold;">And</span><span style=" ">&#40;</span>k&lt;<span style="color: #33ffdd;">127</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
s$=s$+<span style="color: #aaffff; font-weight: bold;">Chr</span><span style=" ">&#40;</span>k<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> s$<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Вот теперь лишних квадратиков не появляется.
Теперь добавим возможность удалять символы из строки. Используем тот же способ проверки кода клавиши. Клавиша BackSpace имеет код 8. Для работы над строками нам понадобятся три функции Left(), Right(), Mid().
</p>
<ul><li>Left() – Возвращает указанное количество символов, начиная с начала строки.
</li><li>Right() – Возвращает указанное количество символов, начиная с конца строки.
</li><li>Mid() - Возвращает указанное количество символов, начиная с указанного символа.
</li></ul>
<p>Примеры по использованию этих функций смотри в справке Blitz.
</p><p>Перед строкой Wend добавляем код:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> k=<span style="color: #33ffdd;">8</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<p>s= <span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>s,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>s<span style=" ">&#41;</span><span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>Запускаем, проверяем. При нажатии на клавишу BackSpace, символы стираются с конца строки. Нам не хватает курсора!!! Сейчас будет. Только функция немного изменится. В качестве курсора будем использовать знак «&nbsp;|&nbsp;». Чтобы курсор не становился частью строки, а только выводился на экран, я заранее ввел переменную View_Text$.
Еще нам понадобится переменная Cur_Pos – значение этой переменной будет содержать позицию курсора в строке. Управление курсором осуществляется клавишами влево и вправо, коды 31 и 30 соответственно.
</p><p>СОВЕТ: Чтобы не искать код той или иной клавиши в таблице ASCII, создайте новый лист и наберите маленькую программку:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<p>k=<span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Print</span> k<br />
</p>
<span style="color: #aaffff; font-weight: bold;">Wend</span></div>
<p>Эта программа выводит на экран код нажатой клавиши.
</p><p>После доработки наша функция выглядит так:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> my_input$<span style=" ">&#40;</span>s$,x#,y#,dx#,dy#<span style=" ">&#41;</span><br />
<p>cur_pos%=<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>s<span style=" ">&#41;</span><br />
view_text$=<span style="color: #00ff66;">&quot;&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">28</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">200</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> x,y,dx,dy,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> x<span style="color: #33ffdd;">+2</span>,y<span style="color: #33ffdd;">+2</span>,dx<span style="color: #33ffdd;">-4</span>,dy<span style="color: #33ffdd;">-4</span>,<span style="color: #33ffdd;">0</span><br />
view_text=<span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>s,cur_pos<span style=" ">&#41;</span><br />
view_text=view_text+<span style="color: #00ff66;">&quot;|&quot;</span><br />
view_text=view_text+<span style="color: #aaffff; font-weight: bold;">Right</span><span style=" ">&#40;</span>s,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>s<span style=" ">&#41;</span>-cur_pos<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> x+dx/<span style="color: #33ffdd;">2</span>,y+dy/<span style="color: #33ffdd;">2</span>,view_text,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
k=<span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>k&gt;<span style="color: #33ffdd;">31</span><span style=" ">&#41;</span><span style="color: #aaffff; font-weight: bold;">And</span><span style=" ">&#40;</span>k&lt;<span style="color: #33ffdd;">127</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
temp$=s<br />
s$=<span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>temp$,cur_pos<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Chr</span><span style=" ">&#40;</span>k<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Right</span><span style=" ">&#40;</span>temp$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>temp$<span style=" ">&#41;</span>-cur_pos<span style=" ">&#41;</span><br />
cur_pos=cur_pos<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> k=<span style="color: #33ffdd;">8</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> cur_pos&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
temp$=s$<br />
s= <span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>temp$,cur_pos<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Right</span><span style=" ">&#40;</span>temp$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>temp$<span style=" ">&#41;</span>-cur_pos<span style=" ">&#41;</span><br />
cur_pos=cur_pos<span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> k=<span style="color: #33ffdd;">4</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> cur_pos&lt;&gt;Len<span style=" ">&#40;</span>s<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
temp$=s<br />
s= <span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>temp$,cur_pos<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Right</span><span style=" ">&#40;</span>temp$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>temp$<span style=" ">&#41;</span>-cur_pos<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> k=<span style="color: #33ffdd;">31</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
cur_pos=cur_pos<span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> cur_pos&lt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> cur_pos=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> k=<span style="color: #33ffdd;">30</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
cur_pos=cur_pos<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> cur_pos&gt;Len<span style=" ">&#40;</span>s<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> cur_pos=<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>s<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> s$<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Теперь Мы можем перемещать курсор по строке и удалять символы перед и после курсора, как во всех редакторах.
Перед дальнейшим улучшением нашей функции, оптимизируем уже имеющийся код.
Заменим наши условия оператором Case:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> my_input$<span style=" ">&#40;</span>s$,x#,y#,dx#,dy#<span style=" ">&#41;</span><br />
<p>cur_pos%=<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>s<span style=" ">&#41;</span><br />
view_text$=<span style="color: #00ff66;">&quot;&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">28</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">200</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> x,y,dx,dy,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> x<span style="color: #33ffdd;">+2</span>,y<span style="color: #33ffdd;">+2</span>,dx<span style="color: #33ffdd;">-4</span>,dy<span style="color: #33ffdd;">-4</span>,<span style="color: #33ffdd;">0</span><br />
view_text=<span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>s,cur_pos<span style=" ">&#41;</span><br />
view_text=view_text+<span style="color: #00ff66;">&quot;|&quot;</span><br />
view_text=view_text+<span style="color: #aaffff; font-weight: bold;">Right</span><span style=" ">&#40;</span>s,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>s<span style=" ">&#41;</span>-cur_pos<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> x+dx/<span style="color: #33ffdd;">2</span>,y+dy/<span style="color: #33ffdd;">2</span>,view_text,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
k=<span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Select</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style=" ">&#40;</span>k&gt;<span style="color: #33ffdd;">31</span><span style=" ">&#41;</span><span style="color: #aaffff; font-weight: bold;">And</span><span style=" ">&#40;</span>k&lt;<span style="color: #33ffdd;">127</span><span style=" ">&#41;</span><br />
temp$=s<br />
s$=<span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>temp$,cur_pos<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Chr</span><span style=" ">&#40;</span>k<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Right</span><span style=" ">&#40;</span>temp$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>temp$<span style=" ">&#41;</span>-cur_pos<span style=" ">&#41;</span><br />
cur_pos=cur_pos<span style="color: #33ffdd;">+1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> k=<span style="color: #33ffdd;">8</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> cur_pos&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
temp$=s$<br />
s= <span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>temp$,cur_pos<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Right</span><span style=" ">&#40;</span>temp$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>temp$<span style=" ">&#41;</span>-cur_pos<span style=" ">&#41;</span><br />
cur_pos=cur_pos<span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> k=<span style="color: #33ffdd;">4</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> cur_pos&lt;&gt;Len<span style=" ">&#40;</span>s<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
temp$=s<br />
s= <span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>temp$,cur_pos<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Right</span><span style=" ">&#40;</span>temp$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>temp$<span style=" ">&#41;</span>-cur_pos<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> k=<span style="color: #33ffdd;">31</span><br />
cur_pos=cur_pos<span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> cur_pos&lt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> cur_pos=<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> k=<span style="color: #33ffdd;">30</span><br />
cur_pos=cur_pos<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> cur_pos&gt;Len<span style=" ">&#40;</span>s<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> cur_pos=<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>s<span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> s$<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Так намного красивее, а главное - быстрее. В нашей программе разницу в скорости Вы не заметите, а в огромных проектах или играх разница существенна.
</p><p>Для удобства добавим обработку клавиш Home и End, в начало или конец строки:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Case</span> k=<span style="color: #33ffdd;">1</span><br />
<p>cur_pos=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Case</span> k=<span style="color: #33ffdd;">2</span><br />
</p>
cur_pos=<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>s<span style=" ">&#41;</span></div>
<p>Надеюсь, что понятно, куда дописать эти строки.
</p><p>Остался только один Bug. И этот недостаток заключается в том, что Строка в окошке может выходить за его пределы – это не хорошо, но исправимо.
<p>Воспользуемся командой ViewPort(), которая ограничивает зону вывода на экран.
Добавив ограничение вывода на экран, получим окончательный вариант функции.
Вот текст всей программы вместе с последними добавлениями:
</p>
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
font=<span style="color: #aaffff; font-weight: bold;">LoadFont</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Times New Roman&quot;</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">SetFont</span> font<br />
<br />
Label$=<span style="color: #00ff66;">&quot;Hello World&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #00ff66;">&quot;Click The Mouse Button On A Screen...&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">60</span>,<span style="color: #00ff66;">&quot;Label = &quot;</span>+Label<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> Label=my_input<span style=" ">&#40;</span>Label$,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">150</span>,<span style="color: #33ffdd;">40</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> my_input$<span style=" ">&#40;</span>s$,x#,y#,dx#,dy#<span style=" ">&#41;</span><br />
cur_pos%=<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>s<span style=" ">&#41;</span><br />
view_text$=<span style="color: #00ff66;">&quot;&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">28</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">200</span>,<span style="color: #33ffdd;">200</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> x,y,dx,dy,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> x<span style="color: #33ffdd;">+2</span>,y<span style="color: #33ffdd;">+2</span>,dx<span style="color: #33ffdd;">-4</span>,dy<span style="color: #33ffdd;">-4</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Viewport</span> x<span style="color: #33ffdd;">+2</span>,y<span style="color: #33ffdd;">+2</span>,dx<span style="color: #33ffdd;">-4</span>,dy<span style="color: #33ffdd;">-4</span><br />
view_text=<span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>s,cur_pos<span style=" ">&#41;</span><br />
view_text=view_text+<span style="color: #00ff66;">&quot;|&quot;</span><br />
view_text=view_text+<span style="color: #aaffff; font-weight: bold;">Right</span><span style=" ">&#40;</span>s,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>s<span style=" ">&#41;</span>-cur_pos<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> x+dx/<span style="color: #33ffdd;">2</span>,y+dy/<span style="color: #33ffdd;">2</span>,view_text,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
k=<span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Select</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style=" ">&#40;</span>k&gt;<span style="color: #33ffdd;">31</span><span style=" ">&#41;</span><span style="color: #aaffff; font-weight: bold;">And</span><span style=" ">&#40;</span>k&lt;<span style="color: #33ffdd;">127</span><span style=" ">&#41;</span><br />
temp$=s<br />
s$=<span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>temp$,cur_pos<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Chr</span><span style=" ">&#40;</span>k<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Right</span><span style=" ">&#40;</span>temp$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>temp$<span style=" ">&#41;</span>-cur_pos<span style=" ">&#41;</span><br />
cur_pos=cur_pos<span style="color: #33ffdd;">+1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> k=<span style="color: #33ffdd;">8</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> cur_pos&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
temp$=s$<br />
s= <span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>temp$,cur_pos<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Right</span><span style=" ">&#40;</span>temp$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>temp$<span style=" ">&#41;</span>-cur_pos<span style=" ">&#41;</span><br />
cur_pos=cur_pos<span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> k=<span style="color: #33ffdd;">4</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> cur_pos&lt;&gt;Len<span style=" ">&#40;</span>s<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
temp$=s<br />
s= <span style="color: #aaffff; font-weight: bold;">Left</span><span style=" ">&#40;</span>temp$,cur_pos<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Right</span><span style=" ">&#40;</span>temp$,<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>temp$<span style=" ">&#41;</span>-cur_pos<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> k=<span style="color: #33ffdd;">31</span><br />
cur_pos=cur_pos<span style="color: #33ffdd;">-1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> cur_pos&lt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> cur_pos=<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> k=<span style="color: #33ffdd;">30</span><br />
cur_pos=cur_pos<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> cur_pos&gt;Len<span style=" ">&#40;</span>s<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> cur_pos=<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>s<span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> k=<span style="color: #33ffdd;">1</span><br />
cur_pos=<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> k=<span style="color: #33ffdd;">2</span><br />
cur_pos=<span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>s<span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #aaffff; font-weight: bold;">Viewport</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> s$<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Полученную функцию можно подогнать под Вашу программу и использовать. Основной принцип я объяснил.
</p><p>Удачного кодинга!
</p>
<div align="right"><a href="http://blitzetcetera.org/images/1/1c/TextEntering.bb" class="internal" title="TextEntering.bb">скачать исходный код</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Grover" title="Участник:Grover">Grover</a> (e-mail: mail_grover@mail.ru)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Боксинг (на примере создания авто FordKa)"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Боксинг (на примере создания авто FordKa)&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Боксинг (на примере создания авто FordKa)&amp;action=edit">править</a>]</span><span class="mw-headline">Боксинг (на примере создания авто FordKa)</span></h1>
<p>Статья рассчитана на людей, уже знакомых с интерфейсом 3ДМакса и имеющих опыт моделлинга. В статье используется английский восьмой 3ДМакс. Этот способ очень универсален и сделать с помощью него можно все что угодно. В этом уроке гнался не за качеством, а за наглядностью. И так приступим. Для начала надо выбрать скетч того что вы хотите сделать (хотя это не обязательно). Идем в Views -&gt; ViewportBackground и устанавливаем там Match Bitmap, Lock Zoom/Pan и All Views.
</p>
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing01.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing01.jpg" src="sdyp4heh.jpg" width="704" height="490" /></a></span></div></div>
<p>Затем жмете Files... и выбираете нужный скетч или чертеж. Я выбрал это:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing02.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing02.jpg" src="f-fno64m.jpg" width="704" height="490" /></a></span></div></div>
<p>Смело жмем Ок и приступаем к основной части работы. В Left'e я создал бокс 4/4/4, выровнял по боковому и верхнему чертежу. 
(Конечно можно взять и большее количество сегментов, от этого повысится точность модели, но работать будет в разы сложнее.)
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing03.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing03.jpg" src="ok1bog_m.jpg" width="704" height="490" /></a></span></div></div>
<p>Теперь конвертите бокс в EditPoly, нажав во вкладке Modify, правой кнопкой на Box и там выбираете EditablyPoly. Начинаете обводить корпус авто по контуру. Я начал слева.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing04.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing04.jpg" src="41qmnty7.jpg" width="706" height="476" /></a></span></div></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing05.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing05.jpg" src="vr6yyis7.jpg" width="706" height="477" /></a></span></div></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing06.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing06.jpg" src="2g2thvl5.jpg" width="704" height="490" /></a></span></div></div>
<p>Тоже самое делаем с передом.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing07.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing07.jpg" src="41qmnty7-2.jpg" width="704" height="490" /></a></span></div></div>
<p>Теперь с верхом
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing08.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing08.jpg" src="506qy8i3.jpg" width="706" height="490" /></a></span></div></div>
<p>После всех проведенных операций наш бокс начал приобретать форму.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing09.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing09.jpg" src="pi5fn6ii.jpg" width="703" height="490" /></a></span></div></div>
<p>Применяем модификатор Smooth, чтоб увидеть все основные дефекты.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing10.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing10.jpg" src="5jk4a0uf.jpg" width="704" height="490" /></a></span></div></div>
<p>Коллапсим этот модификатор (правой кнопкой по модификатору, выбираем Collapse All, отвечаем Yes) и сглаживаем ВСЕ те места где получились наиболее острые углы. Используйте CUT в Editable Poly, он разрезает полигоны на пополам. Модель должна выглядеть ровной даже с модификатором.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing11.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing11.jpg" src="zo49v0hx.jpg" width="704" height="490" /></a></span></div></div>
<p>В конце концов у меня получилось это:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing12.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing12.jpg" src="z6oxfa1i.jpg" width="704" height="490" /></a></span></div></div>
<p>Я применил 32 уровень сглаживания в модификаторе Smooth чтобы посмотреть на модель с максимальным уровнем сглаживания (смуф, это сглаживание не повышающее сложность сетки. То есть количество полигонов остается прежним, а качество модели повышается. Смуф поддерживается практически любым движком).
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing13.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing13.jpg" src="07ypig28-2.jpg" width="704" height="490" /></a></span></div></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing14.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing14.jpg" src="kh72vn2-3.jpg" width="704" height="490" /></a></span></div></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing15.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing15.jpg" src="6b4ipcvr.jpg" width="704" height="490" /></a></span></div></div>
<p>Далее создаем прорез для колеса. Надо создать цилиндр. 8 сегментов будет вполне достаточно.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing16.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing16.jpg" src="lifumhdz.jpg" width="704" height="490" /></a></span></div></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing17.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing17.jpg" src="9do1raqe.jpg" width="704" height="490" /></a></span></div></div>
<p>Далее саттачиваем все 4 цилиндра (один из цилиндров надо конвертить в Edit Poly, в нем выбрать Attach а затем выбрать все цилиндры, они станут одной моделью) и булем прорезаем дыры в корпусе (Create -&gt; Geometry -&gt; Compound Objects -&gt; Boolean). Конвертим это в EditPoly.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing18.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing18.jpg" src="xtqfogoi.jpg" width="704" height="490" /></a></span></div></div>
<p>Теперь будем искать порванные вертексы, это значит что на одной координате находятся 2 вертекса, полигоны получаются как бы порваными. Их надо склеить, иначе позже будут проблемы с булем и вообще это непростительная ошибка в модели. Применим модификатор STL Check -&gt; Open Edges, SelectEdges и ставим галочку на против Check. Status Error показывает количество рваных вертексов.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing19.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing19.jpg" src="dsl8a09c.jpg" width="704" height="490" /></a></span></div></div>
<p>А если включить Wireframe, то можно увидеть сами порванные места.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing20.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing20.jpg" src="ea1_prjp.jpg" width="703" height="490" /></a></span></div></div>
<p>Снова переходим к EditPoly, выделяем точку. 2 Vertices Selected означает что сейчас выделенно 2 вертекса.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing21.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing21.jpg" src="9do1raqe-2.jpg" width="704" height="490" /></a></span></div></div>
<p>Их надо сколлапсить (лучше забиндить коллапс на клавишу, т.к. коллапсить придется много). Коллапс находится здесь 
же, в Editable Poly, Collapse называется. Надо постоянно возвращаться к STLCheck и контролировать количество и расположение ошибок. В конце концов ошибок не осталось. Я все сколлапсил.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing22.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing22.jpg" src="07ypig28-3.jpg" width="704" height="490" /></a></span></div></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing23.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing23.jpg" src="3h0k_1zt.jpg" width="704" height="490" /></a></span></div></div>
<p>Делаем вырез внутри.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing24.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing24.jpg" src="j0ld-bi0.jpg" width="704" height="490" /></a></span></div></div>
<p>Вырезаем двери и окна, постоянно следим за STLChech и порванными вертексами. Много вертексов коллапсим.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing25.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing25.jpg" src="f-fno64m-2.jpg" width="704" height="490" /></a></span></div></div>
<p><br />
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing26.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing26.jpg" src="x86qh9wc.jpg" width="703" height="490" /></a></span></div></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing27.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing27.jpg" src="054bq1kf.jpg" width="704" height="490" /></a></span></div></div>
<p>Делаем двери (для создания дверей пользуйтесь магнитом, чтобы четко передать контур. Обязательно надо щелкнуть правой кнопкой на значке магнита, на панели инструментов и поставить галочку Vertex, убрав все другие. Теперь магнит будет магнитить к вертексам).
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing28.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing28.jpg" src="dqriiirk.jpg" width="706" height="490" /></a></span></div></div>
<p><br />
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing29.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing29.jpg" src="8vyz2je2.jpg" width="704" height="490" /></a></span></div></div>
<p>Далее колеса.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing30.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing30.jpg" src="n1-aa0y_.jpg" width="704" height="490" /></a></span></div></div>
<p>Все! Лоуполи модель готова. Осталось только затекстурить и можно добавлять в какой ни будь Вайс или Мафию.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing31.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing31.jpg" src="_wjh4t-p.jpg" width="704" height="490" /></a></span></div></div>
<p>Иногда возникает желание сделать рендер красивее. Это очень просто. Создавайте под машиной плоскость. Далее Create -&gt; Lights -&gt; Standart -&gt; Skylight. Устанавливайте в любое место сцены. Настройки не трогаем. Далее жмем меню Rendering -&gt; Render... Выбираем вкладку Advanced Lighting и выбираем Light Tracer. Настройки не трогаем, жмем рендер и наслаждаемся красивой, мягкозатененной картинкой.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing32.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Boxing32.jpg" src="j4no38_i.jpg" width="680" height="490" /></a></span></div></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php?title=%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Norton&amp;action=edit" class="new" title="Участник:Norton">Norton</a> (ICQ: 205-844-597), 2006<br />
Если возникли какие либо вопросы, стучитесь в аську
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Анекдоты и шутки в тему"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Анекдоты и шутки в тему&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Анекдоты и шутки в тему&amp;action=edit">править</a>]</span><span class="mw-headline">Анекдоты и шутки в тему</span></h1>
<p>Программист в церкви:
</p>
</p>
<p><dl><dd>Да освятится имя твоё и расширение твоё, Господи...
</dd></dl>
</p>
<hr />
<p>Семь бед - один Reset!
</p>
<hr />
<p>Ничто так не ограничивает полёт мысли программиста, как компилятор...
</p>
<hr />
<p>Я yгадаю этy пpогpаммy с 7 байт...
</p>
<hr />
<p>Hе забуду мать родную - ZX Spectrum навсегда!
</p>
<hr />
<p>Программист-прикладник является приложением к компьютеру, операционной системе и тому начальнику, который говорит, что же ему надо сделать.
</p>
<hr />
<p>Если бы строители строили дома так, как программисты пишут программы, то первая залетевшая в форточку муха разрушила бы цивилизацию.
</p>
<hr />
<ul><li> Чем отличается начинающий программист от законченного? 
</li><li> Начинающий считает, что в килобайте 1000 байт, а законченный - что в килограмме 1024 грамма.
</li></ul>
<hr />
<p>"Hello World!" 17 errors, 31 warnings
</p>
<hr />
<p>Телефонный звонок
</p>
<ul><li> Алллллооооу.
</li><li> Это телефон 444-4444?
</li><li> Даааа.
</li><li> Тогда вызовите, please, скорую, у меня палец в диске телефона застрял.
</li></ul>
<hr />
<p>Едут в машине бизнесмен, инженер и программист. Тут с машиной что-то случается и она останавливается.
</p>
<ul><li> Инженер: Cейчас движок посмотрим, отремонтируем, минут через 40 дальше поедем.
</li><li> Бизнесмен: Да ну, сейчас я друзьям по сотовому телефону позвоню - они нам новую машину сюда пригонят.
</li><li> Программист: А может мы все выйдем из машины, потом опять загрузимся и она дальше поедет?
</li></ul>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Avel" title="Участник:Avel">Агнислав Липкан</a> (e-mail: avelnet@yandex.ru)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="В следующем выпуске (выпуск 7)"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:В следующем выпуске (выпуск 7)&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=В следующем выпуске (выпуск 7)&amp;action=edit">править</a>]</span><span class="mw-headline">В следующем выпуске (выпуск 7)</span></h1>
<p>Будет статья Dimanche13 про лайф-бары, статья Агнислава Липкана про движки, а также новая статья Grover'а о разработке клиент-серверного приложения.
</p>
</p><p>Кстати, работа над структурой журнала еще не закончена, вот список того, что будет сделано:
</p>
<ul><li>Добавлены zip-архивы выпусков журнала, списка статей, сборника кода
</li><li>Все приложения к выпускам викифицированы (переведены в формат Вики)
</li><li>Ссылки на архив с исходниками+медиа для каждой статьи
</li><li>Возможность выбора старого дизайна журнала
</li><li>Некоторые косметические доработки 
</li><li>Думаю, много чего еще, по мере поступления новых идей
</li></ul>
<p align="right">
редактор журнала Матвей Меркулов (MattMerk@mail.ru, ICQ: 392-274-050)
</p>
<p><!-- 
Pre-expand include size: 333623 bytes
Post-expand include size: 249811 bytes
Template argument size: 348 bytes
Maximum: 2097152 bytes
-->
</p>
<!-- Saved in parser cache with key db1:pcache:idhash:690-0!1!0!!ru!2 and timestamp 20071112100329 -->
<div class="printfooter">
Получено с <a href="vwin1xym.html">http://blitzetcetera.org/index.php/%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%967_-_%D0%BE%D0%BA%D1%82%D1%8F%D0%B1%D1%80%D1%8C_2007</a></div>
			<!-- end content -->			<div class="visualClear"></div>				</td>				<td class="rightside">				</td>			</tr>		</table>		</div>	</div>		</div>	
		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</div></body>
<!-- Mirrored from localhost/index.php/%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%967_-_%D0%BE%D0%BA%D1%82%D1%8F%D0%B1%D1%80%D1%8C_2007 by HTTrack Website Copier/3.x [XR&CO'2007], Mon, 12 Nov 2007 11:20:26 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>