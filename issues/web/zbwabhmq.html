<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru" dir="ltr">	
<!-- Mirrored from localhost/index.php/%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%965_-_%D0%B4%D0%B5%D0%BA%D0%B0%D0%B1%D1%80%D1%8C_2005 by HTTrack Website Copier/3.x [XR&CO'2007], Mon, 12 Nov 2007 11:20:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />				<meta name="keywords" content="Выпуск №5 - декабрь 2005,Impersonalis,MANIAK dobrii,Matt Merkulov,Jimon" />
		<link rel="shortcut icon" href="http://blitzetcetera.org/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="http://blitzetcetera.org/opensearch_desc.php" title="Blitz Et Cetera (Русский)" />
		<title>Выпуск №5 - декабрь 2005 — Blitz Et Cetera</title>		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "bvih5rde.css?63"; /*]]>*/</style>		<link rel="stylesheet" type="text/css" media="print" href="gcxktlm6.css?63" />		<link rel="stylesheet" type="text/css" media="handheld" href="zumsslq_.css?63" />		<!--[if lt IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE50Fixes.css?63";</style><![endif]-->		<!--[if IE 5.5000]><style type="text/css">@import "/skins/OfflineNew/IE55Fixes.css?63";</style><![endif]-->		<!--[if IE 6]><style type="text/css">@import "/skins/OfflineNew/IE60Fixes.css?63";</style><![endif]-->		<!--[if IE 7]><style type="text/css">@import "/skins/OfflineNew/IE70Fixes.css?63";</style><![endif]-->		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?63"></script>		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->		<script type= "text/javascript">/*<![CDATA[*/
var skin = "OfflineNew";
var stylepath = "/skins";
var wgArticlePath = "/index.php/$1";
var wgScriptPath = "";
var wgServer = "http://blitzetcetera.org/";
var wgCanonicalNamespace = "";
var wgCanonicalSpecialPageName = false;
var wgNamespaceNumber = 0;
var wgPageName = "Выпуск_№5_-_декабрь_2005";
var wgTitle = "Выпуск №5 - декабрь 2005";
var wgAction = "view";
var wgArticleId = "632";
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "ru";
var wgContentLanguage = "ru";
var wgBreakFrames = false;
var wgCurRevisionId = "3642";
/*]]>*/</script>
		<script type="text/javascript" src="2nq-6cel.js?63"><!-- wikibits js --></script>		<script type="text/javascript" src="http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=js"><!-- site js --></script>		<style type="text/css">/*<![CDATA[*/
@import "http://blitzetcetera.org/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=MediaWiki:OfflineNew.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
@import "http://blitzetcetera.org/index.php?title=-&amp;action=raw&amp;gen=css&amp;maxage=18000";
/*]]>*/</style>		<!-- Head Scripts -->	</head><body  class="mediawiki ns-0 ltr page-Выпуск_№5_-_декабрь_2005">	<div id="globalWrapper">	<div id="logocontainer">		<table align="center">		  <tr>				<td id="blitzetclogo">				</td>			</tr>		</table>	</div>	<div id="magbar">	Журнал о программированнии на языках Blitz3D, BlitzMax, BlitzPlus	</div>		<div id="column-content">	<div id="content">		<a name="top" id="top"></a>				<div id="bodyContent">		<table cellspacing=0 cellpadding=0 width=100%>			<tr>			  <td class="leftside">				</td>				<td class="sheetbody">					<h1 class="sheet">Выпуск №5 - декабрь 2005</h1>			<h3 id="siteSub">Материал из Blitz Et Cetera.</h3>			<div id="contentSub"></div>			<!-- start content -->			<a name="Contents"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%965_-_%D0%B4%D0%B5%D0%BA%D0%B0%D0%B1%D1%80%D1%8C_2005&amp;action=edit&amp;section=1" title="Править секцию: Contents">править</a>]</span> <span class="mw-headline">Contents</span></h2>
<ul><li>Вступление
<ul><li><a href="#Предисловие редактора (выпуск 5)">Предисловие редактора (выпуск 5)</a>
</li><li><a href="#Почта (выпуск 5)">Почта (выпуск 5)</a>
</li></ul>
</li><li>Разработки
<ul><li><a href="#Создаём свой First Person Shooter">Создаём свой First Person Shooter</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Impersonalis" title="Участник:Impersonalis">Impersonalis</a> 
</li><li><a href="#Как сделать «Asteroids» за час">Как сделать «Asteroids» за час</a> - Wave, перевел <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:MANIAK_dobrii" title="Участник:MANIAK dobrii">MANIAK dobrii</a> 
</li><li><a href="#Стрельба на опережение">Стрельба на опережение</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> 
</li><li><a href="#Лабиринты">Лабиринты</a> - Лыхин Д. 
</li><li><a href="#Скрипты">Скрипты</a> - <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> 
</li></ul>
</li><li>Свободный полет
<ul><li><a href="#Заметки  от Джимона">Заметки  от Джимона</a> - <a href="http://blitzetcetera.org/index.php?title=%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Jimon&amp;action=edit" class="new" title="Участник:Jimon">Jimon</a> 
</li></ul>
</li></ul>
<p></td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Предисловие редактора (выпуск 5)"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Предисловие редактора (выпуск 5)&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Предисловие редактора (выпуск 5)&amp;action=edit">править</a>]</span><span class="mw-headline">Предисловие редактора (выпуск 5)</span></h1>
<p>Вот вышел и пятый, посдедний выпуск журнала. Я решил закрыть журнал, думаю, вы догадываетесь почему. Иссяк источник энтузиазма, а с ним и поток статей. Добавлю еще то, что журнал разросся и его стало трудно обновлять, да и с подпиской криво вышло. Эти проблемы мог бы частично решить переход на профессиональный уровень, однако пока это мне не по зубам.
</p>
</p><p>За 5 месяцев пришли две большие статьи - о создании 3D-боевика от первого лица (Impersonalis) и клона Asteroids (Wave, MANIAK_Dobrii), а также нессколько заметок от Джимона. Еще я нашел интересную статью про лабиринты (ZX-ревю-4'97) и написал статьи о пушке, стреляющей на опережение и скриптах (сценариях) в играх.
</p><p>Ну и в заключение я хотел бы поблагодарить всех, кто участвовал в создании журнала и тех, кто просто помог добрым словом.
</p><p>С наилучшими пожеланиями, 
</p>
<div align="right">Матвей Меркулов</div>
<p></td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Почта (выпуск 5)"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Почта (выпуск 5)&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Почта (выпуск 5)&amp;action=edit">править</a>]</span><span class="mw-headline">Почта (выпуск 5)</span></h1>
</p>
<a name=".D0.9F.D0.B8.D1.81.D1.8C.D0.BC.D0.BE_.D0.BE.D1.82_.D0.A1.D0.B5.D1.80.D0.B3.D0.B5.D1.8F_.D0.91.D0.B5.D1.80.D0.B5.D0.BD.D0.B4.D0.B0.D0.BA.D0.BE.D0.B2.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9F%D0%BE%D1%87%D1%82%D0%B0_%28%D0%B2%D1%8B%D0%BF%D1%83%D1%81%D0%BA_5%29&amp;action=edit&amp;section=1" title="Почта (выпуск 5)">править</a>]</span> <span class="mw-headline">Письмо от Сергея Берендакова</span></h2>
<p>Привет. Прежде всего, поблагодарю за журнал, думаю, он незаменим новичкам, да и я подчерпнул из него парочку штуковин.
Причина, побудившая меня написать письмо это проблемы с моделированием в 3DSMAX (хорошо что у меня нету проблем в самом
программировании (пока нету)), если точнее, то скелетная анимация и все что связанно с костями. МАКС у меня древний (4
версия), да и вообще у нас в Казахстане софта не найдешь, просто нету (интересно почему). Может кто-нибудь прочтет письмо и
решит написать статейку о скелетной анимации, так как в интернете информации нормальной я не нашел (просто интернет ну очень
дорогой, долго не "посидишь"). Также хотелось бы увидеть (ну это только мое мнение) работу в программах создания карт
форматом BSP (например, GTKRadiant, кстати, сам начал с ним разбираться).   
</p><p>А теперь комплименты.
<p>Понравился обзор игр в одном из прошлых номеров (вот если бы обзор новых игр созданных на Blitz3D, было б круто), обзор
акселераторов тоже ничё.
</p>
</p><p>Наверное, ты, читая письмо, думаешь: "вот +.. сидит там, а мы тут ему паши". Пожалуйста, ты так не думай, все что было
<p>изложено выше можно воспринимать как мысли в слух, но если кто-то собрался помочь то я в долгу не останусь тоже помогу чем
смогу (только скажите).
</p>
</p><p>В общем это все что хотелось сказать, спасибо за внимание.
</p>
<p><dl><dd>С уважением Берендаков Сергей aka Zigl (<a href="http://ziglsoft.narod.ru/" class="external text" title="http://ziglsoft.narod.ru" rel="nofollow">Мой небольшой сайт</a>)
</dd></dl>
</p>
<hr />
<p>Привет
</p>
<p><dl><dt>Причина, побудившая меня написать письмо это проблемы с моделированием в 3DSMAX (хорошо что у меня нету проблем в самом программировании (пока нету)), если точнее, то скелетная анимация и все что связанно с костями.
</dt></dl>
</p>
<p>К пятому выпуску планирую доработать приложение - учебник по
моделированию. Там будут главы в т. ч. про создание скелета и привязку
модели к нему.
</p>
<p><dl><dt>Понравился обзор игр в одном из прошлых номеров (вот если бы обзор новых игр созданных на Blitz3D, было б круто)
</dt></dl>
</p>
<p>Неплохая идея.
</p>
<p><dl><dt>Наверное, ты, читая письмо, думаешь "вот +.. сидит там, а мы тут ему паши". Пожалуйста, ты так не думай, все что было изложено выше можно воспринимать как мысли в слух, но если кто-то собрался помочь то я в долгу не останусь тоже помогу чем смогу (только скажите)
</dt></dl>
</p>
<p>Все в порядке. Да, вначале меня раздражали некоторые высказывания (в частности, неконструктивная критика). Теперь спокойно к этому отношусь. А вот читать про вещи, которые читатель хотел бы видеть в журнале, мне интересно. Вряд ли я буду по всем темам писать статьи, но на заметку возьму.
</p>
<p><dl><dd>Matt
</dd></dl>
</p>
<a name=".D0.9F.D0.B8.D1.81.D1.8C.D0.BC.D0.BE_.D0.BE.D1.82_.D0.9A.D0.BE.D1.81.D0.B0.D1.80.D0.B5.D0.B2.D0.B0_.D0.9A.D0.BE.D0.BD.D1.81.D1.82.D0.B0.D0.BD.D1.82.D0.B8.D0.BD.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9F%D0%BE%D1%87%D1%82%D0%B0_%28%D0%B2%D1%8B%D0%BF%D1%83%D1%81%D0%BA_5%29&amp;action=edit&amp;section=2" title="Почта (выпуск 5)">править</a>]</span> <span class="mw-headline">Письмо от Косарева Константина</span></h2>
<p>Здравствуйте Матвей.
</p><p>Скачал в сети ваши журналы. Очень понравились. В основном нравится практичность, т.е. ставиться конкретный вопрос и пишется на него ответ.
</p><p>Не так давно, мне на глаза попался в магазине диск с Blitz Basic`ом.
<p>Сам не знаю, зачем я его купил, но, установив его (Blitz3D) дома, он мне чем-то понравился.
Наверное, напомнил ZX Spectrum. Там Basic также был очень простым.
Но теперь у меня есть вопрос, и очень надеюсь, что у вас есть на него ответ.
Как известно, ќскоро› должна (рано или поздно) выйти в свет новая версия ОС Windows (code 
name Longhorn).
</p>
</p><p>В довесок ко всему, я, где-то вычитал, что часть функций DirectX 6 из этой ОС будут самым 
<p>наглым образом искоренены. Эти функции не оставят даже из соображений совместимости. Так 
понимаю, эти самые функции, каким то боком относятся к старому железу, которое все равно 
новую ОС не потянет, а значит, и нет смысла его поддерживать. (Но это только мое мнение).
Следовательно, мой вопрос таков.. А продолжают ли работать разработчики над самим Blitz 3D 
(не Blitz Max), в том плане, что будет ли он когда-либо поддерживать DirectX 9 и выше, а 
то неровен час, что и из DirectX 7 ненароком, что-то вырежут (что-то жизненно важное для 
Blitz Basic).
</p>
</p><p>В принципе я не против пользоваться Blitz Max`ом, но Blitz 3D, мне нравился больше.
<p>Здесь правда есть одна оговорка, Blitz Max, я рассматривал в сумме максимум час, но, 
наверное, в меру своей ограниченности, не понял, как там использовать 3D графику, и 
возможно ли оно в принципе.
И честно говоря, статьи на эту тему в Вашем журнале я тоже пропустил. (Точнее бегло 
просмотрел).
</p>
</p><p>В общем, 
</p>
<p><dl><dd>Журнал Хороший! 1
<dl><dd>Так держать 2
<dl><dd>Желаю удачи 3
<dl><dd>И надеюсь на ответ, на мой вопрос 4
</dd></dl>
</dd></dl>
</dd></dl>
</dd></dl>
</p>
<p>С уважением Косарев Константин.
</p>
<hr />
<p>Добрый день
</p><p>Не знаю, собирается ли Марк (и как скоро) встраивать в B3D
<p>поддержку Directx 8-9 (мне самому очень интересно, будут ли в B3D
шейдеры), но где-то на сайте Марк писал, что Blitz3D и BlitzMAX будут
разрабатываться параллельно, соответственно, проект Blitz3D не будет
закрыт в связи с разработкой BlitzMAX. Если учесть еще то, что Blitz3D
пока что популярнее остальных продуктов в разы, то IMO опасаться
несовместимости с LongHorn не стоит: даже если и будут проблемы с
этим, то и решаться они тоже будут.
</p>
</p><p>Насколько мне известно, в BlitzMax трехмерщина пока создается с
<p>помощью OpenGL напрямую (посредством использования OpenGLовских
команд), поэтому в удобстве создания 3D BMAX пока уступает B3D - это
да. Поэтому многие (в т. ч. и я) не спешат с переходом.
</p>
</p><p>Matt
</p>
<hr />
<p>Доброго времени суток Матвей.
</p><p>Спасибо за ответ, обнадежил. Остается надеяться, что Марк не откажется от своих слов, и будет продолжать работать над 
<p>своей программой. Слишком B3D вышел удачным, на мой взгляд, чтобы его забрасывать. Считать 
так, у меня есть на это все основания. Если я, не являясь программистом, сумел сделать 3D 
сцену в виде небольшой холмистой местности, с домами столбами и деревьями (и прочими 
атрибутами обычной улицы), то можно представить на что способны профессиональные 
программисты.
</p>
</p><p>Нужно только оговориться, что я, не обладая достаточными художественными данными,
<p>наглым образом стянул текстуры с игр GTA Vice City и Far Cry.
В Far Cry облака (очень они там симпатично нарисованы),
в GTA Vice City текстуры кирпичей, травы и т.п.
Надеюсь разработчики на меня не в обиде&nbsp;:)
У меня друзья учатся сейчас в институте на программистов (уже заканчивают). Ну так вот они 
говорят Что С++ круче, а  Basic (они же не знают про B3D, который от Basic`a заимствовал 
по моему только простоту ) отстой, и программируют на нем только тормоза. Возможно, они 
правы. 
Непонятно другое, почему на просьбу показать свои великолепные программы, написанные на не 
менее великолепных языках С++ и Delphi, превосходящие по качеству мои Бейсиковские, они 
постоянно ссылаются на профессиональных программистов.
</p>
</p><p>Я не отрицаю, С++ во много мощнее, универсальнее. Но он во столько же менее удобен. И 
<p>тяжелее в понимании. И если уже говорить об универсальности, тогда лучше программировать 
на ассемблере, вот где безграничные возможности.
Кстати в изучении он на мой взгляд гораздо проще  чем С++. Нужно иметь только хорошее 
логическое мышление и желательно феноменальную память (на случай если часто пишешь 
драйвера для железа, а то придется при себе держать талмуд с описанием всех портов и 
прерываний на каждую конкретную железку). 
</p>
</p><p>Blitz 3D дает прекрасную возможность освоить азы (и не только азы) 3D графики, и 
<p>программирования в частности, что в последствии позволит проще перейти на другой язык 
программирования. Здесь главное не зациклиться на одном языке, а то в последствии сложнее 
будет переучиваться. Как мне кажется, в программировании главное понять принцип, и четко 
представлять чего ты хочешь добиться от своей программы, а на каком языке будет 
реализовано твое творение, не столь важно. Главное, чтобы этот язык отвечал требованиям, 
которые накладывает на него программа и сам программист (причем программист не в последнюю 
очередь).
</p>
</p><p>И вот в связи с этими словами хочется отметить Вашу статью Матвей,  Обзор технологий, 
<p>используемых в играх , для начинающих программистов, эта статья должна иметь большую 
ценность. Я сам как начинающий (надеюсь все-таки программист), почерпнул много нового и 
интересного. Для меня сейчас важнее упорядочить все знания в своей голове, чтобы не 
хвататься сразу за все, и в скором времени бросать. Ваша статья именно это и делает. Т.е. 
дает, четкое представление как устроены игры, и раскладывает в голове все по полочкам.
Также хочется отметить статью  Неофициальная спецификация формата файлов "B3D" V0.2 
Просто днем раньше я искал описание этого формата. А оно под рукой.
Собственно весь журнал в целом очень интересен. К примеру, ваши задания в конкурсе,
казалось бы чего проще поменять две переменные местами, но я  всегда (на уроках 
информатики, в школе) это делал посредством третей переменной, а о варианте&nbsp;:
</p>
</p>
<p><dl><dd>а = а + в
</dd><dd>в = а - в
</dd><dd>а = а - в 
</dd></dl>
</p>
<p>я даже и не пытался думать. Открыли так сказать глаза&nbsp;:)
</p><p>В общем успехов Вам и Вашему журналу.
<p>Надеюсь на скорые выпуски с еще более интересными статьями.
</p>
</p><p>С Уважением Косарев Константин.
</p>
<hr />
<p>Привет
</p>
<p><dl><dt>Слишком B3D вышел удачным, на мой взгляд, чтобы его забрасывать. Считать
</dt></dl>
</p>
<p>так, у меня есть на это все основания. Если я, не являясь программистом, сумел сделать 3D
сцену в виде небольшой холмистой местности, с домами столбами и деревьями (и прочими
атрибутами обычной улицы), то можно представить на что способны профессиональные
программисты.
Интересно. А весит много? Хотелось бы посмотреть.
</p>
<p><dl><dt>У меня друзья учатся сейчас в институте на программистов (уже заканчивают). Ну так вот они
</dt></dl>
</p>
<p>говорят Что С++ круче, а  Basic (они же не знают про B3D, который от Basic`a заимствовал
по моему только простоту ) отстой, и программируют на нем только тормоза. Возможно, они
правы.
</p><p>Старый стереотип. Возможно, они так думают из-за того, что в данный
<p>момент самый известный интерпретатор на основе Бейсика - Visual Basic
уступает по многим параметрам тем же C и Delphi, хотя возможностей у
него тоже немеряно.
</p>
</p><p>Что касается остальной части письма - я полностью согласен с Вами.
<p>Каждый язык удобен для решения задач, на которые он ориентирован,
поэтому Blitz хорошо подходит для написания проектов малого и среднего
размера в одиночку и небольшим коллективом. Если какие-то задачи
требуют большой скорости - их реализовывать придется на C или
ассемблере, создав собственную библиотеку. В этом случае, самая
большая опасность - упереться в "потолок" языка, когда дальнейшее
развитие проекта будет невозможно, тогда придется переносить код на C
или другой язык.
</p>
</p><p>WBR, Matt
</p>
<a name=".D0.9F.D0.B8.D1.81.D1.8C.D0.BC.D0.BE_.D0.BE.D1.82_.D0.93.D0.BE.D0.BD.D1.82.D0.B0.D1.80.D1.8F_.D0.94.D0.BC.D0.B8.D1.82.D1.80.D0.B8.D1.8F_.D0.90.D0.BB.D0.B5.D0.BA.D1.81.D0.B0.D0.BD.D0.B4.D1.80.D0.BE.D0.B2.D0.B8.D1.87.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9F%D0%BE%D1%87%D1%82%D0%B0_%28%D0%B2%D1%8B%D0%BF%D1%83%D1%81%D0%BA_5%29&amp;action=edit&amp;section=3" title="Почта (выпуск 5)">править</a>]</span> <span class="mw-headline">Письмо от Гонтаря Дмитрия Александровича</span></h2>
<p>Здравствуйте!
</p><p>После долгих скитаний поинтернету я нашел то до чего когдато  долгими
<p>головоломными ночами пытался разработать сам, типа вашей статьи "Курс 
молодого бойца".
</p>
</p><p>Тогда очень уж хотелось проникнуть и узнать логику работы игр, чтобы можно 
<p>было воссоздать хоть какойто свой "шедевр". Начинал я ещё с ZX-Spectrum'a, 
но у меня ничего не получалось(в плане скорости)  потому что я ещё незнал о системе 
формирования изображения в BackBuffer'e. Переядя на IBM, скорость у 
компьютера была побольше, было не так уж туго(QBasic) но вcё равно чегото 
нехватало. Взялся я за C++, но это были такие дебри(килограммы кода)  что и 
начинаешь забывать что ты от него хочешь.
</p>
</p><p>Ну вот и наконец нарисовался Blitz, я думаю у него большое будущее, 
<p>старые поклонники Basic'a не оставят его в покое да и Game'писатели тоже.
</p>
</p><p>Ваш журнал это большое открытие для начинающих Game'писателей, Большое 
<p>спасибо вам за это помощ для них, это им очень пригодится.
</p>
</p><p>И ещё хочу сказать "Молодым бойцам":
</p>
<ul><li> Что не стоит начинать сразу с глобального проекты, вы просто увязнете в мегабайтах кода, надо начинать от простого к сложному.
</li><li> Самый главный этап создания ЛЮБОЙ игры это проектирование, плохо спроектированная или вообще неспроектированная игра занимает столько времени на программирование и отладку(если вообще будет работать), что когда они готовы, то обычно быстродействие и качество её работы бывает неудовлетворительным. Начинающим прогр-ам будет очень дорого стоить пренебрежение этим этапом(собственный опыт это показал). Начинающему не терпится начать программирование, он полагает, что методом проб и ошибок, внося коррективы в программу по ходу разработки, решит все проблемы. Опытный программист, наоборот, отдаёт половину своего времени именно этой работе без компьютера, потому что знает, что когда коррекций в программе становится слишком много, то они начинают влиять друг на друга и быстро губят всю работу.(сначало проектирование потом программирование)
</li><li> Нестоит писать слишком головоломные процедуры, код должен быть простым и понятным, нестоит и забывать о главных законах "если размер кода возрастёт вдвое, то количество ошибок в нём возрастёт в 4 раза"  и "если количество ошибок возрастает в двое, то время на их отыскание и устранение тоже возрастает в 4 раза"
</li><li> Пути сокращения ошибок
<ul><li>Сначала проектирование - программирование потом
</li><li>Структурируйте программу
</li><li>Документируйте программу комментариями, используйте интуитивно понятные переменные
</li><li>Старайтесь писать как можно меньше кода. Максимально используйте свои старые процедуры, копируйте похожие куски программы
</li><li>Будьте проще. Пишите простой код. Не пользуйтесь без особой нужды головоломными приёмами.
</li></ul>
</li></ul>
<p>Хотелось бы увидеть в вашем журнале: "ZX-Spectrum Game  переносим на Blitz", хитрые алгоритмы, работа с LPT портом(если возможна), доска объявлений, автоматическая рассылка по Email, конкурсы, задачи.
</p><p>Желаю удачи!
</p>
<p><dl><dd>Гонтарь Дмитрий Александрович
</dd><dd>п.Эльбан,г.Комсомольск-на-Амуре
</dd></dl>
</p>
<p></td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Создаём свой First Person Shooter"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Создаём свой First Person Shooter&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Создаём свой First Person Shooter&amp;action=edit">править</a>]</span><span class="mw-headline">Создаём свой First Person Shooter</span></h1>
</p>
<a name=".D0.92.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=1" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Введение</span></h2>
<p>Всем привет!
</p><p>По опыту знаю: большинство хочет сразу после просмотра сэмплов сесть и написать FPS. И не просто какой-нибудь: УБЕЙ_ИХ_ВСЕХ_2010, а что-нибудь революционно-инновационное – с крутейшей графикой, умнейшим ИИ, и возможностью сетевой игры на разных протоколах и в разных игровых режимах, с абсолютной нелинейностью сюжета, причём всё это будет требовать смехотворно мало ресурсов. Если Вы именно такой пользователь THEN goto основы. Так как начинать с подобного рода программ – отбивать себе всякое желание программить на Блитце – попишите пока тетрисы, змейки и проч.
</p><p>Итак… FPS… конечно же 3D! Запускаем компилятор и смело вбиваем
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>чуть ниже организовываем цикл, это будет главный цикл программы MAIN LOOP. Оформляйте его любыми операторами цикла, я, лично, сделаю так:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Тут всё должно быть ясно как день:
</p>
<ul><li>Цикл крутится пока Не ПрерываниеОтКнопки (Escape)
</li><li>Команда END в данном случае – чистый формализм: после инструкции WEND у нас в коде ничего нет, таким образом, после выхода из цикла программа и так завершится. Но всё же я настоятельно рекомендую не пренебрегать подобными формальностями!
</li></ul>
<p>Уже можно давить F5 – и любоваться  … космосом… без звёзд…
Теперь займёмся камерой… даже - лучше сразу игроком 
Опять же: я настоятельно рекомендую заключать подобные знаковые участки кода в тела функций. Поэтому где-нибудь повыше напишем:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Если Вы затрудняетесь определить: «где же это самое то место» - в принципе Блитцу всё равно, но я настоятельно рекомендую объявлять все функции перед главным циклом (а так как это не С++, то и писать тела функций там же), а поскольку в функции будут использоваться команды работы с 3d-объектами объявить их надо после строчек
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Надеюсь, с местом определились. Теперь передаваемые в функцию аргументы… Думаю, удобно будет задавать ими место появления игрока. С другой стороны, практически всегда у нас он появляется в 0,h#,0 – в центре карты на небольшом расстоянии от земли, поэтому пишем следующее:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Теперь подумаем о физической модели игрока… В масштабах этого манула, позволительно допустить: игрока никто не видит, и камера как в FPS. Значит не стоит отвлекаться на фактический внешний вид игрока. У нас должна быть точка опоры и над ней (на некотором расстоянии) камера. А это, имхо, самый простой и надёжно работающий способ решения:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#</div>
<p>набираем мы в функции. Сам пользователь – это будет сфера (та самая точка) к которой прикреплена камера&nbsp;: в координатах 0,1,-0.5 относительно сферы. Камера прикрепляется сразу после создания, т.к. ей задан родитель (парент) в качестве аргумента. Затем происходит её позиционирование, и затем позиционирование самого игрока.
Запускаем… И снова темнота
А как по-вашему: у нас есть описание действия «создать игрока» и пустой цикл. Для начал надо вызвать функцию создания перед главным циклом:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">create_user<span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Затем: ну да – в памяти мы создали и сферку и камеру – а дальше то что? Как минимум надо это всё обработать как геометрические объекты и отрисовать в BackBuffer . Добавим в главном цикле команду:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Ещё одна неувязочка: на экране находится при двойной буферизации FrontBuffer, а менять содержимое буферов мы будем командой
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Flip</span></div>
<p>После такой перекройки программа должна выглядеть примерно так:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Снова запускаем – и опять темнота… Но на самом деле всё рисуется – сфера которую вы не видите, потому что «не можете наклонить голову» и… всё – больше в мире пока ничего нет.
</p><p>Нам нужна земная твердь. И обязательно текстурка для неё. Ведь компьютер без дополнительных инструкций строит идеальные видео образы – абсолютно ровную поверхность земли (на самом деле мелкие неровности пока тоже ничего бы не дали – нет освещения – которое и позволяет видеть объёмную картину мира , без света всё будет казаться «плосокватым») так что вы просто увидите светлый прямоугольник занимающий часть экрана. Для примера возьмем стандартную Блитц-текстуру.
</p><p>Опять же прибегая к упрощениям – земля будет в виде бесконечной ровной поверхности – создадим её плэйном:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-Terrain.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-Terrain.jpg" src="lvn6fvb4.jpg" width="256" height="256" /></a></span></div></div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>затем загрузим текстурку
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span></div>
<p>и наложим её на поверхность
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex</div>
<p>ну и для профилактики очистим память из под текстуры – она нам больше не понадобится:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex</div>
<p>Ах да всё это должно быть набрано после инициализации графики но перед циклом.
И ещё немного подумав, объединим вызов ф-ции создания игрока и создание мира в одну функцию:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Та-дам! Запускаем, наслаждаемся&nbsp;:D
</p>
<a name=".D0.9A.D0.BE.D0.B4.D0.B8.D0.BC-.D0.BA.D0.BE.D0.B4.D0.B8.D0.BC..."></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=2" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Кодим-кодим...</span></h2>
<p>Для практики: закомментируем команду текстурирования террайна и посмотрим на выполнение.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<p><span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;EntityTexture terrain,tertex</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Как я и обещал, видим светлый прямоугольник отхапавший часть экрана. Раскомментируем строчку обратно. 
Кстати о комментариях: не стоит ими пренебрегать но и объяснять всё подряд не стоит. 
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились&nbsp;:)</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Надеюсь, вы уже обучили Блитц понимать русский язык?  <a href="http://community.boolean.name/index.php?act=ST&amp;f=4&amp;t=25|Только" class="external text" title="http://community.boolean.name/index.php?act=ST&amp;f=4&amp;t=25|Только" rel="nofollow">по секрету</a>. Не стоит также пренебрегать грамотным форматированием кода:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились&nbsp;:)</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Вот…
</p><p>Так-с-с&nbsp;: на поверхность посмотрели – пора двигаться дальше. Будем учить игрока двигаться:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;обновление игрока</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Так получается, что к глазам игрока (камере) и его ногам (сфере) будут обращаться вне функции создания игрока. А значит надо сделать хендлы камеры и сферы глобальными. Для этого подготовим для их хранения глобальные переменные:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera</div>
<p>Теперь это уже не локальные переменные функции create_user, а глобальные всей программы.
Игрока мы будем обновлять на каждой итерации главного цикла, поэтому сразу допишем вызов соответствующей функции:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;обновление игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились&nbsp;:)</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Так… перейдём к программированию движений: для удобства объявим в нашей функции переменную, отвечающую за смещения по осям (никто не мешает вам сделать разную скорость для движения вперёд, назад и шагов влево-вправо)
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">V#=<span style="color: #33ffdd;">0.5</span></div>
<p>и кодируем движения нашей сферки (напомню: на ней укреплена камера)
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<p><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
</p>
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#</div>
<p>Запустим… результат, конечно зависит от производительности вашей машины, но, думаю, он не будет сильно разнится: при движении земля жутко мельтишит под ногами, так что невозможно даже оценить – в какую сторону мы сейчас двигаемся. Для устранения этого надо или понизить коэффициент скорости, или (что мы и сделаем ) растянуть текстурку:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tertex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><span style="color: #ffee00">;вот тута новое</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex</div>
<p>мир по-прежнему имеет весьма сомнительный вид, но уже лучше, чем было.Теперь займёмся обзорами местности.
Будем вращать камеру вверх-вниз в зависимости от смещения мыши по Y-оси и влево-вправо от смещения по X-оси.
Угу: как же ну смотрю я вправо… ещё вправо… опа: курсор упёрся в правый край экрана и всё. Значит после оценки изменений мы должны вернуть мышь на исходную – самое логичное, в центр экрана. Получить текущий размер экрана в пикселях по X и по Y можно функциями 
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>соответственно. Т.е. задвинуть мышь в центр экрана:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span></div>
<p>А снять перемещение мыши – измерив её скорость по осям:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>Но вот ещё загвоздка: если мы будем крутить только камеру, то получается: мы развернули камеру влево и нажали кнопку ВПЕРЁД, но наша опора то как стояла, так и стоит неразвёрнутой – в результате смотрим вбок и прём вперёд, а надо бы идти, туда куда смотрим. С другой стороны вращать только основу мы не можем по схожей причине: Уставились мы в небо и нажали ВПЕРЁД и наша основа полетела тоже в небо (даже если мы включим гравитацию, эффект останется – модуль скорости будет равен проекции вектора скорости на поверхность т.е. если мы задерём голову вверх – cos(90)=0 и мы не сможем двигаться).
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span></div>
<p>т.е. после доработок:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><br />
V#=<span style="color: #33ffdd;">0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Ндя…  неприятный осадок всё же остался: как это можно так задрать голову, что увидеть происходящее за спиной и ниже и сделать 360 градусный проворт головы?!
Модифим – теперь камера не будет превышать указанный нами угол вверх и вниз:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><br />
V#=<span style="color: #33ffdd;">0.5</span><br />
u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<ul><li>ABS-модуль
</li><li>EntityPitch# ( entity[,global] ) – угол вращения в плоскости Y0Z, т.е. вокруг оси X
</li><li>SGN – функция-знак
</li></ul>
<p>Если что не понятно - ставим курсор на функцию и кликаем 2 раза F1. 
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">1</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;обновление игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
V#=<span style="color: #33ffdd;">0.5</span><br />
u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tertex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились&nbsp;:)</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<a name=".22.D0.A7.D0.B5.D1.81.D1.82.D0.BD.D0.B0.D1.8F.22_.D1.84.D0.B8.D0.B7.D0.B8.D0.BA.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=3" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">"Честная" физика</span></h2>
<p>Так-с приступим к добавлению гравитации. Объявим где-нибудь в глобале переменную ускорения свободного падения
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> G#=<span style="color: #33ffdd;">1</span></div>
<p>Обратите внимание на идентификатор const (константа) и тип переменной (#-с плавающей точкой). Теперь надо реализовать контроль за отрывом от поверхности... Это можно сделать 2 способами через просчёт столкновений (Collisions) и через "пики" (Pick). С одной стороны, так как Collisions обрабатывается дольше, сложнее в коде... и самое главное так или иначе автоматически производит response - один из 3-х методов обработки столкновения:
</p>
<ol><li> stop 
</li><li> slide1 - full sliding collision 
</li><li> slide2 - prevent entities from sliding down slopes
</li></ol>
<p>С другой стороны обрабатывать это будет проще... впал в раздумья... короче делаем через collision. Добавим в глобал константы типов
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> USERT=<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;for user</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> TERRT=<span style="color: #33ffdd;">2</span><span style="color: #ffee00">;for terrain</span></div>
<p>Переходим в Create_user() и делаем следующее.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">EntityType</span> user,USERT</div>
<p>Переходим в Create_world() и делаем следующее.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">EntityType</span> terrain,TERRT</div>
<p>и после вызова create_user()
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span></div>
<p>в главном цикле допишем
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>и наконец в update_user() нацарапем
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;физика</span><br />
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#,<span style="color: #33ffdd;">0</span></div>
<p>/сразу предупреждаю физиков: это не окончательный вараинт кода/
И мы смело двигаем пользователя вниз ф-цией TranslateEntity. TranslateEntity отличается от MoveEntity безразличем к пространственной ориентации самой модели. Пример: если объект перевернуть "на голову", то команда move вниз приведёт к движению этого объекта вверх, Translate же будет двигать объект вниз. Перейдём в create_user() и подправим кое-что:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">10</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<p><br />
</p>
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">-0.5</span></div>
<p>Можно запускать! В начале текста я немного занизил высоту камеры относительно "ног", что сейчас и исправил. Теперь, между прочим, стала заметна сфера. Вернёмся к ф-ции создания:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> user,<span style="color: #33ffdd;">0</span></div>
<p>Этим мы задали нулевую "альфу" для сферы - т.е. сделали её полностью прозрачной.
</p><p>Термины "полностью прозрачный" и "невидимый" здесь не одно и то же. Если первый сводится к изменению альфы (и объект просто не видим для камер), то второй реализуется командой HideEntity (и объект убирается из процедуры рендера движка). Но об этом как-нибудь в другой раз. Как очевидно, код:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#,<span style="color: #33ffdd;">0</span></div>
<p>не совсем то, что нам нужно. Хотя вблизи земли разницы никакой нет (допустимые приближения). Вообще, здесь гравитация (вернее её подобие) нужна не столько для симуляции реалистичной физики, сколько для "прижимания" игрока к земле.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> G#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> USERT=<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;for user</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> TERRT=<span style="color: #33ffdd;">2</span><span style="color: #ffee00">;for terrain</span><br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">10</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> user,<span style="color: #33ffdd;">0</span><br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> camera,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">-0.5</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> user,USERT<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;обновление игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
V#=<span style="color: #33ffdd;">0.5</span><br />
u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #ffee00">;физика</span><br />
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tertex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> terrain,TERRT<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились &nbsp;</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Конечно, ничто кроме фантазии программиста не ограничивает возможности языка - так что, никто не мешает Вам, немного поразмыслив, реализовать настоящую модель гравитации. Обратите внимание: я стараюсь заменять конструкции типа x/2 на x*0.5 - это связано со спецификой обработки этих мат.операций процессором (спросите у SubZer0) 
</p>
<a name=".D0.9F.D1.80.D0.B8.D1.86.D0.B5.D0.BB"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=4" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Прицел</span></h2>
<p>Тыкс загрузим картинку прицела в глобале
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-Crosshair.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-Crosshair.png" src="iqbbkrqy.png" width="81" height="67" /></a></span></div></div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> pricel=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Crosshair.png&quot;</span><span style=" ">&#41;</span></div>
<p>назначаем начало координат картинки в её центре
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">MidHandle</span> pricel</div>
<p>А это
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">DrawImage</span> pricel,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span></div>
<p>нужно вписть в главном цикле... вот не скажу где. Если вы использовали мой прицел, то увидите, что отображается он несовсем как хотелось бы.
Установим Mask-цвет - белый:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> pricel=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Crosshair.png&quot;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">MidHandle</span> pricel<br />
</p>
<span style="color: #aaffff; font-weight: bold;">MaskImage</span> pricel,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span></div>
<p>Так: немного подправим код для удобства:
внесём прицел в функцию создания перса, м немного морфируем физ. модель игрока. Теперь уже понятно почему и когда мы крутим камеру и основание. И теперь для удобства просчёта коллизий камеру поместим в центр прозрачной сферы.
И ещё
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">CameraRange</span> camera,<span style="color: #33ffdd;">0.1</span>,<span style="color: #33ffdd;">100</span></div>
<p>установит минимальный и максимальный радиусы рендеринга
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> G#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> USERT=<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;for user</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> TERRT=<span style="color: #33ffdd;">2</span><span style="color: #ffee00">;for terrain</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> pricel=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Crosshair.png&quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">10</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">MidHandle</span> pricel<br />
<span style="color: #aaffff; font-weight: bold;">MaskImage</span> pricel,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
k#=<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> user,k#,k#,k#<br />
<span style="color: #aaffff; font-weight: bold;">EntityRadius</span> user,k#<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">CameraRange</span> camera,<span style="color: #33ffdd;">0.1</span>,<span style="color: #33ffdd;">100</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> user,USERT<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;обновление игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
V#=<span style="color: #33ffdd;">0.5</span><br />
u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #ffee00">;физика</span><br />
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tertex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> terrain,TERRT<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились &nbsp;</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">DrawImage</span> pricel,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<a name=".D0.92.D1.8B.D1.81.D1.82.D1.80.D0.B5.D0.BB.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=5" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Выстрелы</span></h2>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> shot_sprite=<span style="color: #aaffff; font-weight: bold;">LoadSprite</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Shot.png&quot;</span><span style=" ">&#41;</span></div>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-Shot.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-Shot.png" src="bs9a_fmr.png" width="64" height="64" /></a></span></div></div>
<p>Это будет спрайт выстрела. В создании мира добавим
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">HideEntity</span> shot_sprite</div>
<p>скрыв таким образом загруженный спрайт. Создадим функцию порождения выстрела
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> create_Shot<span style=" ">&#40;</span>x#,y#,z#,pitch#,yaw#,roll#<span style=" ">&#41;</span><br />
<p>&nbsp;<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>6 аргументов описывают вектор выстрела: з координаты и углы вращения по осям
Создадим тип выстрела:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> shot<br />
<p><span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>Далее...
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> create_Shot<span style=" ">&#40;</span>x#,y#,z#,pitch#,yaw#,roll#<span style=" ">&#41;</span><br />
<p>s.shot=<span style="color: #aaffff; font-weight: bold;">New</span> shot<br />
s\entity=<span style="color: #aaffff; font-weight: bold;">CopyEntity</span><span style=" ">&#40;</span>shot_sprite<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> s\entity,x#,y#,z#,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> s\entity,pitch#,yaw#,roll#,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>В первой строке при помощи опереатора NEW создаём новый элемент типа shot. Теперь через S мы можем обратиться к любому полю данного элемента типа shot. s\entity - обращаемся к полю entity вновь созданного элемента. Сохраняем туда handle копии спрайта. Далее позиционируем вновь созданный (скопированный) спрайт и разворачиваем его. Последний аргумент 1 (true) означает, что действия будут выполнятся относительно мировых координат и осей.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>vs#=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>For a.shot=Each shot - на первый взгляд, заковыпистая конструкция. Такой цикл будет помещать по очереди в переменную а хендлы всех элементов указанного типа (в данном случае shot). Таким образом данный цикл продвинет все спрайты выстрелов на vs# вдоль оси Z. Добавляем update_shot() в главный цикл. Добавим строку
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span></div>
<p>В ф-цию обновления игрока. Уже можно посмотреть в действии:
</p><p><br />
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS01.gif" src="w6g-fznr.gif" width="205" height="228" /></a></span></div></div>
<p><br />
вот так будут улетать вдаль спрайты. Слово далеко относится к неопределённой логике. Ограничим расстояние полёта.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Field</span> dist#</div>
<p>добавим ещё одно поле в тип. И обработаем его:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>vs#=<span style="color: #33ffdd;">1</span><br />
max_dist#=<span style="color: #33ffdd;">1000</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
&nbsp;a\dist#=a\dist#+vs#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>будем накапливать всоответствующем поле пройденное "снарядом" расстояние, и если оно больше максимального, то: очистим память, занимаемую спрайтом, затем удалим этот элемент типа. В том, что всё работает как надо Вы можите убедиться поэкспериментировав со значением max_dist# и сделав кучу выстрелов (после исчезновения выстрелов фпс возвращается в стабильное состояние).
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> SHOTT=<span style="color: #33ffdd;">3</span><span style="color: #ffee00">;for shot</span></div>
<p>в глобал.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Collisions</span> SHOTT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span></div>
<p>в создание мира
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">EntityType&lt;.b&gt; s\entity,SHOTT</div>
<p>в создании выстрела.
Если запустить программу теперь, то можно наблюдать забавный эффект - поверхность стала уловителем выстрелов:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS02.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS02.jpg" src="pu0dd22o.jpg" width="522" height="206" /></a></span></div></div>
<p>Обновим условие в цикле обработки выстрелов
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
<span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,TERRT<span style=" ">&#41;</span> &lt; &gt; <span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
</p>
<span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>Теперь при столкновении текущего спрайта с объектом, у которого коллизионный тип (а не "обычный" тип - как shot) TERRT, происходит удаление выстрела.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> G#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> USERT=<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;for user</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> TERRT=<span style="color: #33ffdd;">2</span><span style="color: #ffee00">;for terrain</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> SHOTT=<span style="color: #33ffdd;">3</span><span style="color: #ffee00">;for shot</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> pricel=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Crosshair.png&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> shot_sprite=<span style="color: #aaffff; font-weight: bold;">LoadSprite</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Shot.png&quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> shot<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> dist#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">10</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">MidHandle</span> pricel<br />
<span style="color: #aaffff; font-weight: bold;">MaskImage</span> pricel,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
k#=<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> user,k#,k#,k#<br />
<span style="color: #aaffff; font-weight: bold;">EntityRadius</span> user,k#<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">CameraRange</span> camera,<span style="color: #33ffdd;">0.1</span>,<span style="color: #33ffdd;">100</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> user,USERT<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;обновление игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
V#=<span style="color: #33ffdd;">0.5</span><br />
u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;физика</span><br />
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_Shot<span style=" ">&#40;</span>x#,y#,z#,pitch#,yaw#,roll#<span style=" ">&#41;</span><br />
s.shot=<span style="color: #aaffff; font-weight: bold;">New</span> shot<br />
s\entity=<span style="color: #aaffff; font-weight: bold;">CopyEntity</span><span style=" ">&#40;</span>shot_sprite<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> s\entity,SHOTT<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> s\entity,x#,y#,z#,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> s\entity,pitch#,yaw#,roll#,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
vs#=<span style="color: #33ffdd;">1</span><br />
max_dist#=<span style="color: #33ffdd;">1000</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
&nbsp;a\dist#=a\dist#+vs#<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,TERRT<span style=" ">&#41;</span> &lt; &gt; <span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">HideEntity</span> shot_sprite<br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tertex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> terrain,TERRT<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> SHOTT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились &nbsp;</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">DrawImage</span> pricel,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Наряду с описанными в хелпе функциями, для работы с типами, есть и недокументированные команды Object и Handle, которые облегчают программирование доступа к конкретному элементу типа. Об этом в другой раз.
</p>
<a name=".D0.9A.D0.BE.D0.B2.D0.B0.D1.80.D0.BD.D1.8B.D0.B5_.D0.B1.D0.BE.D1.82.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=6" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Коварные боты</span></h2>
<p>Итак, оружие есть - надо и поохотиться. Создадим тип для ботов
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> bot<br />
<p><span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>Далее как обычно:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> create_bot<span style=" ">&#40;</span>x#,y#,z#<span style=" ">&#41;</span><br />
<p>b.bot=<span style="color: #aaffff; font-weight: bold;">New</span> bot<br />
b\entity=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> b\entity,x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Для простоты визуализация бота будет сведена отображению на экране сферы.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>v#=<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.bot=<span style="color: #aaffff; font-weight: bold;">Each</span> bot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PointEntity</span> a\entity,user<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,v#<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Тут всё ясно как день. За исключением, быть может, команды PointEntity entity,target[,roll#] . Так как основы создания искусственного 
интеллекта на базе нейроподобных сетей здесь рассматривать не имеет смысла. А ур-ий, по которым бот, так или иначе, будет за вами двигаться, можно придумать достаточно много, то ограничимся результатом работы самой простой (в исполнении Блитца) команды. После её выполнения объект entity будет развёрнут "лицом" (т.е. в сторону положительного направления Z-оси) к объекту target. Это допустимо, так как в нашем случае действие происходит на плоскости. Не забываем про главный цикл программы. Чуть не забыл (куда это добавлять - должно быть уже очевидно, если нет - в конце я прилагаю исходный код всей программы):
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> BOTT=<span style="color: #33ffdd;">4</span><span style="color: #ffee00">;for bot</span><br />
<p><br />
...<br />
<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> b\entity,BOTT<br />
<br />
...<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,USERT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">Collisions</span> SHOTT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span></div>
<p>а в функции создания мира
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">create_bot<span style=" ">&#40;</span><span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">50</span><span style=" ">&#41;</span></div>
<p>Можно запустить и посмотреть. Как видно, на некотором расстоянии от игрока, бот остановится и начнёт совершать непонятные движения - это он наткнулся на прозрачную сферу, которой окружён игрок. Перепишем ф-цию обновления выстрелов:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>vs#=<span style="color: #33ffdd;">1</span><br />
max_dist#=<span style="color: #33ffdd;">1000</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
&nbsp;a\dist#=a\dist#+vs#<br />
&nbsp;bot_h=<span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,BOTT<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,TERRT<span style=" ">&#41;</span> &lt; &gt; <span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> bot_h &lt; &gt; <span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> q.bot=<span style="color: #aaffff; font-weight: bold;">Each</span> bot<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> q\entity=bot_h<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> q<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Фууу... меня очень угнетает цикл с перебором всех ботов в поисках записи о подбитом, но объяснять как это можно сделать проще, а главное быстрее пока не буду. И чтобы превратить игру в бесконечно долгую, перепишем условие уничтожения бота:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h<br />
<p><span style="color: #aaffff; font-weight: bold;">Delete</span> q<br />
create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Exit</span></div>
<p>Теперь за каждого убитого бота около игрока (в радиусе 100) будет "респиться" новый бот. Причём сколько было ботов при загрузке - такое их кол-во и будет поддерживаться в игре. Перепишем функцию создания мира:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">c_bot=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;input Amount&quot;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> c_bot<br />
&nbsp;create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Next</span></div>
<p>При загрузке будет запрос на ввод кол-ва ботов.
Попробуйте указать 20 и ничего не делайте - вскоре боты заблокируют вас полностью. Понаблюдайте за обработкой коллизий.
</p><p>Даже если Вы работаете с типами впервые, рассмотренного здесь вполне достаточно, чтобы реализовать "жизни" для ботов и зарезервировать поля для хранения промежуточных результатов работы ИИ. Для придания объёма (это надо было ещё вначале сделать) я добавил в create_world() создание и ротацию света:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">light=<span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> light,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span></div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> G#=<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> USERT=<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;for user</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> TERRT=<span style="color: #33ffdd;">2</span><span style="color: #ffee00">;for terrain</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> SHOTT=<span style="color: #33ffdd;">3</span><span style="color: #ffee00">;for shot</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> BOTT=<span style="color: #33ffdd;">4</span><span style="color: #ffee00">;for bot</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> pricel=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Crosshair.png&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> shot_sprite=<span style="color: #aaffff; font-weight: bold;">LoadSprite</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Shot.png&quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> shot<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> dist#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> bot<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">10</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">MidHandle</span> pricel<br />
<span style="color: #aaffff; font-weight: bold;">MaskImage</span> pricel,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<br />
user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
k#=<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> user,k#,k#,k#<br />
<span style="color: #aaffff; font-weight: bold;">EntityRadius</span> user,k#<br />
camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">CameraRange</span> camera,<span style="color: #33ffdd;">0.1</span>,<span style="color: #33ffdd;">100</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> user,USERT<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;обновление игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
V#=<span style="color: #33ffdd;">0.5</span><br />
u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;физика</span><br />
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_Shot<span style=" ">&#40;</span>x#,y#,z#,pitch#,yaw#,roll#<span style=" ">&#41;</span><br />
s.shot=<span style="color: #aaffff; font-weight: bold;">New</span> shot<br />
s\entity=<span style="color: #aaffff; font-weight: bold;">CopyEntity</span><span style=" ">&#40;</span>shot_sprite<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> s\entity,SHOTT<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> s\entity,x#,y#,z#,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> s\entity,pitch#,yaw#,roll#,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
vs#=<span style="color: #33ffdd;">1</span><br />
max_dist#=<span style="color: #33ffdd;">1000</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
&nbsp;a\dist#=a\dist#+vs#<br />
&nbsp;bot_h=<span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,BOTT<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,TERRT<span style=" ">&#41;</span> &lt; &gt; <span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> bot_h &lt; &gt; <span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> q.bot=<span style="color: #aaffff; font-weight: bold;">Each</span> bot<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> q\entity=bot_h<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> q<br />
&nbsp; &nbsp; create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_bot<span style=" ">&#40;</span>x#,y#,z#<span style=" ">&#41;</span><br />
b.bot=<span style="color: #aaffff; font-weight: bold;">New</span> bot<br />
b\entity=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> b\entity,BOTT<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> b\entity,x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
v#=<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.bot=<span style="color: #aaffff; font-weight: bold;">Each</span> bot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PointEntity</span> a\entity,user<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,v#<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
light=<span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> light,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">HideEntity</span> shot_sprite<br />
terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tertex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
<span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> terrain,TERRT<br />
create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
c_bot=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;input Amount&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> c_bot<br />
&nbsp;create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> SHOTT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,USERT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Collisions</span> SHOTT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<span style="color: #ffee00">;функции закончились &nbsp;</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">DrawImage</span> pricel,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<a name=".D0.91.D0.B0.D0.B3-.D1.84.D0.B8.D0.BA.D1.81"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=7" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Баг-фикс</span></h2>
<p>Я всё-таки почти человек, поэтому ничего странного, что забыл дописать ещё вот что:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>v#=<span style="color: #33ffdd;">0.3</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.bot=<span style="color: #aaffff; font-weight: bold;">Each</span> bot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PointEntity</span> a\entity,user<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,v#<br />
<span style="color: #ffee00">;физика</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>теперь ботов будет притягивать вниз.
</p>
<a name=".D0.A7.D0.B8.D1.82-.D0.BC.D0.BE.D0.B4"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=8" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Чит-мод</span></h2>
<p>Попробуйте включить в функцию обработки игрока строку
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span></div>
<p>И стрелять, используя удержание правой кнопки мыши.
</p>
<a name=".D0.A3.D1.85.D0.BE.D0.B4_.D0.BE.D1.82_.D0.BF.D0.BE.D0.BB.D0.BD.D0.BE.D0.B3.D0.BE_.D0.BF.D0.B5.D1.80.D0.B5.D0.B1.D0.BE.D1.80.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=9" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Уход от полного перебора</span></h2>
<p>Расскажу, как улучшить цикл обработки выстрелов. В Блитце есть недокументированные команды Handle и Object. Благодаря команде Handle можно получить "указатель" на объект типа (использование термина "указатель" весьма спорно для Блитца). Например:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">P.Player=<span style="color: #aaffff; font-weight: bold;">New</span> Player<br />
pHANDLE=Handle<span style=" ">&#40;</span>P<span style=" ">&#41;</span></div>
<p>а затем, используя сохранённое значение (здесь в переменной pHANDLE) получить доступ к элементу типа:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">P.PLAYER=Object.PLAYER<span style=" ">&#40;</span>pHANDLE<span style=" ">&#41;</span></div>
<p>Модифицируем функцию create_bot
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> create_bot<span style=" ">&#40;</span>x#,y#,z#<span style=" ">&#41;</span><br />
<p>b.bot=<span style="color: #aaffff; font-weight: bold;">New</span> bot<br />
b\entity=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> b\entity,BOTT<br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> b\entity,x#,y#,z#<br />
<span style="color: #aaffff; font-weight: bold;">NameEntity</span> b\entity,Handle<span style=" ">&#40;</span>b<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Командой NameEntity присвоим объекту B\entity имя - в данном случае, совпадающее с хендлом элемента типа, 
содержащего данный объект. Теперь модифим кусок функции update_shot()
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>vs#=<span style="color: #33ffdd;">1</span><br />
max_dist#=<span style="color: #33ffdd;">1000</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
&nbsp;a\dist#=a\dist#+vs#<br />
&nbsp;bot_h=<span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,BOTT<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,TERRT<span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> bot_h&lt;&gt;<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp; bhandle=<span style="color: #aaffff; font-weight: bold;">EntityName</span><span style=" ">&#40;</span>bot_h<span style=" ">&#41;</span><br />
&nbsp; bc.bot=Object.bot<span style=" ">&#40;</span>bhandle<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> bc<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h<br />
&nbsp; create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Здесь мы получаем указатель на элемент типа из имени бота (имени объекта, который его визуализирует - сферы)
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">bhandle=<span style="color: #aaffff; font-weight: bold;">EntityName</span><span style=" ">&#40;</span>bot_h<span style=" ">&#41;</span></div>
<p>далее удалям запись об этом боте (удаляем соответствующий элемент типа)
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">bc.bot=Object.bot<span style=" ">&#40;</span>bhandle<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Delete</span> bc</div>
<p>И, наконец, удаляем сам объект (используя его хендл)
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h</div>
<p>Таким образом, мы избавились от цикла и сохранили прежнюю функциональность, повысив при этом 
производительность.
</p>
<a name=".D0.A3.D1.85.D0.BE.D0.B4_.D0.BE.D1.82_.D0.BF.D1.80.D0.B8.D0.B2.D1.8F.D0.B7.D0.BA.D0.B8_.D0.BA_FPS"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=10" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Уход от привязки к FPS</span></h2>
<p>В текущей версии программы события (а именно: обновление ботов, игрока, выстрелов) будут происходить с частотой вызова соответствующих ф-ций. Т.е. (как видно из записи главного цикла) с частотой прорисовки - ФПС. А значит напрямую будут зависеть от производительности системы. Избавиться можно 2мя способами:
</p>
<ol><li> Производить обновление N раз в секунду - что приведёт к принудительному занижению высоких ФПС и скачкообразной анимации.
</li><li> Рассчитывать переменные скорости, ускорения и проч. в соответствии с дельтой времени. Что сейчас и сделаем.
</li></ol>
<p>Так как в следующих версиях алгоритма или уже в этой ( при большом кол-ве ботов) время начала обработки первого и последнего ботов вероятно будет отличаться на целое кол-во мс и так же потому, что глобальные переменные делают программу, имхо, менее удобочитаемой и переносимой, а так же плодят логические ошибки (из-за ошибок при вводе имени) - для каждого бота сделаем собственное время последнего обновления.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> bot<br />
<p><span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> time<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>v#=<span style="color: #33ffdd;">0.03</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.bot=<span style="color: #aaffff; font-weight: bold;">Each</span> bot<br />
<span style="color: #ffee00">;=</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\time=<span style="color: #33ffdd;">0</span> a\time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;new_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;delta_t=new_time-a\time<br />
&nbsp;a\time=new_time<br />
<span style="color: #ffee00">;=</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PointEntity</span> a\entity,user<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,v#*delta_t<br />
<span style="color: #ffee00">;физика</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#*delta_t,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Ёлки-палки - только сейчас заметил, что боты притягиваются с коэффицентом 1 а не G. Переменная v# должна получиться универсальным значением для всех ПК (однако Вы можете откалибровать её по-точнее). Проделаем операцию ухода... для выстрелов:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> shot<br />
<p><span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> dist#<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> time<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>v#=<span style="color: #33ffdd;">0.1</span><br />
max_dist#=<span style="color: #33ffdd;">1000</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
<span style="color: #ffee00">;=</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\time=<span style="color: #33ffdd;">0</span> a\time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;new_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;delta_t=new_time-a\time<br />
&nbsp;a\time=new_time<br />
&nbsp;vs#=v*delta_t<br />
<span style="color: #ffee00">;=</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
&nbsp;a\dist#=a\dist#+vs#<br />
&nbsp;bot_h=<span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,BOTT<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,TERRT<span style=" ">&#41;</span><span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> bot_h0<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp; bhandle=<span style="color: #aaffff; font-weight: bold;">EntityName</span><span style=" ">&#40;</span>bot_h<span style=" ">&#41;</span><br />
&nbsp; bc.bot=Object.bot<span style=" ">&#40;</span>bhandle<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> bc<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h<br />
&nbsp; create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Обратите внимание здесь рассчитанная по дельте скорость используется не идиножды - сохраняем в отдельную переменную.Теперь сам игрок. Поскольку мультиплеером в игре и не пахнет - игрок реализован не типизированным объектом и он один. Заведём для его обновления глобальную переменную:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> user_time</div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #ffee00">;=</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> user_time=<span style="color: #33ffdd;">0</span> user_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
new_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
delta_t=new_time-user_time<br />
user_time=new_time<br />
<span style="color: #ffee00">;=</span><br />
V#=<span style="color: #33ffdd;">0.02</span>*delta_t<br />
u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
<span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;физика</span><br />
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#*delta_t,<span style="color: #33ffdd;">0</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Осталось откалибровать коэффициент гравитации.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> G#=<span style="color: #33ffdd;">0.1</span></div>
<p>Пока поставил такое значение. 
</p>
<a name=".D0.9D.D0.B5.D0.B1.D0.B5.D1.81.D0.BD.D0.B0.D1.8F_.D1.81.D1.84.D0.B5.D1.80.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=11" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Небесная сфера</span></h2>
<p>Вопреки названию, будем создавать не сферу, а SkyBox - коробку, так как для неё проще изготовить текстуру и смотрится, имхо, она красивее. Возьмём стандартную функцию создания из примеров блитца (\Samples\Blitz 3D Samples\AGore\GrassDemo).
</p><p><br />
<p>Понадобятся следующие изображения:
</p>
</p>
<center>
<p><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyBK.jpg" class="image" title="Изображение:FPS-SkyBK.jpg"><img alt="Изображение:FPS-SkyBK.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyBK.jpg" src="l3rsckue.jpg" width="256" height="256" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyFR.jpg" class="image" title="Изображение:FPS-SkyFR.jpg"><img alt="Изображение:FPS-SkyFR.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyFR.jpg" src="my5k8fnu.jpg" width="256" height="256" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyLF.jpg" class="image" title="Изображение:FPS-SkyLF.jpg"><img alt="Изображение:FPS-SkyLF.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyLF.jpg" src="xpo6wlx1.jpg" width="256" height="256" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyRT.jpg" class="image" title="Изображение:FPS-SkyRT.jpg"><img alt="Изображение:FPS-SkyRT.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyRT.jpg" src="aabmo546.jpg" width="256" height="256" /></a>
<a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyUP.jpg" class="image" title="Изображение:FPS-SkyUP.jpg"><img alt="Изображение:FPS-SkyUP.jpg" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS-SkyUP.jpg" src="7yc_v-nx.jpg" width="256" height="256" /></a>
</p>
</center>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> MakeSkyBox<span style=" ">&#40;</span> file$ <span style=" ">&#41;</span><br />
<p><br />
m=<span style="color: #aaffff; font-weight: bold;">CreateMesh</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;front face</span><br />
b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;FR.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
<span style="color: #ffee00">;right face</span><br />
b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;LF.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
<span style="color: #ffee00">;back face</span><br />
b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;BK.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
<span style="color: #ffee00">;left face</span><br />
b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;RT.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
<span style="color: #ffee00">;top face</span><br />
b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;UP.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> m,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span><br />
<span style="color: #aaffff; font-weight: bold;">FlipMesh</span> m<br />
<span style="color: #aaffff; font-weight: bold;">EntityFX</span> m,<span style="color: #33ffdd;">9</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityOrder</span> m,<span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> m<br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>и скопируем её в наш код. Вот, кстати, довод за использование ф-ций: в любой момент вы можете использовать свои наработки в других проектах.
Переместимся в функцию create_world() 
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><br />
sky=MakeSkyBox<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Sky&quot;</span><span style=" ">&#41;</span><br />
<br />
</p>
c_bot=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;input Amount&quot;</span><span style=" ">&#41;</span></div>
<p>и скопируем текстуры неба из папки с примером в папку нашей программы. Уже сейчас можно посмотреть на результат, правда, сомнительный. Из-за недостаточных размеров skybox`а небо ощутимо квадратное:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS03.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS03.jpg" src="wlqx27bd.jpg" width="200" height="200" /></a></span></div></div>
<p>Отскалим небо
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> sky,<span style="color: #33ffdd;">150</span>,<span style="color: #33ffdd;">150</span>,<span style="color: #33ffdd;">150</span></div>
<p>После этого незамысловатого изменения небо исчезнет совсем =(. Вероятно оно за максимальным радиусом ренедера. Глянем в create_user - именно здесь мы обрезали расстония рендера, правим:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">CameraRange</span> camera,<span style="color: #33ffdd;">0.1</span>,<span style="color: #33ffdd;">10000</span></div>
<p>Проверяем - всё работает =)
</p>
<a name=".D0.96.D0.B8.D0.B2.D1.83.D1.87.D0.B8.D0.B5_.D0.B1.D0.BE.D1.82.D1.8B"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=12" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Живучие боты</span></h2>
<p>Бот, умирающий от одного залпа, - это, кончено весело, но не интересно. Добавим ботам шкалу жизни. Итак, переходим в объявление типа и правим:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Type</span> bot<br />
<p><span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> time<br />
<span style="color: #aaffff; font-weight: bold;">Field</span> Survivability<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Type</span></div>
<p>В создании бота припишем:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">b\Survivability=<span style="color: #33ffdd;">100</span></div>
<p>Теперь надо растянуть смерть бота, а значит переходим в ф-цию update_shot()
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">ElseIf</span> bot_h&lt;&gt;<span style="color: #33ffdd;">0</span><br />
<p>&nbsp;<span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp;bhandle=<span style="color: #aaffff; font-weight: bold;">EntityName</span><span style=" ">&#40;</span>bot_h<span style=" ">&#41;</span><br />
&nbsp;bc.bot=Object.bot<span style=" ">&#40;</span>bhandle<span style=" ">&#41;</span><br />
&nbsp;bc\Survivability=bc\Survivability<span style="color: #33ffdd;">-16</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> bc\Survivability&lt;=<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> bc<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h<br />
&nbsp; create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>Если есть столкновение пули с ботом, то удаляем пулю и её информационный элемент, получаем хендл элемента типа для бота, получаем доступ к элементу типа, вычитаем из значения живучести бота число. Если живучесть бота меньше или равна 0, то удаляем информацию о боте, удаляем тело бота, создаём нового бота.
Теперь равновесие сместилось в пользу ботов - за это понизим им скорость передвижения:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
v#=<span style="color: #33ffdd;">0.01</span></div>
<a name=".D0.96.D0.B8.D0.B7.D0.BD.D1.8C_.D0.B2_.D0.BA.D0.BE.D1.80.D0.BE.D0.B1.D0.BA.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=13" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Жизнь в коробке</span></h2>
<p>Рано или поздно, надо чётко обазначить границы игрового мира. После добавления в игру SkyBox, это становится необходимо сделать. Модифицируем ф-цию создания неба и сохраним её под новым именем (прототип тоже надо оставить в коде):
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Function</span> MakeBox<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><br />
m=<span style="color: #aaffff; font-weight: bold;">CreateMesh</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;front face</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #ffee00">;right face</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #ffee00">;back face</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #ffee00">;left face</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<span style="color: #ffee00">;top face</span><br />
s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> m,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span><br />
<span style="color: #aaffff; font-weight: bold;">FlipMesh</span> m<br />
<span style="color: #aaffff; font-weight: bold;">EntityFX</span> m,<span style="color: #33ffdd;">9</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityOrder</span> m,<span style="color: #33ffdd;">10</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> m<br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Теперь функция возвращает хендл простой неоттекстурированной корбки. Зайдём в create_world():
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">border=MakeBox<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #ffee00">;ScaleEntity border,140,140,140</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> border,.<span style="color: #33ffdd;">5</span></div>
<p>Запустим прогамму. Если некоторое время идти в одном направлении, можно увидеть коробку, ограничивающую уровень:
</p><p><br />
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS04.jpg" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:FPS04.jpg" src="sp4mtdzn.jpg" width="200" height="200" /></a></span></div></div>
<p><br />
Теперь поставим этой коробке в соответствие тип для колизии
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Const</span> BORDERT=<span style="color: #33ffdd;">5</span><span style="color: #ffee00">;for box</span><br />
<p><br />
...<br />
<br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> border,.<span style="color: #33ffdd;">5</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityType</span> border,BORDERT<br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,BORDERT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span></div>
<p>Боты могут проходить сквозь эту стену - на случай если игрок будет в крайнем положении, в следствие чего бот создастся за стеной. Поэтому коллизию с типом ботов не ставим. Спрайтам выстрелов это тоже не нужно. Теперь, если идти в одну сторону, в какой-то момент вы просто упрётесь в стену. Ставим стене нулевую альфу и растягиваем её.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">border=MakeBox<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> border,<span style="color: #33ffdd;">140</span>,<span style="color: #33ffdd;">140</span>,<span style="color: #33ffdd;">140</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> border,<span style="color: #33ffdd;">0</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">EntityType</span> border,BORDERT</div>
<a name=".D0.9A.D0.BE.D0.B4.D0.B8.D0.BC-.D0.BA.D0.BE.D0.B4.D0.B8.D0.BC"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=14" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Кодим-кодим</span></h2>
<p>Что-то управление больно казуальным вышло. Перенастроим движение на W,S,A,D. Функция update_user()
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">30</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<p><span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">32</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">17</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
</p>
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">31</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#</div>
<a name=".D0.9F.D1.80.D1.8B.D0.B6.D0.BA.D0.B8_.D0.B8_.D1.80.D0.B5.D0.B0.D0.BB.D0.B8.D1.81.D1.82.D0.B8.D1.87.D0.BD.D0.BE.D1.81.D1.82.D1.8C_.D1.84.D0.B8.D0.B7.D0.B8.D0.BA.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=15" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Прыжки и реалистичность физики</span></h2>
<p>Давно пора было это сделать. Для нормальной реализации кинематики нам понадобится:
</p>
<a name=".D0.9A.D0.BE.D0.BD.D1.82.D1.80.D0.BE.D0.BB.D1.8C_.D0.B7.D0.B0_.D0.BE.D1.82.D1.80.D1.8B.D0.B2.D0.BE.D0.BC_.D0.BE.D1.82_.D0.B7.D0.B5.D0.BC.D0.BB.D0.B8_.D0.B8_.D0.BC.D0.BE.D0.BC.D0.B5.D0.BD.D1.82.D0.BE.D0.BC_.D1.81.D0.BE.D0.BF.D1.80.D0.B8.D0.BA.D0.BE.D1.81.D0.BD.D0.BE.D0.B2.D0.B5.D0.BD.D0.B8.D1.8F_.D1.81_.D0.BD.D0.B5.D0.B9"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=16" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Контроль за отрывом от земли и моментом соприкосновения с ней</span></h3>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">EntityPickMode</span> terrain,<span style="color: #33ffdd;">2</span></div>
<p>Теперь к земле можно применить операцию pick.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> jump_bool</div>
<p>Переменная под логику отрыва от поверхности.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;физика</span><br />
<p>jump_bool=<span style="color: #aaffff; font-weight: bold;">True</span><br />
pick_ent=<span style="color: #aaffff; font-weight: bold;">LinePick</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-3</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">If</span> pick_ent jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span></div>
<p>Допишем в функции обновления игрока. И добавим
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #00ff66;">&quot;jump_bool=&quot;</span>+jump_bool<br />
<span style="color: #aaffff; font-weight: bold;">Flip</span></div>
<p>в главном цикле. Запустим. И увидим, что программа работает неверно.jump_bool=1, т.е. условие If pick_ent не срабатывает, т.е. LinePick возвращает 0, т.е. на расстоянии 3 ед. под игроком ничего "не цепляется" командой Pick =(. Вообще в этой точке будет как раз соприкосновение сферы игрока и земли, так что надо попробовать увеличить расстояние - методом калибровки подбираем значение=3.6
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">pick_ent=<span style="color: #aaffff; font-weight: bold;">LinePick</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-3.6</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span></div>
<p>Ориентировочное значение три я взял, исходя из ф-ции создания игрока:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>k#=<span style="color: #33ffdd;">3</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> user,k#,k#,k#</div>
<p>и если был бы внимательнее, посмотрел чуть ниже
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">EntityRadius</span> user,k#</div>
<p>Радиус коллизи тоже равен 3, что как раз и объясняет возникшее затруднение. Наше расстояние должно быть немногим больше 3, как оказалось = 3.6. Теперь значение jump_bool характеризует состояние игрока - есть или нет сцепления.
</p>
<a name=".D0.92.D1.80.D0.B5.D0.BC.D1.8F_.D0.BD.D0.B5.D0.B2.D0.B7.D0.B0.D0.B8.D0.BC.D0.BE.D0.B4.D0.B5.D0.B9.D1.81.D1.82.D0.B2.D0.B8.D1.8F_.D1.81_.D0.B7.D0.B5.D0.BC.D0.BB.D1.91.D0.B9"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=17" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Время невзаимодействия с землёй</span></h3>
<p>Перепишем обновление игрока ещё раз:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;физика</span><br />
<p><br />
pick_ent=<span style="color: #aaffff; font-weight: bold;">LinePick</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-3.6</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> pick_ent <br />
&nbsp;jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span> <br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp;jump_bool=<span style="color: #aaffff; font-weight: bold;">True</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">EndIf</span></div>
<p>Время взаимодействия как-таковое нам нужно между обновлениями,а оно у нас уже есть.
</p>
<a name=".D0.A1.D0.BA.D0.BE.D1.80.D0.BE.D1.81.D1.82.D0.B8_.D0.B4.D0.B2.D0.B8.D0.B6.D0.B5.D0.BD.D0.B8.D1.8F_.D0.B4.D0.BB.D1.8F_.D0.B8.D1.85_.D0.B4.D0.B8.D0.BD.D0.B0.D0.BC.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.BE.D0.B3.D0.BE_.D0.B8.D0.B7.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D1.8F"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=18" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Скорости движения для их динамического изменения</span></h3>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Global</span> user_vy#</div>
<p>Снова переписываем:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">pick_ent=<span style="color: #aaffff; font-weight: bold;">LinePick</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-3.6</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">If</span> pick_ent <br />
&nbsp;jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span> <br />
&nbsp;user_vy#=<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp;jump_bool=<span style="color: #aaffff; font-weight: bold;">True</span><br />
&nbsp;user_vy#=user_vy#-G#*delta_t<span style="color: #ffee00">;v1=v2-a*t</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,user_vy#*delta_t,<span style="color: #33ffdd;">0</span></div>
<a name=".D0.98.D0.BD.D0.B8.D1.86.D0.B8.D0.B0.D0.BB.D0.B8.D0.B7.D0.B0.D1.86.D0.B8.D1.8F_.D1.81.D0.BE.D0.B1.D1.8B.D1.82.D0.B8.D1.8F_.22.D0.BF.D1.80.D1.8B.D0.B6.D0.BE.D0.BA.22"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%91%D0%BC_%D1%81%D0%B2%D0%BE%D0%B9_First_Person_Shooter&amp;action=edit&amp;section=19" title="Создаём свой First Person Shooter">править</a>]</span> <span class="mw-headline">Инициализация события "прыжок"</span></h3>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,user_vy#*delta_t,<span style="color: #33ffdd;">0</span><br />
<p><span style="color: #ffee00">;;;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">57</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span> <span style="color: #aaffff; font-weight: bold;">Then</span> user_vy#=<span style="color: #33ffdd;">50</span></div>
<p>однако - не работает =(. После некоторых раздумий подправим физику
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">pick_ent=<span style="color: #aaffff; font-weight: bold;">LinePick</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-3.6</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,user_vy#*delta_t,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">True</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> pick_ent<br />
&nbsp;jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span><br />
&nbsp;user_vy=<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp;jump_bool=<span style="color: #aaffff; font-weight: bold;">True</span><br />
&nbsp;user_vy#=user_vy#-G#*delta_t<span style="color: #ffee00">;v1=v2-a*t</span><br />
<span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
<span style="color: #ffee00">;;;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">57</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span> <span style="color: #aaffff; font-weight: bold;">Then</span> user_vy#=<span style="color: #33ffdd;">1</span></div>
<p>и гравитацию на 0.001. Однако теперь объект не смещается вниз, пока его не сдвинут вперёд-назад или влево-вправо. Я думаю, логика игры не пострадает, если предположить, что человек, прыгая вверх чуть-чуть смещается вперёд.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,user_vy#*delta_t,user_vy#*<span style="color: #33ffdd;">0.01</span>,<span style="color: #aaffff; font-weight: bold;">True</span></div>
<p>Вот полный код:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffee00">;инициализация графики</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">32</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> camera<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> G#=<span style="color: #33ffdd;">0.001</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> USERT=<span style="color: #33ffdd;">1</span><span style="color: #ffee00">;for user</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> TERRT=<span style="color: #33ffdd;">2</span><span style="color: #ffee00">;for terrain</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> SHOTT=<span style="color: #33ffdd;">3</span><span style="color: #ffee00">;for shot</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> BOTT=<span style="color: #33ffdd;">4</span><span style="color: #ffee00">;for bot</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> BORDERT=<span style="color: #33ffdd;">5</span><span style="color: #ffee00">;for box</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> jump_bool<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user_time<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> user_vy#<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> pricel=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Crosshair.png&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> shot_sprite=<span style="color: #aaffff; font-weight: bold;">LoadSprite</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Shot.png&quot;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> shot<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> dist#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> time<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Type</span> bot<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> entity<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> time<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Field</span> Survivability<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #ffee00">;создание игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_user<span style=" ">&#40;</span>x#=<span style="color: #33ffdd;">0</span>,y#=<span style="color: #33ffdd;">10</span>,z#=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">MidHandle</span> pricel<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">MaskImage</span> pricel,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
&nbsp; <br />
&nbsp; user=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; k#=<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> user,k#,k#,k#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityRadius</span> user,k#<br />
&nbsp; camera=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">CameraRange</span> camera,<span style="color: #33ffdd;">0.1</span>,<span style="color: #33ffdd;">10000</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> user,x#,y#,z#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityType</span> user,USERT<br />
<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;обновление игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffee00">;=</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> user_time=<span style="color: #33ffdd;">0</span> user_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; new_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; delta_t=new_time-user_time<br />
&nbsp; user_time=new_time<br />
&nbsp; <span style="color: #ffee00">;=</span><br />
&nbsp; V#=<span style="color: #33ffdd;">0.02</span>*delta_t<br />
&nbsp; u#=<span style="color: #33ffdd;">70</span><span style="color: #ffee00">;предельный угол</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">TurnEntity</span> camera,<span style="color: #aaffff; font-weight: bold;">MouseYSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">TurnEntity</span> user,<span style="color: #33ffdd;">0</span>,-<span style="color: #aaffff; font-weight: bold;">MouseXSpeed</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">30</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,-V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">32</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,V#,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">17</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,+V# <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">31</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,-V#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">MoveMouse</span> <span style="color: #aaffff; font-weight: bold;">GraphicsWidth</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span>,<span style="color: #aaffff; font-weight: bold;">GraphicsHeight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">0.5</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>&gt;u# <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> camera,u#*<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityPitch</span>#<span style=" ">&#40;</span>camera<span style=" ">&#41;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> create_shot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityPitch</span><span style=" ">&#40;</span>camera<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityYaw</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; <br />
<br />
&nbsp; <span style="color: #ffee00">;физика</span><br />
&nbsp; <br />
&nbsp; <br />
&nbsp; pick_ent=<span style="color: #aaffff; font-weight: bold;">LinePick</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityY</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-3.6</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,user_vy#*delta_t,user_vy#*<span style="color: #33ffdd;">0.01</span>,<span style="color: #aaffff; font-weight: bold;">True</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pick_ent<br />
&nbsp; &nbsp; jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span><br />
&nbsp; &nbsp; user_vy=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">True</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; jump_bool=<span style="color: #aaffff; font-weight: bold;">True</span><br />
&nbsp; &nbsp; user_vy#=user_vy#-G#*delta_t<span style="color: #ffee00">;v1=v2-a*t</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
<br />
&nbsp; <span style="color: #ffee00">;;;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">57</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">And</span> jump_bool=<span style="color: #aaffff; font-weight: bold;">False</span> <span style="color: #aaffff; font-weight: bold;">Then</span> user_vy#=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_Shot<span style=" ">&#40;</span>x#,y#,z#,pitch#,yaw#,roll#<span style=" ">&#41;</span><br />
&nbsp; s.shot=<span style="color: #aaffff; font-weight: bold;">New</span> shot<br />
&nbsp; s\entity=<span style="color: #aaffff; font-weight: bold;">CopyEntity</span><span style=" ">&#40;</span>shot_sprite<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityType</span> s\entity,SHOTT<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> s\entity,x#,y#,z#,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> s\entity,pitch#,yaw#,roll#,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; v#=<span style="color: #33ffdd;">0.1</span><br />
&nbsp; max_dist#=<span style="color: #33ffdd;">1000</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> a.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
&nbsp; &nbsp; <span style="color: #ffee00">;=</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> a\time=<span style="color: #33ffdd;">0</span> a\time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; new_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; delta_t=new_time-a\time<br />
&nbsp; &nbsp; a\time=new_time<br />
&nbsp; &nbsp; vs#=v*delta_t<br />
&nbsp; &nbsp; <span style="color: #ffee00">;=</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,vs#<br />
&nbsp; &nbsp; a\dist#=a\dist#+vs#<br />
&nbsp; &nbsp; bot_h=<span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,BOTT<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> a\dist#&gt;max_dist#<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">EntityCollided</span><span style=" ">&#40;</span>a\entity,TERRT<span style=" ">&#41;</span>&lt;&gt;<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">ElseIf</span> bot_h&lt;&gt;<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> a\entity<br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> a<br />
&nbsp; &nbsp; &nbsp; bhandle=<span style="color: #aaffff; font-weight: bold;">EntityName</span><span style=" ">&#40;</span>bot_h<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; bc.bot=Object.bot<span style=" ">&#40;</span>bhandle<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; bc\Survivability=bc\Survivability<span style="color: #33ffdd;">-16</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> bc\Survivability&lt;=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Delete</span> bc<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> bot_h<br />
&nbsp; &nbsp; &nbsp; &nbsp; create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">EntityZ</span><span style=" ">&#40;</span>user<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_bot<span style=" ">&#40;</span>x#,y#,z#<span style=" ">&#41;</span><br />
&nbsp; b.bot=<span style="color: #aaffff; font-weight: bold;">New</span> bot<br />
&nbsp; b\Survivability=<span style="color: #33ffdd;">100</span><br />
&nbsp; b\entity=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityType</span> b\entity,BOTT<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> b\entity,x#,y#,z#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">NameEntity</span> b\entity,Handle<span style=" ">&#40;</span>b<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">True</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; v#=<span style="color: #33ffdd;">0.01</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> a.bot=<span style="color: #aaffff; font-weight: bold;">Each</span> bot<br />
&nbsp; &nbsp; <span style="color: #ffee00">;=</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> a\time=<span style="color: #33ffdd;">0</span> a\time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; new_time=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; delta_t=new_time-a\time<br />
&nbsp; &nbsp; a\time=new_time<br />
&nbsp; &nbsp; <span style="color: #ffee00">;=</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">PointEntity</span> a\entity,user<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> a\entity,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,v#*delta_t<br />
&nbsp; &nbsp; <span style="color: #ffee00">;физика</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">TranslateEntity</span> user,<span style="color: #33ffdd;">0</span>,-G#*delta_t,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;создание игрового мира</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; light=<span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">RotateEntity</span> light,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">HideEntity</span> shot_sprite<br />
&nbsp; terrain=<span style="color: #aaffff; font-weight: bold;">CreatePlane</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; tertex=<span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Terrain.jpg&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleTexture</span> tertex,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityTexture</span> terrain,tertex<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeTexture</span> tertex<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityType</span> terrain,TERRT<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityPickMode</span> terrain,<span style="color: #33ffdd;">2</span><br />
&nbsp; create_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <br />
&nbsp; sky=MakeSkyBox<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;FPS-Sky&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> sky,<span style="color: #33ffdd;">150</span>,<span style="color: #33ffdd;">150</span>,<span style="color: #33ffdd;">150</span><br />
&nbsp; border=MakeBox<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> border,<span style="color: #33ffdd;">140</span>,<span style="color: #33ffdd;">140</span>,<span style="color: #33ffdd;">140</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityAlpha</span> border,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityType</span> border,BORDERT<br />
&nbsp; <br />
&nbsp; c_bot=<span style="color: #aaffff; font-weight: bold;">Input</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;input Amount&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">For</span> i=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> c_bot<br />
&nbsp; &nbsp; create_bot<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-100</span>,<span style="color: #33ffdd;">100</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,BORDERT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> SHOTT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,TERRT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,USERT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> BOTT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> USERT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Collisions</span> SHOTT,BOTT,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> MakeSkyBox<span style=" ">&#40;</span> file$ <span style=" ">&#41;</span><br />
<br />
&nbsp; m=<span style="color: #aaffff; font-weight: bold;">CreateMesh</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffee00">;front face</span><br />
&nbsp; b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;FR.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
&nbsp; <span style="color: #ffee00">;right face</span><br />
&nbsp; b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;LF.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
&nbsp; <span style="color: #ffee00">;back face</span><br />
&nbsp; b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;BK.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
&nbsp; <span style="color: #ffee00">;left face</span><br />
&nbsp; b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;RT.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
&nbsp; <span style="color: #ffee00">;top face</span><br />
&nbsp; b=<span style="color: #aaffff; font-weight: bold;">LoadBrush</span><span style=" ">&#40;</span> file$+<span style="color: #00ff66;">&quot;UP.jpg&quot;</span>,<span style="color: #33ffdd;">49</span> <span style=" ">&#41;</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m,b <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FreeBrush</span> b<br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> m,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FlipMesh</span> m<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityFX</span> m,<span style="color: #33ffdd;">9</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityOrder</span> m,<span style="color: #33ffdd;">10</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> m<br />
&nbsp; <br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> MakeBox<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; m=<span style="color: #aaffff; font-weight: bold;">CreateMesh</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffee00">;front face</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #ffee00">;right face</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #ffee00">;back face</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #ffee00">;left face</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #ffee00">;top face</span><br />
&nbsp; s=<span style="color: #aaffff; font-weight: bold;">CreateSurface</span><span style=" ">&#40;</span> m<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>:<span style="color: #aaffff; font-weight: bold;">AddVertex</span> s,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">-1</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">AddTriangle</span> s,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">3</span><br />
<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> m,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span>,<span style="color: #33ffdd;">100</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">FlipMesh</span> m<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityFX</span> m,<span style="color: #33ffdd;">9</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityOrder</span> m,<span style="color: #33ffdd;">10</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> m<br />
&nbsp; <br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;функции закончились &nbsp;</span><br />
<span style="color: #ffee00">;--------------------------------</span><br />
create_world<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;MAIN LOOP</span><br />
<span style="color: #aaffff; font-weight: bold;">While</span> <span style="color: #aaffff; font-weight: bold;">Not</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">1</span><br />
&nbsp; update_user<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; update_shot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; update_bot<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">UpdateWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">RenderWorld</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">DrawImage</span> pricel,<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">10</span>,<span style="color: #00ff66;">&quot;jump_bool=&quot;</span>+jump_bool<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Wend</span><br />
<span style="color: #ffee00">;----------------------------</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Всё!
</p>
<div align="right"><a href="http://blitzetcetera.org/images/e/e8/FPS.zip" class="internal" title="FPS.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Impersonalis" title="Участник:Impersonalis">Impersonalis</a> (e-mail: impersonalis@boolean.name)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Как сделать «Asteroids» за час"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Как сделать «Asteroids» за час&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Как сделать «Asteroids» за час&amp;action=edit">править</a>]</span><span class="mw-headline">Как сделать «Asteroids» за час</span></h1>
</p>
<a name=".D0.92.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5_2"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=1" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">Введение</span></h2>
<p>Тут ты узнаешь как сделать клон "asteroids" за час. Шаг за шагом, с подробными объяснениями описано программирование и разработка игры. Если ты новичок в BlitzMax, то эта  статья для тебя.
</p><p>Для начала нам нужен план действий. Для нашей игры он будет не очень длинным. Во время разработки даже такого маленького плана, нужно быть очень внимательным, т.к. разработка плана это очень важный этап разработки игры, и если упустить какую-либо деталь, то, затем, в процессе программирования это может привести к переписыванию игры с самого начала.
</p>
<a name=".D0.9E.D0.BF.D0.B8.D1.81.D0.B0.D0.BD.D0.B8.D0.B5_.D1.8D.D1.82.D0.B0.D0.BF.D0.BE.D0.B2_.D1.80.D0.B0.D0.B7.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D0.BA.D0.B8"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=2" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">Описание этапов разработки</span></h2>
<ul><li>Визуальный (разработка)
<ul><li>Описание того, как будет играться в игру 
</li><li>Цель игры
</li></ul>
</li><li>Нарисовать на бумаге "скриншоты" будущей игры
</li><li>Технический (Программирование)
<ul><li>Описание типов
</li><li>Описание методов и функций
</li><li>Создать файлы медиа
</li></ul>
</li></ul>
<p>В игре побольше, план был бы гораздо сложнее, с множеством различных стадий. Итак, запускай секундомер, и продолжай читать. 
</p>
<a name="Asteroid_Wars_-_.D0.9E.D0.B1.D0.B7.D0.BE.D1.80"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=3" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">Asteroid Wars - Обзор</span></h2>
<p>О чем эта игра? Эта игра похожа на классический "asteroids". Наша версия будет простой и динамичной. 
</p>
<a name=".D0.A3.D0.BF.D1.80.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=4" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">Управление</span></h3>
<p>Игрок может поворачивать корабль по и против часовой стрелки клавишами вправо и влево. Клавишами вверх и вниз управляется ускорение вперед и назад(80% от ускорения вперед). Корабль может стрелять вперед с помощью клавиши пробел. 
</p>
<a name=".D0.93.D0.B5.D0.B9.D0.BC.D0.BF.D0.BB.D1.8D.D0.B9"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=5" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">Геймплэй</span></h3>
<p>Что будет делать игрок? Игровое действие происходит на различных уровнях, на каждом из которых, главной целью является уничтожение камней. Камни бывают трех размеров: большой, средний и маленький. С началом каждого уровня у игрока есть всего один корабль. При попадании снаряда в камень, он разлетаются на камни меньшего размера, исключая самые маленькие камни - они превращаться в пыль. В первом уровне всего один камень среднего размера, но, с прохождением на следующие уровни, количество и размер камней увеличиваются. Число уровней бесконечно. Если корабль сталкивается с камнем, то игра заканчивается, "жизнь" только одна… 
</p>
<a name=".D0.A6.D0.B5.D0.BB.D1.8C"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=6" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">Цель</span></h3>
<p>Главная цель игры - заработать наибольшее количество очков. 
</p><p>Разработка первой половины плана закончена. Теперь нарисуй на листке бумаги несколько картинок того, что, как ты думаешь, должно происходить на экране во время игры - это пригодиться на следующих шагах. Я не буду рассказывать как рисовать картинки:. Теперь пришло время приступить к техническому этапу разработки.
</p>
<a name=".D0.A1.D1.82.D1.80.D1.83.D0.BA.D1.82.D1.83.D1.80.D1.8B_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D1.85:"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=7" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">Структуры данных:</span></h2>
<p>TShip, TShot, TRock - все расширенные из TSpaceObject. Я решил, что для каждого из типов будет свой файл "ИмяТипа.bmx". Это не необходимо для маленькой игры, но даст коду "структурность" и спасет много времени отладки. В файле AsteroidWars, будет храниться основной цикл игры, его и надо будет запускать.
</p><p>Методы и функции объекта SpaceObject: Create - Функция,  New,  Update,  UpdateAll - Функция,  Destroy,  Draw. Остальное мы добавим по мере надобности. 
</p>
<a name=".D0.9D.D0.B0.D1.87.D0.BD.D0.B5.D0.BC_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D0.BC.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D1.82.D1.8C"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=8" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">Начнем программировать</span></h2>
<p>Начнем с того, что создадим все необходимые .bmx-файлы. Создай и открой "Ast-TSpaceObject.bmx".
</p><p>Определим поля типа. Нам нужно:
</p>
<ul><li>X и Y - координаты
</li><li>Direction - угол поворота
</li><li>Thrust - скорость в текущем направлении.
</li></ul>
<p>Вставим методы, но пока оставим их пустыми. Не закрывай этот файл - потом можно будет быстро к нему обратиться. 
</p>
<a name="Ast-TSpaceObject.bmx"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=9" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">Ast-TSpaceObject.bmx</span></h3>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TSpaceObject <span style="color: #ffff00; font-weight: bold;">Abstract</span><br />
<p><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> X#,Y#<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> XSpeed#,YSpeed#<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Direction<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> UpdateAll<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Destroy<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span></div>
<p>Создай файлы Ast-TShip.bmx, Ast-TRock.bmx, Ast-TShot.bmx и AsteroidWars.bmx. Открой их все, переключись на AsteroidWars.bmx и подключи остальные(Ast-TSpaceObject, Ast-TShip, Ast-TRock и Ast-TShot). 
</p>
<a name="AsteroidWars.bmx"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=10" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">AsteroidWars.bmx</span></h3>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Include</span> <span style="color: #00FF66;">&quot;Ast-TSpaceObject.bmx&quot;</span><br />
<p><span style="color: #ffff00; font-weight: bold;">Include</span> <span style="color: #00FF66;">&quot;Ast-TShip.bmx&quot;</span><br />
<span style="color: #ffff00; font-weight: bold;">Include</span> <span style="color: #00FF66;">&quot;Ast-TShot.bmx&quot;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">Include</span> <span style="color: #00FF66;">&quot;Ast-TRock.bmx&quot;</span></div>
<p>Переключайся на TShip и декларируй там тип (угадай с каким именем), расширенный из(угадай опять). 
</p>
<a name="Ast-TShip.bmx"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=11" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">Ast-TShip.bmx</span></h3>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TShip <span style="color: #ffff00; font-weight: bold;">Extends</span> TSpaceObject<br />
<p><br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span></div>
<p>Будешь создавать свою игру - используй туже систему с несколькими файлами. Если бы игра была сделана в одном файле, то было бы гораздо трудней в ней разбираться.
</p><p>Не думай, что в типе TShip чего-то недостаточно, TShip расширен из TSpaceObject и, следовательно, содержит все его поля. Я начну с функции Create() - она создает новый экземпляр типа корабля и добавляет его в список. Этот список надо где-то хранить, для этого в типе TShip создадим глобальную переменную List типа TList. При первом использовании списка его нужно создать. У нас в игре будет только один игрок, так что не обязательно создавать список и добавлять в него корабль, но, в случае, если кто-то собирается добавить ещё игроков, AI, врагов или даже мультиплэер то это необходимо. Необходимо также определить начальные координаты - начальныйX и начальныйY. Создай метод New() и впиши в него определение начальных координат. New() вызывается когда создается новый экземпляр типа, в котором он находится.
</p>
<a name="Ast-TShip.bmx_2"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=12" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">Ast-TShip.bmx</span></h3>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TShip <span style="color: #ffff00; font-weight: bold;">Extends</span> TSpaceObject<br />
<p><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Global</span> List:<span style="color: #ffff00; font-weight: bold;">TList</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Global</span> Image:Timage<br />
&nbsp; <br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; Ship:TShip = <span style="color: #ffff00; font-weight: bold;">New</span> TShip &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> List = <span style="color: #ffff00; font-weight: bold;">Null</span> List = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; List.<span style="">AddLast</span> Ship <span style="color: #B1E7EB;">'Добавляем Ship в конец списка List</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
&nbsp;<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Method</span> <span style="color: #ffff00; font-weight: bold;">New</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; X = <span style="color: #FFFFFF;">300</span><br />
&nbsp; Y = <span style="color: #FFFFFF;">400</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
<br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span></div>
<p>Время передохнуть… Следующий этап может занять вечность, но я уверен, что если ты сосредоточишься, то успеешь завершить его за 20мин. 30сек. Запусти свой любимый редактор изображений. Под любимым я имею в виду тот, в котором ты умеешь работать лучше всего. Как создавать медиа - это твое дело, далее лишь советы. Создай новую картинку, по размеру с корабль, я сделаю её 25x25 пикселей. На черном фоне нарисуй космический корабль, смотрящий вправо. Сохрани его как "Ast-Ship.png", если не можешь в .png, то попробуй jpg или bmp. Осталось ещё две картинки - ракета и скала. Создай картинку 20x10, это будет наша ракета. Опять же на черном фоне рисуй ракету, смотрящую вправо, и сохрани её в ту же папку, что и "Ast-Ship.png" под именем "Ast-Missile.png". Теперь рисуем скалу, она должна быть гораздо больше корабля. Сделаем только одну большую скалу, а остальные получим масштабированием первой.  На черном фоне, 100x100, рисуем камень - текстура камня или что-нибудь ещё. Вот примеры:
</p>
<table class="gallery" cellspacing="0" cellpadding="0">
	<tr>
		<td><div class="gallerybox" style="width: 150px;">
			<div class="thumb" style="padding: 13px 0; width: 150px;"><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Ast-Ship.png" title="Изображение:Ast-Ship.png"><img src="ji3zwyhc.png" width="120" height="120" alt="" /></a></div>
			<div class="gallerytext">
<p><!-- 
Pre-expand include size: 138833 bytes
Post-expand include size: 69958 bytes
Template argument size: 42 bytes
Maximum: 2097152 bytes
-->
</p>
			</div>
		</div></td>
		<td><div class="gallerybox" style="width: 150px;">
			<div class="thumb" style="padding: 43px 0; width: 150px;"><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Ast-Missile.png" title="Изображение:Ast-Missile.png"><img src="86_cj7e5.png" width="120" height="60" alt="" /></a></div>
			<div class="gallerytext">
<p><!-- 
Pre-expand include size: 138833 bytes
Post-expand include size: 69958 bytes
Template argument size: 42 bytes
Maximum: 2097152 bytes
-->
</p>
			</div>
		</div></td>
		<td><div class="gallerybox" style="width: 150px;">
			<div class="thumb" style="padding: 13px 0; width: 150px;"><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Ast-Rock.png" title="Изображение:Ast-Rock.png"><img src="aabmo546.png" width="120" height="120" alt="" /></a></div>
			<div class="gallerytext">
<p><!-- 
Pre-expand include size: 138833 bytes
Post-expand include size: 69958 bytes
Template argument size: 42 bytes
Maximum: 2097152 bytes
-->
</p>
			</div>
		</div></td>
	</tr>
</table>
<p>Теперь пропишем загрузку и центровку(MidHandleImage( Image )) "Ast-Ship.png" в функции create(). Эта картинка - глобальная, и все "новоиспеченные" корабли будут выглядеть одинаково. Создай метод Draw(), который будет поворачивать, позиционировать и отображать наш корабль на экране.
</p>
<a name="Ast-TShip.bmx_3"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=13" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">Ast-TShip.bmx</span></h3>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TShip <span style="color: #ffff00; font-weight: bold;">Extends</span> TSpaceObject<br />
<p><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Global</span> List:<span style="color: #ffff00; font-weight: bold;">TList</span> <br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Global</span> Image:Timage<br />
&nbsp;<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Ship:TShip = <span style="color: #ffff00; font-weight: bold;">New</span> TShip &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> List = <span style="color: #ffff00; font-weight: bold;">Null</span> List = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; List.<span style="">AddLast</span> Ship <span style="color: #B1E7EB;">' Добавляем Ship в конец списка List</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Not</span> Image <br />
&nbsp; &nbsp;Image = <span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;Ast-Ship.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">MidHandleImage</span><span style=" ">&#40;</span> Image <span style=" ">&#41;</span><span style="color: #B1E7EB;">'Центруем</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
&nbsp;<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Method</span> <span style="color: #ffff00; font-weight: bold;">New</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #B1E7EB;">'Начальные значения</span><br />
&nbsp; X = <span style="color: #FFFFFF;">300</span><br />
&nbsp; Y = <span style="color: #FFFFFF;">400</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">SetRotation</span><span style=" ">&#40;</span> Direction <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">DrawImage</span><span style=" ">&#40;</span> Image,X,Y <span style=" ">&#41;</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
<br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span></div>
<p>Теперь поправим метод Update() и функцию UpdateAll(). В Update() мы будем обрабатывать ввод пользователя, рисовать корабль и обновлять его движение. Можно проверить работоспособность программы, добавив вызов Draw() в метод Update. В функции UpdateAll() мы будем перебирать каждый корабль, несмотря на то, что  он у нас всего один. Это пригодиться в будущем, если понадобиться добавить ещё несколько штук. Создадим Each-in-цикл со списком List и заставим каждый объект-корабль выполнять метод Update().
</p>
<a name="Ast-TShip.bmx_4"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=14" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">Ast-TShip.bmx</span></h3>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TShip <span style="color: #ffff00; font-weight: bold;">Extends</span> TSpaceObject<br />
<p><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Global</span> List:<span style="color: #ffff00; font-weight: bold;">TList</span> <br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Global</span> Image:Timage<br />
&nbsp;<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Ship:TShip = <span style="color: #ffff00; font-weight: bold;">New</span> TShip &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> List = <span style="color: #ffff00; font-weight: bold;">Null</span> List = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; List.<span style="">AddLast</span> Ship <span style="color: #B1E7EB;">' Добавляем Ship в конец списка List</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Not</span> Image <br />
&nbsp; &nbsp;Image = <span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;Ast-Ship.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">MidHandleImage</span><span style=" ">&#40;</span> Image <span style=" ">&#41;</span><span style="color: #B1E7EB;">'Центруем</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
&nbsp;<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Method</span> <span style="color: #ffff00; font-weight: bold;">New</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #B1E7EB;">'Начальные значения</span><br />
&nbsp; X = <span style="color: #FFFFFF;">300</span><br />
&nbsp; Y = <span style="color: #FFFFFF;">400</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">SetRotation</span><span style=" ">&#40;</span> Direction <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">DrawImage</span><span style=" ">&#40;</span> Image,X,Y <span style=" ">&#41;</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #B1E7EB;">'Нужно добавить:</span><br />
&nbsp; <span style="color: #B1E7EB;">'GetInput, ввод пользователя</span><br />
&nbsp; <span style="color: #B1E7EB;">'Update physics, движение корабля</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Function</span> UpdateAll<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> Ship:TShip = <span style="color: #ffff00; font-weight: bold;">EachIn</span> List<br />
&nbsp; &nbsp;Ship.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
<br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span></div>
<p>Всё понятно? Вопросы есть? Не стесняйся спрашивать на форумах, только задавай конкретные вопросы и никогда не проси написать что-то за тебя (исключая случаи с небольшим куском кода, или алгоритма) (зам. Пер.).
</p><p>Ок, посмотрим, что у нас уже есть. Переключись на главный файл. Установи графический режим (я выбрал 800,600,0). Вызови Create() из типа TShip. Помни, что чтобы запустить функцию, находящуюся в типе, нужно вызывать её из типа, т.е. ИмяТипа.Функция(), что в нашем случае будет TShip.Create(). Создай главный цикл, выход из которого происходит при нажатии на Escape. В центре этого цикла вставь вызов UpdateAll(), а в конце - Flip и Cls. 
</p>
<a name="AsteroidWars.bmx_2"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=15" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">AsteroidWars.bmx</span></h3>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Include</span> <span style="color: #00FF66;">&quot;Ast-TSpaceObject.bmx&quot;</span><br />
<p><span style="color: #ffff00; font-weight: bold;">Include</span> <span style="color: #00FF66;">&quot;Ast-TShip.bmx&quot;</span><br />
<span style="color: #ffff00; font-weight: bold;">Include</span> <span style="color: #00FF66;">&quot;Ast-TShot.bmx&quot;</span><br />
<span style="color: #ffff00; font-weight: bold;">Include</span> <span style="color: #00FF66;">&quot;Ast-TRock.bmx&quot;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Graphics</span> <span style="color: #FFFFFF;">800</span>,<span style="color: #FFFFFF;">600</span>,<span style="color: #FFFFFF;">0</span><br />
<br />
TShip.<span style="">Create</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #B1E7EB;">'Главный цикл</span><br />
<span style="color: #ffff00; font-weight: bold;">Repeat</span><span style="color: #B1E7EB;">' - - - - - - - - - - - - - - - - - </span><br />
<br />
&nbsp;TShip.<span style="">UpdateAll</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <br />
<span style="color: #ffff00; font-weight: bold;">Flip</span><br />
<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">Until</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>Key_Escape<span style=" ">&#41;</span><span style="color: #B1E7EB;">'- - - - - - - -</span></div>
<p>Запускай!  Пока всё, что ты можешь делать - это любоваться на свой, застывший в центре  экрана, корабль. Но это только начало дальше - лучше.
</p><p>Теперь добавим интерактивности. Переключайся опять на Ast-TShip.bmx. Сейчас будем встраивать физическую модель и управление. Этот шаг не простой, но очень важный, я постараюсь объяснить всё настолько доступно, на сколько смогу. Тебе необходимы хотя бы минимальные знания о векторах, т.к. я о них тебе рассказывать не буду - тема для другой статьи. Шаг первый,  вот код метода Update():
</p>
<a name=".D0.92_.D1.84.D0.B0.D0.B9.D0.BB.D0.B5_Ast-TShip.bmx"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=16" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">В файле Ast-TShip.bmx</span></h3>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>&nbsp; Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; <span style="color: #B1E7EB;">'Возможные действия</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Up,Down,<span style="color: #ffff00; font-weight: bold;">Left</span>,<span style="color: #ffff00; font-weight: bold;">Right</span>,Fire<br />
&nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">'Действиями управляет пользователь</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>Key_Up<span style=" ">&#41;</span> &nbsp; &nbsp; Up &nbsp; = <span style="color: #ffff00; font-weight: bold;">True</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>Key_Down<span style=" ">&#41;</span> &nbsp; Down &nbsp;= <span style="color: #ffff00; font-weight: bold;">True</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>Key_Left<span style=" ">&#41;</span> &nbsp; <span style="color: #ffff00; font-weight: bold;">Left</span> &nbsp;= <span style="color: #ffff00; font-weight: bold;">True</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>Key_Right<span style=" ">&#41;</span> &nbsp;<span style="color: #ffff00; font-weight: bold;">Right</span> &nbsp;= <span style="color: #ffff00; font-weight: bold;">True</span> <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>Key_Space<span style=" ">&#41;</span> &nbsp; Fire = <span style="color: #ffff00; font-weight: bold;">True</span><br />
&nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">' ФИЗИЧЕСКАЯ МОДЕЛЬ </span><br />
&nbsp; <span style="color: #B1E7EB;">'---------------------------------------</span><br />
&nbsp; <span style="color: #B1E7EB;">'Добавь это, чтобы добавить физическую модель</span><br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> Acceleration# &nbsp; = <span style="color: #FFFFFF;">0.04</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> Friction# &nbsp; &nbsp;= <span style="color: #FFFFFF;">0.014</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> TopSpeed# &nbsp; &nbsp;= <span style="color: #FFFFFF;">2.0</span><br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> TurnAcceleration# = <span style="color: #FFFFFF;">0.18</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> TurnFriction# &nbsp; = <span style="color: #FFFFFF;">0.06</span> &nbsp;<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> TurnMax# &nbsp; &nbsp; = <span style="color: #FFFFFF;">3</span><br />
&nbsp;<br />
</p>
&nbsp; <span style="color: #B1E7EB;">'---------------------------------------</span></div>
<p><br />	
Переменные Left,Right,Up,Down и Fire я добавил для того, чтобы отделить действия от клавиш. В нашем случае это не необходимо, но если добавить игроков или AI… Пока понятно, не так ли? Надеюсь, что да, потому что основное впереди. Шаг два:
</p>
<a name=".D0.92_.D1.84.D0.B0.D0.B9.D0.BB.D0.B5_Ast-TShip.bmx_.2C.D0.BC.D0.B5.D1.82.D0.BE.D0.B4.D0.B5_Update.28.29"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=17" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">В файле Ast-TShip.bmx ,методе Update()</span></h3>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #B1E7EB;">'ФИЗИКА ДВИЖЕНИЯ</span><br />
<p>&nbsp; <span style="color: #B1E7EB;">'-------------------------------------- &nbsp; &nbsp; &nbsp; &nbsp;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Up<br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">'Создаем и прибавляем вектор ускорения к</span><br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">'вектору скорости</span><br />
&nbsp; &nbsp;XSpeed:+ <span style="color: #ffff00; font-weight: bold;">Cos</span><span style=" ">&#40;</span>Direction<span style=" ">&#41;</span>*Acceleration<br />
&nbsp; &nbsp;YSpeed:+ <span style="color: #ffff00; font-weight: bold;">Sin</span><span style=" ">&#40;</span>Direction<span style=" ">&#41;</span>*Acceleration <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Down<br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">' Создаем и вычитаем вектор ускорения из</span><br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">' вектора скорости</span><br />
&nbsp; &nbsp;XSpeed:- <span style="color: #ffff00; font-weight: bold;">Cos</span><span style=" ">&#40;</span>Direction<span style=" ">&#41;</span>*Acceleration<br />
&nbsp; &nbsp;YSpeed:- <span style="color: #ffff00; font-weight: bold;">Sin</span><span style=" ">&#40;</span>Direction<span style=" ">&#41;</span>*Acceleration<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">'Считаем длину вектора скорости</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> SpeedVectorLength# = <span style="color: #ffff00; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>XSpeed*XSpeed + YSpeed*YSpeed<span style=" ">&#41;</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> SpeedVectorLength &gt; <span style="color: #FFFFFF;">0</span><br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">'Если движемся, то уменьшаем скорость на величину трения</span><br />
&nbsp; &nbsp;XSpeed:- <span style=" ">&#40;</span>XSpeed/SpeedVectorLength<span style=" ">&#41;</span>*Friction<br />
&nbsp; &nbsp;YSpeed:- <span style=" ">&#40;</span>YSpeed/SpeedVectorLength<span style=" ">&#41;</span>*Friction<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> SpeedVectorLength &gt; TopSpeed<br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">'Если скорость больше максимальной, то уменьшаем</span><br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">'её до максимальной, хранящейся в TopSpeed</span><br />
&nbsp; &nbsp;XSpeed:+ <span style=" ">&#40;</span>XSpeed/SpeedVectorLength<span style=" ">&#41;</span>*<span style=" ">&#40;</span>TopSpeed - SpeedVectorLength<span style=" ">&#41;</span><br />
&nbsp; &nbsp;YSpeed:+ <span style=" ">&#40;</span>YSpeed/SpeedVectorLength<span style=" ">&#41;</span>*<span style=" ">&#40;</span>TopSpeed - SpeedVectorLength<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">'Двигаем</span><br />
&nbsp; X:+ XSpeed<br />
&nbsp; Y:+ YSpeed<br />
&nbsp; &nbsp; &nbsp;<br />
&nbsp; <span style="color: #B1E7EB;">'Rem 'Рисуем векторы &nbsp;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">SetRotation</span> <span style="color: #FFFFFF;">0</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span> <span style="color: #B1E7EB;">'Красный </span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawLine</span> X,Y,X,Y + YSpeed*<span style="color: #FFFFFF;">50</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span> <span style="color: #B1E7EB;">'Зеленый</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawLine</span> X,Y,X+XSpeed*<span style="color: #FFFFFF;">50</span>,Y<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">255</span> <span style="color: #B1E7EB;">'Синий</span><br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">'Это длина вектора скорости</span><br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">'Он построен сложением Красного и зеленого векторов</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawLine</span> X,Y,X+XSpeed*<span style="color: #FFFFFF;">50</span>,Y+YSpeed*<span style="color: #FFFFFF;">50</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">255</span><br />
</p>
&nbsp; <span style="color: #B1E7EB;">'EndRem</span></div>
<p>Ниже будет объяснение всего кода, а сейчас о поворотах. Шаг три:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #B1E7EB;">'ФИЗИКА ПОВОРОТА</span><br />
<p>&nbsp; <span style="color: #B1E7EB;">'--------------------------------------</span><br />
&nbsp; <span style="color: #B1E7EB;">' &nbsp; &nbsp; &nbsp; &nbsp; </span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Left</span> TurnSpeed:-TurnAcceleration<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Right</span> TurnSpeed:+TurnAcceleration &nbsp; <br />
&nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">'Лимит скорости поворота в TurnMax</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> TurnSpeed &gt; &nbsp;TurnMax TurnSpeed = &nbsp;TurnMax<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> TurnSpeed &lt; -TurnMax TurnSpeed = -TurnMax<br />
&nbsp; &nbsp; <br />
&nbsp; Direction:+TurnSpeed<br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Direction &gt; <span style="color: #FFFFFF;">360</span> &nbsp;Direction:- <span style="color: #FFFFFF;">360</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Direction &lt; <span style="color: #FFFFFF;">0</span> &nbsp;Direction:+ <span style="color: #FFFFFF;">360</span><br />
&nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">'Применяем воздействие трения на скорость поворота</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> TurnSpeed &gt; &nbsp;TurnFriction TurnSpeed:- TurnFriction<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> TurnSpeed &lt; -TurnFriction TurnSpeed:+ TurnFriction<br />
&nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">'Если трение больше скорости поворота, то прекращаем поворот</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> TurnSpeed &lt; TurnFriction <span style="color: #ffff00; font-weight: bold;">And</span> TurnSpeed &gt; -TurnFriction TurnSpeed =<span style="color: #FFFFFF;">0</span><br />
&nbsp; <br />
</p>
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndMethod</span></div>
<p>("если ты закончил 8-ой класс средней школы, то следующие 2 абзаца можно не читать" - прим. Пер.)
Перед тем как разбираться с вышеприведенным кодом, я бы посоветовал тебе его запустить и посмотреть что получилось.
</p><p>Всё вышеописанное можно обозначить одним словом: Векторы. Векторы - ключ к физике. Векторы работают и в 2D и в 3D. Я попытаюсь объяснить, что я натворил без объяснения того, что такое вектор, так что… ты поймешь. 
</p><p>Когда мы жмем Вверх или Вниз, мы хотим, чтобы двигатель корабля подтолкнул его вперед (или назад). Этот "толчок", происходящий за некоторое время, называется силой. Что же такое сила? Сила - это что-то, что ускоряет физические тела (предметы). Ты, скорее всего, уже видел уравнение: Сила = Масса x Ускорение. Это значит, что двигатель придаст большее ускорение более легкому кораблю, чем тяжелому, если действовать на них он будет с одинаковой силой. Из вышеприведенного уравнения имеем: Ускорение = Сила/Масса. У нас в игре Масса равна 1, и её можно опустить в уравнении. Таким образом, в нашей игре двигатель придает кораблю ускорение равное силе. Посмотрим код:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">If</span> Up<br />
<p>&nbsp;XSpeed:+ <span style="color: #ffff00; font-weight: bold;">Cos</span><span style=" ">&#40;</span>Direction<span style=" ">&#41;</span>*Acceleration<br />
&nbsp;YSpeed:+ <span style="color: #ffff00; font-weight: bold;">Sin</span><span style=" ">&#40;</span>Direction<span style=" ">&#41;</span>*Acceleration <br />
</p>
<span style="color: #ffff00; font-weight: bold;">EndIf</span></div>
<p>XSpeed и YSpeed - это значения вектора скорости корабля. В этом случае ускорение - это "сила толчка двигателя" Я беру его (ускорения) значение и, учитывая, что это векторная величина, в зависимости от угла направления, прибавляю его к вектору скорости.
Если бы я использовал какую-нибудь физическую библиотеку, то получилось бы что-то похожее на это: 
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">If</span> Up<br />
<p>&nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> Thruster:Vector = NewVector<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;Thruster.<span style="">SetLength</span><span style=" ">&#40;</span> Acceleration <span style=" ">&#41;</span><br />
&nbsp;Thruster.<span style="">SetDir</span><span style=" ">&#40;</span> Direction <span style=" ">&#41;</span><br />
&nbsp;Speed.<span style="">Add</span><span style=" ">&#40;</span> Thruster <span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">EndIf</span></div>
<p>Чтобы уменьшить скорость нужно уменьшить длину вектора скорости, а не сами его значения (XSpeed и YSpeed). Чтобы получить длину вектора, используем теорему Пифагора. 
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Local</span> SpeedVectorLength# = <span style="color: #ffff00; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>XSpeed*XSpeed + YSpeed*YSpeed<span style=" ">&#41;</span></div>
<p>Трение применяется к скорости так: 
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">If</span> SpeedVectorLength &gt; <span style="color: #FFFFFF;">0</span><br />
<p>&nbsp;XSpeed:- <span style=" ">&#40;</span>XSpeed/SpeedVectorLength<span style=" ">&#41;</span>*Friction<br />
&nbsp;YSpeed:- <span style=" ">&#40;</span>YSpeed/SpeedVectorLength<span style=" ">&#41;</span>*Friction<br />
</p>
<span style="color: #ffff00; font-weight: bold;">EndIf</span></div>
<p>Выражение XSpeed/SpeedVectorLength создает единичный вектор, сонаправленный вектору скорости. Это значит, что длина полученного вектора равна единице, а направление остается тем же. Затем я умножаю полученный вектор на силу Трения и получаю вектор, сонаправленный вектору скорости, но уже с длиной равной силе трения. После чего я вычитаю из вектора скорости полученный вектор. С библиотекой векторов это было бы похоже на это:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">Speed.<span style="">Sub</span><span style=" ">&#40;</span> Speed.<span style="">Unit</span><span style=" ">&#40;</span><span style=" ">&#41;</span>.<span style="">Multiply</span><span style=" ">&#40;</span>Friction<span style=" ">&#41;</span> <span style=" ">&#41;</span></div>
<p>Или
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">Speed.<span style="">Decrease</span><span style=" ">&#40;</span> Friction <span style=" ">&#41;</span></div>
<p>Нам также нужно ввести предел скорости. В реальном мире этот предел зависел бы от трения, которого нет в космосе. В мире нашей игры мы диктуем законы физики, так что мы будем использовать одновременно и трение и предел скорости.  
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">If</span> SpeedVectorLength &gt; TopSpeed<br />
<p>&nbsp;XSpeed:+ <span style=" ">&#40;</span>XSpeed/SpeedVectorLength<span style=" ">&#41;</span>*<span style=" ">&#40;</span>TopSpeed - SpeedVectorLength<span style=" ">&#41;</span><br />
&nbsp;YSpeed:+ <span style=" ">&#40;</span>YSpeed/SpeedVectorLength<span style=" ">&#41;</span>*<span style=" ">&#40;</span>TopSpeed - SpeedVectorLength<span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">EndIf</span></div>
<p>Если скорость превышает определенный предел, то мы вычитаем из неё ту величину, на которую она этот предел превышает, (TopSpeed - SpeedVectorLength). Это то же самое, что и трение, с одним замечанием, что сила трения зависит от скорости. С библиотекой векторов:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">If</span> Speed.<span style="">Length</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &gt; MaxSpeed <span style="color: #ffff00; font-weight: bold;">Then</span> Speed.<span style="">SetLength</span><span style=" ">&#40;</span> MaxSpeed <span style=" ">&#41;</span></div>
<p>Последний шаг - изменить позицию корабля в зависимости от скорости 
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">X:+ XSpeed<br />
Y:+ Yspeed</div>
<p>С библиотекой векторов:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">Position.<span style="">Add</span><span style=" ">&#40;</span> Speed <span style=" ">&#41;</span></div>
<p>С поворотом дело обстоит проще, так что я не буду про него писать. Поиграй с шестью переменными (Acceleration# и т.д.), и выбери наилучший вариант. Такая физическая модель подходит для большинства игр с видом сверху. Если делаешь гонки, то я посоветую увеличить TurnAcceleration#, чтобы получить более поддающееся управление, сила трения поворота (TurnFriction#), в данном случае, будет равна качеству сцепления с дорогой. 
</p>
<a name="Ast-TShip.bmx_5"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=18" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">Ast-TShip.bmx</span></h3>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TShip <span style="color: #ffff00; font-weight: bold;">Extends</span> TSpaceObject<br />
<p><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Global</span> List:<span style="color: #ffff00; font-weight: bold;">TList</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Global</span> Image:Timage<br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Field</span> TurnSpeed#<br />
&nbsp; <br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Ship:TShip = <span style="color: #ffff00; font-weight: bold;">New</span> TShip &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> List = <span style="color: #ffff00; font-weight: bold;">Null</span> List = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; List.<span style="">AddLast</span> Ship <span style="color: #B1E7EB;">' Добавляем Ship в конец списка List</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Not</span> Image <br />
&nbsp; &nbsp;Image = <span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;Ast-Ship.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">MidHandleImage</span><span style=" ">&#40;</span> Image <span style=" ">&#41;</span><span style="color: #B1E7EB;">'Центруем</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
&nbsp;<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Method</span> <span style="color: #ffff00; font-weight: bold;">New</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #B1E7EB;">'Начальные значения</span><br />
&nbsp; X = <span style="color: #FFFFFF;">300</span><br />
&nbsp; Y = <span style="color: #FFFFFF;">400</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
&nbsp;<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">SetRotation</span><span style=" ">&#40;</span> Direction <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">DrawImage</span><span style=" ">&#40;</span> Image,X,Y <span style=" ">&#41;</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; <span style="color: #B1E7EB;">'Возможные действия</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Up,Down,<span style="color: #ffff00; font-weight: bold;">Left</span>,<span style="color: #ffff00; font-weight: bold;">Right</span>,Fire<br />
&nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">' Действиями управляет пользователь, Игрок 1</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>Key_Up<span style=" ">&#41;</span> &nbsp; &nbsp; Up &nbsp; = <span style="color: #ffff00; font-weight: bold;">True</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>Key_Down<span style=" ">&#41;</span> &nbsp; Down &nbsp;= <span style="color: #ffff00; font-weight: bold;">True</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>Key_Left<span style=" ">&#41;</span> &nbsp; <span style="color: #ffff00; font-weight: bold;">Left</span> &nbsp;= <span style="color: #ffff00; font-weight: bold;">True</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>Key_Right<span style=" ">&#41;</span> &nbsp;<span style="color: #ffff00; font-weight: bold;">Right</span> &nbsp;= <span style="color: #ffff00; font-weight: bold;">True</span> <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span>Key_Space<span style=" ">&#41;</span> &nbsp;Fire = <span style="color: #ffff00; font-weight: bold;">True</span><br />
&nbsp;<br />
&nbsp;<br />
&nbsp; <span style="color: #B1E7EB;">' ФИЗИЧЕСКАЯ МОДЕЛЬ </span><br />
&nbsp; <span style="color: #B1E7EB;">'---------------------------------------</span><br />
&nbsp; <span style="color: #B1E7EB;">'Добавь это, чтобы добавить физическую модель</span><br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> Acceleration# &nbsp; = <span style="color: #FFFFFF;">0.04</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> Friction# &nbsp; &nbsp;= <span style="color: #FFFFFF;">0.014</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> TopSpeed# &nbsp; &nbsp;= <span style="color: #FFFFFF;">2.0</span><br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> TurnAcceleration# = <span style="color: #FFFFFF;">0.18</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> TurnFriction# &nbsp; = <span style="color: #FFFFFF;">0.03</span> &nbsp;<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> TurnMax# &nbsp; &nbsp; = <span style="color: #FFFFFF;">5</span><br />
&nbsp;<br />
&nbsp; <span style="color: #B1E7EB;">'--------------------------------------- </span><br />
&nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">'ФИЗИКА ДВИЖЕНИЯ</span><br />
&nbsp; <span style="color: #B1E7EB;">'--------------------------------------</span><br />
&nbsp; <span style="color: #B1E7EB;">' &nbsp; &nbsp; &nbsp; &nbsp; </span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Up<br />
<br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">' Создаем и вычитаем вектор ускорения из</span><br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">' вектора скорости</span><br />
&nbsp; &nbsp;XSpeed:+ <span style="color: #ffff00; font-weight: bold;">Cos</span><span style=" ">&#40;</span>Direction<span style=" ">&#41;</span>*Acceleration<br />
&nbsp; &nbsp;YSpeed:+ <span style="color: #ffff00; font-weight: bold;">Sin</span><span style=" ">&#40;</span>Direction<span style=" ">&#41;</span>*Acceleration <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Down<br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">' Создаем и вычитаем вектор ускорения из</span><br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">' вектора скорости</span><br />
&nbsp; &nbsp;XSpeed:- <span style="color: #ffff00; font-weight: bold;">Cos</span><span style=" ">&#40;</span>Direction<span style=" ">&#41;</span>*Acceleration<br />
&nbsp; &nbsp;YSpeed:- <span style="color: #ffff00; font-weight: bold;">Sin</span><span style=" ">&#40;</span>Direction<span style=" ">&#41;</span>*Acceleration<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">'Считаем длину вектора скорости</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> SpeedVectorLength# = <span style="color: #ffff00; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>XSpeed*XSpeed + YSpeed*YSpeed<span style=" ">&#41;</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> SpeedVectorLength &gt; <span style="color: #FFFFFF;">0</span><br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">'Если движемся, то уменьшаем скорость на величину трения</span><br />
&nbsp; &nbsp;XSpeed:- <span style=" ">&#40;</span>XSpeed/SpeedVectorLength<span style=" ">&#41;</span>*Friction<br />
&nbsp; &nbsp;YSpeed:- <span style=" ">&#40;</span>YSpeed/SpeedVectorLength<span style=" ">&#41;</span>*Friction<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> SpeedVectorLength &gt; TopSpeed<br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">'Если скорость больше максимальной, то уменьшаем</span><br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">'её до максимальной, хранящейся в TopSpeed</span><br />
&nbsp; &nbsp;XSpeed:+ <span style=" ">&#40;</span>XSpeed/SpeedVectorLength<span style=" ">&#41;</span>*<span style=" ">&#40;</span>TopSpeed - SpeedVectorLength<span style=" ">&#41;</span><br />
&nbsp; &nbsp;YSpeed:+ <span style=" ">&#40;</span>YSpeed/SpeedVectorLength<span style=" ">&#41;</span>*<span style=" ">&#40;</span>TopSpeed - SpeedVectorLength<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">'Двигаем</span><br />
&nbsp; X:+ XSpeed<br />
&nbsp; Y:+ YSpeed<br />
&nbsp; &nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">'Rem 'Рисуем векторы &nbsp;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">SetRotation</span> <span style="color: #FFFFFF;">0</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span> <span style="color: #B1E7EB;">'Красный </span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawLine</span> X,Y,X,Y + YSpeed*<span style="color: #FFFFFF;">50</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">0</span> <span style="color: #B1E7EB;">'Зеленый</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawLine</span> X,Y,X+XSpeed*<span style="color: #FFFFFF;">50</span>,Y<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">255</span> <span style="color: #B1E7EB;">'Синий</span><br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">'Это длина вектора скорости</span><br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">'Он построен сложением красного и зеленого векторов</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">DrawLine</span> X,Y,X+XSpeed*<span style="color: #FFFFFF;">50</span>,Y+YSpeed*<span style="color: #FFFFFF;">50</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">SetColor</span> <span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">255</span>,<span style="color: #FFFFFF;">255</span><br />
&nbsp; <span style="color: #B1E7EB;">'EndRem </span><br />
&nbsp; &nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">'ФИЗИКА ПОВОРОТА</span><br />
&nbsp; <span style="color: #B1E7EB;">'--------------------------------------</span><br />
&nbsp; <span style="color: #B1E7EB;">' &nbsp; &nbsp; &nbsp; &nbsp; </span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Left</span> TurnSpeed:-TurnAcceleration<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Right</span> TurnSpeed:+TurnAcceleration &nbsp; <br />
&nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">'Предел для TurnSpeed</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> TurnSpeed &gt; &nbsp;TurnMax TurnSpeed = &nbsp;TurnMax<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> TurnSpeed &lt; -TurnMax TurnSpeed = -TurnMax<br />
&nbsp; &nbsp; <br />
&nbsp; Direction:+TurnSpeed<br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Direction &gt; <span style="color: #FFFFFF;">360</span> &nbsp;Direction:- <span style="color: #FFFFFF;">360</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Direction &lt; <span style="color: #FFFFFF;">0</span> &nbsp;Direction:+ <span style="color: #FFFFFF;">360</span><br />
&nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">'Применяем силу трения для поворота</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> TurnSpeed &gt; &nbsp;TurnFriction TurnSpeed:- TurnFriction<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> TurnSpeed &lt; -TurnFriction TurnSpeed:+ TurnFriction<br />
&nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">'Если сила трения больше скорости поворота, то прекращаем поворот</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> TurnSpeed &lt; TurnFriction <span style="color: #ffff00; font-weight: bold;">And</span> TurnSpeed &gt; -TurnFriction TurnSpeed = <span style="color: #FFFFFF;">0</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Fire TShot.<span style="">Fire</span><span style=" ">&#40;</span> X, Y, Direction, XSpeed, YSpeed <span style=" ">&#41;</span><br />
&nbsp; <br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Function</span> UpdateAll<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Ship:TShip<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> Ship = <span style="color: #ffff00; font-weight: bold;">EachIn</span> List<br />
&nbsp; &nbsp;Ship.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
<br />
</p>
<span style="color: #ffff00; font-weight: bold;">End</span> <span style="color: #ffff00; font-weight: bold;">Type</span></div>
<p>Теперь добавим выстрелы. Открой Ast-TShot.bmx и создай в нем тип TShot, расширенный из TSpaceObject. Нам понадобиться список, чтобы хранить в нем все снаряды. Создай метод Create(), похожий на Create() из TShip. Для снаряда мы будем использовать картинку Ast-Missile.png.
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Ast-Missile.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Ast-Missile.png" src="86_cj7e5.png" width="20" height="10" /></a></span></div></div>
<a name="Ast-TShot.bmx"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=19" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">Ast-TShot.bmx</span></h3>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TShot <span style="color: #ffff00; font-weight: bold;">Extends</span> TSpaceObject<br />
<p><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Global</span> List:<span style="color: #ffff00; font-weight: bold;">TList</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Global</span> Image:TImage<br />
&nbsp;<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Shot:TShot = <span style="color: #ffff00; font-weight: bold;">New</span> TShot &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> List = <span style="color: #ffff00; font-weight: bold;">Null</span> List = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; List.<span style="">AddLast</span> Shot <span style="color: #B1E7EB;">'Добавим созданный выстрел в список List</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Not</span> Image<br />
&nbsp; &nbsp;Shot.<span style="">Image</span> = <span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;Ast-Shot.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">MidHandleImage</span><span style=" ">&#40;</span> Shot.<span style="">Image</span> <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
&nbsp;<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Function</span> UpdateAll<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
&nbsp; <br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Method</span> Destroy<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
&nbsp;<br />
</p>
<span style="color: #ffff00; font-weight: bold;">EndType</span></div>
<p>Теперь можно создавать снаряды, но откуда они будут появляться? При выстреле снаряды всегда должны появляться спереди стреляющего корабля. Придется добавить парочку параметров в функцию Create().
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> Create<span style=" ">&#40;</span> X, Y, Direction, XSpeed, YSpeed <span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> Shot:TShot = <span style="color: #ffff00; font-weight: bold;">New</span> TShot &nbsp;<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">If</span> List = <span style="color: #ffff00; font-weight: bold;">Null</span> List = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;List.<span style="">AddLast</span> Shot <span style="color: #B1E7EB;">'Добавим созданный выстрел в список List</span><br />
&nbsp; <br />
&nbsp;Shot.<span style="">X</span> = X<br />
&nbsp;Shot.<span style="">Y</span> = Y<br />
&nbsp;Shot.<span style="">Direction</span> = Direction<br />
&nbsp;Shot.<span style="">XSpeed</span> = XSpeed<br />
&nbsp;Shot.<span style="">YSpeed</span> = YSpeed<br />
&nbsp; <br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Not</span> Image<br />
&nbsp; Shot.<span style="">Image</span> = <span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;Ast-Shot.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">MidHandleImage</span><span style=" ">&#40;</span> Shot.<span style="">Image</span> <span style=" ">&#41;</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp;<br />
</p>
<span style="color: #ffff00; font-weight: bold;">EndFunction</span></div>
<p>Поправим сплагиатированные из Ast-TShip.bmx Update() и UpdateAll(), чтобы их можно было использовать со снарядами. Вот что должно получиться: 
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TShot <span style="color: #ffff00; font-weight: bold;">Extends</span> TSpaceObject<br />
<p><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Global</span> List:<span style="color: #ffff00; font-weight: bold;">TList</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Global</span> Image:TImage<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Fire<span style=" ">&#40;</span> X, Y, Direction, XSpeed, YSpeed &nbsp;<span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Shot:TShot = <span style="color: #ffff00; font-weight: bold;">New</span> TShot &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> List = <span style="color: #ffff00; font-weight: bold;">Null</span> List = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; List.<span style="">AddLast</span> Shot<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Not</span> Image<span style="color: #B1E7EB;">'First Time</span><br />
&nbsp; &nbsp; &nbsp; Image = <span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;Ast-Missile.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">MidHandleImage</span><span style=" ">&#40;</span> Image <span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> ShotSpeed#= <span style="color: #FFFFFF;">8</span><br />
&nbsp; &nbsp; Shot.<span style="">X</span> &nbsp; &nbsp; &nbsp;= X<br />
&nbsp; &nbsp; Shot.<span style="">Y</span> &nbsp; &nbsp; &nbsp;= Y<br />
&nbsp; &nbsp; Shot.<span style="">Direction</span> &nbsp;= Direction<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #B1E7EB;">'Add Shot Start Speed</span><br />
&nbsp; &nbsp; Shot.<span style="">XSpeed</span>= <span style="color: #ffff00; font-weight: bold;">Cos</span><span style=" ">&#40;</span>Direction<span style=" ">&#41;</span>*ShotSpeed + XSpeed<br />
&nbsp; &nbsp; Shot.<span style="">YSpeed</span>= <span style="color: #ffff00; font-weight: bold;">Sin</span><span style=" ">&#40;</span>Direction<span style=" ">&#41;</span>*ShotSpeed + YSpeed<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetRotation</span><span style=" ">&#40;</span> Direction <span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawImage</span><span style=" ">&#40;</span> Image,X,Y <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; X:+ XSpeed<br />
&nbsp; &nbsp; Y:+ YSpeed &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> X &gt; <span style="color: #FFFFFF;">800</span> <span style="color: #ffff00; font-weight: bold;">Or</span> Y &gt; <span style="color: #FFFFFF;">600</span> <span style="color: #ffff00; font-weight: bold;">Or</span> X &lt; <span style="color: #FFFFFF;">0</span> <span style="color: #ffff00; font-weight: bold;">Or</span> Y &lt; <span style="color: #FFFFFF;">0</span> Destroy<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> UpdateAll<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Not</span> List <span style="color: #ffff00; font-weight: bold;">Return</span> <br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Shot:TShot<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> Shot = <span style="color: #ffff00; font-weight: bold;">EachIn</span> List<br />
&nbsp; &nbsp; &nbsp; Shot.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Destroy<span style=" ">&#40;</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; List.<span style="">remove</span><span style=" ">&#40;</span> <span style="color: #ffff00; font-weight: bold;">Self</span> <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
&nbsp; <br />
</p>
<span style="color: #ffff00; font-weight: bold;">EndType</span></div>
<p>Тут всё говорит само за себя, кроме этого:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;">Shot.<span style="">XSpeed</span>= <span style="color: #ffff00; font-weight: bold;">Cos</span><span style=" ">&#40;</span>Direction<span style=" ">&#41;</span>*ShotSpeed + XSpeed<br />
Shot.<span style="">YSpeed</span>= <span style="color: #ffff00; font-weight: bold;">Sin</span><span style=" ">&#40;</span>Direction<span style=" ">&#41;</span>*ShotSpeed + YSpeed</div>
<p>Опять векторы =). Это то же самое, что и ускорение вперед. В нашей игре на выстрелы не действует сила трения, и они не могут поворачивать, так что код метода Update() у них гораздо проще, чем в Ast-TShip.bmx. 
</p><p>Чтобы добавить возможность стрелять, нужно добавить в метод Update() типа TShip добавить: 
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">If</span> Fire TShot.<span style="">Fire</span><span style=" ">&#40;</span> X, Y, Direction, XSpeed, YSpeed <span style=" ">&#41;</span></div>
<p>Ок, круто - мы можем ездить по экрану и стрелять. Теперь нужно добавить чего-нибудь, по чему можно пострелять - камней. Но перед этим добавим границы, если вылететь за край экрана, то корабль появиться с другой стороны. 
Добавь следующие строки в метод Update() файла Ast-TShip.bmx:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">If</span> X &gt; <span style="color: #FFFFFF;">800</span> X = <span style="color: #FFFFFF;">0</span><br />
<p>&nbsp;<span style="color: #ffff00; font-weight: bold;">If</span> Y &gt; <span style="color: #FFFFFF;">600</span> Y = <span style="color: #FFFFFF;">0</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">If</span> X &lt; <span style="color: #FFFFFF;">0</span> X = <span style="color: #FFFFFF;">800</span><br />
</p>
&nbsp;<span style="color: #ffff00; font-weight: bold;">If</span> Y &lt; <span style="color: #FFFFFF;">0</span> Y = <span style="color: #FFFFFF;">600</span></div>
<p>Переключайся на Ast-TRock.bmx. Этот тип очень похож на TShot. Нужно принять во внимание, что камни приходятся разных размеров. Для этого я добавил два поля - Size (размер - прим. пер.) и Rotation (поворот - прим. пер.).
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TRock <span style="color: #ffff00; font-weight: bold;">Extends</span> TSpaceObject<br />
<p><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Global</span> List:<span style="color: #ffff00; font-weight: bold;">TList</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Global</span> Image:TImage<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Field</span> Size<br />
</p>
&nbsp;<span style="color: #ffff00; font-weight: bold;">Field</span> Rotation#</div>
<p>Я также добавлю три константы. Всякий раз, когда мне нужно определить размер, я могу написать: Size = 1 или 2. С использованием констант это будет выглядеть так: Size = SMALL or MEDIUM (small - маленький; medium-средний; - прим. пер.). Такой прием очень часто используется в программировании, т.к. упрощает код.  
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Const</span> LARGE &nbsp;= <span style="color: #FFFFFF;">3</span><br />
<p>&nbsp;<span style="color: #ffff00; font-weight: bold;">Const</span> MEDIUM = <span style="color: #FFFFFF;">2</span><br />
</p>
&nbsp;<span style="color: #ffff00; font-weight: bold;">Const</span> SMALL &nbsp;= <span style="color: #FFFFFF;">1</span></div>
<p>Вместо Create() я назову эту функцию Spawn(), она почти то же самое, что и Create() из TShot и TShip.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> Spawn<span style=" ">&#40;</span> X, Y ,Size <span style=" ">&#41;</span><br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Rock:TRock = <span style="color: #ffff00; font-weight: bold;">New</span> TRock &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Not</span> List List = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; List.<span style="">AddLast</span> Rock<br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Not</span> Image<span style="color: #B1E7EB;">'Нет ещё картинки</span><br />
&nbsp; &nbsp;Image = <span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;Ast-Rock.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">MidHandleImage</span><span style=" ">&#40;</span> Image <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> RockSpeed# = <span style="color: #FFFFFF;">0</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Select</span> Size<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Case</span> LARGE<span style="color: #B1E7EB;">'Большой &nbsp;</span><br />
&nbsp; &nbsp; RockSpeed = <span style="color: #FFFFFF;">0.2</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Case</span> MEDIUM<span style="color: #B1E7EB;">'Средний</span><br />
&nbsp; &nbsp; RockSpeed = <span style="color: #FFFFFF;">0.5</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Case</span> SMALL<span style="color: #B1E7EB;">'Маленький </span><br />
&nbsp; &nbsp; RockSpeed = <span style="color: #FFFFFF;">1</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndSelect</span><br />
&nbsp; <br />
&nbsp; Rock.<span style="">X</span> &nbsp; &nbsp; = X<br />
&nbsp; Rock.<span style="">Y</span> &nbsp; &nbsp; = Y<br />
&nbsp; Rock.<span style="">Direction</span> &nbsp; = <span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">360</span><span style=" ">&#41;</span><br />
&nbsp; Rock.<span style="">Rotation</span> &nbsp; = Rock.<span style="">Direction</span><br />
&nbsp; Rock.<span style="">Size</span> &nbsp; &nbsp;= Size<br />
&nbsp; <br />
&nbsp; <span style="color: #B1E7EB;">'Определяем начальную скорость</span><br />
&nbsp; Rock.<span style="">XSpeed</span>= <span style="color: #ffff00; font-weight: bold;">Cos</span><span style=" ">&#40;</span>Rock.<span style="">Direction</span><span style=" ">&#41;</span>*RockSpeed<br />
&nbsp; Rock.<span style="">YSpeed</span>= <span style="color: #ffff00; font-weight: bold;">Sin</span><span style=" ">&#40;</span>Rock.<span style="">Direction</span><span style=" ">&#41;</span>*RockSpeed<br />
</p>
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndFunction</span></div>
<p><br />	
Код выше говорит сам за себя, камни летят с неизменной скоростью, пока их кто-нибудь не разнесет.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Select</span> <span style="color: #ffff00; font-weight: bold;">Self</span>.<span style="">Size</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Case</span> LARGE<span style="color: #B1E7EB;">'Большой &nbsp;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetScale</span> <span style="color: #FFFFFF;">2</span>,<span style="color: #FFFFFF;">2</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Case</span> MEDIUM<span style="color: #B1E7EB;">'Средний</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetScale</span> <span style="color: #FFFFFF;">1</span>,<span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Case</span> SMALL<span style="color: #B1E7EB;">'Маленький </span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetScale</span> <span style="color: #FFFFFF;">0.5</span>, <span style="color: #FFFFFF;">0.5</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndSelect</span><br />
&nbsp; &nbsp;<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">SetRotation</span><span style=" ">&#40;</span> Rotation <span style=" ">&#41;</span><br />
&nbsp; Rotation:<span style="color: #FFFFFF;">+0.5</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">DrawImage</span><span style=" ">&#40;</span> Image,X,Y <span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">SetScale</span> <span style="color: #FFFFFF;">1</span>,<span style="color: #FFFFFF;">1</span><br />
</p>
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndMethod</span></div>
<p><br />	
Заметь - появился новый метод Collision(), я расскажу про него через секунду. 
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>&nbsp; Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; X:+ XSpeed<br />
&nbsp; Y:+ YSpeed &nbsp; <br />
&nbsp; <br />
&nbsp; Collision<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> X &gt; <span style="color: #FFFFFF;">800</span> X = <span style="color: #FFFFFF;">0</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Y &gt; <span style="color: #FFFFFF;">600</span> Y = <span style="color: #FFFFFF;">0</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> X &lt; <span style="color: #FFFFFF;">0</span> X = <span style="color: #FFFFFF;">800</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Y &lt; <span style="color: #FFFFFF;">0</span> Y = <span style="color: #FFFFFF;">600</span> &nbsp;<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Function</span> UpdateAll<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Not</span> List <span style="color: #ffff00; font-weight: bold;">Return</span> <br />
&nbsp; <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> Rock:TRock = <span style="color: #ffff00; font-weight: bold;">EachIn</span> List<br />
&nbsp; &nbsp;Rock.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Method</span> Destroy<span style=" ">&#40;</span><span style=" ">&#41;</span> <br />
&nbsp; List.<span style="color: #B1E7EB;">Remove( Self )<br />
&nbsp;EndMethod<br />
</p>
</span></div>
<p>До этого момента камни летали себе в космосе и никого не трогали. Нам нужно, чтобы они взаимодействовали с кораблем и снарядами, так чтобы они представляли опасность для корабля и могли быть уничтожены снарядами.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Method</span> Collision<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Radius<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Select</span> Size<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Case</span> LARGE<span style="color: #B1E7EB;">'Большой &nbsp;</span><br />
&nbsp; &nbsp; Radius = <span style="color: #FFFFFF;">100</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Case</span> MEDIUM<span style="color: #B1E7EB;">'Средний</span><br />
&nbsp; &nbsp; Radius = <span style="color: #FFFFFF;">50</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Case</span> SMALL<span style="color: #B1E7EB;">'Маленький</span><br />
&nbsp; &nbsp; Radius = <span style="color: #FFFFFF;">20</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndSelect</span><br />
&nbsp;<br />
&nbsp; <span style="color: #B1E7EB;">'Если камень попадает в корабль</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> TShip.<span style="">List</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> Ship:TShip = <span style="color: #ffff00; font-weight: bold;">EachIn</span> TShip.<span style="">List</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Distance<span style=" ">&#40;</span> X, Y, Ship.<span style="">X</span>, Ship.<span style="">Y</span> <span style=" ">&#41;</span> &lt; Radius<br />
&nbsp; &nbsp; &nbsp;Ship.<span style="">Destroy</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #B1E7EB;">'Корабль = Мертв &nbsp;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Next</span><br />
</p>
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span></div>
<p>При проверке на столкновение корабля и камня я использовал тот факт, что если корабль ближе к камню, чем его (камня) радиус, то столкновение произошло. Камни в нашей игре круглые, так что это должно работать. Тот же метод мы будем использовать и для снарядов.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #B1E7EB;">'Если снаряд попадает в камень</span><br />
<p>&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Not</span> TShot.<span style="">List</span> <span style="color: #ffff00; font-weight: bold;">Return</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> Shot:TShot = <span style="color: #ffff00; font-weight: bold;">EachIn</span> TShot.<span style="">List</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">If</span> Distance<span style=" ">&#40;</span> X, Y, Shot.<span style="">X</span>, Shot.<span style="">Y</span> <span style=" ">&#41;</span> &lt; Radius<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; Shot.<span style="">Destroy</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Select</span> Size<br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Case</span> LARGE <br />
&nbsp; &nbsp; &nbsp; Destroy<span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #B1E7EB;">'Разрушаем камень </span><br />
&nbsp; &nbsp; &nbsp; Spawn<span style=" ">&#40;</span> X, Y , MEDIUM <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; Spawn<span style=" ">&#40;</span> X, Y , MEDIUM <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Case</span> MEDIUM<br />
&nbsp; &nbsp; &nbsp; Destroy<span style=" ">&#40;</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; &nbsp; Spawn<span style=" ">&#40;</span> X, Y , SMALL <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; Spawn<span style=" ">&#40;</span> X, Y , SMALL <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Case</span> SMALL<br />
&nbsp; &nbsp; &nbsp; Destroy<span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #B1E7EB;">'</span><br />
&nbsp; &nbsp; &nbsp; Score:<span style="color: #FFFFFF;">+1</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndSelect</span><br />
&nbsp;<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span> <br />
</p>
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndMethod</span></div>
<p>Если снаряд раздолбал камень, то появляется два поменьше, исключая случай, если у раздолбанного камня размер - Small. Вот функция, которая вычисляет расстояние между двумя точками:
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Function</span> Distance#<span style=" ">&#40;</span> X1, Y1, X2, Y2 <span style=" ">&#41;</span><br />
<p>&nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> DX# = X2 - X1<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> DY# = Y2 - Y1<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Return</span> <span style="color: #ffff00; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>Dx*Dx + Dy*Dy<span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">EndFunction</span></div>
<p>Расстояние тут вычисляется по теореме Пифагора. Что… не знаешь такого? Ты верно в школе не учился? 
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Type</span> TRock <span style="color: #ffff00; font-weight: bold;">Extends</span> TSpaceObject<br />
<p><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Global</span> List:<span style="color: #ffff00; font-weight: bold;">TList</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Global</span> Image:TImage<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Size<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Field</span> Rotation#<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Const</span> LARGE &nbsp;= <span style="color: #FFFFFF;">3</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Const</span> MEDIUM = <span style="color: #FFFFFF;">2</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Const</span> SMALL &nbsp;= <span style="color: #FFFFFF;">1</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> Spawn<span style=" ">&#40;</span> X, Y ,Size <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Rock:TRock = <span style="color: #ffff00; font-weight: bold;">New</span> TRock&nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Not</span> List List = <span style="color: #ffff00; font-weight: bold;">CreateList</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List.<span style="">AddLast</span> Rock<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Not</span> Image<span style="color: #B1E7EB;">'First Time</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Image = <span style="color: #ffff00; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span><span style="color: #00FF66;">&quot;Ast-Rock.png&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">MidHandleImage</span><span style=" ">&#40;</span> Image <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> RockSpeed# = <span style="color: #FFFFFF;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Select</span> Size<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> LARGE<span style="color: #B1E7EB;">'Large&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RockSpeed = <span style="color: #FFFFFF;">0.5</span> + <span style="color: #ffff00; font-weight: bold;">Rnd</span><span style=" ">&#40;</span> <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">0.5</span> <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> MEDIUM<span style="color: #B1E7EB;">'Medium</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RockSpeed = <span style="color: #FFFFFF;">1</span> + <span style="color: #ffff00; font-weight: bold;">Rnd</span><span style=" ">&#40;</span> <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">1.0</span> <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> SMALL<span style="color: #B1E7EB;">'Small&nbsp; &nbsp; &nbsp; &nbsp; </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RockSpeed = <span style="color: #FFFFFF;">1</span> &nbsp; + <span style="color: #ffff00; font-weight: bold;">Rnd</span><span style=" ">&#40;</span> <span style="color: #FFFFFF;">0</span>, <span style="color: #FFFFFF;">1.5</span> <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndSelect</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rock.<span style="">X</span> &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= X<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rock.<span style="">Y</span> &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= Y<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rock.<span style="">Direction</span> &nbsp; = <span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">360</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rock.<span style="">Rotation</span> &nbsp; &nbsp;= Rock.<span style="">Direction</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rock.<span style="">Size</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= Size<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Add Rock Start Speed</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rock.<span style="">XSpeed</span>= <span style="color: #ffff00; font-weight: bold;">Cos</span><span style=" ">&#40;</span>Rock.<span style="">Direction</span><span style=" ">&#41;</span>*RockSpeed<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rock.<span style="">YSpeed</span>= <span style="color: #ffff00; font-weight: bold;">Sin</span><span style=" ">&#40;</span>Rock.<span style="">Direction</span><span style=" ">&#41;</span>*RockSpeed<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Select</span> <span style="color: #ffff00; font-weight: bold;">Self</span>.<span style="">Size</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> LARGE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetScale</span> <span style="color: #FFFFFF;">2</span>,<span style="color: #FFFFFF;">2</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rotation:+ <span style="color: #FFFFFF;">0.1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> MEDIUM<span style="color: #B1E7EB;">'Medium</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetScale</span> <span style="color: #FFFFFF;">1</span>,<span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rotation:+ <span style="color: #FFFFFF;">0.2</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> SMALL<span style="color: #B1E7EB;">'Small&nbsp; &nbsp; &nbsp; &nbsp; </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetScale</span> <span style="color: #FFFFFF;">0.5</span>, <span style="color: #FFFFFF;">0.5</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rotation:+ <span style="color: #FFFFFF;">0.7</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndSelect</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetRotation</span><span style=" ">&#40;</span> Rotation <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetBlend</span> LIGHTBLEND<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawImage</span><span style=" ">&#40;</span> Image,X,Y <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetScale</span> <span style="color: #FFFFFF;">1</span>,<span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">SetRotation</span> <span style="color: #FFFFFF;">0</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Update<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Draw<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X:+ XSpeed<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Y:+ YSpeed&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Collision<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> X &gt; <span style="color: #FFFFFF;">800</span><span style="color: #FFFFFF;">+50</span> X = <span style="color: #FFFFFF;">-50</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Y &gt; <span style="color: #FFFFFF;">600</span><span style="color: #FFFFFF;">+50</span> Y = <span style="color: #FFFFFF;">-50</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> X &lt; <span style="color: #FFFFFF;">-50</span> X = <span style="color: #FFFFFF;">800</span><span style="color: #FFFFFF;">+50</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Y &lt; <span style="color: #FFFFFF;">-50</span> Y = <span style="color: #FFFFFF;">600</span><span style="color: #FFFFFF;">+50</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Function</span> UpdateAll<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Not</span> List <span style="color: #ffff00; font-weight: bold;">Return</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> Rock:TRock = <span style="color: #ffff00; font-weight: bold;">EachIn</span> List<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rock.<span style="">Update</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Destroy<span style=" ">&#40;</span><span style=" ">&#41;</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List.<span style="">remove</span><span style=" ">&#40;</span> <span style="color: #ffff00; font-weight: bold;">Self</span> <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Method</span> Collision<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Rock vs Ship</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Rock vs Shot</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Radius<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Select</span> Size<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> LARGE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Radius = <span style="color: #FFFFFF;">50</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> MEDIUM<span style="color: #B1E7EB;">'Medium</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Radius = <span style="color: #FFFFFF;">50</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> SMALL<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Radius = <span style="color: #FFFFFF;">20</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndSelect</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'If a rock hit a ship</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> TShip.<span style="">List</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> Ship:TShip = <span style="color: #ffff00; font-weight: bold;">EachIn</span> TShip.<span style="">List</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Distance<span style=" ">&#40;</span> X, Y, Ship.<span style="">X</span>, Ship.<span style="">Y</span> <span style=" ">&#41;</span> &lt; Radius<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Ship.<span style="">Destroy</span><span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #B1E7EB;">'Ship = Dead&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'If a shot hit a rock</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">Not</span> TShot.<span style="">List</span> <span style="color: #ffff00; font-weight: bold;">Return</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> Shot:TShot = <span style="color: #ffff00; font-weight: bold;">EachIn</span> TShot.<span style="">List</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Distance<span style=" ">&#40;</span> X, Y, Shot.<span style="">X</span>, Shot.<span style="">Y</span> <span style=" ">&#41;</span> &lt; Radius<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Shot.<span style="">Destroy</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Select</span> Size<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> LARGE&nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Destroy<span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #B1E7EB;">'Destory the rock&nbsp; &nbsp; &nbsp; </span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spawn<span style=" ">&#40;</span> X+<span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">-20</span>,<span style="color: #FFFFFF;">20</span><span style=" ">&#41;</span>, Y+<span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">-20</span>,<span style="color: #FFFFFF;">20</span><span style=" ">&#41;</span> , MEDIUM <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spawn<span style=" ">&#40;</span> X+<span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">-20</span>,<span style="color: #FFFFFF;">20</span><span style=" ">&#41;</span>, Y+<span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">-20</span>,<span style="color: #FFFFFF;">20</span><span style=" ">&#41;</span> , MEDIUM <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spawn<span style=" ">&#40;</span> X+<span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">-20</span>,<span style="color: #FFFFFF;">20</span><span style=" ">&#41;</span>, Y+<span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">-20</span>,<span style="color: #FFFFFF;">20</span><span style=" ">&#41;</span> , MEDIUM <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> MEDIUM<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Destroy<span style=" ">&#40;</span><span style=" ">&#41;</span>&nbsp; &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spawn<span style=" ">&#40;</span> X, Y , SMALL <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Spawn<span style=" ">&#40;</span> X, Y , SMALL <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> SMALL<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Destroy<span style=" ">&#40;</span><span style=" ">&#41;</span><span style="color: #B1E7EB;">'</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #B1E7EB;">'Spawn( X, Y , LARGE )</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Score:<span style="color: #FFFFFF;">+1</span> <span style="color: #B1E7EB;">'Global from Main</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndSelect</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Next</span>&nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndMethod</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
<span style="color: #ffff00; font-weight: bold;">EndType</span>&nbsp;<br />
<br />
<span style="color: #B1E7EB;">'Give the distance between two points</span><br />
<span style="color: #ffff00; font-weight: bold;">Function</span> Distance#<span style=" ">&#40;</span> X1, Y1, X2, Y2 <span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> DX# = X2 - X1<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> DY# = Y2 - Y1<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Return</span> <span style="color: #ffff00; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>Dx*Dx + Dy*Dy<span style=" ">&#41;</span><br />
</p>
<span style="color: #ffff00; font-weight: bold;">EndFunction</span></div>
<p>Всё, теперь время настроить параметры игры. Нужно чтобы всё соотносилось наилучшим образом. Пора делать игру из полученного движка. Вот что нужно для этого:
</p>
<ul><li>Стартовый экран - Жми пробел, чтобы начать игру; Q, чтобы выйти 
</li><li>Если побил все камни начать новый уровень
</li><li>Вести учет очков игрока. Только маленькие камни их приносят, по очку каждый.
</li><li>Если игрок умирает, покажи ему его счет. Перезапуск игры - R, выход - Q. 
</li></ul>
<p>Чтобы всё это добавить нужно, для начала, переключиться на AsteroidWars.bmx
</p><p>Создаем глобальную переменную Mode и три константы для каждого режима: Интро (Intro), Смерть (Death) и Игра (Playing). Плюс две глобальных переменных для хранения текущего и лучшего счета.
</p>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Const</span> Intro &nbsp;= <span style="color: #FFFFFF;">1</span><br />
<p><span style="color: #ffff00; font-weight: bold;">Const</span> Death &nbsp;= <span style="color: #FFFFFF;">2</span><br />
<span style="color: #ffff00; font-weight: bold;">Const</span> Playing = <span style="color: #FFFFFF;">3</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Global</span> Mode = Intro<br />
</p>
<span style="color: #ffff00; font-weight: bold;">Global</span> Score, HighestScore</div>
<p>Затем я прописал все режимы, ничего особенного, но потребовалось много всего отлаживать. Поэтому я не могу расписать этот этап пошагово. Вместо этого я выложу результат того, что у меня получилось. Я бы посоветовал тебе создать свою собственную версию, используя эту как основу. Геймплэй, который получился у меня, мягко говоря, неважный. Это ведь просто пример, и ничего больше! Надеюсь, этот пример поможет начинающим игрописателям. Удачи! 
</p>
<a name="AsteroidWars.bmx_3"></a><h3><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%9A%D0%B0%D0%BA_%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%C2%ABAsteroids%C2%BB_%D0%B7%D0%B0_%D1%87%D0%B0%D1%81&amp;action=edit&amp;section=20" title="Как сделать «Asteroids» за час">править</a>]</span> <span class="mw-headline">AsteroidWars.bmx</span></h3>
<div class="bmx" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#01516B;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #ffff00; font-weight: bold;">Strict</span><br />
<p><span style="color: #B1E7EB;">'AppTitle = &quot;Asteroid Wars Example&quot;</span><br />
<br />
<span style="color: #B1E7EB;">Rem<br />
<br />
&nbsp; Статья, для которой был написан этот исходник может быть найдена тут: &nbsp;www.blitzbasic.com - forums - blitzmax - tutorials<br />
<br />
EndRem</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Include</span> <span style="color: #00FF66;">&quot;Ast-TSpaceObject.bmx&quot;</span><br />
<span style="color: #ffff00; font-weight: bold;">Include</span> <span style="color: #00FF66;">&quot;Ast-TShip.bmx&quot;</span><br />
<span style="color: #ffff00; font-weight: bold;">Include</span> <span style="color: #00FF66;">&quot;Ast-TShot.bmx&quot;</span><br />
<span style="color: #ffff00; font-weight: bold;">Include</span> <span style="color: #00FF66;">&quot;Ast-TRock.bmx&quot;</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Graphics</span> <span style="color: #FFFFFF;">800</span>,<span style="color: #FFFFFF;">600</span>,<span style="color: #FFFFFF;">0</span><br />
<br />
<br />
<span style="color: #ffff00; font-weight: bold;">Const</span> Intro &nbsp;= <span style="color: #FFFFFF;">1</span><br />
<span style="color: #ffff00; font-weight: bold;">Const</span> Death &nbsp;= <span style="color: #FFFFFF;">2</span><br />
<span style="color: #ffff00; font-weight: bold;">Const</span> Playing = <span style="color: #FFFFFF;">3</span><br />
<br />
<span style="color: #ffff00; font-weight: bold;">Global</span> Mode = Intro<br />
<span style="color: #ffff00; font-weight: bold;">Global</span> Score, HighestScore<br />
<span style="color: #ffff00; font-weight: bold;">Global</span> Level , Rank$<br />
<br />
TRock.<span style="">Spawn</span><span style=" ">&#40;</span> <span style="color: #FFFFFF;">50</span>,<span style="color: #FFFFFF;">50</span>, TRock.<span style="">LARGE</span> <span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> NR = <span style="color: #FFFFFF;">1</span> <span style="color: #ffff00; font-weight: bold;">To</span> <span style="color: #FFFFFF;">20</span><br />
&nbsp;TRock.<span style="">Spawn</span><span style=" ">&#40;</span> <span style="color: #FFFFFF;">400</span>,<span style="color: #FFFFFF;">300</span>, TRock.<span style="">SMALL</span> <span style=" ">&#41;</span><br />
<span style="color: #ffff00; font-weight: bold;">Next</span><br />
<br />
&nbsp;<span style="color: #B1E7EB;">'Главный цикл</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Repeat</span><span style="color: #B1E7EB;">' - - - - - - - - - - - - - - - - - </span><br />
&nbsp; TShot.<span style="">UpdateAll</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; TRock.<span style="">UpdateAll</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Select</span> Mode<br />
<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Case</span> Intro<br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawText</span> <span style="color: #00FF66;">&quot;Welcome to Asteroids Wars Beta Version&quot;</span>,<span style="color: #FFFFFF;">50</span>,<span style="color: #FFFFFF;">100</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawText</span> <span style="color: #00FF66;">&quot;Highest Score this run: &quot;</span>+HighestScore+<span style="color: #00FF66;">&quot; rocks.&quot;</span>,<span style="color: #FFFFFF;">50</span>,<span style="color: #FFFFFF;">130</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawText</span> <span style="color: #00FF66;">&quot;Steer with LEFT, RIGHT &nbsp; &nbsp; &nbsp;&quot;</span>,<span style="color: #FFFFFF;">50</span>,<span style="color: #FFFFFF;">170</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawText</span> <span style="color: #00FF66;">&quot;Thrust with UP and DOWN &nbsp; &nbsp; &quot;</span>,<span style="color: #FFFFFF;">50</span>,<span style="color: #FFFFFF;">190</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawText</span> <span style="color: #00FF66;">&quot;Fire with SPACE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;</span>,<span style="color: #FFFFFF;">50</span>,<span style="color: #FFFFFF;">210</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawText</span> <span style="color: #00FF66;">&quot; --------- &nbsp;P R E S S &nbsp; S P A C E &nbsp; T O &nbsp;S T A R T &nbsp;---------- &quot;</span>,<span style="color: #FFFFFF;">50</span>,<span style="color: #FFFFFF;">260</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span>Key_Space<span style=" ">&#41;</span> StartGame<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Case</span> Playing<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawText</span> <span style="color: #00FF66;">&quot;Score: &quot;</span>+Score, <span style="color: #FFFFFF;">20</span>, <span style="color: #FFFFFF;">20</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawText</span> <span style="color: #00FF66;">&quot;Level: &quot;</span>+level, <span style="color: #FFFFFF;">20</span>, <span style="color: #FFFFFF;">40</span><br />
&nbsp; &nbsp; TShip.<span style="">UpdateAll</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> TShip.<span style="">List</span>.<span style="">Count</span><span style=" ">&#40;</span><span style=" ">&#41;</span> = <span style="color: #FFFFFF;">0</span> <br />
&nbsp; &nbsp; &nbsp;Mode = Death<br />
&nbsp; &nbsp; &nbsp;GetRanking<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp;Level = <span style="color: #FFFFFF;">0</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">FlushKeys</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> TRock.<span style="">List</span>.<span style="">Count</span><span style=" ">&#40;</span><span style=" ">&#41;</span> = <span style="color: #FFFFFF;">0</span> StartGame<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Case</span> Death<br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawText</span> <span style="color: #00FF66;">&quot;~~ You Lost Your Ship - G A M E &nbsp;O V E R ~~ &quot;</span>,<span style="color: #FFFFFF;">50</span>,<span style="color: #FFFFFF;">100</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawText</span> <span style="color: #00FF66;">&quot;You managed to destroy &quot;</span>+Score+<span style="color: #00FF66;">&quot; rocks in &quot;</span>+level+<span style="color: #00FF66;">&quot; different zones.&quot;</span>,<span style="color: #FFFFFF;">50</span>,<span style="color: #FFFFFF;">130</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawText</span> <span style="color: #00FF66;">&quot;------------------------ &nbsp;&quot;</span>,<span style="color: #FFFFFF;">50</span>,<span style="color: #FFFFFF;">170</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawText</span> <span style="color: #00FF66;">&quot; Your RANK&nbsp;: &quot;</span>+Rank$ &nbsp; ,<span style="color: #FFFFFF;">50</span>,<span style="color: #FFFFFF;">190</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawText</span> <span style="color: #00FF66;">&quot;------------------------ &nbsp;&quot;</span>,<span style="color: #FFFFFF;">50</span>,<span style="color: #FFFFFF;">210</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">DrawText</span> <span style="color: #00FF66;">&quot; --------- &nbsp;P R E S S &nbsp;[R] &nbsp;T O &nbsp; R E T R Y &nbsp;---------- &quot;</span>,<span style="color: #FFFFFF;">50</span>,<span style="color: #FFFFFF;">260</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span>Key_R<span style=" ">&#41;</span> Mode = Intro<br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndSelect</span><br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Flip</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Cls</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">If</span> <span style="color: #ffff00; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span>Key_Q<span style=" ">&#41;</span> <span style="color: #ffff00; font-weight: bold;">End</span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Until</span> <span style="color: #ffff00; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span>Key_Escape<span style=" ">&#41;</span><span style="color: #B1E7EB;">'- - - - - - - - </span><br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">End</span> <br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Function</span> StartGame<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> TRock.<span style="">List</span>.<span style="">Count</span><span style=" ">&#40;</span><span style=" ">&#41;</span> &gt; <span style="color: #FFFFFF;">0</span> <span style="color: #B1E7EB;">'First Time</span><br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">'Clear</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">For</span> <span style="color: #ffff00; font-weight: bold;">Local</span> Rock:TRock = <span style="color: #ffff00; font-weight: bold;">EachIn</span> TRock.<span style="">List</span><br />
&nbsp; &nbsp; Rock.<span style="">Destroy</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Next</span><br />
<br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">'Start</span><br />
&nbsp; &nbsp;TShip.<span style="">Create</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Else</span><span style="color: #B1E7EB;">'In play</span><br />
<br />
&nbsp; &nbsp;Level:<span style="color: #FFFFFF;">+1</span><br />
&nbsp; &nbsp;<span style="color: #B1E7EB;">'Score:+13</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">EndIf</span><br />
<br />
&nbsp; CreateRocks<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; Mode = Playing<br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Function</span> CreateRocks<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Danger = Level*<span style="color: #FFFFFF;">20</span> + <span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">10</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Local</span> Ship:TShip = TShip<span style=" ">&#40;</span> TShip.<span style="">List</span>.<span style="">First</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <span style=" ">&#41;</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Repeat</span> <br />
<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Local</span> X,Y<br />
<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Repeat</span> <br />
&nbsp; &nbsp; X = <span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">800</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; Y = <span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">0</span>,<span style="color: #FFFFFF;">600</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Until</span> Distance<span style=" ">&#40;</span>Ship.<span style="">X</span>, Ship.<span style="">Y</span>, X, Y <span style=" ">&#41;</span> &gt; <span style="color: #FFFFFF;">200</span><br />
<br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">Select</span> <span style="color: #ffff00; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #FFFFFF;">1</span>,<span style="color: #FFFFFF;">2</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> <span style="color: #FFFFFF;">1</span><br />
&nbsp; &nbsp; &nbsp;TRock.<span style="">Spawn</span><span style=" ">&#40;</span> X, Y, TRock.<span style="">LARGE</span> <span style=" ">&#41;</span> &nbsp;;Danger:- <span style="color: #FFFFFF;">5</span><br />
&nbsp; &nbsp; <span style="color: #ffff00; font-weight: bold;">Case</span> <span style="color: #FFFFFF;">2</span><br />
&nbsp; &nbsp; &nbsp;TRock.<span style="">Spawn</span><span style=" ">&#40;</span> X, Y, TRock.<span style="">MEDIUM</span> <span style=" ">&#41;</span>&nbsp;;Danger:- <span style="color: #FFFFFF;">3</span><br />
&nbsp; &nbsp;<span style="color: #ffff00; font-weight: bold;">EndSelect</span><br />
<br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">Until</span> Danger &lt;= <span style="color: #FFFFFF;">0</span><br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndFunction</span><br />
<br />
&nbsp;<span style="color: #ffff00; font-weight: bold;">Function</span> GetRanking<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp; Rank$ = <span style="color: #00FF66;">&quot;Classified&quot;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Level = <span style="color: #FFFFFF;">1</span> Rank = <span style="color: #00FF66;">&quot;You didn't get a single one?!&quot;</span> <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Level = <span style="color: #FFFFFF;">1</span> Rank = <span style="color: #00FF66;">&quot;ROFL&quot;</span> <br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Level = <span style="color: #FFFFFF;">2</span> Rank = <span style="color: #00FF66;">&quot;LOL&quot;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Level = <span style="color: #FFFFFF;">3</span> Rank = <span style="color: #00FF66;">&quot;Newbie&quot;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Level = <span style="color: #FFFFFF;">4</span> Rank = <span style="color: #00FF66;">&quot;Beginner&quot;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Level = <span style="color: #FFFFFF;">5</span> Rank = <span style="color: #00FF66;">&quot;Average&quot;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Level = <span style="color: #FFFFFF;">6</span> Rank = <span style="color: #00FF66;">&quot;Fair&quot;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Level = <span style="color: #FFFFFF;">7</span> Rank = <span style="color: #00FF66;">&quot;Almost got one&quot;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Level = <span style="color: #FFFFFF;">8</span> Rank = <span style="color: #00FF66;">&quot;Starfighter&quot;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Level = <span style="color: #FFFFFF;">9</span> Rank = <span style="color: #00FF66;">&quot;Rock Destroyer&quot;</span><br />
&nbsp; <span style="color: #ffff00; font-weight: bold;">If</span> Level = <span style="color: #FFFFFF;">10</span> Rank = <span style="color: #00FF66;">&quot;Duplicator&quot;</span><br />
&nbsp; <span style="color: #B1E7EB;">'...</span><br />
&nbsp; <span style="color: #B1E7EB;">'....</span><br />
<br />
&nbsp; HighestScore = Score<br />
</p>
&nbsp;<span style="color: #ffff00; font-weight: bold;">EndFunction</span></div>
<p>Оригинал статьи лежит <a href="http://www.blitzmax.com/Community/posts.php?topic=48800" class="external text" title="http://www.blitzmax.com/Community/posts.php?topic=48800" rel="nofollow">здесь</a>.
</p>
<div align="right"><a href="http://blitzetcetera.org/images/2/24/Asteroid_Wars.zip" class="internal" title="Asteroid Wars.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: Wave (e-mail: Truplos@msn.com)<br />
Перевод: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:MANIAK_dobrii" title="Участник:MANIAK dobrii">MANIAK dobrii</a> (e-mail: MANIAK_dobrii@list.ru, сайт: <a href="http://www.maniak-dobrii.nm.ru/" class="external free" title="http://www.maniak-dobrii.nm.ru/" rel="nofollow">http://www.maniak-dobrii.nm.ru/</a>)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Стрельба на опережение"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Стрельба на опережение&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Стрельба на опережение&amp;action=edit">править</a>]</span><span class="mw-headline">Стрельба на опережение</span></h1>
<p>Практически во всех играх механизм ведения огня компьютерным противником одинаков - нацелиться прямо на игрока и выстрелить. Соответственно, от снаряда легко увернуться, просто  шагнув в сторону. Немного сложнее увернуться от ракет (т. к. нужно отбежать от места взрыва) и от огня (например, пехотинцев в Unreal) со случайным отклонением от цели. Моментальный выстрел (когда сразу просчитывается вся траектория полета снаряда и определяется объект столкновения) не рассматриваем - здесь хорошо подходит именно простой вариант (с небольшими вариациями типа задержки перед началом стрельбы (пулеметчик из Doom2), низкой частотой огня (сержант из Doom) и уменьшенной точностью).
</p>
</p>
<a name=".D0.9B.D0.B8.D0.BD.D0.B5.D0.B9.D0.BD.D0.BE.D0.B5_.D0.B4.D0.B2.D0.B8.D0.B6.D0.B5.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D1%82%D1%80%D0%B5%D0%BB%D1%8C%D0%B1%D0%B0_%D0%BD%D0%B0_%D0%BE%D0%BF%D0%B5%D1%80%D0%B5%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5&amp;action=edit&amp;section=1" title="Стрельба на опережение">править</a>]</span> <span class="mw-headline">Линейное движение</span></h2>
<p>Пусть даны координаты пушки (x<sub>0</sub>, y<sub>0</sub>) и координаты объекта (x, y). Рассмотрим задачу для двумерного пространства: снаряд стартует в центре пушки и его скорость - константа (v<sub>0</sub>), а объект движется с постоянной скоростью (v) под углом a от оси X. Необходимо найти угол a<sub>0</sub>, при котором  снаряд, выпущенный из пушки, попадет точно в центр объекта.
</p><p>Координаты объекта в момент времени t будут равны (x<sub>0</sub> + t v<sub>x</sub>, y<sub>0</sub> + t v<sub>y</sub>), где v<sub>x</sub> = cos(a), v<sub>y</sub> = sin(a). Следует учесть, что снаряд вылетает не из центра пушки, а из дула, которое находится на некотором расстоянии от нее. До этой точки снаряд долетел бы, преодолев некоторое расстояние r. Таким образом, под каким бы углом пушка бы не выстрелила, в момент времени t снаряд будет от нее на расстоянии vt + r. Выразив расстояние через координаты, получаем уравнение:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Shooting01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Shooting01.gif" src="wko2akuh.gif" width="298" height="227" /></a></span></div></div>
<p>В итоге, после возведения в квадрат (т. к. t &gt; 0, v &gt; 0 и r &gt; 0, то знак учитывать не нужно), раскрытия скобок и приведения подобных, получим квадратное уравнение (&#916;x = x - x<sub>0</sub>, &#916;y = y - y<sub>0</sub>):
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Shooting02.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Shooting02.gif" src="0x0pt0s4.gif" width="423" height="21" /></a></span></div></div>
<p>Если дискриминант этого уравнения меньше нуля, значит решения не существует (при этом целесообразно будет просто нацелить пушку на объект с помощью  функции ATan2). В ином случае, если больший из корней положителен, то пушка стреляет в направлении точки, в которой должна произойти встреча снаряда и объекта. Вы можете улучшить алгоритм, просчитав вариант, когда оба корня положительны (тогда оптимальным будет выбор меньшего корня - снаряд попадет раньше).
</p><p>Решение для трехмерного варианта выводится аналогичным образом - попытайтесь его найти.
<p>Задачи, где учитывается ускорение и скорость вращения, гораздо сложнее, т. к. из-за усложнения формулы для движения объекта, приходится решать уравнения четвертой степени.
</p>
</p>
<a name=".D0.A3.D1.81.D1.82.D1.80.D0.B0.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B7.D0.B0.D0.B2.D0.B8.D1.81.D0.B8.D0.BC.D0.BE.D1.81.D1.82.D0.B8_.D0.BE.D1.82_FPS"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D1%82%D1%80%D0%B5%D0%BB%D1%8C%D0%B1%D0%B0_%D0%BD%D0%B0_%D0%BE%D0%BF%D0%B5%D1%80%D0%B5%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5&amp;action=edit&amp;section=2" title="Стрельба на опережение">править</a>]</span> <span class="mw-headline">Устранение зависимости от FPS</span></h2>
<p>Хотя напрямую этот раздел темы не касается, все же будет полезно его разобрать. Часто бывает так, что старые игры и демошки на одних компьютерах тормозят, на других - идут нормально, на третьих - быстрят. Это происходит из-за того, что в этих программах за один цикл действия происходит фиксированная трансформация мира (например, движение на один пиксел, поворот камеры на 1 градус и т. д.). Поэтому, чем больше / меньше от задуманного в программе циклов (и больше / меньше кадров в секунду она выдает), тем быстрее / медленнее идет процесс. Чтобы этого избежать, фиксируют кол-во кадров в секунду (а если скорость низкая - рендеринг некоторых может быть пропущен) или вводят зависимость внутренних процессов от времени. Недостаток первого - ограниченный FPS (можно сделать его завышенным, делая по нескольку циклов на рендеринг), второго - искажение процессов, вызванное изменением FPS (перемещения становятся более округлыми или резкими и скачкообразными, чего можно, впрочем, избежать, задав верхнюю границу периода времени на рендеринг). Остановимся на втором варианте.
</p><p>Все довольно просто - во все процессы, которые должны зависеть от времени, добавляется множитель dt#, который равен протяженности предыдущего цикла в миллисекундах. Это поворот игрока, движение игрока и снарядов. Поворот башен (кроме вращающихся автоматически) не требует регулировки.
</p>
<a name=".D0.A1.D0.B0.D0.BC.D0.BE.D0.BE.D0.B1.D1.83.D1.87.D0.B5.D0.BD.D0.B8.D0.B5"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D1%82%D1%80%D0%B5%D0%BB%D1%8C%D0%B1%D0%B0_%D0%BD%D0%B0_%D0%BE%D0%BF%D0%B5%D1%80%D0%B5%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5&amp;action=edit&amp;section=3" title="Стрельба на опережение">править</a>]</span> <span class="mw-headline">Самообучение</span></h2>
<p>Создания самообучающейся системы - задача, основной этап решения которой ориентирован на поиск подходящей модели. В данном случае, требуется найти оптимальный угол для стрельбы, основываясь на опыте предыдущих. Входные параметры - координаты, направление движения игрока, скорость, координаты снарядов.
</p><p>Алгоритм должен стремиться попасть в игрока - оптимальным будет вариант, когда снаряд попадет в центр. Но для этого снаряд должен долететь  до цели т. е. расстояния от пушки до игрока и до снаряда должны сравняться. В этом случае можно заключить, насколько удачен был выстрел и, на основе этого опыта, алгоритм должен сделать вывод. А вывод таков - "если бы пушка выстрелила в направлении текущей позиции игрока этим снарядом, то результат был бы оптимален". Соответственно, компьютер учитывает поправку к выстрелу для данного расстояния и, когда игрок будет на таком же расстоянии, как в прошлый раз, нужно будет выстрелить, отклонившись от прямого направления на игрока на сохраненный угол.
</p><p>Для хранения соответствий "расстояние - поправка" создадим массив и зададим шаг, на который будут различаться соседние расстояния в массиве. Расстояние для записи поправки можно взять как в момент встречи (так в приведенном коде), так и в момент выстрела (придется запоминать и включить переменную в тип снаряда) - разница невелика.
</p><p>В программе есть доп. алгоритмы стрельбы - в заданном направлении, вращаясь и стрельба веером.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span><br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-20</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">45</span>,<span style="color: #33ffdd;">45</span>,<span style="color: #33ffdd;">45</span><br />
<br />
<span style="color: #ffee00">;Тип для пушки - координаты, угол, режим стрельбы, указатели на 3D-объекты,</span><br />
<span style="color: #ffee00">; переменные для AI</span><br />
<span style="color: #aaffff; font-weight: bold;">Type</span> turret<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#,y#,Mode,head,barrel,ang#,dir#,dx#,dy#<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #ffee00">;Тип для выстрела - координаты, приращения, указатель на 3D-объект,</span><br />
<span style="color: #ffee00">; расстояние от пушки, вспомогательные переменные для AI</span><br />
<span style="color: #aaffff; font-weight: bold;">Type</span> shot<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> x#,y#,dx#,dy#,h,r#,tx#,ty#,dir#,t.turret<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Const</span> aimax=<span style="color: #33ffdd;">200</span>,aistp#=.<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> aiang#<span style=" ">&#40;</span>aimax<span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">SetFont</span> <span style="color: #aaffff; font-weight: bold;">LoadFont</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;arial&quot;</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;Константы - период стрельбы, скорость снарядов, скорость игрока</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> frq=<span style="color: #33ffdd;">200</span>, v0#=.<span style="color: #33ffdd;">01</span>, vp#=.<span style="color: #33ffdd;">005</span><br />
<span style="color: #ffee00">;Const frq=200, v0#=.2, vp#=.1</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> bs#=<span style="color: #33ffdd;">2</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Global</span> x#,y#<br />
<br />
<span style="color: #ffee00">;createturret 1:createturret 2:createturret 3:createturret 4</span><br />
createturret <span style="color: #33ffdd;">5</span>:createturret <span style="color: #33ffdd;">4</span>:createturret <span style="color: #33ffdd;">2</span><br />
<br />
<br />
<span style="color: #ffee00">;Создание игрока</span><br />
p=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">16</span><span style=" ">&#41;</span><br />
h=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">8</span>,p<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> h,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> h,.<span style="color: #33ffdd;">4</span>,.<span style="color: #33ffdd;">4</span>,.<span style="color: #33ffdd;">4</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;tim=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span> <br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> t.turret=<span style="color: #aaffff; font-weight: bold;">Each</span> turret<br />
<br />
&nbsp; <span style="color: #ffee00">;Вспомогательные переменные + нацеливание на игрока по умолчанию</span><br />
&nbsp; dx#=x#-t\x<br />
&nbsp; dy#=y#-t\y<br />
&nbsp; cang#=<span style="color: #aaffff; font-weight: bold;">ATan2</span><span style=" ">&#40;</span>dy#,dx<span style=" ">&#41;</span><br />
&nbsp; t\dx#=dx#<br />
&nbsp; t\dy#=dy#<br />
&nbsp; t\dir#=cang#<br />
&nbsp; pr#=<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>dx#*dx#+dy#*dy#<span style=" ">&#41;</span><br />
<br />
&nbsp; <span style="color: #ffee00">;Режимы прицеливания пушек:</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Select</span> t\Mode<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">0</span><span style="color: #ffee00">; стрельба в данном направлении</span><br />
&nbsp; &nbsp; cang=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span><span style="color: #ffee00">; стрельба с вращением</span><br />
&nbsp; &nbsp; cang#=t\ang#+.<span style="color: #33ffdd;">05</span>*dt#<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span><span style="color: #ffee00">; точное нацеливание на объект</span><br />
<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">3</span><span style="color: #ffee00">; стрельба веером</span><br />
&nbsp; &nbsp; cang#=cang#+<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>dcang#<span style=" ">&#41;</span>*<span style="color: #33ffdd;">30</span><br />
&nbsp; &nbsp; dcang#=dcang#<span style="color: #33ffdd;">+2</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">4</span><span style="color: #ffee00">; стрельба на опережение</span><br />
&nbsp; &nbsp; <span style="color: #ffee00">;Вычисление коэффициентов квадратного уравнения</span><br />
&nbsp; &nbsp; a#=v#*v#-v0#*v0#<br />
&nbsp; &nbsp; b#=<span style="color: #33ffdd;">2.0</span>*v#*<span style=" ">&#40;</span>dx#*<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>+dy#*<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>-bs#<span style=" ">&#41;</span><br />
&nbsp; &nbsp; c#=dx#*dx#+dy#*dy#-bs#*bs#<br />
&nbsp; &nbsp; <span style="color: #ffee00">;Вычисление дискриминанта</span><br />
&nbsp; &nbsp; d#=b#*b#<span style="color: #33ffdd;">-4.0</span>*a#*c#<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> d#&gt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;Вычисление момента встречи снаряда и игрока</span><br />
&nbsp; &nbsp; &nbsp;t1#=<span style=" ">&#40;</span>-b#+<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>d#<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2.0</span>/a#<br />
&nbsp; &nbsp; &nbsp;t2#=<span style=" ">&#40;</span>-b#-<span style="color: #aaffff; font-weight: bold;">Sqr</span><span style=" ">&#40;</span>d#<span style=" ">&#41;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">2.0</span>/a#<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> t2#&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> t1#=t2#<br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> t1#&gt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; &nbsp; <span style="color: #ffee00">;Вычисление угла через координаты объекта в найденный момент времени</span><br />
&nbsp; &nbsp; &nbsp; cang#=<span style="color: #aaffff; font-weight: bold;">ATan2</span><span style=" ">&#40;</span>y#+t1#*v#*<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>-t\y#,x#+t1#*v#*<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>-t\x#<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span> <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">5</span><span style="color: #ffee00">; самообучающаяся пушка (поправка к углу берется из массива</span><br />
&nbsp; &nbsp; cang#=cang#+aiang<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>pr#*aistp#<span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<br />
&nbsp; <span style="color: #ffee00">;Поворот пушки</span><br />
&nbsp; rotateturret t,cang#<br />
&nbsp; <span style="color: #ffee00">;Возврат дула на прежнее положение</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">EntityX</span><span style=" ">&#40;</span>t\barrel<span style=" ">&#41;</span>&lt;.<span style="color: #33ffdd;">75</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">MoveEntity</span> t\barrel,<span style="color: #33ffdd;">0</span>,-.<span style="color: #33ffdd;">25</span>/frq*dt#,<span style="color: #33ffdd;">0</span><br />
&nbsp;<br />
&nbsp; <span style="color: #ffee00">;Выстрел и смещение дула внутрь пушки</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> nextshot&lt;=tim <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;fire t<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t\barrel,.<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Задание следующего момента стрельбы </span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> nextshot&lt;=tim <span style="color: #aaffff; font-weight: bold;">Then</span> nextshot=tim+frq<br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> s.shot=<span style="color: #aaffff; font-weight: bold;">Each</span> shot<br />
&nbsp; <span style="color: #ffee00">;Смещение снарядов</span><br />
&nbsp; s\x#=s\x#+s\dx#*dt#<br />
&nbsp; s\y#=s\y#+s\dy#*dt#<br />
&nbsp; s\r#=s\r#+v0#*dt#<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">PositionEntity</span> s\h,s\x#,s\y#,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #ffee00">;Если расстояния от пушки до снаряда и до игрока равны, то</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> pr#&lt;=s\r# <span style="color: #aaffff; font-weight: bold;">And</span> s\dir#&lt;<span style="color: #33ffdd;">999</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Вычисляется корректирующий угол для данного расстояния</span><br />
&nbsp; &nbsp;Newang#=s\t\dir#-s\dir#<br />
&nbsp; &nbsp;<span style="color: #ffee00">; втискивается в границы [-180,180)</span><br />
&nbsp; &nbsp;Newang#=Newang#-<span style="color: #aaffff; font-weight: bold;">Floor</span><span style=" ">&#40;</span><span style=" ">&#40;</span>Newang#<span style="color: #33ffdd;">+180.0</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">360.0</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">360.0</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">; и заносится в массив,</span><br />
&nbsp; &nbsp;aiang<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>pr#*aistp#<span style=" ">&#41;</span><span style=" ">&#41;</span>=Newang#<br />
&nbsp; &nbsp;<span style="color: #ffee00">; (следующая строка - чтобы не заносить этот снаряд в массив еще раз)</span><br />
&nbsp; &nbsp;s\dir#=<span style="color: #33ffdd;">999</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style=" ">&#40;</span>s\x#-x#<span style=" ">&#41;</span>^<span style="color: #33ffdd;">2</span>+<span style=" ">&#40;</span>s\y#-y#<span style=" ">&#41;</span>^<span style="color: #33ffdd;">2</span>&lt;<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">FreeEntity</span> s\h:<span style="color: #aaffff; font-weight: bold;">Delete</span> s<br />
&nbsp; &nbsp;red=<span style="color: #33ffdd;">255</span><br />
&nbsp; &nbsp;hits#=hits#<span style="color: #33ffdd;">+1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Удаление снарядов, вышедших за границы экрана</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>s\x#<span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>s\y#<span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">40</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> s\h:<span style="color: #aaffff; font-weight: bold;">Delete</span> s<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Индикация попадания</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> red&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; red=red-<span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span>dt/<span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; red=<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">EntityColor</span> p,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>-red,<span style="color: #33ffdd;">255</span>-red<br />
<br />
&nbsp;<span style="color: #ffee00">;Перемещение и поворот игрока (скорость вычисляется исходя из прошедшего времени)</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> p,x#,y#,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> p,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,ang#<br />
&nbsp;v#=<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span><span style=" ">&#41;</span>*vp#<br />
&nbsp;ang#=ang#+.<span style="color: #33ffdd;">3</span>*dt#*<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp;x#=x#+v#*<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>*dt#<br />
&nbsp;y#=y#+v#*<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>*dt#<br />
&nbsp;<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
&nbsp;<span style="color: #ffee00">;Счет</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #00ff66;">&quot;Hits/sec:&quot;</span>+<span style=" ">&#40;</span>hits#/sec#<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
&nbsp;<span style="color: #ffee00">;Время, затраченное этот цикл (дробное, так как умножается на дробные величины)</span><br />
&nbsp;dt#=<span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-tim<br />
&nbsp;sec#=sec#<span style="color: #33ffdd;">+0.001</span>*dt#<br />
<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> createturret<span style=" ">&#40;</span>Mode<span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Создание головной части</span><br />
t.turret=<span style="color: #aaffff; font-weight: bold;">New</span> turret<br />
t\head=<span style="color: #aaffff; font-weight: bold;">CreateCylinder</span><span style=" ">&#40;</span><span style="color: #33ffdd;">6</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleMesh</span> t\head,<span style="color: #33ffdd;">1</span>,.<span style="color: #33ffdd;">5</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateMesh</span> t\head,<span style="color: #33ffdd;">90</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #ffee00">;Дуло создать отдельно, но привязать к головной части</span><br />
t\barrel=<span style="color: #aaffff; font-weight: bold;">CreateCylinder</span><span style=" ">&#40;</span><span style="color: #33ffdd;">16</span>,<span style="color: #aaffff; font-weight: bold;">False</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> t\barrel,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">90</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> t\barrel,.<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">1</span>,.<span style="color: #33ffdd;">2</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t\barrel,.<span style="color: #33ffdd;">75</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
h=<span style="color: #aaffff; font-weight: bold;">CreateCylinder</span><span style=" ">&#40;</span><span style="color: #33ffdd;">16</span>,<span style="color: #aaffff; font-weight: bold;">True</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> h,.<span style="color: #33ffdd;">3</span>,.<span style="color: #33ffdd;">3</span>,.<span style="color: #33ffdd;">3</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> h,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">90</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> h,<span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityParent</span> t\barrel,t\head<br />
<span style="color: #aaffff; font-weight: bold;">EntityParent</span> h,t\barrel<br />
<span style="color: #ffee00">;Задание координат пушки случайным образом</span><br />
t\x#=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-20</span>,<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span><br />
t\y#=<span style="color: #aaffff; font-weight: bold;">Rnd</span><span style=" ">&#40;</span><span style="color: #33ffdd;">-20</span>,<span style="color: #33ffdd;">20</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> t\head,t\x#,t\y#,<span style="color: #33ffdd;">0</span><br />
t\Mode=Mode<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> rotateturret<span style=" ">&#40;</span>t.turret,ang#<span style=" ">&#41;</span><br />
t\ang#=ang#<br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> t\head,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,ang#<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> fire<span style=" ">&#40;</span>t.turret<span style=" ">&#41;</span><br />
ang#=t\ang#<br />
s.shot=<span style="color: #aaffff; font-weight: bold;">New</span> shot<br />
s\x#=t\x#+<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>*r<br />
s\y#=t\y#+<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>*r<br />
s\r#=r<br />
s\dx#=<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>*v0#<br />
s\dy#=<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span>ang#<span style=" ">&#41;</span>*v0#<br />
s\h=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> s\h,.<span style="color: #33ffdd;">15</span>,.<span style="color: #33ffdd;">15</span>,.<span style="color: #33ffdd;">15</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> s\h,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #ffee00">;Вспомогательные переменные (для AI)</span><br />
s\tx#=t\x#<br />
s\ty#=t\y#<br />
s\dir=t\dir#<br />
s\t=t<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/4/4c/Shooting.bb" class="internal" title="Shooting.bb">скачать исходный код</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)&lt;/noinclude&gt;
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Лабиринты"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Лабиринты&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Лабиринты&amp;action=edit">править</a>]</span><span class="mw-headline">Лабиринты</span></h1>
</p>
<p align="right">
"Лабиринты  -   архитектурные сооружения со сложными коридорами,
которые строились для  того, чтобы приводить в трепет  непосвященных..."
</p>
<p align="right">
Мартин Гарднер.
</p>
<p>Слово  "лабиринт"  греческого происхождения, и переводится как подземные ходы или подземелье. В природе существует много подземных пещер  с  огромным  количеством ходов, перекрестков и тупиков. Есть примеры и других  природных  лабиринтов, вот  скажем, шхеры - множество мелких островков, составляющих единую группу. В  шхерах  десятки   фарватеров, проливов, заливов,  бухточек,  в которых нетрудно заблудиться.
</p><p>Но существуют лабиринты и искусственного происхождения, созданные человеком вольно или  невольно. Примером невольного создания лабиринтов  являются  различные  шахты,  рудники, каменоломни, называемые  общим  словом "Катакомбы". Чаще всего под словом "Лабиринт" мы  подразумеваем искусственное,  специально  созданное, чрезвычайно сложное  сооружение.  Происхождение   таких "Лабиринтов"  довольно  древнее.
</p><p>Например, Геродот описывает египетский Лабиринт, в котором  было 5000 комнат. Сначала Лабиринты  носили  религиозно-мистический характер, но  в  более  поздние  времена  стали   предметом развлечений, перейдя  в  сады  и парки  в  виде  живой   изгороди сложной  конфигурации.  В наше время,  по  утверждению  Мартина Гарднера, "существует две области науки, в  которых  интерес  к Лабиринтам  остается   неизменно высоким: психология и  конструирование вычислительных машин."
</p><p>Однако, существует  еще  одна область человеческой деятельности, в которой Лабиринты  являются необходимым атрибутом  -  это компьютерные игры.  Действительно, почти все игры жанров Adventure, Arcade и  Arcade/Adventure используют Лабиринты. Встречаются они и в других  жанрах:  Puzzle, Action, изредка в Simulations. В связи с этим у  пользователя компьютера  появляются  две задачи: прохождение Лабиринтов в игровых  программах  и  создание Лабиринтов для "своих" программ.
</p><p>Задача "о  прохождении  Лабиринта" распадается на пару  других: Техническую  и  Логическую. Техническая часть состоит в том, чтобы  справиться  с  управлением своей  "марионетки", избежать столкновений с  "бяка-спрайтами" и не попасть в ловушки. Логическая часть - отыскание правильно-
<p>го пути.
</p>
</p><p>Коль скоро задача логическая, то, очевидно,  должен  существовать алгоритм для ее решения.  С точки зрения математики, путь от входа до цели есть  топологический инвариант. Проще говоря, это означает: план  Лабиринта, нарисованный  на  куске резины, можно растянуть таким  образом, что
<p>вход  и  цель  соединятся  одним прямым коридором.
</p>
</p><p>Проведя прямую линию по  этому коридору, мы получим кратчайший путь  до  цели.  Практически же, если у нас есть  план  Лабиринта, следует заштриховать (завалить) все  тупики.  Оставшаяся часть - путь (или несколько  путей) к цели. В  некоторых  играх можно видеть весь Лабиринт целиком (иногда его план). Но, обычно, в таких играх цель  игры  не прохождение Лабиринта, а собирание предметов.  Или же Лабиринт снабжен "переключателями" в  виде  закрывающихся-открывающихся дверей, падающих  решеток, разводных  мостов  и т.д., которые способны изменять конфигурацию Лабиринта.  Задача - выбрать момент  для  прохождения,  когда "переключатели" в нужном положении (или переключить их самому),
<p>чтобы достичь цели.
</p>
</p><p>Итак, если на экране весь Лабиринт, то отыскание верного пути не  представляет  трудностей. Другое дело, если Лабиринт  разбит на множество экранов. Тогда, чтобы  отыскать  таким  способом путь, придется  составлять  план Лабиринта. А без плана?
</p><p>Здесь мы вплотную подходим  к вопросу о конфигурациях и  видах Лабиринтов. Прежде  всего  отметим, что Лабиринты  бывают  двух видов:  двух  или   трехмерными, т.е. одно или многоэтажными. При этом двухмерная графика игры  необязательно  означает   двухмерный Лабиринт, и, наоборот, часто
<p>трехмерная графика  совмещена  с двухмерным Лабиринтом. При двухмерной графике изображение Лабиринта может быть  горизонтальным (смотрим сверху) или  вертикальным (смотрим сбоку).  При  трехмерной графике  тоже  существуют два способа изображения  (обычно только части лабиринта): изометрия и фронтальная проекция.
</p>
</p><p>Теперь о  конфигурации  Лабиринта. Специалисты различают три конфигурации:  Лабиринты   односвязные, Лабиринты  многосвязные без "петли" вокруг цели  и Лабиринты  многосвязные  с замкнутой "петлей" вокруг цели.  Односвязными  называются  Лабиринты,  не содержащие замкнутых маршрутов и не имеющие отдельно стоящих стенок. Лабиринты с отдельно  стоящими  стенками  и  с  замкнутыми маршрутами называются многосвязными.  При этом, если  замкнутый маршрут не проходит вокруг цели, то Лабиринт второй конфигурации; если же  цель  можно  обойти  по
<p>замкнутому маршруту, значит, Лабиринт третьей конфигурации.
</p>
</p><p>В Лабиринтах первой и  второй конфигурации всегда  можно  достичь  цели, если  двигаться,  все время  касаясь рукой   стенки. Правда, этот путь не  будет  самым коротким. В Лабиринте третьей конфигурации  таким  способом никогда  не  достичь  цели.   Вы просто обойдете ее по наибольшему замкнутому маршруту. Часто мы вообще  не  знаем, с  Лабиринтом какой конфигурации  имеем  дело. Существует ли универсальный  алгоритм для прохождения любых Лабиринтов? Существует - Алгоритм Люка-Тремо:
</p>
<ul><li>На выходе туннеля к перекрестку и на входе с  перекрестка в туннель всегда  делаем  от метку с одной и той же стороны (например справа) по  ходу движения.
</li><li>От первого  перекрестка  идем по какому  угодно  пути, пока не достигнем или  нового  перекрестка, или  не  зайдем  в тупик. Тогда:
</li><li>Если  мы  зашли  в  тупик, то следует  вернуться  назад,  а пройденный  путь    отбросить (пункт 1), отметив его  дважды (вход-выход). От перекрестка идти в  другом  направлении.
</li><li>Если  мы  приходим  к  новому перекрестку, то  двигаемся  в любом   направлении,  отметив путь, по  которому  пришли, и путь, по которому уходим.
</li><li>Если мы приходим к  известному нам перекрестку не тем путем, которым уходили, то  немедленно  поворачивать  назад (не забыв пункт 1).
</li><li>Никогда не  ходите  по  пути, отмеченному дважды.
</li><li>Если больше нет путей без отметок, следует выбрать  путь, отмеченный одной меткой.
</li></ul>
<p>Я  думаю, что  этот  алгоритм поможет Вам в прохождении  Лабиринтов, хотя "ставить" метки  на экранах весьма проблематично.
</p><p>Теперь перейдем к  вопросу  о создании  Лабиринтов.  Не  будем касаться  проблем,  связанных  с ручной разработкой  и  хранением Лабиринтов в памяти  компьютера. Это очень трудоемкая работа.
</p><p>Попробуем смоделировать  процесс  возникновения   Лабиринта. Как возникает Лабиринт в природных условиях?  Под  воздействием воды, ветра, температурных условий,  эрозии  грунт  разрушается в  наиболее слабых местах, образуя ходы, тупики, перекрестки. С точки зрения  географии, направления создаваемых  туннелей  совершенно случайны. Обозначим направления  "размывания   грунта" цифрами 1-4 и  выберем  его случайно, используя функцию RAND.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">SeedRnd</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">ClsColor</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
Y = <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rnd</span> * <span style="color: #33ffdd;">24</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Координаты &quot;пробившегося источника&quot;</span><br />
X = <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rnd</span> * <span style="color: #33ffdd;">32</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
<span style="color: #aaffff; font-weight: bold;">For</span> N = <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">350</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Длительность процесса</span><br />
&nbsp;B = <span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Направление &quot;размывания&quot;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> B &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Подсчет координат &quot;нового туннеля&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span>: <span style="color: #aaffff; font-weight: bold;">If</span> Y &lt;&gt; <span style="color: #33ffdd;">0</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> Y = Y - <span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span>: <span style="color: #aaffff; font-weight: bold;">If</span> X &lt;&gt; <span style="color: #33ffdd;">31</span> <span style="color: #aaffff; font-weight: bold;">Then</span> X = X + <span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">3</span>: <span style="color: #aaffff; font-weight: bold;">If</span> X &lt;&gt; <span style="color: #33ffdd;">21</span> <span style="color: #aaffff; font-weight: bold;">Then</span> Y = Y + <span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">4</span>: <span style="color: #aaffff; font-weight: bold;">If</span> X &lt;&gt; <span style="color: #33ffdd;">0</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> X = X - <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Rect</span> X*<span style="color: #33ffdd;">25</span>,Y*<span style="color: #33ffdd;">25</span>,<span style="color: #33ffdd;">25</span>,<span style="color: #33ffdd;">25</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;&quot;Размываем&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">WaitKey</span>:<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>То, что получилось на экране, мало походит  на  лабиринт.  Как говорится: "Процесс не пошел". "Грунт"  оказался  достаточно "однородным", и туннелей не возникло.   Нарушим   "однородность грунта",  заменив  в   программе некоторые строки:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">SeedRnd</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">ClsColor</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
Y = <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rnd</span> * <span style="color: #33ffdd;">24</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Координаты &quot;пробившегося источника&quot;</span><br />
X = <span style="color: #aaffff; font-weight: bold;">Int</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Rnd</span> * <span style="color: #33ffdd;">32</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
<span style="color: #aaffff; font-weight: bold;">For</span> N = <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">350</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Длительность процесса</span><br />
&nbsp;B = <span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">4</span><span style=" ">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">; Направление &quot;размывания&quot;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> B &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ffee00">; Подсчет координат &quot;нового туннеля&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span>: <span style="color: #aaffff; font-weight: bold;">If</span> Y &gt; <span style="color: #33ffdd;">1</span> &nbsp; <span style="color: #aaffff; font-weight: bold;">Then</span> Y1 = Y - <span style="color: #33ffdd;">1</span>: Y = Y - <span style="color: #33ffdd;">2</span>: X1=X<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span>: <span style="color: #aaffff; font-weight: bold;">If</span> X &lt; <span style="color: #33ffdd;">30</span> <span style="color: #aaffff; font-weight: bold;">Then</span> X1 = X + <span style="color: #33ffdd;">1</span>: X = X + <span style="color: #33ffdd;">2</span>: Y1=Y<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">3</span>: <span style="color: #aaffff; font-weight: bold;">If</span> Y &lt; <span style="color: #33ffdd;">20</span> <span style="color: #aaffff; font-weight: bold;">Then</span> Y1 = Y + <span style="color: #33ffdd;">1</span>: Y = Y + <span style="color: #33ffdd;">2</span>: X1=X<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">4</span>: <span style="color: #aaffff; font-weight: bold;">If</span> X &gt; <span style="color: #33ffdd;">1</span> &nbsp;<span style="color: #aaffff; font-weight: bold;">Then</span> X1 = X - <span style="color: #33ffdd;">1</span>: X = X - <span style="color: #33ffdd;">2</span>: Y1=Y<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Rect</span> X*<span style="color: #33ffdd;">25</span>,Y*<span style="color: #33ffdd;">25</span>,<span style="color: #33ffdd;">25</span>,<span style="color: #33ffdd;">25</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ffee00">;&quot;Размываем&quot;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Rect</span> X1*<span style="color: #33ffdd;">25</span>,Y1*<span style="color: #33ffdd;">25</span>,<span style="color: #33ffdd;">25</span>,<span style="color: #33ffdd;">25</span> &nbsp; &nbsp; &nbsp; &nbsp;<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">WaitKey</span>:<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Теперь результат  можно  считать  удовлетворительным. Сложность   Лабиринта можно  менять, изменяя  переменную цикла "N" и длину проходимого "штрека" за один  шаг.  Полученный  алгоритм  я называю "алгоритмом  проходки", которую  он действительно напоминает.  Выходящий Лабиринт  -  многосвязный. Можно ли с помощью  этого  алгоритма получить односвязный? Очевидно, да. Следует наложить  ограничения  (например, с  помощью
</p><p>функции GetColor), при  которых  невозможно  соединение   "штреков" между собой. Но при этом  возможен случай "сходящейся  спирали", в котором дальнейшая  "проходка" невозможна:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Maze01.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Maze01.gif" src="yf8574qp.gif" width="105" height="105" /></a></span></div></div>
<p>Тогда  следует  вернуться назад  до  того  момента, когда станет это возможным  хотя бы в одном направлении.  Поэтому придется  запоминать  координаты предыдущих позиций печати.  Если захотите, то проделайте это  сами, а мы рассмотрим другой алгоритм  генерирования  Лабиринтов.
</p><p>Назовем его  алгоритмом  "удаления перегородок".  Принцип работы ясен из названия. Сначала "строим" некоторое количество изолированных друг от друга "комнат", а затем удаляем перегородки между ними произвольным образом, но придерживаясь некоторых  ограничений:.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">SeedRnd</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span><br />
<br />
<span style="color: #ffee00">;&quot;Строим комнаты&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">ClsColor</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> N = <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">29</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">2</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> M = <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">21</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">2</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Rect</span> N * <span style="color: #33ffdd;">25</span>, M * <span style="color: #33ffdd;">25</span>, <span style="color: #33ffdd;">25</span>, <span style="color: #33ffdd;">25</span> <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #ffee00">; Индексируем &nbsp;вертикальные и горизонтальные &quot;перегородки&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> A<span style=" ">&#40;</span><span style="color: #33ffdd;">14</span>,<span style="color: #33ffdd;">11</span><span style=" ">&#41;</span>: <span style="color: #aaffff; font-weight: bold;">Dim</span> B<span style=" ">&#40;</span><span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">; Количество &quot;удаляемых&quot; вертикальных &quot;перегородок&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> N = <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">105</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; <span style="color: #ffee00">;Определили индексы &quot;удаляемой&quot; перегородки</span><br />
&nbsp; I = <span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><br />
&nbsp; J = <span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">11</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffee00">; Проверим, не удалялась ли &quot;перегородка&quot; раньше, и если &quot;удалялась&quot;, то</span><br />
&nbsp; <span style="color: #ffee00">; назначим другие индексы.</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> A<span style=" ">&#40;</span>I,J<span style=" ">&#41;</span> = <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
&nbsp;<span style="color: #ffee00">; Отметка об удалении &quot;перегородки&quot;</span><br />
&nbsp;A<span style=" ">&#40;</span>I,J<span style=" ">&#41;</span> = <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #ffee00">; &quot;Удаление перегородки&quot;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Rect</span> <span style=" ">&#40;</span>I * <span style="color: #33ffdd;">2</span> - <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> * <span style="color: #33ffdd;">25</span>, J * <span style="color: #33ffdd;">2</span> * <span style="color: #33ffdd;">25</span>, <span style="color: #33ffdd;">25</span>, <span style="color: #33ffdd;">25</span><br />
&nbsp;<span style="color: #ffee00">; Переход к следующей &quot;перегородке&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #ffee00">; Аналогично &quot;удаляем перегородки&quot;, стоящие горизонтально</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> N = <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">100</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; <span style="color: #ffee00">;Определили индексы &quot;удаляемой&quot; перегородки</span><br />
&nbsp; I = <span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">15</span><span style=" ">&#41;</span><br />
&nbsp; J = <span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> B<span style=" ">&#40;</span>I,J<span style=" ">&#41;</span> = <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
&nbsp;B<span style=" ">&#40;</span>I,J<span style=" ">&#41;</span> = <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Rect</span> I * <span style="color: #33ffdd;">2</span> * <span style="color: #33ffdd;">25</span>, <span style=" ">&#40;</span>J * <span style="color: #33ffdd;">2</span> - <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> * <span style="color: #33ffdd;">25</span>, <span style="color: #33ffdd;">25</span>, <span style="color: #33ffdd;">25</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">WaitKey</span>:<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Ограничения, которые  мы  накладывали в этой  программе, это количество удаленных  вертикальных и горизонтальных  "перегородок". При этом мы также следили, чтобы ни одна  "перегородка"  не  удалялась  больше  одного  раза. Можно наложить и другие  ограничения.  Например, ограничим число входов-выходов в каждой  комнате:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">SeedRnd</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span><br />
<br />
<span style="color: #ffee00">;&quot;Строим комнаты&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">ClsColor</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> N = <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">29</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">2</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> M = <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">21</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">2</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Rect</span> N * <span style="color: #33ffdd;">25</span>, M * <span style="color: #33ffdd;">25</span>, <span style="color: #33ffdd;">25</span>, <span style="color: #33ffdd;">25</span> <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #ffee00">; Индексирование &quot;перегородок&quot; и &quot;комнат&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> A<span style=" ">&#40;</span><span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">11</span><span style=" ">&#41;</span>: <span style="color: #aaffff; font-weight: bold;">Dim</span> G<span style=" ">&#40;</span><span style="color: #33ffdd;">14</span>,<span style="color: #33ffdd;">11</span><span style=" ">&#41;</span>: <span style="color: #aaffff; font-weight: bold;">Dim</span> V<span style=" ">&#40;</span><span style="color: #33ffdd;">15</span>,<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">; Количество &quot;удаляемых&quot; &quot;перегородок&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> N = <span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">205</span><br />
&nbsp;<span style="color: #ffee00">;Какую &quot;перегородку&quot; удалять, вертикальную или горизонтальную</span><br />
&nbsp;B = <span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> B=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Определили перегородку для удаления:</span><br />
&nbsp; &nbsp;I = <span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;J = <span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">11</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">; Если она удалена, то будем искать другую.</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> G<span style=" ">&#40;</span>I,J<span style=" ">&#41;</span> = <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #ffee00">; Если соединяемые комнаты имеют по три входа, то ищем другую перегородку.</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> A<span style=" ">&#40;</span>I + <span style="color: #33ffdd;">1</span>,J<span style=" ">&#41;</span> &lt; <span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">And</span> A<span style=" ">&#40;</span>I,J<span style=" ">&#41;</span> &lt; <span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Forever</span><br />
&nbsp; <span style="color: #ffee00">; &quot;Удалили перегородку&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Rect</span> I * <span style="color: #33ffdd;">2</span> * <span style="color: #33ffdd;">25</span>, <span style=" ">&#40;</span>J * <span style="color: #33ffdd;">2</span> - <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> * <span style="color: #33ffdd;">25</span>, <span style="color: #33ffdd;">25</span>, <span style="color: #33ffdd;">25</span><br />
&nbsp; <span style="color: #ffee00">; Отмечаем удаленную &quot;перегородку&quot; и соединенные &quot;комнаты&quot;</span><br />
&nbsp; G<span style=" ">&#40;</span>I,J<span style=" ">&#41;</span> = <span style="color: #33ffdd;">1</span>: A<span style=" ">&#40;</span>I,J<span style=" ">&#41;</span> = A<span style=" ">&#40;</span>I,J<span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span>: A<span style=" ">&#40;</span>I + <span style="color: #33ffdd;">1</span>,J<span style=" ">&#41;</span> = &nbsp;A<span style=" ">&#40;</span>I + <span style="color: #33ffdd;">1</span>,J<span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #ffee00">; Переходим к следующему удалению.</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; <span style="color: #ffee00">; Аналогично действуем при удалении горизонтальных &quot;перегородок&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp;I = <span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">15</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;J = <span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> V<span style=" ">&#40;</span>I,J<span style=" ">&#41;</span> = <span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> A<span style=" ">&#40;</span>I,J<span style=" ">&#41;</span> &lt; <span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">And</span> A<span style=" ">&#40;</span>I,J + <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> &lt; <span style="color: #33ffdd;">3</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Forever</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Rect</span> <span style=" ">&#40;</span>I * <span style="color: #33ffdd;">2</span> - <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> * <span style="color: #33ffdd;">25</span>, J * <span style="color: #33ffdd;">2</span> * <span style="color: #33ffdd;">25</span>, <span style="color: #33ffdd;">25</span>, <span style="color: #33ffdd;">25</span><br />
&nbsp; V<span style=" ">&#40;</span>I,J<span style=" ">&#41;</span> = <span style="color: #33ffdd;">1</span>: V<span style=" ">&#40;</span>I,J<span style=" ">&#41;</span> = V<span style=" ">&#40;</span>I,J<span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span>: A<span style=" ">&#40;</span>I,J + <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> = &nbsp;A<span style=" ">&#40;</span>I,J + <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> + <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span> <br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">WaitKey</span>:<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Лабиринт,   полученный этой программой, более "изящный", чем в  предыдущем  случае, но  программа работает  немного  медленнее.  А вообще-то, чем больше наложенных  ограничений, тем  медленнее работает программа. Полученный  алгоритм - многосвязный. Для построения односвязных Лабиринтов  больше  подходит алгоритм "устанавливаемых  перегородок". Он значительно  проще, а главное, работает намного быстрее. Суть алгоритма  в  следующем: сначала " строим" несколько изолированных друг от друга "коридоров", затем ставим в них перегородки, одновременно соединяя коридоры  между  собой: 
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">SeedRnd</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span><br />
<br />
<span style="color: #ffee00">; Строим коридоры</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">21</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">2</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Rect</span> <span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>*n,<span style="color: #33ffdd;">600</span>,<span style="color: #33ffdd;">20</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">420</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> <span style="color: #33ffdd;">620</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">420</span><br />
<br />
<span style="color: #ffee00">;Количество &quot;перегородок&quot; между &quot;коридорами&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">9</span><br />
&nbsp;<span style="color: #ffee00">;Определим количество устанавливаемых &quot;перегородок&quot; в одном &quot;коридоре&quot;</span><br />
&nbsp;k=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">4</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #ffee00">;Длина участков между этими &quot;перегородками&quot;</span><br />
&nbsp;l=<span style="color: #aaffff; font-weight: bold;">Floor</span><span style=" ">&#40;</span><span style=" ">&#40;</span><span style="color: #33ffdd;">30</span>-k<span style=" ">&#41;</span>/k<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #ffee00">;Установка &quot;перегородок&quot; и соединение &quot;коридоров&quot; между собой.</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> m=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> k<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp; &nbsp;b=<span style=" ">&#40;</span>l<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>*<span style=" ">&#40;</span>m<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>+<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span>l<span style="color: #33ffdd;">-3</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Until</span> b&lt;=<span style="color: #33ffdd;">28</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Rect</span> <span style=" ">&#40;</span>b<span style="color: #33ffdd;">+2</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">20</span>,<span style=" ">&#40;</span>n*<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Rect</span> <span style=" ">&#40;</span>b<span style="color: #33ffdd;">+2</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">20</span>,<span style=" ">&#40;</span>n*<span style="color: #33ffdd;">2</span><span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Rect</span> b*<span style="color: #33ffdd;">20</span>,<span style=" ">&#40;</span>n*<span style="color: #33ffdd;">2</span><span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">40</span>,<span style="color: #33ffdd;">20</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> m=k <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Rect</span> <span style=" ">&#40;</span>b<span style="color: #33ffdd;">+3</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">20</span>,<span style=" ">&#40;</span>n*<span style="color: #33ffdd;">2</span><span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span>*<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">40</span>,<span style="color: #33ffdd;">20</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #ffee00">;Делаем вход</span><br />
y=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">40</span>*y,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span><br />
<span style="color: #ffee00">;Делаем выход</span><br />
y=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> <span style="color: #33ffdd;">620</span>,<span style="color: #33ffdd;">40</span>*y,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">WaitKey</span>:<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Программа может быть  использована  в  играх  типа "Гонки по  Лабиринту". Можно ли с помощью  алгоритма  "устанавливаемых  перегородок" получить многосвязный  "Лабиринт"? Нетрудно  увидеть,  что  если немного увеличить число устанавливаемых перегородок и  сделать несколько  "лишних"   соединений между  коридорами, то  получится искомый результат.  Оставлю  это Вам.
</p><p>А вместо этого предлагаю программу с тем же  алгоритмом  для многосвязного Лабиринта, но применительно к  векторной  графике
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">SeedRnd</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span><br />
m=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> r=<span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">192</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">16</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">19</span><br />
&nbsp; b=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">3</span><span style=" ">&#41;</span><br />
&nbsp; x1=r*<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span><span style="color: #33ffdd;">18</span>*n<span style=" ">&#41;</span><br />
&nbsp; y1=r*<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span><span style="color: #33ffdd;">18</span>*n<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> b=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> m=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Goto</span> one<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> b=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Goto</span> two<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> b=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style=" ">&#40;</span>m=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Or</span> m=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Goto</span> one<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> b=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">And</span> r&lt;&gt;<span style="color: #33ffdd;">16</span> <span style="color: #aaffff; font-weight: bold;">And</span> r&lt;&gt;<span style="color: #33ffdd;">192</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Goto</span> three<br />
&nbsp; .one<br />
&nbsp; x2=r*<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span><span style="color: #33ffdd;">18</span>*<span style=" ">&#40;</span>n<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; y2=r*<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span><span style="color: #33ffdd;">18</span>*<span style=" ">&#40;</span>n<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Line</span> <span style="color: #33ffdd;">320</span>+x1,<span style="color: #33ffdd;">240</span>+y1,<span style="color: #33ffdd;">320</span>+x2,<span style="color: #33ffdd;">240</span>+y2<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Goto</span> three<br />
&nbsp; .two<br />
&nbsp; x3=<span style=" ">&#40;</span>r<span style="color: #33ffdd;">+16</span><span style=" ">&#41;</span>*<span style="color: #aaffff; font-weight: bold;">Cos</span><span style=" ">&#40;</span><span style="color: #33ffdd;">18</span>*n<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
&nbsp; y3=<span style=" ">&#40;</span>r<span style="color: #33ffdd;">+16</span><span style=" ">&#41;</span>*<span style="color: #aaffff; font-weight: bold;">Sin</span><span style=" ">&#40;</span><span style="color: #33ffdd;">18</span>*n<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> r=<span style="color: #33ffdd;">192</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Goto</span> three<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Line</span> <span style="color: #33ffdd;">320</span>+x1,<span style="color: #33ffdd;">240</span>+y1,<span style="color: #33ffdd;">320</span>+x3,<span style="color: #33ffdd;">240</span>+y3<br />
&nbsp; .three<br />
&nbsp; m=b<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">WaitKey</span>:<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Я привожу  этот  листинг  без комментариев.  Следует, пожалуй, только пояснить, что  переменная "M" введена для запоминания предыдущего  результата  переменной по "B", чтобы  исключить  постановку двух перегородок подряд  и двойное  соединение  "коридоров" без перегородки.  Цель  Лабиринта - его центр. Лабиринт многосвязный, может получиться  второй или третьей конфигурации. 
</p><p>Теперь Вы знаете основные алгоритмы  генерирования  Лабиринтов.
</p><p>А теперь обратимся  к классической компьютерной игре "Snake", где змейка поедает яблоки, пытаясь не врезаться в препятствие и не запутаться в кольцах собственного тела. Надо сказать, что за последние несколько лет она встречалась мне три  раза в различных вариантах. "Snake" тоже  использует Лабиринт.  Так вот, Лабиринты для "Snake"а годятся  не любые, а только обладающие необходимыми  свойствами: они или совсем не должны иметь  тупиков, или тупики должны быть достаточно широки для маневра. Иначе Вам никогда не собрать  всех  "яблок" (лягушек, мышей и пр.).
</p><p>Что  касается "широких" тупиков, то такой Лабиринт построить  довольно легко,  сделав  все  коридоры  и комнаты двойной или тройной  ширины. А построить Лабиринт вообще  без тупиков?  Я  уверен, что сейчас Вы принялись  соображать, какую систему  ограничений  следует наложить на алгоритм и  какой  алгоритм  подходит  больше.
</p><p>Сразу  скажу  -  этот путь "гиблый". Никакой из  выше  перечисленных  алгоритмов  не  подойдет из-за  сложности   накладываемых ограничений. Нужен новый алгоритм.
</p><p>Коль скоро тупиков не  должно быть вообще, то давайте построим лабиринт из замкнутых коридоров, в которых нет тупиков  (они  закольцованы). Тогда и в  Лабиринте не могут появиться тупики.
</p><p>Итак, "Алгоритм замкнутых  коридоров":
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">SeedRnd</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> m=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">30</span><br />
&nbsp;a=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">12</span><span style=" ">&#41;</span><br />
&nbsp;x=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">32</span>-a<span style=" ">&#41;</span><br />
&nbsp;y=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">22</span>-a<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> a<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Rect</span> x*<span style="color: #33ffdd;">20</span>,<span style=" ">&#40;</span>y+n<span style=" ">&#41;</span>*<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Rect</span> <span style=" ">&#40;</span>x+a<span style=" ">&#41;</span>*<span style="color: #33ffdd;">20</span>,<span style=" ">&#40;</span>y+n<span style=" ">&#41;</span>*<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Rect</span> <span style=" ">&#40;</span>x+n<span style=" ">&#41;</span>*<span style="color: #33ffdd;">20</span>,<span style=" ">&#40;</span>y+a<span style=" ">&#41;</span>*<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Rect</span> <span style=" ">&#40;</span>x+n<span style=" ">&#41;</span>*<span style="color: #33ffdd;">20</span>,y*<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
</p>
<span style="color: #aaffff; font-weight: bold;">WaitKey</span>:<span style="color: #aaffff; font-weight: bold;">End</span></div>
<p>Мы  использовали  в  качестве исходной фигуры замкнутого коридора квадрат, выбирая его размеры и координаты расположения  на плоскости произвольным  образом. Лабиринт имеет свободные "полости" и некоторые коридоры  увеличенной ширины. Это дает  возможность  свободного  маневра.  Вероятность того,  что  какой-либо квадрат останется  "отрезанным", зависит от переменной цикла "M". При достаточно большом ее значении  "отрезанных"  квадратов  не будет.  Конечно, исходной  фигурой для коридоров может быть  не только квадрат.  Подойдет  любая замкнутая фигура: прямоугольник, треугольник,  любой  многоугольник, окружность и т.п. Возможно, что в  своей  программе  Вы  используете не одну замкнутую фигуру, а некоторое их сочетание.
</p><p>И  вот  теперь, никак  нельзя обойти вопрос о "степени  свободы" Лабиринта. До сих пор мы генерировали Лабиринты  с  четырьмя степенями свободы, то есть  с возможностью движения в  четырех направлениях , так как для криволинейных фигур число степеней свободы вообще не определено (  =  бесконечности)).  Если в последнем алгоритме исходной фигурой  коридора будет  треугольник, то  степеней свободы будет  не  4, а  6:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Maze02.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Maze02.gif" src="vxewr3tq.gif" width="227" height="205" /></a></span></div></div>
<p>Для шестиугольника их  тоже  будет 6. Увеличение степени свободы Лабиринта неизбежно  ведет  к усложнению  системы   управления "марионеткой", поэтому  вряд  ли целесообразно  иметь  их  больше чем 8. Вопрос о степени  свободы Лабиринта связан напрямую с  задачей "о паркетах", то есть, заполнением плоскости (для нас экрана) многоугольными плитами. Если  все  плитки  - одинаковые правильные   многоугольники,  то возможно  всего   три   варианта "паркетов":  треугольники, квадраты, четырехугольники. Деформируя их, можно получить несколько иной  вид, например, прямоугольники:
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Maze03.gif" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Maze03.gif" src="c1-qyagr.gif" width="325" height="125" /></a></span></div></div>
<p>Если  в  качестве исходного рисунка взять "паркет" не  из  четырехугольников, то,  используя  алгоритм  "удаляемых"  перегородок", получим Лабиринт  с  6  (шестью) степенями свободы. Все это относится к  двухмерным  Лабиринтам. Ясно, что в трехмерных  Лабиринтах степень свободы будет  всегда на 2 больше (вверх-вниз).
</p><p>Кроме трех перечисленных однородных "паркетов" существует еще 11  однородных, сочетающих  разные фигуры.  Возможно, они  тоже пригодны для наших  целей.  Тех, кто этим вопросом  заинтересуется, я отсылаю к книге Г.Штейнгауза "Математический калейдоскоп" (Библиотека "Квант", 1981 г.)
</p><p>Пожалуй, на этом стоит закончить. Думаю, что Вы поняли - Лабиринты  "такое  дело",  которое открывает огромное поле деятельности для пользователей  компьютеров с любым уровнем  подготовки, и  для  исследований, и  для программирования.  Остается  еще очень много незатронутых  вопросов (например, совмещенный скроллинг и генерация Лабиринта, генерирование трехмерных Лабиринтов и т.д.)
</p><p>На "десерт" приведу еще  один алгоритм генерирования  Лабиринтов, поражающий своей  простотой и сложностью выходящего  многосвязного, со степенью свободы  8, Лабиринта. В  среде  "Синклерманов", он известен  под  странным названием  "Комбикорм":
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">SeedRnd</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> x=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">31</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">2</span><br />
&nbsp; puttile x,y,<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">7</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">18</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> x=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">31</span><br />
&nbsp; puttile x,y,<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">7</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> y=<span style="color: #33ffdd;">19</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">20</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> x=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">31</span> <span style="color: #aaffff; font-weight: bold;">Step</span> <span style="color: #33ffdd;">2</span><br />
&nbsp; puttile x,y,<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">7</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Line</span> <span style="color: #33ffdd;">16</span>,<span style="color: #33ffdd;">16</span>,<span style="color: #33ffdd;">624</span>,<span style="color: #33ffdd;">16</span><br />
<span style="color: #aaffff; font-weight: bold;">Line</span> <span style="color: #33ffdd;">624</span>,<span style="color: #33ffdd;">35</span>,<span style="color: #33ffdd;">624</span>,<span style="color: #33ffdd;">415</span><br />
<span style="color: #aaffff; font-weight: bold;">Line</span> <span style="color: #33ffdd;">35</span>,<span style="color: #33ffdd;">415</span>,<span style="color: #33ffdd;">624</span>,<span style="color: #33ffdd;">415</span><br />
<span style="color: #aaffff; font-weight: bold;">Line</span> <span style="color: #33ffdd;">16</span>,<span style="color: #33ffdd;">16</span>,<span style="color: #33ffdd;">16</span>,<span style="color: #33ffdd;">415</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">WaitKey</span>:<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> puttile<span style=" ">&#40;</span>x,y,n<span style=" ">&#41;</span><br />
xx=x*<span style="color: #33ffdd;">19</span><span style="color: #33ffdd;">+16</span><br />
yy=y*<span style="color: #33ffdd;">19</span><span style="color: #33ffdd;">+16</span><br />
<span style="color: #aaffff; font-weight: bold;">Select</span> n<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span>:<span style="color: #aaffff; font-weight: bold;">Line</span> xx,yy,xx,yy<span style="color: #33ffdd;">+19</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span>:<span style="color: #aaffff; font-weight: bold;">Line</span> xx,yy,xx<span style="color: #33ffdd;">+19</span>,yy<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">3</span>:<span style="color: #aaffff; font-weight: bold;">Line</span> xx<span style="color: #33ffdd;">+19</span>,yy,xx<span style="color: #33ffdd;">+19</span>,yy<span style="color: #33ffdd;">+19</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">4</span>:<span style="color: #aaffff; font-weight: bold;">Line</span> xx,yy<span style="color: #33ffdd;">+19</span>,xx<span style="color: #33ffdd;">+19</span>,yy<span style="color: #33ffdd;">+19</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">5</span>:<span style="color: #aaffff; font-weight: bold;">Line</span> xx,yy,xx<span style="color: #33ffdd;">+19</span>,yy<span style="color: #33ffdd;">+19</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">6</span>:<span style="color: #aaffff; font-weight: bold;">Line</span> xx<span style="color: #33ffdd;">+19</span>,yy,xx,yy<span style="color: #33ffdd;">+19</span><br />
<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>ВСЕ. ЖЕЛАЮ ВАМ УСПЕХОВ. 
</p>
<div align="right"><a href="http://blitzetcetera.org/images/1/18/Maze.zip" class="internal" title="Maze.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: Лыхин Д., г.Кемерово<br />
Компиляция: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)<br />
Источник: ZX-ревю
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Скрипты"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Скрипты&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Скрипты&amp;action=edit">править</a>]</span><span class="mw-headline">Скрипты</span></h1>
<p>Скриптом (в переводе с английского - сценарий) принято называть программу на специализированно языке, встроенном в другую программу и соданом для ее нужд. В играх, например, скрипты обычно описывают диалоги (как в японских RPG), видеовставки (Turok 2) и другие события, происходящие по ходу игры и, в основном, не требующие вмешательства игрока. Бывают и скриптовые программы знакомства с игрой (Metal Heart), где программа "учит" игрока и он выполняет определенную последовательность действий
</p>
</p><p>В редакторах (напр. 3DS Max) скрипты используются в качестве возможности создавать программы для построения сложных объектов, а также в виде демонстрационных роликов к помощи.
</p>
<a name=".D0.A1.D0.BA.D1.80.D0.B8.D0.BF.D1.82_.D0.B2_RPG"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B&amp;action=edit&amp;section=1" title="Скрипты">править</a>]</span> <span class="mw-headline">Скрипт в RPG</span></h2>
<p>Итак, что нужно для создания скрипта? Прежде всего - список простейших действий, из которых будет состоять программа. Рассмотрим типичный для фэнтезийных РПГ сценарий:
</p>
<ul><li>Главный герой Леонард беседует со стражником
<ul><li>Стражник) Стой, кто идет!
</li><li>Леонард) Мое имя Леонард, я пришел из города Сэндворм сражаться с гигантскими пауками!
</li><li>Стражник) Леонард? Я слышал о тебе. Проходи к капитану дворцовой стражи, налево и по коридору 2-я дверь.
</li></ul>
</li><li>Стражники расступаются
</li><li>Леонард входит в замок
</li><li>В замке: Леонард идет к капитану стражи.
</li><li>Леонард беседует с капитаном стражи
<ul><li>Леонард) Здравствуйте.
</li><li>КС) Здравствуй. Тебя зовут Леонард, не так ли?
</li><li>Леонард) Да, я Леонард.
</li><li>КС) Мое имя Жан. Я слушаю тебя.
</li><li>Леонард) Я слышал, вы набираете людей для похода в горы, уничтожить гигантских пауков.
</li><li>КС) Да, эти пауки уже представляют угрозу.
</li><li>Леонард) Я хочу присоединиться к вам.
</li><li>КС) Хорошо, Леонард. Я наслышан о твоих подвигах, думаю, обойдемся без экзаменов. А пока, иди подзаправься. Завтра утром выходим.
</li></ul>
</li><li>Леонард уходит из комнаты, дверь закрывается, управление передается игроку.
</li></ul>
<p>Здесь можно выделить следующие моменты:
</p>
<ul><li>Текстовое окно с репликами персонажа
</li><li>Перемещение в заданную точку
</li><li>Смена тайлов (открыть дверь - закрыть дверь и т. д.)
</li></ul>
<p>Для каждого из них нужно выбрать команду и параметры, которые будут вводиться в скрипте:
</p>
<ul><li>Текстовое окно: SPEAK(№персонажа,текст)
</li><li>Перемещение: MOVE(кол-во_тайлов_по_горизонтали, по_вертикали)
</li><li>Смена тайлов: CHANGE (x,y,№нового_тайла)
</li></ul>
<p>Для программы понадобится вот эта полоска (вырезана из QB-игры Mysterious Song by DarkDread):
</p>
<div class="center"><div class="floatnone"><span><a href="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Script-Tiles.png" class="image" title=""><img alt="" longdesc="http://blitzetcetera.org/index.php/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5:Script-Tiles.png" src="okh6rm9i.png" width="240" height="20" /></a></span></div></div>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span>,<span style="color: #33ffdd;">32</span><br />
<p><br />
<span style="color: #ffee00">;Загрузка изображений тайлов (последняя - спрайт)</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> tiles=<span style="color: #aaffff; font-weight: bold;">LoadAnimImage</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Script-Tiles.png&quot;</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">12</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Цвет маски - пурпурный</span><br />
<span style="color: #aaffff; font-weight: bold;">MaskImage</span> tiles,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">255</span><br />
<br />
<span style="color: #ffee00">;Буфер для тайловой карты</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> buf=<span style="color: #aaffff; font-weight: bold;">CreateImage</span><span style=" ">&#40;</span><span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> bufb=<span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>buf<span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;Координаты игрока, номер экрана</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> px=<span style="color: #33ffdd;">16</span>,py=<span style="color: #33ffdd;">12</span>,sc=<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #ffee00">;Занесение в память карт тайлов экранов</span><br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> scr$<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">19</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> n1=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> n2=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">19</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Read</span> scr$<span style=" ">&#40;</span>n1,n2<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">SetFont</span> <span style="color: #aaffff; font-weight: bold;">LoadFont</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Arial Cyr&quot;</span>,<span style="color: #33ffdd;">20</span>,<span style="color: #aaffff; font-weight: bold;">True</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Установка экрана номер 0</span><br />
setscr <span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #ffee00">;Приращения, зависящие от нажатых клавиш</span><br />
&nbsp;dx=<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">205</span><span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">203</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> dx=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> dy=<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">208</span><span style=" ">&#41;</span>-<span style="color: #aaffff; font-weight: bold;">KeyDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">200</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Else</span> dy=<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #ffee00">;Перемещение</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> dx&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Or</span> dy&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> move dx,dy<br />
&nbsp;<span style="color: #ffee00">;Пуск скрипта при нажатии пробела перед стражником</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> py&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">57</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">If</span> land$<span style=" ">&#40;</span>px,py<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span>=<span style="color: #00ff66;">&quot;J&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> runscript<br />
<br />
<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">WaitKey</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> setscr<span style=" ">&#40;</span>n1<span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Рисование тайлов в буфер тайловой карты</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> bufb<br />
<span style="color: #aaffff; font-weight: bold;">For</span> n2=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">19</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> n3=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">31</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">DrawBlock</span> tiles,n3*<span style="color: #33ffdd;">20</span>,n2*<span style="color: #33ffdd;">20</span>,<span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>scr$<span style=" ">&#40;</span>n1,n2<span style=" ">&#41;</span>,n3<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span><span style="color: #33ffdd;">-65</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
sc=n1<br />
drawbuf<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> drawbuf<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Реинициализация</span><br />
<span style="color: #aaffff; font-weight: bold;">DrawBlock</span> buf,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<span style="color: #aaffff; font-weight: bold;">DrawImage</span> tiles,px*<span style="color: #33ffdd;">20</span>,py*<span style="color: #33ffdd;">20</span>,<span style="color: #33ffdd;">11</span><br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> move<span style=" ">&#40;</span>dx,dy<span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Пресечение возможности выхода за границу экрана</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> dx+px&gt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> dx+px=&lt;<span style="color: #33ffdd;">31</span> <span style="color: #aaffff; font-weight: bold;">And</span> dy+py&gt;=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> dy+py&lt;=<span style="color: #33ffdd;">19</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> land$<span style=" ">&#40;</span>px+dx,py+dy<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #ffee00">;Можно ходить только по траве, полу и дороге</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;E&quot;</span>,<span style="color: #00ff66;">&quot;H&quot;</span>,<span style="color: #00ff66;">&quot;I&quot;</span><br />
&nbsp; &nbsp;px=px+dx<br />
&nbsp; &nbsp;py=py+dy<br />
&nbsp; &nbsp;<span style="color: #ffee00">;Перемещение между экранами</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> py=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> sc=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; py=<span style="color: #33ffdd;">18</span><br />
&nbsp; &nbsp; setscr <span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> py=<span style="color: #33ffdd;">19</span> <span style="color: #aaffff; font-weight: bold;">And</span> sc=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; py=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp; setscr <span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;drawbuf<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Delay</span> <span style="color: #33ffdd;">100</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Функция возвращающая номер тайла по координатам</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> land$<span style=" ">&#40;</span>x,y<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>scr$<span style=" ">&#40;</span>sc,y<span style=" ">&#41;</span>,x<span style="color: #33ffdd;">+1</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> runscript<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Restore</span> script<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Read</span> m$<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> m$=<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;<span style="color: #ffee00">;Адреса разделителей в строке</span><br />
&nbsp;i1=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>m$,<span style="color: #00ff66;">&quot; &quot;</span><span style=" ">&#41;</span><br />
&nbsp;i2=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>m$,<span style="color: #00ff66;">&quot;/&quot;</span>,i1<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
&nbsp;i3=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>m$+<span style="color: #00ff66;">&quot;/&quot;</span>,<span style="color: #00ff66;">&quot;/&quot;</span>,i2<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #ffee00">;Выделение имени команды</span><br />
&nbsp;cmd$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,<span style="color: #33ffdd;">1</span>,i1<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #ffee00">;Разбиение строки на параметры</span><br />
&nbsp;par1=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,i1<span style="color: #33ffdd;">+1</span>,i2-i1<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
&nbsp;par2$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,i2<span style="color: #33ffdd;">+1</span>,i3-i2<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
&nbsp;par3$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,i3<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
&nbsp;x=par1:y=par2$<br />
&nbsp;<span style="color: #ffee00">;Stop</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> cmd$<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;SPEAK&quot;</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Команда &quot;говорить&quot; выдает текст в окне</span><br />
&nbsp; &nbsp;Textwindow par1,par2$<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;MOVE&quot;</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Команда &quot;переместиться&quot; перемещает игрока в заданную точку</span><br />
&nbsp; &nbsp;drawbuf<br />
&nbsp; &nbsp;<span style="color: #ffee00">;Сначала по горизонтали</span><br />
&nbsp; &nbsp;x=x-px<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> dx=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>x<span style=" ">&#41;</span><br />
&nbsp; &nbsp; move <span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span>x<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Затем по вертикали.</span><br />
&nbsp; &nbsp;y=y-py<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> dy=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">Abs</span><span style=" ">&#40;</span>y<span style=" ">&#41;</span><br />
&nbsp; &nbsp; move <span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">Sgn</span><span style=" ">&#40;</span>y<span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;CHANGE&quot;</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Команда &quot;изменить&quot; изменяет тайл с заданными координатами</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Рисование тайла в буфере тайловой карты</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> bufb<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">DrawBlock</span> tiles,x*<span style="color: #33ffdd;">20</span>,y*<span style="color: #33ffdd;">20</span>,<span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span>par3$<span style=" ">&#41;</span><span style="color: #33ffdd;">-65</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Изменение карты тайлов - замена символа в строке</span><br />
&nbsp; &nbsp;scr$<span style=" ">&#40;</span>sc,y<span style=" ">&#41;</span>=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>scr$<span style=" ">&#40;</span>sc,y<span style=" ">&#41;</span>,<span style="color: #33ffdd;">1</span>,x<span style=" ">&#41;</span>+par3$+<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>scr$<span style=" ">&#40;</span>sc,y<span style=" ">&#41;</span>,x<span style="color: #33ffdd;">+2</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Default</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Сообщение об ошибке (при неизвестной команде)</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;Unknow command '&quot;</span>+cmd$+<span style="color: #00ff66;">&quot;'&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Stop</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
drawbuf<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> Textwindow<span style=" ">&#40;</span>v,txt$<span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Окно текста</span><br />
<span style="color: #aaffff; font-weight: bold;">FlushKeys</span><br />
drawbuf<br />
<span style="color: #ffee00">;Рисование окна</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span>,<span style="color: #33ffdd;">255</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">400</span>,<span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">80</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">128</span>,<span style="color: #33ffdd;">128</span>,<span style="color: #33ffdd;">128</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> <span style="color: #33ffdd;">3</span>,<span style="color: #33ffdd;">403</span>,<span style="color: #33ffdd;">637</span>,<span style="color: #33ffdd;">77</span><br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">192</span>,<span style="color: #33ffdd;">192</span>,<span style="color: #33ffdd;">192</span><br />
<span style="color: #aaffff; font-weight: bold;">Rect</span> <span style="color: #33ffdd;">2</span>,<span style="color: #33ffdd;">402</span>,<span style="color: #33ffdd;">636</span>,<span style="color: #33ffdd;">76</span><br />
<span style="color: #ffee00">;Рисование персонажа, в данный момент говорящего</span><br />
<span style="color: #aaffff; font-weight: bold;">DrawImage</span> tiles,<span style="color: #33ffdd;">10</span>,<span style="color: #33ffdd;">410</span>,<span style="color: #33ffdd;">9</span>+v<br />
<span style="color: #aaffff; font-weight: bold;">Color</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
y=<span style="color: #33ffdd;">410</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>txt$<span style=" ">&#41;</span><br />
&nbsp;k$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>txt$,n,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #ffee00">;Пробел - начало нового слова</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> k$=<span style="color: #00ff66;">&quot; &quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #ffee00">;Если длина куска фразы с новым словом больше допустимой - переход на новую строку</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">StringWidth</span><span style=" ">&#40;</span>m$+w$<span style=" ">&#41;</span>&gt;<span style="color: #33ffdd;">490</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">40</span>,y,m$<br />
&nbsp; &nbsp;y=y<span style="color: #33ffdd;">+20</span><br />
&nbsp; &nbsp;m$=w$<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Иначе - прибавить слово к фразе</span><br />
&nbsp; &nbsp;m$=m$+<span style="color: #00ff66;">&quot; &quot;</span>+w$<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; w$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; w$=w$+k$<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #ffee00">;Печать остатка</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">40</span>,y,m$+<span style="color: #00ff66;">&quot; &quot;</span>+w$<br />
<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">WaitKey</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Карты</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;AAAAAAAAAAAAAAAEEAAAAAAAAAAAAAAA&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;BBBBBBBBBBBBBBAEEABBBBBBBBBBBBBB&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;FFFFFFFFFFFFFFBDDBFFFFFFFFFFFFFF&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;GGGGGGGGGGGGGGGIIGGGGGGGGGGGGGGG&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;GGGGGGGGGGGGGGGIIGGGGGGGGGGGGGGG&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;GGGGGGGGGGGGGGGIIGGGGGGGGGGGGGGG&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;GGGGGGGGGGGGGGGIIGGGGGGGGGGGGGGG&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;HHHHHHHHHHHHHHJJJJHHHHHHHHHHHHHH&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;HHHHHHHHHHHHHHJHHJHHHHHHHHHHHHHH&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;AAAAAAAAAAAAAAAEEAAAAAAAAAAAAAAA&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;BCBBBCBBBCBBBCBEEBCBBBCBBBCBBBCB&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;AAAAAEAAAAAEAAAEEAAAEAAAAAEAAAAA&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;BBABBDBBABBDBBAEEABBDBBABBDBBAEE&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;EEAEEEEEAEEEEEAEEAEEEEEAEEEEEAEE&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;EEAEEEEEAEEEEEAEEAEEEEEAEEEEEAEE&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;EEAEEEEEAEEEEEAEEAEEEEEAEEEEEAEE&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;AAAAAAAAAAAAAAAEEAAAAAAAAAAAAAAA&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;CBABCBCBABCBCBAEEABCBCBABCBBCABC&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;EEAEEEEEAEEEEEAEEAEEEEEAEEEEEAEE&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;EEAEEKEEAEEEEEAEEAEEEEEAEEEEEAEE&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;EEAEEEEEAEEEEEAEEAEEEEEAEEEEEAEE&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;EEAEEEEEAEEEEEAEEAEEEEEAEEEEEAEE&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;AAAAAEAAAAAEAAAEEAAAEAAAAAEAAAAA&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;BBCBBDBBCBBDBCBEEBCBDBBCBBDBBCBB&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;AAAAAAAAAAAAAAAEEAAAAAAAAAAAAAAA&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;BBBBBBBBBBBBBBAEEABBBBBBBBBBBBBB&quot;</span><br />
<br />
<span style="color: #ffee00">;Данные скрипта</span><br />
.script<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;SPEAK 0/Стой, кто идет!&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;SPEAK 2/Мое имя Леонард, я пришел из города Сэндворм сражаться с гигантскими пауками!&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;SPEAK 0/Леонард? Я слышал о тебе. Проходи к капитану дворцовой стражи, налево и по коридору 2-я дверь.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;CHANGE 15/7/H&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;CHANGE 16/7/H&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;CHANGE 13/7/J&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;CHANGE 18/7/J&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;CHANGE 15/2/E&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;CHANGE 16/2/E&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;MOVE 16/1&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;CHANGE 15/2/D&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;CHANGE 16/2/D&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;MOVE 16/0&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;MOVE 16/17&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;MOVE 5/17&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;CHANGE 5/16/E&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;MOVE 5/13&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;SPEAK 2/Здравствуйте.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;SPEAK 1/Здравствуй. Тебя зовут Леонард, не так ли?&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;SPEAK 2/Да, я Леонард.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;SPEAK 1/Мое имя Жан. Я слушаю тебя.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;SPEAK 2/Я слышал, вы набираете людей для похода в горы, уничтожить гигантских пауков.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;SPEAK 1/Да, эти пауки уже представляют угрозу.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;SPEAK 2/Я хочу присоединиться к вам.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;SPEAK 1/Хорошо, Леонард. Я наслышан о твоих подвигах, думаю, обойдемся без экзаменов.<br />
Data &quot;</span>SPEAK <span style="color: #33ffdd;">1</span>/А пока, иди подзаправься. Завтра утром выходим.<span style="color: #00ff66;">&quot;<br />
Data &quot;</span>MOVE <span style="color: #33ffdd;">5</span>/<span style="color: #33ffdd;">17</span><span style="color: #00ff66;">&quot;<br />
Data &quot;</span>CHANGE <span style="color: #33ffdd;">5</span>/<span style="color: #33ffdd;">16</span>/D<span style="color: #00ff66;">&quot;<br />
</p>
<p><dl><dt>Пустая строка - конец скрипта<br />
</dt></dl>
</p>
Data &quot;</span><span style="color: #00ff66;">&quot;</span></div>
<p>В программе также показано, как сделать перемещение по  тайловой карте и между экранами и текстовое окно с разбивкой строк.
</p><p>Можно снабдить скриптовый движок дополнительными возможностями - добавить поддержку управляющих кодов. К примеру, нужно, чтобы часть текста выводилась жирным шрифтом. Пусть такой текст будет окружен решетками (#), вот пример: "Для битвы с пауками, тебе нужно #особое# оружие". Вывод на экран реализуется так: строка побуквенно выводится и каждая встреченная решетка переключает флаг (переменную, которая может принимать значения 0-False и 1-True) жирного шрифта (bold=1-bold). Если флаг равен единице - идет печать жирным шрифтом, иначе - обычным. Можно вводить и теги (как в HTML), открывающие и закрывающие: "Для битвы с пауками, тебе нужно <b>особое</b> оружие". Реализация тегов несколько более сложна, зато скрипт удобнее читать.
</p><p>Еще небольшое дополнение: если вы пользуетесь оператором DATA для хранения скрипта и хотели бы использовать кавычки, то можно вместо кавычек использовать апостроф, а потом заменять его командой m$=Replace$(m$,"'",chr$(34)).
</p>
<a name=".D0.A1.D0.BA.D1.80.D0.B8.D0.BF.D1.82_.D1.83.D1.87.D0.B5.D0.B1.D0.BD.D0.B8.D0.BA.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B&amp;action=edit&amp;section=2" title="Скрипты">править</a>]</span> <span class="mw-headline">Скрипт учебника</span></h2>
<p>Пусть дана небольшая программа - просмотровщик трехмерных фигур и нужно сделать цикл уроков, показывающий как с ней работать. Можно, конечно, сделать html-справку, но она будет не так наглядна, как сценарий учебника, где с помощью подсказок пользователь сам осваивает программу. Скрипт в примере поддерживает 3 типа команд:
</p>
<ul><li>Вывод текста на экран
</li><li>Ожидание события
</li><li>Ожидание нажатия клавиши
</li></ul>
<p>При ожидании события, когда выполняется какое-либо действие, меняется переменная события и, если ее значение равно заданному в скрипте номеру, то скрипт выполняется дальше, иначе - приостанавливается.
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">Graphics3D</span> <span style="color: #33ffdd;">640</span>,<span style="color: #33ffdd;">480</span><br />
<p><br />
cam=<span style="color: #aaffff; font-weight: bold;">CreateCamera</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> cam,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">-3</span><br />
<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> <span style="color: #aaffff; font-weight: bold;">CreateLight</span><span style=" ">&#40;</span><span style=" ">&#41;</span>,<span style="color: #33ffdd;">45</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">45</span><br />
<br />
<span style="color: #ffee00">;Адрес, номер и детализация фигуры</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> m,et=<span style="color: #33ffdd;">1</span>,det=<span style="color: #33ffdd;">10</span><br />
<span style="color: #ffee00">;Цвет фигуры</span><br />
<span style="color: #aaffff; font-weight: bold;">Global</span> cr=<span style="color: #33ffdd;">255</span>,cg=<span style="color: #33ffdd;">255</span>,cb=<span style="color: #33ffdd;">255</span><br />
<span style="color: #ffee00">;Создание фигуры</span><br />
recreate<br />
<br />
<span style="color: #aaffff; font-weight: bold;">CameraProject</span> cam,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
<br />
<span style="color: #ffee00">;Вычисление приращения по осям X и Y</span><br />
d#=<span style="color: #aaffff; font-weight: bold;">ProjectedX</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">CameraProject</span> cam,<span style="color: #33ffdd;">1</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span><br />
d#=<span style="color: #33ffdd;">1.0</span>/<span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">ProjectedX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-d#<span style=" ">&#41;</span><br />
esc#=<span style="color: #33ffdd;">1.0</span><br />
<br />
<span style="color: #ffee00">;Загрузка в память команд урока</span><br />
<span style="color: #aaffff; font-weight: bold;">Dim</span> cmd$<span style=" ">&#40;</span><span style="color: #33ffdd;">18</span>,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">17</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Read</span> cmd$<span style=" ">&#40;</span>n,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span>,cmd$<span style=" ">&#40;</span>n,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">SetFont</span> <span style="color: #aaffff; font-weight: bold;">LoadFont</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Arial Cyr&quot;</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">SetBuffer</span> <span style="color: #aaffff; font-weight: bold;">BackBuffer</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #ffee00">;Вычисление приращений значений для мыши</span><br />
&nbsp;dx#=<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-odx#<br />
&nbsp;dy#=ody#-<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;dmz=<span style="color: #aaffff; font-weight: bold;">MouseZ</span><span style=" ">&#40;</span><span style=" ">&#41;</span>-mz<br />
&nbsp;event=<span style="color: #33ffdd;">0</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #ffee00">;Перемещение фигуры (событие №1)</span><br />
&nbsp; ex#=ex#+d#*dx#<br />
&nbsp; ey#=ey#+d#*dy#<br />
&nbsp; event=<span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">2</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #ffee00">;Вращение фигуры (событие №2)</span><br />
&nbsp; exang#=exang#+dx#<br />
&nbsp; eyang#=eyang#+dy#<br />
&nbsp; event=<span style="color: #33ffdd;">2</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> <span style="color: #aaffff; font-weight: bold;">MouseDown</span><span style=" ">&#40;</span><span style="color: #33ffdd;">3</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #ffee00">;Масштабирование фигуры (событие №3)</span><br />
&nbsp; esc#=esc#*<span style="color: #33ffdd;">1.01</span>^dy#<br />
&nbsp; event=<span style="color: #33ffdd;">3</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> dmz&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> det+dmz&gt;<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">And</span> det+dmz&lt;<span style="color: #33ffdd;">20</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Изменение детализации (событие №6)</span><br />
&nbsp; &nbsp;det=det+dmz<br />
&nbsp; &nbsp;recreate<br />
&nbsp; &nbsp;event=<span style="color: #33ffdd;">6</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; mz=<span style="color: #aaffff; font-weight: bold;">MouseZ</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; mb=<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;odx#=<span style="color: #aaffff; font-weight: bold;">MouseX</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;ody#=<span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<br />
&nbsp;<span style="color: #ffee00">;Обработка нажатий клавиш</span><br />
&nbsp;i=<span style="color: #aaffff; font-weight: bold;">GetKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> i&gt;=<span style="color: #33ffdd;">49</span> <span style="color: #aaffff; font-weight: bold;">And</span> i&lt;=<span style="color: #33ffdd;">52</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #ffee00">;Изменение типа фигуры (событие №4)</span><br />
&nbsp; et=i<span style="color: #33ffdd;">-48</span><br />
&nbsp; recreate<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> et=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">Then</span> event=<span style="color: #33ffdd;">4</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> i=<span style="color: #33ffdd;">48</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp; <span style="color: #ffee00">;Изменение цвета фигуры (событие №5)</span><br />
&nbsp; cr=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp; cg=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp; cb=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">255</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">EntityColor</span> m,cr,cg,cb<br />
&nbsp; event=<span style="color: #33ffdd;">5</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">PositionEntity</span> m,ex#,ey#,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RotateEntity</span> m,eyang#,exang#,<span style="color: #33ffdd;">0</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ScaleEntity</span> m,esc#,esc#,esc#<br />
<br />
&nbsp;<span style="color: #ffee00">;Обработка команд</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> cmd$<span style=" ">&#40;</span>cn,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;TEXT&quot;</span> <br />
&nbsp; &nbsp;<span style="color: #ffee00">;Вывод текста (только при бездействии)</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> event=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; txt$=cmd$<span style=" ">&#40;</span>cn,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; cn=cn<span style="color: #33ffdd;">+1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;WAITFOR&quot;</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Ожидание события</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> event=cmd$<span style=" ">&#40;</span>cn,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> cn=cn<span style="color: #33ffdd;">+1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;WAITKEY&quot;</span><br />
&nbsp; &nbsp;<span style="color: #ffee00">;Ожидание нажатия клавиши пробела</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> i=<span style="color: #33ffdd;">32</span> <span style="color: #aaffff; font-weight: bold;">Then</span> cn=cn<span style="color: #33ffdd;">+1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">RenderWorld</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,txt$<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Flip</span><br />
<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">KeyHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Function</span> recreate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;Создание фигуры</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> m&lt;&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">FreeEntity</span> m<br />
<span style="color: #aaffff; font-weight: bold;">Select</span> et<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">1</span>:m=<span style="color: #aaffff; font-weight: bold;">CreateCube</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">2</span>:m=<span style="color: #aaffff; font-weight: bold;">CreateSphere</span><span style=" ">&#40;</span>det<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">3</span>:m=<span style="color: #aaffff; font-weight: bold;">CreateCylinder</span><span style=" ">&#40;</span>det<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #33ffdd;">4</span>:m=<span style="color: #aaffff; font-weight: bold;">CreateCone</span><span style=" ">&#40;</span>det<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
<span style="color: #aaffff; font-weight: bold;">EntityColor</span> m,cr,cg,cb<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;TEXT&quot;</span>,<span style="color: #00ff66;">&quot;Это программа предназначена для просмотра трехмерных объектов. Нажмите пробел.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;WAITKEY&quot;</span>,<span style="color: #00ff66;">&quot;&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;TEXT&quot;</span>,<span style="color: #00ff66;">&quot;Данный урок поможет вам освоить ее.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;WAITKEY&quot;</span>,<span style="color: #00ff66;">&quot;&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;TEXT&quot;</span>,<span style="color: #00ff66;">&quot;Зажав левую кнопку мыши, вы можете перемещать объект. Попробуйте.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;WAITFOR&quot;</span>,<span style="color: #00ff66;">&quot;1&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;TEXT&quot;</span>,<span style="color: #00ff66;">&quot;С помощью правой кнопки, можно вращать объект. Поверните объект.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;WAITFOR&quot;</span>,<span style="color: #00ff66;">&quot;2&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;TEXT&quot;</span>,<span style="color: #00ff66;">&quot;Средняя кнопка - масштабирование объекта. Измените размер объекта.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;WAITFOR&quot;</span>,<span style="color: #00ff66;">&quot;3&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;TEXT&quot;</span>,<span style="color: #00ff66;">&quot;Цифровые клавиши 1-4 - выбор объекта. Для продолжения, выберите сферу(2).&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;WAITFOR&quot;</span>,<span style="color: #00ff66;">&quot;4&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;TEXT&quot;</span>,<span style="color: #00ff66;">&quot;Вы можете изменять цвет объекта клавишей 0. Измените цвет для подолжения.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;WAITFOR&quot;</span>,<span style="color: #00ff66;">&quot;5&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;TEXT&quot;</span>,<span style="color: #00ff66;">&quot;Смена детализации объекта - вращение колесика мыши.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;WAITFOR&quot;</span>,<span style="color: #00ff66;">&quot;6&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;TEXT&quot;</span>,<span style="color: #00ff66;">&quot;Вот и все, урок окончен.&quot;</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;WAITKEY&quot;</span>,<span style="color: #00ff66;">&quot;&quot;</span></div>
<a name=".D0.91.D0.BE.D0.BB.D0.B5.D0.B5_.D1.84.D1.83.D0.BD.D0.BA.D1.86.D0.B8.D0.BE.D0.BD.D0.B0.D0.BB.D1.8C.D0.BD.D0.B0.D1.8F_.D1.81.D0.BA.D1.80.D0.B8.D0.BF.D1.82.D0.BE.D0.B2.D0.B0.D1.8F_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D0.B0"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B&amp;action=edit&amp;section=3" title="Скрипты">править</a>]</span> <span class="mw-headline">Более функциональная скриптовая система</span></h2>
<p>Нижеследующая программа имеет больше возможностей по сравнению с 1-ым листингом. Она базируется на функциях.
</p>
<ul><li>"%имя функции{параметр,номер}" - синтаксис функции
</li><li>"общий блок1первый блок2второй блок...9девятый блок" - синтаксис команды
</li><li>"[имя вызываемой функции{параметр,переменная1=значение1,2переменная2=значение2...}]" - функция в блоке
</li></ul>
<p>Каждая функция начинается с символа "%", может иметь несколько разных имен, разделенных запятой (удобно для подбора окончаний), параметр и номер (если он указан, то берется строка с этим номером, равным значению переменной; если переменная равна 0, то берется случайное число). За функцией следует одна или несколько команд. Команды содержат блоки разделенные цифрами - общий блок длится до 1-ой встреченной цифры и обозначает общее для всех блоков начало текста. После цифры 1 идет блок, который будет присоединен к общему, если параметр равен 1, после цифры 2 - блок, присоединяемый в случае, когда параметр равен 2 и т. д. В блоках могут встречаться вызовы других функций, взятые в квадратные скобки, значение параметра функции и (опционально) блоки задания переменных через точку с запятой. Пример функции:
</p>
<ul><li>Data "%имя{пол}"
</li><li>Data  "1[имя-м]2[имя-ж]"
</li></ul>
<p>В этом примере - команда, которую можно перевести, как "Если пол равен 1,то вызвать функцию "имя-м", если пол равен 2, вызвать функцию "имя-ж". Общий блок здесь равен пустой строке.
</p><p>Переменные задаются в начале строк DATA, после идет разделитель - пустая строка, затем - функции с командами. Завершает блок данных еще одна пустая строка. Имена переменных и функций могут содержать пробелы. Запрещенные символы - "%", "[", "]", "{", "}", "=", ";".
</p><p>Еще в программе есть функция для запроса команды из скрипт-функции с помощью мыши (с ее помощью запрашиваются пол, имя, фамилия и отчество). Сама программа выводит случайным образом набор из тестовых фраз - приветствий и просьб.
</p><p>Стоит отметить и режим отладки - в случае, если вы неправильно введете имя функции или переменной, программа остановится и укажет на ошибку (DebugLog). Также можно включить некоторые сообщения программы с помощью переменной "debug".
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;"><span style="color: #aaffff; font-weight: bold;">SeedRnd</span> <span style="color: #aaffff; font-weight: bold;">MilliSecs</span><span style=" ">&#40;</span><span style=" ">&#41;</span><br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> vfuncnames=<span style="color: #33ffdd;">1</span>,vchunks=<span style="color: #33ffdd;">2</span>,vprocessing=<span style="color: #33ffdd;">4</span>,vvars=<span style="color: #33ffdd;">8</span><br />
<span style="color: #aaffff; font-weight: bold;">Const</span> maxparam=<span style="color: #33ffdd;">2</span>,debug=<span style="color: #33ffdd;">0</span><span style="color: #ffee00">;vchunks+vprocessing;+vfuncnames+vchunks</span><br />
<br />
<span style="color: #ffee00">;Кусок команды</span><br />
<span style="color: #aaffff; font-weight: bold;">Type</span> chunk<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> txt$,f.func,v.var,value,vfrom.var<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #ffee00">;Команда</span><br />
<span style="color: #aaffff; font-weight: bold;">Type</span> cmd<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> chunk.chunk<span style=" ">&#91;</span><span style="color: #33ffdd;">9</span><span style=" ">&#93;</span>,chunkq<span style=" ">&#91;</span><span style="color: #33ffdd;">9</span><span style=" ">&#93;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #ffee00">;Переменная</span><br />
<span style="color: #aaffff; font-weight: bold;">Type</span> var<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> name$,value<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #ffee00">;Функция</span><br />
<span style="color: #aaffff; font-weight: bold;">Type</span> func<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Field</span> firstcmd.cmd,cmdq,name$,param.var,snum.var<br />
<span style="color: #aaffff; font-weight: bold;">End Type</span><br />
<br />
<span style="color: #ffee00">;Создание переменных</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Read</span> name$<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> name$=<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;addvar name$<br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<br />
<span style="color: #ffee00">;Первый проход для функций (создает элементы)</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Read</span> m$<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> m$=<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>m$,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #00ff66;">&quot;%&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; brc1=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>m$,<span style="color: #00ff66;">&quot;{&quot;</span><span style=" ">&#41;</span><br />
&nbsp; param.var=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; snum.var=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> brc1=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;fname$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp;fname$=fromto$<span style=" ">&#40;</span>m$,<span style="color: #33ffdd;">2</span>,brc1<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;comma=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>m$,<span style="color: #00ff66;">&quot;,&quot;</span>,brc1<span style=" ">&#41;</span><br />
&nbsp; &nbsp;brc2=<span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>m$,<span style="color: #00ff66;">&quot;}&quot;</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> comma&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> brc2&gt;comma <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; vname$=fromto$<span style=" ">&#40;</span>m$,comma<span style="color: #33ffdd;">+1</span>,brc2<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; snum.var=findvar<span style=" ">&#40;</span>vname$<span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> comma&gt;brc1<span style="color: #33ffdd;">+1</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; vname$=fromto$<span style=" ">&#40;</span>m$,brc1<span style="color: #33ffdd;">+1</span>,comma<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; param.var=findvar<span style=" ">&#40;</span>vname$<span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> comma=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; vname$=fromto$<span style=" ">&#40;</span>m$,brc1<span style="color: #33ffdd;">+1</span>,brc2<span style="color: #33ffdd;">-1</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; param.var=findvar<span style=" ">&#40;</span>vname$<span style=" ">&#41;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; f.func=addfunc<span style=" ">&#40;</span>fname$,param,snum<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<br />
<span style="color: #ffee00">;Второй проход для функций (создает наборы команд)</span><br />
<span style="color: #aaffff; font-weight: bold;">Restore</span> func<br />
f=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Read</span> m$<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> m$=<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>m$,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span>=<span style="color: #00ff66;">&quot;%&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> f=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> f=<span style="color: #aaffff; font-weight: bold;">First</span> func <span style="color: #aaffff; font-weight: bold;">Else</span> f=<span style="color: #aaffff; font-weight: bold;">After</span> f<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> debug <span style="color: #aaffff; font-weight: bold;">And</span> vfuncnames <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> f\param&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> mm$=<span style="color: #00ff66;">&quot;(&quot;</span>+f\param\name$+<span style="color: #00ff66;">&quot;)&quot;</span> <span style="color: #aaffff; font-weight: bold;">Else</span> mm$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> f\snum&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> mm$=mm$+<span style="color: #00ff66;">&quot;{&quot;</span>+f\snum\name$+<span style="color: #00ff66;">&quot;}&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;------------&quot;</span>+f\name$+mm$+<span style="color: #00ff66;">&quot;------------&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; addcmd<span style=" ">&#40;</span>f,m$<span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Graphics</span> <span style="color: #33ffdd;">800</span>,<span style="color: #33ffdd;">600</span><br />
<span style="color: #aaffff; font-weight: bold;">SetFont</span> <span style="color: #aaffff; font-weight: bold;">LoadFont</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;Arial Cyr&quot;</span>,<span style="color: #33ffdd;">14</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #ffee00">;Запрос данных</span><br />
gender=ask<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;ваш пол&quot;</span>,<span style="color: #00ff66;">&quot;выбор пола&quot;</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
fam=ask<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;ваша фамилия&quot;</span>,<span style="color: #00ff66;">&quot;фамилия&quot;</span>,gender<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> gender=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <br />
&nbsp;ask <span style="color: #00ff66;">&quot;ваше имя&quot;</span>,<span style="color: #00ff66;">&quot;имяотчество&quot;</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp;ask <span style="color: #00ff66;">&quot;ваше имя&quot;</span>,<span style="color: #00ff66;">&quot;имя (ж)&quot;</span>,<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
ask <span style="color: #00ff66;">&quot;ваше отчество&quot;</span>,<span style="color: #00ff66;">&quot;имяотчество&quot;</span>,<span style="color: #33ffdd;">2</span>+<span style=" ">&#40;</span>gender=<span style="color: #33ffdd;">2</span><span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> debug <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;----------------------------------------&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span> <br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Print</span> m$+phrase$<span style=" ">&#40;</span>findfunc<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;обращение&quot;</span><span style=" ">&#41;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Until</span> <span style="color: #aaffff; font-weight: bold;">WaitKey</span><span style=" ">&#40;</span><span style=" ">&#41;</span>=<span style="color: #33ffdd;">27</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">End</span><br />
<br />
<span style="color: #ffee00">;Переменные</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;падеж&quot;</span>,<span style="color: #00ff66;">&quot;тип&quot;</span>,<span style="color: #00ff66;">&quot;пол&quot;</span>,<span style="color: #00ff66;">&quot;номер&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;ваше имя&quot;</span>, <span style="color: #00ff66;">&quot;ваша фамилия&quot;</span>, <span style="color: #00ff66;">&quot;ваше отчество&quot;</span>, <span style="color: #00ff66;">&quot;ваш пол&quot;</span>,<span style="color: #00ff66;">&quot;&quot;</span><br />
<br />
.func<br />
<span style="color: #ffee00">;Функции с командами</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%обращение&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Здравствуй, [ву{падеж=1}].&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Приветствую, [вф{падеж=1}].&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Добрый день, [ви{падеж=1}] [во].&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Привет, [ви{падеж=1}].&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Как жизнь, [вп{падеж=1}]?&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Кто из вас [вф{падеж=1}] [ви] [во]?&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Нигде не могу найти [имя{падеж=4;номер=0}] [отчество].&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;[вп{падеж=1}], пойдем к [имя{падеж=3;номер=0}].&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Мы с [вф{падеж=5}] сейчас придем.&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Поговорим о [фамилия{падеж=6;номер=0}] [имя] [отчество]&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%выбор пола&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Мужской&quot;</span>,<span style="color: #00ff66;">&quot;Женский&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%имя{пол}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1[имяотчество{1}]2[имя (ж)]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%отчество{пол}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1[имяотчество{2}]2[имяотчество{3}]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%уменьш. имя{пол}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1[уменьш. имя (м)]2[уменьш. имя (ж)]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%панибр. имя{пол}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1[панибр. имя (м)]2[панибр. имя (ж)]&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%вф&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;[фамилия{ваш пол;номер=ваша фамилия}]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%ви&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;[имя{ваш пол;номер=ваше имя}]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%ву&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;[уменьш. имя{ваш пол;номер=ваше имя}]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%вп&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;[панибр. имя{ваш пол;номер=ваше имя}]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%во&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;[отчество{ваш пол;номер=ваше отчество}]&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%имяотчество{тип,номер}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Алексе1[й]2евич[евич]3евн[евна]&quot;</span>,<span style="color: #00ff66;">&quot;Андре1[й]2евич[евич]3евн[евна]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Евдоким1[_]2ович[ович]3овн[овна]&quot;</span>,<span style="color: #00ff66;">&quot;Карл1[_]2ович[ович]3овн[овна]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Иван1[_]2ович[ович]3овн[овна]&quot;</span>,<span style="color: #00ff66;">&quot;Федор1[_]2ович[ович]3овн[овна]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Дав1ид[_]2ыдович[ович]3ыдовн[овна]&quot;</span>,<span style="color: #00ff66;">&quot;Тимофе1[й]2евич[евич]3евн[евна]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Харитон1[_]2ович[ович]3овн[овна]&quot;</span>,<span style="color: #00ff66;">&quot;Антон1[_]2ович[ович]3овн[овна]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Гаврил1[а]2ович[ович]3овн[овна]&quot;</span>,<span style="color: #00ff66;">&quot;Миха1ил[_]2йлович[ович]3йловн[овна]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Иль1[я]2ич[ич]3инич[ина]&quot;</span>,<span style="color: #00ff66;">&quot;Пав1[ел]2лович[ович]3ловн[овна]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Петр1[_]2ович[ович]3овн[овна]&quot;</span>,<span style="color: #00ff66;">&quot;Яков1[_]2левич[евич]3левн[евна]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Семен1[_]2ович[ович]3овн[овна]&quot;</span>,<span style="color: #00ff66;">&quot;Исаак1[_]2ович[ович]3овн[овна]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Марк1[_]2ович[ович]3овн[овна]&quot;</span>,<span style="color: #00ff66;">&quot;Игнат1[_]2ьевич[евич]3ьевн[евна]&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%уменьш. имя (м){,номер}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Леш[а3]&quot;</span>,<span style="color: #00ff66;">&quot;Андрюш[а3]&quot;</span>,<span style="color: #00ff66;">&quot;Евдоким&quot;</span>,<span style="color: #00ff66;">&quot;Карлуш[а3]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Ван[я]&quot;</span>,<span style="color: #00ff66;">&quot;Фед[я]&quot;</span>,<span style="color: #00ff66;">&quot;Давид[_]&quot;</span>,<span style="color: #00ff66;">&quot;Тимош[а3]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Харитош[а3]&quot;</span>,<span style="color: #00ff66;">&quot;Антош[а3]&quot;</span>,<span style="color: #00ff66;">&quot;Гавр[я]&quot;</span>,<span style="color: #00ff66;">&quot;Миш[а3]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Илюш[а3]&quot;</span>,<span style="color: #00ff66;">&quot;Паш[а3]&quot;</span>,<span style="color: #00ff66;">&quot;Пет[я]&quot;</span>,<span style="color: #00ff66;">&quot;Яш[а3]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Сен[я]&quot;</span>,<span style="color: #00ff66;">&quot;Из[я]&quot;</span>,<span style="color: #00ff66;">&quot;Марк[_]&quot;</span>,<span style="color: #00ff66;">&quot;Игнат[_]&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%панибр. имя (м){,номер}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Лех[а3]&quot;</span>,<span style="color: #00ff66;">&quot;Андрюх[а3]&quot;</span>,<span style="color: #00ff66;">&quot;Евдоким&quot;</span>,<span style="color: #00ff66;">&quot;Карлух[а3]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Вано&quot;</span>,<span style="color: #00ff66;">&quot;Фед[я]&quot;</span>,<span style="color: #00ff66;">&quot;Давид[_]&quot;</span>,<span style="color: #00ff66;">&quot;Тимох[а3]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Харитох[а3]&quot;</span>,<span style="color: #00ff66;">&quot;Антох[а3]&quot;</span>,<span style="color: #00ff66;">&quot;Гавр[я]&quot;</span>,<span style="color: #00ff66;">&quot;Мих[а3]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Илюх[а3]&quot;</span>,<span style="color: #00ff66;">&quot;Пах[а3]&quot;</span>,<span style="color: #00ff66;">&quot;Пет[я]&quot;</span>,<span style="color: #00ff66;">&quot;Яш[а3]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Сен[я]&quot;</span>,<span style="color: #00ff66;">&quot;Из[я]&quot;</span>,<span style="color: #00ff66;">&quot;Марк[_]&quot;</span>,<span style="color: #00ff66;">&quot;Игнат[_]&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%имя (ж){,номер}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Ольг[а]&quot;</span>,<span style="color: #00ff66;">&quot;Анн[а2]&quot;</span>,<span style="color: #00ff66;">&quot;Серафим[а2]&quot;</span>,<span style="color: #00ff66;">&quot;Марин[а2]&quot;</span>,<span style="color: #00ff66;">&quot;Зинаид[а2]&quot;</span>,<span style="color: #00ff66;">&quot;Ид[а2]&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%уменьш. имя (ж),панибр. имя (ж){,номер}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Ол[я]&quot;</span>,<span style="color: #00ff66;">&quot;Ан[я]&quot;</span>,<span style="color: #00ff66;">&quot;Фим[а2]&quot;</span>,<span style="color: #00ff66;">&quot;Марин[а2]&quot;</span>,<span style="color: #00ff66;">&quot;Зин[а2]&quot;</span>,<span style="color: #00ff66;">&quot;Ид[а2]&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%фамилия{пол,номер}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Орлов1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Крылов1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Спиридонов1[ов]2[ова]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Михайлов1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Круглов1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Перехрестов1[ов]2[ова]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Петров1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Камаров1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Семенов1[ов]2[ова]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Кушаков1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Петраков1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Пушкин1[ин]2[ина]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Гогол1[ь]2ь&quot;</span>,<span style="color: #00ff66;">&quot;Калугин1[ин]2[ина]&quot;</span>,<span style="color: #00ff66;">&quot;Мясов1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Макаров1[ов]2[ова]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Петерсен&quot;</span>,<span style="color: #00ff66;">&quot;Горбунов1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Притыкин1[ин]2[ина]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Серпухов1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Куров1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Тикакеев1[ев]2[ева]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Коратыгин1[ин]2[ина]&quot;</span>,<span style="color: #00ff66;">&quot;Машкин1[ин]2[ина]&quot;</span>,<span style="color: #00ff66;">&quot;Кошкин1[ин]2[ина]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Марков1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Окнов1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Козлов1[ов]2[ова]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Стрючков1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Мотыльков1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Ковшегуб&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Сусанин1[ин]2[ина]&quot;</span>,<span style="color: #00ff66;">&quot;Жуковск1[ий]2[ая]&quot;</span>,<span style="color: #00ff66;">&quot;Жуков1[ов]2[ова]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Захарьин1[ин]2[ина]&quot;</span>,<span style="color: #00ff66;">&quot;Петрушевск1[ий]2[ая]&quot;</span>,<span style="color: #00ff66;">&quot;Комаров1[ов]2[ова]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Зубов1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Ромашкин1[ин]2[ина]&quot;</span>,<span style="color: #00ff66;">&quot;Фетелюшин1[ин]2[ина]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Комаров1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Пакин1[ин]2[ина]&quot;</span>,<span style="color: #00ff66;">&quot;Ракукин1[ин]2[ина]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Немецк1[ий]2[ая]&quot;</span>,<span style="color: #00ff66;">&quot;Григорьев1[ев]2[ева]&quot;</span>,<span style="color: #00ff66;">&quot;Шашкин1[ин]2[ина]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Мышин1[ин]2[ина]&quot;</span>,<span style="color: #00ff66;">&quot;Коршунов1[ов]2[ова]&quot;</span>,<span style="color: #00ff66;">&quot;Кулыгин1[ин]2[ина]&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;Селезнев1[ев]2[ева]&quot;</span>,<span style="color: #00ff66;">&quot;Кузнецов1[ов]2[ова]&quot;</span><br />
<br />
<span style="color: #ffee00">;Окончания</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%ов,ев{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;2а3у4а5ым6е&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%ович,евич{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;2а3у4а5ем6е&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%_,ен,им,уб,ан,ич{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;2а3у4а5ом6е&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%ин{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;2а3у4а5ым6е&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%ей{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1ей2ея3ею4ея5ем6ее&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%ь{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1ь2я3ю4я5ем6е&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%а{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1а2и3е4у5ой6е&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%а2{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1а2ы3е4у5ой6е&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%а3{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1а2и3е4у5ей6е&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%я{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1я2и3е4ю5ей6е&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%овна,евна{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1а2ы3е4у5ой6е&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%ова,ева,ина{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1а2ой3ой4у5ой6ой&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%ий{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1ий2ого3ому4ого5им6ом&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%ая{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1ая2ой3ой4ую5ой6ой&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%й{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1й2я3ю4я5ем6е&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;%ел{падеж}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Data</span> &nbsp;<span style="color: #00ff66;">&quot;1ел2ла3лу4ла5лом6ле&quot;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Data</span> <span style="color: #00ff66;">&quot;&quot;</span><br />
<br />
<span style="color: #ffee00">;Функция возвращает часть исходной строки с символа pfrom до pto</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> fromto$<span style=" ">&#40;</span>v$,pfrom,pto<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>v$,pfrom,pto-pfrom<span style="color: #33ffdd;">+1</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Добавление новой переменной (имя)</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> addvar.var<span style=" ">&#40;</span>name$<span style=" ">&#41;</span><br />
v.var=<span style="color: #aaffff; font-weight: bold;">New</span> var<br />
v\name$=name$<br />
v\value=<span style="color: #33ffdd;">1</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> v<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Добавление новой функции (имя,параметр,переменная для номера</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> addfunc.func<span style=" ">&#40;</span>name$,param.var,snum.var<span style=" ">&#41;</span><br />
f.func=<span style="color: #aaffff; font-weight: bold;">New</span> func<br />
f\param=param<br />
f\snum=snum<br />
f\name$=<span style="color: #00ff66;">&quot;,&quot;</span>+name$+<span style="color: #00ff66;">&quot;,&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> debug <span style="color: #aaffff; font-weight: bold;">And</span> vfuncnames <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;{&quot;</span>+name$+<span style="color: #00ff66;">&quot;}&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> f<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Добавление новой команды (функция,строка данных)</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> addcmd.cmd<span style=" ">&#40;</span>f.func,m$<span style=" ">&#41;</span><br />
v.var=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
vfrom.var=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
f2.func=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
c.cmd=<span style="color: #aaffff; font-weight: bold;">New</span> cmd<br />
<span style="color: #aaffff; font-weight: bold;">If</span> f\firstcmd=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> f\firstcmd=c<br />
m$=m$+<span style="color: #00ff66;">&quot;[&quot;</span><br />
<span style="color: #ffee00">;Парсер</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #aaffff; font-weight: bold;">Len</span><span style=" ">&#40;</span>m$<span style=" ">&#41;</span><br />
&nbsp;mm$=<span style="color: #aaffff; font-weight: bold;">Mid</span>$<span style=" ">&#40;</span>m$,n,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Select</span> mm$<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;[&quot;</span><br />
&nbsp; &nbsp;atcmd=<span style="color: #33ffdd;">1</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> txt$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> addchunk c,cn,<span style="color: #aaffff; font-weight: bold;">Null</span>,<span style="color: #aaffff; font-weight: bold;">Null</span>,<span style="color: #33ffdd;">0</span>,txt$,<span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; &nbsp;txt$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;]&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> f2=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> f2=findfunc<span style=" ">&#40;</span>txt$<span style=" ">&#41;</span><br />
&nbsp; &nbsp;addchunk c,cn,f2,<span style="color: #aaffff; font-weight: bold;">Null</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #00ff66;">&quot;&quot;</span>,<span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; &nbsp;atcmd=<span style="color: #33ffdd;">0</span><br />
&nbsp; &nbsp;f2=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; &nbsp;txt$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;{&quot;</span><br />
&nbsp; &nbsp;f2=findfunc<span style=" ">&#40;</span>txt$<span style=" ">&#41;</span><br />
&nbsp; &nbsp;v=f2\param<br />
&nbsp; &nbsp;txt$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;=&quot;</span><br />
&nbsp; &nbsp;v=findvar<span style=" ">&#40;</span>txt$<span style=" ">&#41;</span><br />
&nbsp; &nbsp;txt$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;}&quot;</span>,<span style="color: #00ff66;">&quot;;&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span><span style="color: #00ff66;">&quot;0123456789&quot;</span>,<span style="color: #aaffff; font-weight: bold;">Left</span>$<span style=" ">&#40;</span>txt$,<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; addchunk c,cn,<span style="color: #aaffff; font-weight: bold;">Null</span>,v,txt$,<span style="color: #00ff66;">&quot;&quot;</span>,<span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> debug <span style="color: #aaffff; font-weight: bold;">And</span> vvars <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">DebugLog</span> f\name$+<span style="color: #00ff66;">&quot;(&quot;</span>+v\name$+<span style="color: #00ff66;">&quot;=&quot;</span>+txt$+<span style="color: #00ff66;">&quot;)&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; vfrom=findvar<span style=" ">&#40;</span>txt$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; addchunk c,cn,<span style="color: #aaffff; font-weight: bold;">Null</span>,v,<span style="color: #33ffdd;">0</span>,<span style="color: #00ff66;">&quot;&quot;</span>,vfrom<br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> debug <span style="color: #aaffff; font-weight: bold;">And</span> vvars <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">DebugLog</span> f\name$+<span style="color: #00ff66;">&quot;(&quot;</span>+v\name$+<span style="color: #00ff66;">&quot;=&quot;</span>+vfrom\name$+<span style="color: #00ff66;">&quot;)&quot;</span><br />
&nbsp; &nbsp; vfrom=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;txt$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; &nbsp;v=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Default</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span>mm$<span style=" ">&#41;</span>&gt;=<span style="color: #33ffdd;">49</span> <span style="color: #aaffff; font-weight: bold;">And</span> <span style="color: #aaffff; font-weight: bold;">Asc</span><span style=" ">&#40;</span>mm$<span style=" ">&#41;</span>&lt;=<span style="color: #33ffdd;">57</span> <span style="color: #aaffff; font-weight: bold;">And</span> atcmd=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> txt$&lt;&gt;<span style="color: #00ff66;">&quot;&quot;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> addchunk c,cn,<span style="color: #aaffff; font-weight: bold;">Null</span>,<span style="color: #aaffff; font-weight: bold;">Null</span>,<span style="color: #33ffdd;">0</span>,txt$,<span style="color: #aaffff; font-weight: bold;">Null</span><br />
&nbsp; &nbsp; cn=mm$<br />
&nbsp; &nbsp; txt$=<span style="color: #00ff66;">&quot;&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">Else</span><br />
&nbsp; &nbsp; txt$=txt$+mm$<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
&nbsp;<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
f\cmdq=f\cmdq<span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> c<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Добавление куска команды</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> addchunk<span style=" ">&#40;</span>c.cmd,n,f.func,v.var,value,txt$,vfrom.var<span style=" ">&#41;</span><br />
ch.chunk=<span style="color: #aaffff; font-weight: bold;">New</span> chunk<br />
ch\f=f<br />
ch\v=v<br />
ch\value=value<br />
ch\txt$=txt$<br />
ch\vfrom=vfrom<br />
<span style="color: #aaffff; font-weight: bold;">If</span> c\chunk<span style=" ">&#91;</span>n<span style=" ">&#93;</span>=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> c\chunk<span style=" ">&#91;</span>n<span style=" ">&#93;</span>=ch<br />
c\chunkq<span style=" ">&#91;</span>n<span style=" ">&#93;</span>=c\chunkq<span style=" ">&#91;</span>n<span style=" ">&#93;</span><span style="color: #33ffdd;">+1</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> debug <span style="color: #aaffff; font-weight: bold;">And</span> vchunks <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp;m$=n+<span style="color: #00ff66;">&quot;,&quot;</span>+c\chunkq<span style=" ">&#91;</span>n<span style=" ">&#93;</span>+<span style="color: #00ff66;">&quot;:&quot;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> f&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> m$=m$+<span style="color: #00ff66;">&quot;func &quot;</span>+ch\f\name$+<span style="color: #00ff66;">&quot;;&quot;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> vfrom&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; m$=m$+<span style="color: #00ff66;">&quot;var &quot;</span>+ch\v\name$+<span style="color: #00ff66;">&quot;=&quot;</span>+ch\vfrom\name$+<span style="color: #00ff66;">&quot;; &quot;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> v&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; m$=m$+<span style="color: #00ff66;">&quot;var &quot;</span>+ch\v\name$+<span style="color: #00ff66;">&quot;=&quot;</span>+ch\value+<span style="color: #00ff66;">&quot;; &quot;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">DebugLog</span> m$+<span style="color: #00ff66;">&quot;'&quot;</span>+txt$+<span style="color: #00ff66;">&quot;'&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Поиск функции по названию</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> findfunc.func<span style=" ">&#40;</span>funcname$<span style=" ">&#41;</span><br />
funcname$=<span style="color: #00ff66;">&quot;,&quot;</span>+funcname$+<span style="color: #00ff66;">&quot;,&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> f.func=<span style="color: #aaffff; font-weight: bold;">Each</span> func<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">Instr</span><span style=" ">&#40;</span>f\name$,funcname$<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> f<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> f=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;Function [&quot;</span>+funcname$+<span style="color: #00ff66;">&quot;] not found&quot;</span>:<span style="color: #aaffff; font-weight: bold;">Stop</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Поиск переменной по названию</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> findvar.var<span style=" ">&#40;</span>vname$<span style=" ">&#41;</span><br />
<span style="color: #ffee00">;DebugLog vname$</span><br />
<span style="color: #aaffff; font-weight: bold;">For</span> v.var=<span style="color: #aaffff; font-weight: bold;">Each</span> var<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> v\name$=vname$ <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Return</span> v<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> v=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">DebugLog</span> <span style="color: #00ff66;">&quot;Variable {&quot;</span>+vname$+<span style="color: #00ff66;">&quot;} not found&quot;</span>:<span style="color: #aaffff; font-weight: bold;">Stop</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Вывод фразы (функция, значение параметра, номер команды)</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> phrase$<span style=" ">&#40;</span>f.func,pvalue=<span style="color: #33ffdd;">0</span>,num=<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">If</span> f\snum&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">And</span> num=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> num=f\snum\value<br />
<span style="color: #aaffff; font-weight: bold;">If</span> num=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> cn=<span style="color: #aaffff; font-weight: bold;">Rand</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span>,f\cmdq<span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Else</span> cn=num<br />
<br />
cmd.cmd=f\Firstcmd<br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">2</span> <span style="color: #aaffff; font-weight: bold;">To</span> cn<br />
&nbsp;cmd=<span style="color: #aaffff; font-weight: bold;">After</span> cmd<br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">If</span> f\param&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">And</span> pvalue&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">Then</span> f\param\value=pvalue<br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">To</span> <span style="color: #33ffdd;">1</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> f\param=<span style="color: #aaffff; font-weight: bold;">Null</span> <span style="color: #aaffff; font-weight: bold;">Then</span> chn=n <span style="color: #aaffff; font-weight: bold;">Else</span> chn=n*f\param\value<br />
&nbsp;ch.chunk=cmd\chunk<span style=" ">&#91;</span>chn<span style=" ">&#93;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> debug <span style="color: #aaffff; font-weight: bold;">And</span> vprocessing <span style="color: #aaffff; font-weight: bold;">And</span> f\param&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">DebugLog</span> f\name$+<span style="color: #00ff66;">&quot; param {&quot;</span>+f\param\name$+<span style="color: #00ff66;">&quot;=&quot;</span>+f\param\value+<span style="color: #00ff66;">&quot;}&quot;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> nn=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> cmd\chunkq<span style=" ">&#91;</span>chn<span style=" ">&#93;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> debug <span style="color: #aaffff; font-weight: bold;">And</span> vprocessing <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;m$=f\name$+<span style="color: #00ff66;">&quot;:&quot;</span>+chn+<span style="color: #00ff66;">&quot;(&quot;</span>+nn+<span style="color: #00ff66;">&quot; of &quot;</span>+cmd\chunkq<span style=" ">&#91;</span>chn<span style=" ">&#93;</span>+<span style="color: #00ff66;">&quot;):&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> ch\f&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> m$=m$+<span style="color: #00ff66;">&quot;func &quot;</span>+ch\f\name$<br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> ch\vfrom&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp; m$=m$+<span style="color: #00ff66;">&quot;(&quot;</span>+ch\v\name$+<span style="color: #00ff66;">&quot;=&quot;</span>+ch\vfrom\name$+<span style="color: #00ff66;">&quot;)&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">ElseIf</span> ch\v&lt;&gt;Null<br />
&nbsp; &nbsp; m$=m$+<span style="color: #00ff66;">&quot;(&quot;</span>+ch\v\name$+<span style="color: #00ff66;">&quot;=&quot;</span>+ch\value+<span style="color: #00ff66;">&quot;)&quot;</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; &nbsp;<span style="color: #aaffff; font-weight: bold;">DebugLog</span> m$+<span style="color: #00ff66;">&quot;'&quot;</span>+txt$+<span style="color: #00ff66;">&quot;'&quot;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> ch\vfrom&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;ch\v\value=ch\vfrom\value<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">ElseIf</span> ch\v&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span><br />
&nbsp; &nbsp;ch\v\value=ch\value<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">End</span> <span style="color: #aaffff; font-weight: bold;">If</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">If</span> ch\f&lt;&gt;Null <span style="color: #aaffff; font-weight: bold;">Then</span> p$=p$+phrase$<span style=" ">&#40;</span>ch\f,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; p$=p$+ch\txt$<br />
&nbsp; ch=<span style="color: #aaffff; font-weight: bold;">After</span> ch<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Return</span> p$<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Установка значения переменной по названию</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> setvar<span style=" ">&#40;</span>name$,value<span style=" ">&#41;</span><br />
v.var=findvar<span style=" ">&#40;</span>name$<span style=" ">&#41;</span><br />
v\value=value<br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Функция для теста падежей</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> testpad<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
f.func=<span style="color: #aaffff; font-weight: bold;">First</span> func<br />
c.cmd=<span style="color: #aaffff; font-weight: bold;">First</span> cmd<br />
pad.var=findvar<span style=" ">&#40;</span><span style="color: #00ff66;">&quot;падеж&quot;</span><span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> f\cmdq<br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Cls</span><br />
&nbsp; pad\value=<span style="color: #33ffdd;">1</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,phrase$<span style=" ">&#40;</span>f,n<span style=" ">&#41;</span><br />
&nbsp; pad\value=<span style="color: #33ffdd;">2</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">14</span>,<span style="color: #00ff66;">&quot;Здесь нет &quot;</span>+phrase$<span style=" ">&#40;</span>f,n<span style=" ">&#41;</span><br />
&nbsp; pad\value=<span style="color: #33ffdd;">3</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">28</span>,<span style="color: #00ff66;">&quot;Пойти к &quot;</span>+phrase$<span style=" ">&#40;</span>f,n<span style=" ">&#41;</span><br />
&nbsp; pad\value=<span style="color: #33ffdd;">4</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">42</span>,<span style="color: #00ff66;">&quot;Посмотреть на &quot;</span>+phrase$<span style=" ">&#40;</span>f,n<span style=" ">&#41;</span><br />
&nbsp; pad\value=<span style="color: #33ffdd;">5</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">56</span>,<span style="color: #00ff66;">&quot;Стоять перед &quot;</span>+phrase$<span style=" ">&#40;</span>f,n<span style=" ">&#41;</span><br />
&nbsp; pad\value=<span style="color: #33ffdd;">6</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">70</span>,<span style="color: #00ff66;">&quot;Говорить о &quot;</span>+phrase$<span style=" ">&#40;</span>f,n<span style=" ">&#41;</span><br />
&nbsp; <span style="color: #aaffff; font-weight: bold;">WaitKey</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Next</span><br />
&nbsp;f=<span style="color: #aaffff; font-weight: bold;">After</span> f<br />
<span style="color: #aaffff; font-weight: bold;">Until</span> f=<span style="color: #aaffff; font-weight: bold;">Null</span><br />
<span style="color: #aaffff; font-weight: bold;">End Function</span><br />
<br />
<span style="color: #ffee00">;Запрос номера команды (имя переменной, имя функции, значение параметра)</span><br />
<span style="color: #ffee00">; имя переменной - той, которая будет изменена</span><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> ask<span style=" ">&#40;</span>vname$,fname$,pvalue<span style=" ">&#41;</span><br />
v.var=findvar<span style=" ">&#40;</span>vname$<span style=" ">&#41;</span><br />
f.func=findfunc<span style=" ">&#40;</span>fname$<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Cls</span><br />
<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,fname$<br />
<span style="color: #aaffff; font-weight: bold;">For</span> n=<span style="color: #33ffdd;">1</span> <span style="color: #aaffff; font-weight: bold;">To</span> f\cmdq<br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">Text</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">10</span>*n,n+<span style="color: #00ff66;">&quot;) &quot;</span>+phrase$<span style=" ">&#40;</span>f,pvalue,n<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">Next</span><br />
<span style="color: #aaffff; font-weight: bold;">Repeat</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> <span style="color: #aaffff; font-weight: bold;">MouseHit</span><span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span> <span style="color: #aaffff; font-weight: bold;">Then</span> i=<span style="color: #aaffff; font-weight: bold;">Floor</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">MouseY</span><span style=" ">&#40;</span><span style=" ">&#41;</span>/<span style="color: #33ffdd;">10</span><span style=" ">&#41;</span><br />
&nbsp;<span style="color: #aaffff; font-weight: bold;">If</span> i&gt;<span style="color: #33ffdd;">0</span> <span style="color: #aaffff; font-weight: bold;">And</span> i&lt;n <span style="color: #aaffff; font-weight: bold;">Then</span> <span style="color: #aaffff; font-weight: bold;">Exit</span><br />
<span style="color: #aaffff; font-weight: bold;">Forever</span><br />
v\value=i<br />
<span style="color: #aaffff; font-weight: bold;">Return</span> i<br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<div align="right"><a href="http://blitzetcetera.org/images/0/03/Script.zip" class="internal" title="Script.zip">скачать архив с файлами к статье</a></div>
<hr />
<p>Автор: <a href="http://blitzetcetera.org/index.php/%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%BD%D0%B8%D0%BA:Matt_Merkulov" title="Участник:Matt Merkulov">Матвей Меркулов</a> (E-mail: MattMerk@mail.ru, ICQ: 392-274-050)
</td><td class="rightside"><table cellspacing=0 cellpadding=0><tr><td class="rightheader"></td></tr></table></td></tr><tr colspan="3" height="40"><td>&nbsp;</td></tr><tr><td class="leftside"><table cellspacing=0 cellpadding=0><tr><td class="leftheader"></td></tr></table></td><td class="sheetbody"><a name="Заметки  от Джимона"></a><h1><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=Обсуждение:Заметки  от Джимона&amp;action=edit">обсудить</a>] [<a href="http://blitzetcetera.org/index.php?title=Заметки  от Джимона&amp;action=edit">править</a>]</span><span class="mw-headline">Заметки  от Джимона</span></h1>
</p>
<a name=".D0.97.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.BA.D0.B0_.D1.82.D0.B5.D0.BA.D1.81.D1.82.D1.83.D1.80"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%97%D0%B0%D0%BC%D0%B5%D1%82%D0%BA%D0%B8_%D0%BE%D1%82_%D0%94%D0%B6%D0%B8%D0%BC%D0%BE%D0%BD%D0%B0&amp;action=edit&amp;section=1" title="Заметки от Джимона">править</a>]</span> <span class="mw-headline">Загрузка текстур</span></h2>
<p>Я заметил глюк в блице: версия 1.87 не хочет грузить текстуры с размером не кратным 2 на видеокартах geforce 6 series
В общем, я написал функцию обхода этого:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">video_card_type$=<span style="color: #00ff66;">&quot;Geforce 6 series&quot;</span><br />
<p><br />
<span style="color: #aaffff; font-weight: bold;">Function</span> load_texture<span style=" ">&#40;</span>file$,flags=<span style="color: #33ffdd;">1</span>,frames=<span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<span style="color: #ffee00">;by jimon</span><br />
<span style="color: #aaffff; font-weight: bold;">Select</span> video_card_type$<br />
<span style="color: #aaffff; font-weight: bold;">Case</span> <span style="color: #00ff66;">&quot;Geforce 6 series&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; img=<span style="color: #aaffff; font-weight: bold;">LoadImage</span><span style=" ">&#40;</span>file$<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; tex=<span style="color: #aaffff; font-weight: bold;">CreateTexture</span><span style=" ">&#40;</span><span style="color: #aaffff; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>img<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>img<span style=" ">&#41;</span>,flags,frames<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">CopyRect</span> <span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">ImageWidth</span><span style=" ">&#40;</span>img<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">ImageHeight</span><span style=" ">&#40;</span>img<span style=" ">&#41;</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #33ffdd;">0</span>,<span style="color: #aaffff; font-weight: bold;">ImageBuffer</span><span style=" ">&#40;</span>img<span style=" ">&#41;</span>,<span style="color: #aaffff; font-weight: bold;">TextureBuffer</span><span style=" ">&#40;</span>tex<span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">FreeImage</span> img<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> tex<br />
<span style="color: #aaffff; font-weight: bold;">Default</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aaffff; font-weight: bold;">Return</span> <span style="color: #aaffff; font-weight: bold;">LoadTexture</span><span style=" ">&#40;</span>file$,flags<span style=" ">&#41;</span><br />
<span style="color: #aaffff; font-weight: bold;">End Select</span><br />
</p>
<span style="color: #aaffff; font-weight: bold;">End Function</span></div>
<p>Потом установил 1.90 но там уже текстуры блиц грузит!!! Решил протестировать на скорость. 1.87 моя функция загрузила текстуру 873*519 за 55 мс , блиц не загрузил но что-то думал 33 мс. 1.90 моя функция также загрузила за 55 мс , а блиц думал целых 907 мс (!!!), но что-то загрузил.
</p><p>В общем, желательно во всех програмах использовать ету функцию&nbsp;:), чтобы ваши игры нормально шли на новых видеокартах.
</p><p>ps. у меня XFX 6600 GT и все идет с этим кодом
</p>
<a name=".D0.9A.D0.B0.D0.BA_.D0.BE.D0.B1.D0.BE.D0.B9.D1.82.D0.B8_.D0.BE.D1.88.D0.B8.D0.B1.D0.BA.D1.83_.D0.B4.D0.B5.D0.BB.D0.B5.D0.BD.D0.B8.D1.8F_.D0.BD.D0.B0_.D0.BD.D0.BE.D0.BB.D1.8C_.3F"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%97%D0%B0%D0%BC%D0%B5%D1%82%D0%BA%D0%B8_%D0%BE%D1%82_%D0%94%D0%B6%D0%B8%D0%BC%D0%BE%D0%BD%D0%B0&amp;action=edit&amp;section=2" title="Заметки от Джимона">править</a>]</span> <span class="mw-headline">Как обойти ошибку деления на ноль&nbsp;?</span></h2>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">a=b/c#</div>
<p>Обязательно задать c тип float и ошибки не будет. Это происходит из-за неточностей в обработке сверхмалых чисел то, есть когда c#=0, то получается примерно так a=b/0.00000001
</p><p>Вот так вот.
</p>
<a name=".D0.9E.D1.88.D0.B8.D0.B1.D0.BA.D0.B0_.D0.B2_.D0.B1.D0.B8.D0.B1.D0.BB.D0.B8.D0.BE.D1.82.D0.B5.D0.BA.D0.B5_ODE"></a><h2><span class="editsection">[<a href="http://blitzetcetera.org/index.php?title=%D0%97%D0%B0%D0%BC%D0%B5%D1%82%D0%BA%D0%B8_%D0%BE%D1%82_%D0%94%D0%B6%D0%B8%D0%BC%D0%BE%D0%BD%D0%B0&amp;action=edit&amp;section=3" title="Заметки от Джимона">править</a>]</span> <span class="mw-headline">Ошибка в библиотеке ODE</span></h2>
<p>Найдена критическая ошибка в функции преобразовании углов поворота в матрицу поворота в arkon ode 0.5 wrapper. Пример ошибки&nbsp;:
</p>
<div class="bb" style="font-family: monospace;background-color:#FFFFFF;border:1px dashed #CCCCCC;padding:10px;background-color:#225588;color:#FFFFFF;border:1px solid #003040;padding:10px;">space = ODE_dWorldCreate<span style=" ">&#40;</span><span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
<p><br />
body = ODE_dBodyCreate<span style=" ">&#40;</span><span style=" ">&#41;</span><br />
geom = ODE_dCreateBox<span style=" ">&#40;</span>space, <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span>, <span style="color: #33ffdd;">1</span><span style=" ">&#41;</span><br />
ODE_dGeomSetBody geom, body<br />
<br />
ODE_dBodySetRotation<span style=" ">&#40;</span>body, <span style="color: #33ffdd;">45</span>,<span style="color: #33ffdd;">155</span>,<span style="color: #33ffdd;">0</span><span style=" ">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
x#=ODE_dBodyGetPitch#<span style=" ">&#40;</span>body<span style=" ">&#41;</span><br />
y#=ODE_dBodyGetYaw#<span style=" ">&#40;</span>body<span style=" ">&#41;</span><br />
z#=ODE_dBodyGetRoll#<span style=" ">&#40;</span>body<span style=" ">&#41;</span><br />
<br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Start angles&nbsp;: 45 , 155 , 0&quot;</span><br />
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Ode angles&nbsp;: &quot;</span>+x+<span style="color: #00ff66;">&quot; , &quot;</span>+y+<span style="color: #00ff66;">&quot; , &quot;</span>+z<br />
</p>
<span style="color: #aaffff; font-weight: bold;">Print</span> <span style="color: #00ff66;">&quot;Maybe ode_pitch=cos(start_yaw)*start_pitch&quot;</span></div>
<hr />
<p>Автор: Jimon (jimon.j1m0n@gmail.com)
</p><!-- 
<p>Pre-expand include size: 242560 bytes
Post-expand include size: 149789 bytes
Template argument size: 130 bytes
Maximum: 2097152 bytes
-->
</p>
<!-- Saved in parser cache with key db1:pcache:idhash:632-0!1!0!!ru!2 and timestamp 20071112103559 -->
<div class="printfooter">
Получено с <a href="zbwabhmq.html">http://blitzetcetera.org/index.php/%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%965_-_%D0%B4%D0%B5%D0%BA%D0%B0%D0%B1%D1%80%D1%8C_2005</a></div>
			<!-- end content -->			<div class="visualClear"></div>				</td>				<td class="rightside">				</td>			</tr>		</table>		</div>	</div>		</div>	
		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</div></body>
<!-- Mirrored from localhost/index.php/%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA_%E2%84%965_-_%D0%B4%D0%B5%D0%BA%D0%B0%D0%B1%D1%80%D1%8C_2005 by HTTrack Website Copier/3.x [XR&CO'2007], Mon, 12 Nov 2007 11:20:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>